(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{1018:function(t,e,n){},1135:function(t,e,n){(function(t){
/*!
 * jQuery Migrate - v3.0.0 - 2016-06-09
 * Copyright jQuery Foundation and other contributors
 */
!function(t,e){"use strict";var n;t.migrateVersion="3.0.0",(n=e.console&&e.console.log&&function(){e.console.log.apply(e.console,arguments)})&&(t&&!/^[12]\./.test(t.fn.jquery)||n("JQMIGRATE: jQuery 3.0.0+ REQUIRED"),t.migrateWarnings&&n("JQMIGRATE: Migrate plugin loaded multiple times"),n("JQMIGRATE: Migrate is installed"+(t.migrateMute?"":" with logging active")+", version "+t.migrateVersion));var r={};function i(n){var i=e.console;r[n]||(r[n]=!0,t.migrateWarnings.push(n),i&&i.warn&&!t.migrateMute&&(i.warn("JQMIGRATE: "+n),t.migrateTrace&&i.trace&&i.trace()))}function a(t,e,n,r){Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return i(r),n}})}t.migrateWarnings=[],void 0===t.migrateTrace&&(t.migrateTrace=!0),t.migrateReset=function(){r={},t.migrateWarnings.length=0},"BackCompat"===document.compatMode&&i("jQuery is not compatible with Quirks Mode");var o,s=t.fn.init,l=t.isNumeric,c=t.find,u=/\[(\s*[-\w]+\s*)([~|^$*]?=)\s*([-\w#]*?#[-\w#]*)\s*\]/,f=/\[(\s*[-\w]+\s*)([~|^$*]?=)\s*([-\w#]*?#[-\w#]*)\s*\]/g;for(o in t.fn.init=function(t){var e=Array.prototype.slice.call(arguments);return"string"==typeof t&&"#"===t&&(i("jQuery( '#' ) is not a valid selector"),e[0]=[]),s.apply(this,e)},t.fn.init.prototype=t.fn,t.find=function(t){var e=Array.prototype.slice.call(arguments);if("string"==typeof t&&u.test(t))try{document.querySelector(t)}catch(n){t=t.replace(f,function(t,e,n,r){return"["+e+n+'"'+r+'"]'});try{document.querySelector(t),i("Attribute selector with '#' must be quoted: "+e[0]),e[0]=t}catch(t){i("Attribute selector with '#' was not fixed: "+e[0])}}return c.apply(this,e)},c)Object.prototype.hasOwnProperty.call(c,o)&&(t.find[o]=c[o]);t.fn.size=function(){return i("jQuery.fn.size() is deprecated; use the .length property"),this.length},t.parseJSON=function(){return i("jQuery.parseJSON is deprecated; use JSON.parse"),JSON.parse.apply(null,arguments)},t.isNumeric=function(e){var n,r,a=l(e),o=(r=(n=e)&&n.toString(),!t.isArray(n)&&r-parseFloat(r)+1>=0);return a!==o&&i("jQuery.isNumeric() should not be called on constructed objects"),o},a(t,"unique",t.uniqueSort,"jQuery.unique is deprecated, use jQuery.uniqueSort"),a(t.expr,"filters",t.expr.pseudos,"jQuery.expr.filters is now jQuery.expr.pseudos"),a(t.expr,":",t.expr.pseudos,'jQuery.expr[":"] is now jQuery.expr.pseudos');var d=t.ajax;t.ajax=function(){var t=d.apply(this,arguments);return t.promise&&(a(t,"success",t.done,"jQXHR.success is deprecated and removed"),a(t,"error",t.fail,"jQXHR.error is deprecated and removed"),a(t,"complete",t.always,"jQXHR.complete is deprecated and removed")),t};var p=t.fn.removeAttr,h=t.fn.toggleClass,m=/\S+/g;t.fn.removeAttr=function(e){var n=this;return t.each(e.match(m),function(e,r){t.expr.match.bool.test(r)&&(i("jQuery.fn.removeAttr no longer sets boolean properties: "+r),n.prop(r,!1))}),p.apply(this,arguments)},t.fn.toggleClass=function(e){return void 0!==e&&"boolean"!=typeof e?h.apply(this,arguments):(i("jQuery.fn.toggleClass( boolean ) is deprecated"),this.each(function(){var n=this.getAttribute&&this.getAttribute("class")||"";n&&t.data(this,"__className__",n),this.setAttribute&&this.setAttribute("class",n||!1===e?"":t.data(this,"__className__")||"")}))};var g=!1;t.swap&&t.each(["height","width","reliableMarginRight"],function(e,n){var r=t.cssHooks[n]&&t.cssHooks[n].get;r&&(t.cssHooks[n].get=function(){var t;return g=!0,t=r.apply(this,arguments),g=!1,t})}),t.swap=function(t,e,n,r){var a,o,s={};for(o in g||i("jQuery.swap() is undocumented and deprecated"),e)s[o]=t.style[o],t.style[o]=e[o];for(o in a=n.apply(t,r||[]),e)t.style[o]=s[o];return a};var v=t.data;t.data=function(e,n,r){var a;return n&&n!==t.camelCase(n)&&(a=t.hasData(e)&&v.call(this,e))&&n in a?(i("jQuery.data() always sets/gets camelCased names: "+n),arguments.length>2&&(a[n]=r),a[n]):v.apply(this,arguments)};var y=t.Tween.prototype.run;t.Tween.prototype.run=function(e){t.easing[this.easing].length>1&&(i('easing function "jQuery.easing.'+this.easing.toString()+'" should use only first argument'),t.easing[this.easing]=t.easing[this.easing].bind(t.easing,e,this.options.duration*e,0,1,this.options.duration)),y.apply(this,arguments)};var b=t.fn.load,w=t.event.fix;t.event.props=[],t.event.fixHooks={},t.event.fix=function(e){var n,r=e.type,a=this.fixHooks[r],o=t.event.props;if(o.length)for(i("jQuery.event.props are deprecated and removed: "+o.join());o.length;)t.event.addProp(o.pop());if(a&&!a._migrated_&&(a._migrated_=!0,i("jQuery.event.fixHooks are deprecated and removed: "+r),(o=a.props)&&o.length))for(;o.length;)t.event.addProp(o.pop());return n=w.call(this,e),a&&a.filter?a.filter(n,e):n},t.each(["load","unload","error"],function(e,n){t.fn[n]=function(){var t=Array.prototype.slice.call(arguments,0);return"load"===n&&"string"==typeof t[0]?b.apply(this,t):(i("jQuery.fn."+n+"() is deprecated"),t.splice(0,0,n),arguments.length?this.on.apply(this,t):(this.triggerHandler.apply(this,t),this))}}),t(function(){t(document).triggerHandler("ready")}),t.event.special.ready={setup:function(){this===document&&i("'ready' event is deprecated")}},t.fn.extend({bind:function(t,e,n){return i("jQuery.fn.bind() is deprecated"),this.on(t,null,e,n)},unbind:function(t,e){return i("jQuery.fn.unbind() is deprecated"),this.off(t,null,e)},delegate:function(t,e,n,r){return i("jQuery.fn.delegate() is deprecated"),this.on(e,t,n,r)},undelegate:function(t,e,n){return i("jQuery.fn.undelegate() is deprecated"),1===arguments.length?this.off(t,"**"):this.off(e,t||"**",n)}});var x=t.fn.offset;t.fn.offset=function(){var e,n=this[0],r={top:0,left:0};return n&&n.nodeType?(e=(n.ownerDocument||document).documentElement,t.contains(e,n)?x.apply(this,arguments):(i("jQuery.fn.offset() requires an element connected to a document"),r)):(i("jQuery.fn.offset() requires a valid DOM element"),r)};var k=t.param;t.param=function(e,n){var r=t.ajaxSettings&&t.ajaxSettings.traditional;return void 0===n&&r&&(i("jQuery.param() no longer uses jQuery.ajaxSettings.traditional"),n=r),k.call(this,e,n)};var _=t.fn.andSelf||t.fn.addBack;t.fn.andSelf=function(){return i("jQuery.fn.andSelf() replaced by jQuery.fn.addBack()"),_.apply(this,arguments)};var T=t.Deferred,A=[["resolve","done",t.Callbacks("once memory"),t.Callbacks("once memory"),"resolved"],["reject","fail",t.Callbacks("once memory"),t.Callbacks("once memory"),"rejected"],["notify","progress",t.Callbacks("memory"),t.Callbacks("memory")]];t.Deferred=function(e){var n=T(),r=n.promise();return n.pipe=r.pipe=function(){var e=arguments;return i("deferred.pipe() is deprecated"),t.Deferred(function(i){t.each(A,function(a,o){var s=t.isFunction(e[a])&&e[a];n[o[1]](function(){var e=s&&s.apply(this,arguments);e&&t.isFunction(e.promise)?e.promise().done(i.resolve).fail(i.reject).progress(i.notify):i[o[0]+"With"](this===r?i.promise():this,s?[e]:arguments)})}),e=null}).promise()},e&&e.call(n,n),n}}(t,window)}).call(this,n(11))},1137:function(t,e,n){var r=n(11),i=n(652),a=n(879);function o(t,e){u.call(this,t,e)}function s(t,e){u.call(this,t,e),this.id="exportTimeline"}function l(t,e){u.call(this,t,e),this.id="helperLines"}function c(t,e){u.call(this,t,e),this.id="overviewAxis"}function u(t,e){this.name=t,this.spec=e||null}function f(t,e){u.call(this,t,e),this.id="trimClinicalTimeline"}i.timeline=function(){var t=["circle","rect"],e=function(){},n=function(){},r=function(){},a=function(){},o=function(){},s="bottom",l=null,c=null,u=null,f=null,d=0,p={format:function(t){return i.time.format("%I %p")(t)},tickTime:i.time.hours,tickInterval:1,tickSize:6,tickValues:null},h=i.scale.category20(),m=null,g="rect",v=0,y=0,b={left:30,right:30,top:30,bottom:30},w=!1,x=0,k=!1,_=!1,T=20,A=5,I=5,D=!0,O=!1,j=!1,M={stroke:"stroke-dasharray",spacing:"4 10"},E={marginTop:25,marginBottom:0,width:1,color:h},S=!1,L={marginTop:25,marginBottom:0,width:1,color:h},C=null;function P(t){var P=t.append("g"),q=t[0][0].getBoundingClientRect(),B=i.select(t[0][0]),H={},z=1,F=0,R=0;!function(){if(l||q.width){if(!l||!q.width)try{l=B.attr("width")}catch(t){console.log(t)}}else try{if(!(l=B.attr("width")))throw"width of the timeline is not set. As of Firefox 27, timeline().with(x) needs to be explicitly set in order to render"}catch(t){console.log(t)}}(),_&&P.each(function(t,e){t.forEach(function(t,e){t.times.forEach(function(t,n){0===e&&0===n?(originTime=t.starting_time,t.starting_time=0,t.ending_time=t.ending_time-originTime):(t.starting_time=t.starting_time-originTime,t.ending_time=t.ending_time-originTime)})})}),(w||0===y||0===v)&&(P.each(function(t,e){t.forEach(function(t,e){var n=0;t.collapse?t.times.forEach(function(t){t.stack=z}):function(t,e){for(var n=-1/0,r=[],i=[],a=t.sort(function(t,e){return parseInt(t.starting_time)-parseInt(e.starting_time)}),o=0;o<a.length;o++)parseInt(a[o].starting_time)===parseInt(a[o].ending_time)&&parseInt(a[o].starting_time)<=parseInt(n)+e||parseInt(a[o].starting_time)!==parseInt(a[o].ending_time)&&parseInt(a[o].starting_time)<parseInt(n)?(i.push(a[o]),parseInt(a[o].ending_time)>n&&(n=parseInt(a[o].ending_time))):(i.length>0&&r.push(i),i=[a[o]],n=parseInt(a[o].ending_time));return r.push(i),r}(t.times,x).forEach(function(t,e){var r=0;t.forEach(function(t,e){t.stack=z+r,r>n&&(n=r),r++})}),w&&-1==Object.keys(H).indexOf(e)&&(H[e]=z,z++),z+=n,t.times.forEach(function(t,e){0===v&&(t.starting_time<F||0===F&&!1===_)&&(F=t.starting_time),0===y&&t.ending_time>R&&(R=t.ending_time)})})}),0===y&&(y=R),0===v&&(v=F));var V=1/(y-v)*(l-b.left-b.right),Q=i.time.scale().domain([v,y]).range([b.left,l-b.right]),N=i.svg.axis().scale(Q).orient(s).tickFormat(p.format).tickSize(p.tickSize);if(null!==p.tickValues?N.tickValues(p.tickValues):N.ticks(p.numTicks||p.tickTime,p.tickInterval),D&&P.append("g").attr("class","axis").attr("transform","translate(0,"+(b.top+(T+I)*z)+")").call(N),j&&P.append("g").attr("class","axis").attr("transform","translate(0,"+(b.top+(T+I)*z)+")").attr(M.stroke,M.spacing).call(N.tickFormat("").tickSize(-(b.top+(T+I)*(z-1)+3),0,0)),P.each(function(i,o){i.forEach(function(i,o){var s=i.times,c=void 0!==i.label;if(void 0!==i.id&&console.warn("d3Timeline Warning: Ids per dataset is deprecated in favor of a 'class' key. Ids are now per data element."),f){var d=(T+I)*H[o];P.selectAll("svg").data(s).enter().insert("rect").attr("class","row-green-bar").attr("x",0+b.left).attr("width",l-b.right-b.left).attr("y",d).attr("height",T).attr("fill",f)}if(P.selectAll("svg").data(s).enter().append(Z).attr("x",Y).attr("y",g).attr("width",G).attr("cy",function(t,e){return g(t)+T/2}).attr("cx",Y).attr("r",W).attr("height",W).style("fill",function(t,e){var n;return"display"in t&&-1!==t.display.split(" ").indexOf("unfilled")?"rgb(255, 255, 255)":t.color?t.color:m?(n=t[m],h(n||i[m])):h(c?i.label:o)}).style("stroke",function(t,e){if("display"in t&&-1!==t.display.split(" ").indexOf("unfilled"))return t.color?t.color:h(c?i.label:o)}).attr("filter",function(t,e){return"display"in t&&-1!==t.display.split(" ").indexOf("dropshadow")?"url(#dropshadow)":""}).on("mousemove",function(t,n){e(t,o,i)}).on("mouseover",function(t,e){n(t,e,i)}).on("mouseout",function(t,e){r(t,e,i)}).on("click",function(t,e){a(t,o,i)}).attr("class",function(t,e){return i.class?"timelineSeries_"+i.class:"timelineSeries_"+o}).attr("id",function(t,e){return i.id&&!t.id?"timelineItem_"+i.id:t.id?t.id:"timelineItem_"+o+"_"+e}),P.selectAll("svg").data(s).enter().append("text").attr("x",J).attr("y",function(t,e){return w?b.top+(T+I)*H[o]+.75*T:b.top+.75*T}).text(function(t){return t.label}),u){var p=T+I/2+b.top+(T+I)*H[o];t.append("svg:line").attr("class","row-seperator").attr("x1",0+b.left).attr("x2",l-b.right).attr("y1",p).attr("y2",p).attr("stroke-width",1).attr("stroke",u)}function g(t,e){return w?b.top+(T+I)*t.stack:b.top}c&&t.append("text").attr("class","timeline-label").attr("transform","translate(0,"+(.75*T+b.top+(T+I)*H[o])+")").text(c?i.label:i.id).on("click",function(t,e){a(t,o,i)}),void 0!==i.icon&&t.append("image").attr("class","timeline-label").attr("transform","translate(0,"+(b.top+(T+I)*H[o])+")").attr("xlink:href",i.icon).attr("width",b.left).attr("height",T)})}),l>q.width){var U=i.behavior.zoom().x(Q).on("zoom",function(){var t=Math.min(0,Math.max(q.width-l,i.event.translate[0]));U.translate([t,0]),P.attr("transform","translate("+t+",0)"),o(t*V,Q),C=t});t.attr("class","scrollable").call(U),U.translate([d,0]),U.event(t)}k&&P.selectAll(".tick text").attr("transform",function(t){return"rotate("+k+")translate("+(this.getBBox().width/2+10)+","+this.getBBox().height/2+")"});var X=P[0][0].getBoundingClientRect();function Z(t,e){var n;return"display"in t?"rect"===t.display||"circle"===t.display?n=t.display:"square"===t.display?n="rect":-1!==t.display.split(" ").indexOf("circle")?n="circle":console.warn("d3Timeline Warning: unrecognized display attribute: "+t.display):n=g,document.createElementNS(i.ns.prefix.svg,n)}function W(t,e){return parseInt(t.size)||T}function G(t,e){if("display"in t&&"rect"!==t.display)return T;var n=(t.ending_time-t.starting_time)*V;return n<A&&(n=A),n}function Y(t,e){return"display"in t&&"square"===t.display?b.left+(t.starting_time-v)*V-T/2:b.left+(t.starting_time-v)*V}function J(t,e){return b.left+(t.starting_time-v)*V+5}function $(e,n){t.append("svg:line").attr("x1",e).attr("y1",n.marginTop).attr("x2",e).attr("y2",c-n.marginBottom).style("stroke",n.color).style("stroke-width",n.width)}(function(){if(c||B.attr("height"))c?B.attr("height",c):c=B.attr("height");else{if(!T)throw"height of the timeline is not set";c=X.height+X.top+3-q.top,i.select(t[0][0]).attr("height",c)}})(),S&&P.each(function(t,e){t.forEach(function(t){t.times.forEach(function(t){$(Q(t.starting_time),L),$(Q(t.ending_time),L)})})}),O&&$(Q(new Date),E)}return P.margin=function(t){return arguments.length?(b=t,P):b},P.orient=function(t){return arguments.length?(s=t,P):s},P.itemHeight=function(t){return arguments.length?(T=t,P):T},P.itemMinWidth=function(t){return arguments.length?(A=t,P):A},P.itemMargin=function(t){return arguments.length?(I=t,P):I},P.height=function(t){return arguments.length?(c=t,P):c},P.width=function(t){return arguments.length?(l=t,P):l},P.display=function(e){return arguments.length&&-1!=t.indexOf(e)?(g=e,P):g},P.tickFormat=function(t){return arguments.length?(p=t,P):p},P.hover=function(t){return arguments.length?(e=t,P):e},P.mouseover=function(t){return arguments.length?(n=t,P):t},P.mouseout=function(t){return arguments.length?(r=t,P):t},P.click=function(t){return arguments.length?(a=t,P):a},P.scroll=function(t){return arguments.length?(o=t,P):o},P.colors=function(t){return arguments.length?(h=t,P):h},P.beginning=function(t){return arguments.length?(v=t,P):v},P.ending=function(t){return arguments.length?(y=t,P):y},P.rotateTicks=function(t){return k=t,P},P.stack=function(){return w=!w,P},P.stackSlack=function(){return arguments.length?P:x},P.relativeTime=function(){return _=!_,P},P.showBorderLine=function(){return S=!S,P},P.showBorderFormat=function(t){return arguments.length?(L=t,P):L},P.showToday=function(){return O=!O,P},P.showTodayFormat=function(t){return arguments.length?(E=t,P):E},P.colorProperty=function(t){return arguments.length?(m=t,P):m},P.rowSeperators=function(t){return arguments.length?(u=t,P):u},P.background=function(t){return arguments.length?(f=t,P):f},P.showTimeAxis=function(){return D=!D,P},P.showTimeAxisTick=function(){return j=!j,P},P.showTimeAxisTickFormat=function(t){return arguments.length?(M=t,P):M},P.translate=function(t){return arguments.length?(d=t,P):d},P.scrolledX=function(t){return arguments.length?(C=t,P):C},P},o.prototype.run=function(t,e){r(e.configUlId).html(""),t.plugins().forEach(function(t){if(t.obj.name){var n=r('<input type="checkbox" id="'+t.obj.id+'">').attr("checked",t.enabled);r(e.configUlId).append(n).append("<li>"+t.obj.name+"</li>")}}),r(e.configUlId+" input").on("change",function(){n(this.id,this.checked)});var n=function(e,n){t.plugins().forEach(function(t){e===t.obj.id&&(t.enabled=n)}),t()}},o.prototype.remove=function(t,e){r(this.spec.configUlId).remove()},Object.setPrototypeOf(o.prototype,u.prototype),s.prototype.run=function(t,e){return r(e.exportDivId).css("visibility","visible"),{generateSVG:function(){r("#addtrack").css("visibility","hidden");var t=document.getElementsByTagName("path")[0];t.setAttribute("stroke","black"),t.setAttribute("fill","none"),t=document.getElementsByTagName("line");for(var n=0;n<t.length;n++)t[n].setAttribute("stroke","black"),t[n].setAttribute("fill","none");var i=document.querySelector(e.timelineDiv+" svg"),a=(new XMLSerializer).serializeToString(i),o=document.createElement("a");a.match(/^<svg[^>]+xmlns="http\:\/\/www\.w3\.org\/2000\/svg"/)||(a=a.replace(/^<svg/,'<svg xmlns="http://www.w3.org/2000/svg"')),a.match(/^<svg[^>]+"http\:\/\/www\.w3\.org\/1999\/xlink"/)||(a=a.replace(/^<svg/,'<svg xmlns:xlink="http://www.w3.org/1999/xlink"')),a='<?xml version="1.0" standalone="no"?>\r\n'+a;var s="data:image/svg+xml;charset=utf-8,"+encodeURIComponent(a);o.download="clinical-timeline.svg",o.href=s,o.click(),r("#addtrack").css("visibility","visible")},generatePNG:function(t){r("#addtrack").css("visibility","hidden");var n=document.getElementsByTagName("path")[0];n.setAttribute("stroke","black"),n.setAttribute("fill","none"),n=document.getElementsByTagName("line");for(var i=0;i<n.length;i++)n[i].setAttribute("stroke","black"),n[i].setAttribute("fill","none");var a=(new XMLSerializer).serializeToString(document.querySelector(e.timelineDiv+" svg")),o=document.getElementById("canvas"),s=o.getContext("2d"),l=self.URL||self.webkitURL||self,c=new Image,u=new Blob([a],{type:"image/svg+xml;charset=utf-8"}),f=l.createObjectURL(u);c.onload=function(){s.drawImage(c,0,0);var e=o.toDataURL("image/png");document.querySelector("#png-container").innerHTML='<img src="'+e+'"/>';var n=document.createElement("a");n.download="clinical-timeline.png",t&&(n.href=o.toDataURL("image/png").replace("image/png","image/octet-stream")),n.click(),l.revokeObjectURL(e),n.remove()},c.src=f,r("#addtrack").css("visibility","visible")},generatePDF:function(){this.generatePNG(!1),setTimeout(function(){html2canvas(r("#canvas"),{onrendered:function(t){var e=document.getElementById("canvas").toDataURL("image/png"),n=new jsPDF("p","mm");n.addImage(e,"PNG",0,0),n.save("clinical-timeline.pdf")}})},50)}}},s.prototype.remove=function(t,e){r(e.exportDivId).css("visibility","hidden")},Object.setPrototypeOf(s.prototype,u.prototype),l.prototype.run=function(t,e){i.selectAll(t.divId()+" [id^='timelineItem']").on("click",function(e){if(1===t.zoomFactor()){var n=i.select(t.divId()+" svg").append("g").attr("class","helper-line-group"),a=parseInt(this.getAttribute("x")),o=parseInt(this.getAttribute("y")),s=parseInt(this.getAttribute("width")),l=parseInt(this.getAttribute("height"));n.append("line").attr("x1",a-("circle"===e.display?s:0)).attr("y1",o+l/2).attr("x2",120).attr("y2",o+l/2).attr("stroke-width",1).attr("stroke","#aaa").attr("class","helper-line x"),n.append("line").attr("x1",a).attr("y1",o).attr("x2",a).attr("y2",40).attr("stroke-width",1).attr("stroke","#aaa").attr("class","helper-line y"),n.append("rect").attr("width",120).attr("height",14).attr("x",0).attr("y",o-7).attr("stroke-width",2).attr("stroke","rgb(57, 106, 177)").style("fill","none"),n.append("path").style("stroke","rgb(146, 36, 40)").style("fill","none").attr("d","M "+(a-5)+" 30 L "+a+" 20 L "+(a+5)+" 30 Z"),n.append("text").attr("x",this.getAttribute("x")).attr("y",40).text(t.formatTime(t.daysToTimeObject(e.starting_time),"days")).style("text-anchor","middle").style("font-size","10px"),r(this).qtip("hide"),setTimeout(function(){n.remove()},1e3)}})},Object.setPrototypeOf(l.prototype,u.prototype),c.prototype.run=function(t,e){var n=t.getReadOnlyVars(),r=n.margin,a=t.overviewAxisWidth(),o=n.chart,s=t.zoomFactor(),l=t.divId(),c=i.select(l+" .overview"),u=t.computeZoomLevel(n.minDays,n.maxDays,t.width()),f=t.getTickValues(n.minDays,n.maxDays,u),p=f[0],h=f[f.length-1],m=i.time.scale().domain([d.roundDown(n.minDays,d.getDifferenceTicksDays(u)),d.roundUp(n.maxDays,d.getDifferenceTicksDays(u))]).range([0+r.overviewAxis.left,a-r.overviewAxis.right]),g=t.computeZoomLevel(n.minDays,n.maxDays,t.width()*s),v=m(d.roundDown(n.minDays,d.getDifferenceTicksDays(g)))-m(d.roundDown(n.minDays,d.getDifferenceTicksDays(u))),y=m(d.roundUp(n.maxDays,d.getDifferenceTicksDays(u)))-m(d.roundUp(n.maxDays,d.getDifferenceTicksDays(g))),b=[{height:2,width:a,x:0,y:24,fill:"#ccc"},{height:2,width:a,x:0,y:44,fill:"#ccc"},{height:18,width:2,x:0,y:26,fill:"#ccc"},{height:18,width:2,x:a-2,y:26,fill:"#ccc"}],w=i.time.scale().domain([p,h]).range([0+r.overviewAxis.left,a-r.overviewAxis.right]),x=i.svg.axis().scale(w).orient("bottom").tickFormat(function(e){return t.formatTime(t.daysToTimeObject(e.valueOf()),u)}).ticks(f.length).tickValues(f).tickSize(3).tickPadding(4),k=i.svg.axis().scale(w).orient("top").tickFormat(function(e){return t.formatTime(t.daysToTimeObject(e.valueOf()),u)}).ticks(f.length).tickValues(f).tickSize(3).tickPadding(0);c.style("display","initial"),c.append("g").attr("class","x axis overview-axis").attr("transform","translate(0,25)").call(x),c.append("g").attr("class","x axis overview-axis overview-axis-mirror").attr("transform","translate(0,44)").call(k),c.selectAll(l+" rect.overview-border").data(b).enter().append("rect").attr("height",function(t){return t.height}).attr("width",function(t){return t.width}).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("fill",function(t){return t.fill}).attr("class","overview-border");var _=o.width(),T=(a-r.overviewAxis.left-r.overviewAxis.right)/s,A=i.time.scale().domain([0,-_]).range([0+v,a-y]),I=i.time.scale().domain([0+v,a-y]).range([0,-_]),D=i.behavior.drag().on("drag",function(e,n){if(o.scrolledX()){var r=A(o.scrolledX());i.select(l+" .overview-rectangle").attr("x",r),t.overviewX(r)}}),O=i.behavior.drag().on("drag",function(e,n){var r=parseInt(i.select(l+" .overview-rectangle").attr("x"))+i.event.dx;r>v&&r<a-T-y&&s>1&&(i.select(l+" svg g").attr("transform","translate("+I(r)+",0)"),i.select(l+" .overview-rectangle").attr("x",r),t.overviewX(r))});c.append("rect").attr("height",16).attr("width",T).attr("x",t.overviewX()).attr("y",27).attr("fill","rgba(25,116,255, 0.4)").attr("class","overview-rectangle").style("cursor","move").call(O);i.select(l+" svg").call(D)},Object.setPrototypeOf(c.prototype,u.prototype),u.prototype.run=function(t,e){console.log("A plugin must have a run function to be functional")},u.prototype.remove=function(t,e){},f.prototype.run=function(t,e){if(1===t.zoomFactor()){var n=[],a=[],o=[],s=[],l=t.divId(),c=i.select(t.divId()+" .timeline"),u=t.getReadOnlyVars().maxDays,f=t.getReadOnlyVars().minDays,p=t.width(),h=t.getReadOnlyVars().margin,m=t.computeZoomLevel(f,u,p),g=t.getTickValues(f,u,m),v=[{x:75,y:0},{x:80,y:5},{x:85,y:-5},{x:90,y:5},{x:95,y:-5},{x:100,y:5},{x:105,y:-5},{x:110,y:0}],y=Math.max(.2*(u-f),d.getDifferenceTicksDays(m)),b=i.svg.line().x(function(t){return t.x}).y(function(t){return t.y}).interpolate("linear"),w=g.map(function(t){return Math.round(t)}),x=[w[0],w[w.length-1]];i.select(t.divId()+" > svg > g > g.axis").style("visibility","hidden"),i.selectAll(l+" .timeline g rect,"+l+" .timeline g circle").each(function(t,e){for(var r=parseInt(t.starting_time);r<=parseInt(t.ending_time)+parseInt(d.getDifferenceTicksDays(m));r+=d.getDifferenceTicksDays(m))-1===n.indexOf(r)&&n.push(parseInt(r))}),n.sort(function(t,e){return t-e}),n.forEach(function(t,e){if(t>w[0]&&t<w[w.length-1]){for(var n=0;n<w.length-1&&!(t>=w[n]&&t<=w[n+1]);n++);-1===x.indexOf(w[n])&&n!==w.length-1&&x.push(w[n]),-1===x.indexOf(w[n+1])&&n!==w.length-1&&x.push(w[n+1])}}),x.sort(function(t,e){return t-e});var k=0;x.forEach(function(t,e){if(e<x.length-1){var n=x[e],r=x[e+1],i=e+1,s=parseInt((x[e+1]-x[e])/d.getDifferenceTicksDays(m))-1;if(1===s)x.push(Math.round((n+r)/2));else if(r-n>y)(i-k>1||0===k&&r-n>d.getDifferenceTicksDays(m))&&(a.push(i),o.push(r)),k=i;else if(s>1)for(var l=0;l<s;l++)x.push(n+(l+1)*d.getDifferenceTicksDays(m))}}),x.sort(function(t,e){return t-e}),a=[];for(var _=0;_<o.length;_++)a.push(x.indexOf(o[_]));for(var T=i.time.scale().domain([h.left,p-h.right]).range([h.left,p-h.right]),A=0,I=0;I<x.length;I++){a.indexOf(I)>-1&&(A+=30);var D=30*a.length;s.push(h.left+A+I*((p-h.right-h.left-D)/(x.length-1)))}var O=i.svg.axis().scale(T).orient("top").tickValues(s).tickFormat(function(e,n){return t.formatTime(t.daysToTimeObject(x[n]),m)}),j=(c.append("g").attr("class","x axis").attr("transform","translate(0,20)").call(O),c.append("g").attr("class","kink"));for(_=0;_<x.length;_++)if(a.indexOf(_)>-1){var M=(s[_-1]+s[_])/2;j.append("rect").attr("height",10).attr("width",35).attr("class","kink-bg").attr("x",M-17.5).attr("y",15).attr("fill","white"),j.append("path").attr("d",b(v)).attr("stroke","black").attr("stroke-width",1).attr("fill","none").attr("class","kink-line").attr("transform","translate("+(M-92.5)+",20)")}i.selectAll(l+" .kink-bg, "+l+" .kink-line").style("cursor","pointer").on("click",function(){t.pluginSetOrGetState("trimClinicalTimeline",!1),xAxisBBox=i.select(t.divId()+" > svg > g > g.axis")[0][0].getBBox(),i.select(t.divId()+"> svg > g").insert("rect").attr("x",xAxisBBox.x).attr("y",4).attr("width",xAxisBBox.width).attr("height",xAxisBBox.height).attr("fill","rgba(0,0,0,0)").style("cursor","pointer").on("click",function(){t.pluginSetOrGetState("trimClinicalTimeline",!0)}).append("svg:title").text("Click to trim the timeline")}).append("svg:title").text("Click to expand the timeline");var E=(s[1]-s[0])/(i.transform(i.select(r(l+" .axis .tick")[1]).attr("transform")).translate[0]-i.transform(i.select(r(l+" .axis .tick")[0]).attr("transform")).translate[0]);i.selectAll(l+" [id^=timelineItem]").each(function(t){"circle"===this.tagName?i.select(this).attr("cx",S(t.starting_time)).attr("r",i.select(this).attr("r")):"rect"===this.tagName?(i.select(this).attr("x",S(t.starting_time)),t.hasOwnProperty("display")&&"square"===t.display||i.select(this).attr("width",i.select(this).attr("width")*E)):console.log("No such element as "+this)})}function S(t){var e=d.getLowerBoundIndex(x,t),n=e+1;return n>x.length-1?s[e]:s[e]+(t-x[e])*(s[n]-s[e])/(x[n]-x[e])}},Object.setPrototypeOf(f.prototype,u.prototype);var d={timelineConstants:{ALLOWED_ZOOM_LEVELS:["days","3days","10days","months","years"],DAYS_PER_YEAR:365,DAYS_PER_MONTH:30},getDifferenceTicksDays:function(t){var e;switch(t){case"days":e=1;break;case"3days":e=3;break;case"10days":e=10;break;case"months":e=30;break;case"years":e=365}return e},getLowerBoundIndex:function(t,e){for(var n=0,r=t.length-1;n<r;){var i=Math.round((n+r)/2);t[i]>e?r=i-1:n=i}return n},roundUp:function(t,e){var n=t%e;return 0===e||0===n?t:t<0?-1*d.roundDown(-1*t,e):Math.round(t+e-n)},roundDown:function(t,e){var n=t%e;return 0===e||0===n?t:t<0?-1*d.roundUp(-1*t,e):Math.round(t-n)}};function p(t,e){u.call(this,t,e),this.id="verticalLine"}function h(t,e){u.call(this,t,e),this.id="zoom"}function m(t){for(var e=i.selectAll(t+" g circle,rect"),n=[],r=0;r<e[0].length;r++){var a=e[0][r];a.getAttribute("id")&&a.getAttribute("id").startsWith("timelineItem")&&n.push(a)}return n.sort(function(t,e){return g(t).start-g(e).start}),n}function g(t){if("circle"===t.localName)var e=t.getAttribute("cx")?t.getAttribute("cx"):t.getAttribute("x"),n=parseFloat(e)-parseFloat(t.getAttribute("width")),r=parseFloat(e)+parseFloat(t.getAttribute("width"));else r=(n=parseFloat(t.getAttribute("x")))+parseFloat(t.getAttribute("width"));return{start:n,end:r}}p.prototype.run=function(t,e){var n=t.divId(),a=i.select(n+" svg").append("g").attr("class","hover-line"),o=a.append("line").attr("x1",0).attr("x2",0).attr("y1",20).attr("y2",268).style("stroke","#ccc"),s=i.select(n+" svg")[0][0].getBoundingClientRect().height,l=a.append("text").attr("class","hover-text").attr("y",s-10).attr("font-size",12).attr("fill","#888"),c=e.hoverBegin,u=e.hoverEnd,f=i.time.scale().domain([c,u]).range([t.getReadOnlyVars().beginning,t.getReadOnlyVars().ending]),d=!0;a.style("opacity",0),i.select(n+" svg").on("mousemove",function(){var t=i.mouse(this)[0];t>c&&t<u&&(l.text(parseInt(f(t))+"d"),l.attr("x",t+4),o.attr("x1",t).attr("x2",t),a.style("opacity",1),d&&r(n+" .timeline g rect, "+n+" .timeline g circle").each(function(e){var i=r(n+" .timeline g rect, "+n+" .timeline g circle")[e],a=parseInt(i.getBBox().x),o=parseInt(i.getBBox().width);t>a+o/2-2&&t<a+o/2+2?(r(i).qtip("disable",!1),r(i).qtip("show")):(r(i).qtip("hide"),r(i).qtip("disable",!0))}))}).on("mouseout",function(){a.style("opacity",0)});var p=e.tooltipControllerId;r(p).css("visibility","visible"),r(p+" a").on("click",function(){d?(r(p+" a").text("Show tooltips on vertical-line"),d=!1):(r(p+" a").text("Hide tooltips on vertical-line"),d=!0)})},p.prototype.remove=function(t,e){r(e.tooltipControllerId).css("visibility","hidden")},Object.setPrototypeOf(p.prototype,u.prototype),h.prototype.run=function(t,e){var n=t.getReadOnlyVars(),a=n.maxDays,o=n.minDays,s=n.beginning,l=n.ending,c=n.margin,u=t.divId(),f=t.width(),p=d.roundDown,h=d.roundUp,v=t.overviewAxisWidth(),y=n.chart,b=i.select(u+" svg"),w=i.select(u+" svg g"),x=w[0][0].getBoundingClientRect();if(1===t.zoomFactor()){if("days"!==t.computeZoomLevel(o,a,f*t.zoomFactor())){var k=i.time.scale().domain([s,l]).range([c.left-10,f-c.right+10]),_=i.svg.brush().x(k).on("brush",function(){i.event.target.extent()}).on("brushend",function(){var e=parseInt(i.select(u+" .extent").attr("x")),n=e+parseInt(i.select(u+" .extent").attr("width"));if(e+2>n){var s,l=(s=2)*f/4;n=Math.max(0,n-f/4),e=Math.min(f,e+f/4)}else{var w,x,k=function(t,e){for(var n=m(t),r=0;r<n.length;r++){var a=n[r];if(e<g(a).start+10){var o,s="#"+a.getAttribute("id");return i.select(s).each(function(t){o=t.ending_time?t.ending_time:t.starting_time}),{id:s,day:o}}}return null}(u,e);x=k?k.id:null,w=k?k.day:null;var T=function(t,e){for(var n=m(t),r=0;r<n.length;r++){var a=n[r];if(e<g(a).end-10){var o,s=a.getAttribute("id");return i.select("#"+s).each(function(t){o=t.starting_time}),o}}return null}(u,n);s=s||.9*(a-o)/(T-w)}var A=t.computeZoomLevel(o,a,f),I=i.time.scale().domain([p(o,d.getDifferenceTicksDays(A)),h(a,d.getDifferenceTicksDays(A))]).range([0+c.overviewAxis.left,v-c.overviewAxis.right]);t.overviewX(void 0!==w?w:I(_.extent()[0].valueOf())),t.zoomFactor(s),t.zoomFactor()>0?t.zoomFactor(Math.min(t.zoomFactor(),t.computeZoomFactor("days",o,a,f))):t.zoomFactor(t.computeZoomFactor("days",o,a,f)),r("."+u.substr(1)+"-qtip").qtip("hide"),i.select(u).style("visibility","hidden"),t(),i.select(u).style("visibility","visible"),l?t.translateX(-l):w&&w>o?(l=parseFloat(i.select(x)[0][0].getAttribute("x"))-200,t.translateX(-l)):t.translateX(0),i.select(u).style("visibility","hidden"),t(),i.select(u).style("visibility","visible"),i.select(u+" svg").insert("rect").attr("transform","translate("+(parseInt(b.attr("width"))-72)+", "+parseInt(b.attr("height")-16)+")").attr("width",68).attr("height",14).attr("ry",2).attr("rx",2).style("stroke-width",1).style("fill","lightgray").style("stroke","gray"),i.select(u+" svg").insert("text").attr("transform","translate("+(parseInt(b.attr("width"))-70)+", "+parseInt(b.attr("height")-5)+")").attr("class","timeline-label").text("Reset zoom").style("cursor","zoom-out").attr("id","timelineZoomOut").on("click",function(){t.zoomFactor(1),t.overviewX(c.overviewAxis.left),r("."+u.substr(1)+"-qtip").qtip("hide"),i.select(u).style("visibility","hidden"),t(),i.select(u).style("visibility","visible"),y.scrolledX(null),this.remove()})});w.insert("g",".axis").attr("id","overlayBrush").attr("class","brush").call(_).selectAll(u+" .extent,"+u+" .background,"+u+" .resize rect").attr("height",x.height+20).attr("y",0).style("cursor","zoom-in"),T(u,b,"Click + drag to zoom","hidden",120),i.select(u+" .background").on("mouseover",function(){i.select(u+" #timelineZoomExplanation").style("visibility","visible")}).on("mouseout",function(){i.select(u+" #timelineZoomExplanation").style("visibility","hidden")})}}else T(u,b,"Scroll/drag to move","visible",180),i.select(u+" svg").style("cursor","move");function T(t,e,n,r,a){i.select(t+" svg").insert("text").attr("transform","translate("+(parseInt(e.attr("width"))-a)+", "+parseInt(e.attr("height")-5)+")").attr("class","timeline-label").text("").attr("id","timelineZoomExplanation").text(n).style("visibility",r)}},Object.setPrototypeOf(h.prototype,u.prototype);var v=function(){return function(t){var e=a.groupBy(t,"eventType"),n=[];return a.each(e,function(t){var e,r,i,a;n.push((r={label:(i=(e=t)[0].eventType,/(?=.*[a-z])(?=.*[A-Z])/.test(i)||/[A-Z]+[a-z]{0}/.test(i)&&i.length<5?i:(a=i).charAt(0).toUpperCase()+a.slice(1).toLowerCase()),visible:!0,times:[]},e.forEach(function(t){var e={starting_time:t.startDate,ending_time:null!==t.stopDate?t.stopDate:t.startDate,display:null!==t.stopDate?"rect":"circle",tooltip_tables:[Object.keys(t.eventData).map(function(e){return[e,t.eventData[e]]})]};e.tooltip_tables[0].push(["START_DATE",t.startDate]),null!==t.stopDate&&e.tooltip_tables[0].push(["STOP_DATE",t.stopDate]),r.times.push(e)}),r))}),n}}();!function(){function t(t){required_track_attrs=["label","times","visible"];for(var n=0;n<required_track_attrs.length;n++)if(!(required_track_attrs[n]in t))throw required_track_attrs[n]+" not in track";!function(t){for(var n=0;n<t.length;n++)(function(t){for(var n=0;n<t.length;n++)e(t[n])})(t[n].tooltip_tables)}(t.times)}function e(t){if(!t)throw"tooltip_table err no table: "+t;for(var e=0;e<t.length;e++){if(!t[e])throw"tooltip_table err missing array: "+t[e];if(2!==t[e].length)throw"tooltip_table err expected array of key and value pair: "+t[e]}}}();e.clinicalTimeline=function(){"use strict";var t,e,n,o,s=i.scale.category20(),l={left:200,right:30,top:15,bottom:0,overviewAxis:{left:15,right:15}},c=6,u=8,f=null,p=null,h=1,m=[],g=null,v=0,y=0,b=0,w=0,x=0,k=0,_=l.overviewAxis.left;function T(t,e){return t.filter(function(t){return t.label.trim()===e.trim()})[0]}function A(){var a,d=t.filter(function(t){return t.visible});x=Math.max((a=t,Math.max.apply(Math,a.map(function(t){return Math.max.apply(Math,t.times.map(function(t){return t.ending_time||0}))}))),1),null===g&&(x>300&&(g=5),x>600&&(g=10),x>900&&(g=20)),w=Math.min(function(t){return Math.min.apply(Math,t.map(function(t){return Math.min.apply(Math,t.times.map(function(t){return t.starting_time}))}))}(t),0);var _=A.computeZoomLevel(w,x,p*h),O=A.getTickValues(w,x,_);y=O[0],b=O[O.length-1],k=p-200;var M=i.timeline().stack().margin(l).tickFormat({format:function(t){return A.formatTime(A.daysToTimeObject(t.valueOf()),_)},tickValues:A.getTickValues(w,x,_),tickSize:6}).translate(v).width(p*h).beginning(String(y)).ending(b).stackSlack(g).orient("top").itemHeight(c).itemMargin(u).colors(s);r(f).html("");var E=i.select(f).append("svg").attr("width",p).attr("class","timeline");E.append("rect").attr("width","100%").attr("height","100%").attr("fill","white"),E.append("defs").html('<filter id="dropshadow" x="0" y="0" width="200%" height="200%">  <feOffset result="offOut" in="SourceAlpha" dx="1.5" dy="1.5" />  <feGaussianBlur result="blurOut" in="offOut" stdDeviation="1" />  <feBlend in="SourceGraphic" in2="blurOut" mode="normal" /></filter>'),E.datum(function(t){return t.filter(function(t){return t.collapse&&!D(t)}).forEach(j),t}(d)).call(M),r(f+" [id^='timelineItem']").each(function(){A.addDataPointTooltip(r(this))}),r(f+" [id^='timelineItem']").each(function(){r(this).on({mouseover:function(){I(this,2)},mouseout:function(){I(this,-2)}})}),e&&r(f+" .timeline-label").each(function(e){var n;r(this).prop("__data__")[e].split&&!r(this).prop("__data__")[e].parent_track?function(e,n){function i(e){return function(){var n,i,a;n=e,i=t.filter(function(t){return r.trim(t.label)===r.trim(n)&&t.split})[0],a=t.filter(function(t){return t.split&&t.parent_track===n}).reduce(function(t,e){return t.concat(e.times)},[]),i.times=a,i.visible=!0,i.label=n,delete i.split,t=t.filter(function(t){return!(t.split&&t.parent_track===n)}),A()}}e.qtip({content:{text:"track"},events:{render:function(t,n){var a=r.parseHTML("<div class='track-toolip'></div>"),o=r.parseHTML("<a href='#' onClick='return false' class='hide-track'>Unsplit</a>");r(o).on("click",i(e.prop("innerHTML").split(".")[0])),r(a).append(o),r(this).html(a)}},show:{event:"mouseover"},hide:{fixed:!0,delay:0,event:"mouseout"},style:{classes:"qtip-light qtip-rounded qtip-wide"},position:{my:"top middle",at:"top middle",viewport:r(window)}})}(r(this)):(n=r(this)).qtip({content:{text:"track"},events:{render:function(e,i){var a,o=r.parseHTML("<div class='track-toolip'></div>"),s=r.parseHTML("<a href='#' onClick='return false' class='hide-track'>Hide "+n.prop("innerHTML")+"</a>");r(s).on("click",(a=n.prop("innerHTML"),function(){C(a),A()})),r(o).append(s),r(o).append("<br />"),D(T(t,n.prop("innerHTML")))||(s=r.parseHTML("<a href='#' onClick='return false' class='hide-track'>Collapse/Stack</a>"),r(s).on("click",function(t){return function(){P(t),A()}}(n.prop("innerHTML"))),r(o).append(s),r(o).append("<br />"));var l=r.parseHTML("<a href='#' onClick='return false' class='color-by-attr'>Color by</a>");r(o).append(l);var c=r.parseHTML("&nbsp;<a href='#' onClick='return false'>Clear</a>");r(c).on("click",function(){!function(e){for(var n=T(t,e).times,r=0;r<n.length;r++)"color"in n[r]&&delete n[r].color}(n.prop("innerHTML")),A()}),r(o).append(c),r(o).append("<br />");var u=r.parseHTML("<a href='#' onClick='return false' class='split-by-attr'>Split by</a>");r(o).append(u),r(o).append("<br />");var f=r.parseHTML("<a href='#' onClick='return false' class='split-by-attr'>Size by</a>");r(o).append(f),r(this).html(o),q(r(l),n.prop("innerHTML"),"color"),q(r(u),n.prop("innerHTML"),"split"),q(r(f),n.prop("innerHTML"),"size")}},show:{event:"mouseover"},hide:{fixed:!0,delay:0,event:"mouseout"},style:{classes:"qtip-light qtip-rounded qtip-wide"},position:{my:"top middle",at:"top middle",viewport:r(window)}})}),E.attr("height",parseInt(E.attr("height"))+15),E.insert("text").attr("transform","translate(0,"+E.attr("height")+")").attr("class","timeline-label").style("visibility",e?"":"hidden").text("Add track").attr("id","addtrack"),r("#addtrack").qtip({content:{text:"addtrack"},events:{render:function(e,n){if(invisibleTracks=t.filter(function(t){return!t.visible}),0===invisibleTracks.length)r(this).html("All tracks shown");else{for(var i="",a=0;a<invisibleTracks.length;a++)i+="<a href='#' onClick='return false' class='show-track'>"+invisibleTracks[a].label+"</a><br />";r(this).html(i),r(".show-track").each(function(){r(this).on("click",function(){C(r(this).prop("innerHTML")),r(this).remove(),A()})})}}},show:{event:"mouseover"},hide:{fixed:!0,delay:0,event:"mouseout"},style:{classes:"qtip-light qtip-rounded qtip-wide"},position:{my:"top middle",at:"top middle",viewport:r(window)}}),E.insert("text").attr("transform","translate(0, 15)").attr("class","timeline-label").text("Time since diagnosis"),i.select(f+" .axis").attr("transform","translate(0,20)"),r(f+" .timeline-label").each(function(t,e){e.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}),i.select(f+" svg").insert("rect",".timeline-label").attr("width",130).attr("height",E.attr("height")).attr("x",0).attr("y",0).style("fill","rgb(255, 255, 255)"),r(f+" [id^='timelineItem']").css("cursor","pointer"),i.select(f).append("svg").attr("height",75).attr("width",k).attr("class","overview").style("display","none"),o={beginning:y,ending:b,minDays:w,maxDays:x,margin:l,chart:M},n.forEach(function(t){var e=t.obj;e.run instanceof Function&&t.enabled?e.run(A,t.obj.spec):e.enabled||e.remove(A,t.obj.spec)}),m.forEach(function(t){t.call()})}function I(t,e){r(t).attr("r",parseInt(r(t).attr("r"))+e),r(t).attr("height",parseInt(r(t).attr("height"))+e)}function D(t){var e=!1;return t.times.forEach(function(t){parseInt(t.starting_time)!==parseInt(t.ending_time)&&(e=!0)}),e}function O(t){for(var e=[],n=0;n<t.times.length;n++){var r=t.times[n];if(r.tooltip_tables.length>1)for(var i=0;i<r.tooltip_tables.length;i++)e=e.concat({starting_time:r.starting_time,ending_time:r.ending_time,display:"circle",tooltip_tables:[r.tooltip_tables[i]]});else e=e.concat(r)}t.times=e}function j(t){if(t&&0!==t.times.length){for(var e,n=[],r=[],i=t.times.sort(function(t,e){return parseInt(t.starting_time)-parseInt(e.starting_time)}),o=function(t,e){return 1===e.length?e[0]:{starting_time:t,ending_time:t,display:"dropshadow circle",tooltip_tables:a.reduce(e.map(function(t){return t.tooltip_tables}),function(t,e){return t.concat(e)},[])}},s=0;s<i.length;s++){var l=i[s];parseInt(l.starting_time)===e?r=r.concat(l):(r.length>0&&(n=n.concat(o(e,r))),r=[l],e=parseInt(l.starting_time))}n=n.concat(o(e,r)),t.times=n}}function M(e,n){return a.groupBy(T(t,e).times,function(t){return 1===t.tooltip_tables.length?a.reduce(t.tooltip_tables[0],function(t,e){return t[e[0]]=e[1],t},{})[n]:void 0})}function E(t,e){"string"==typeof e&&(e=[e]);for(var n,r=[t],i=0;i<e.length;i++){var a=e[i];n=[];for(var o=0;o<r.length;o++)n=n.concat(S(r[o],a));r=n}}function S(e,n){O(T(t,e));var r=M(e,n);if("undefined"in r)return[];var i=a.findIndex(t,function(t){return t.label===e}),o=t[i].split?e.match(new RegExp("^ *"))[0]:"";o+="    ",(t=t.filter(function(t){return t.label!==e})).splice(i,0,{label:e,times:[],visible:!0,split:!0});for(var s=a.sortBy(Object.keys(r),function(t){return a.min(a.pluck(r[t],"starting_time"))}),l=0;l<s.length;l++)t.splice(i+l+1,0,{label:o+s[l],times:r[s[l]],visible:!0,split:!0,parent_track:e});return s.map(function(t){return o+t})}function L(e,n,r,a){var o=T(t,e).times.map(function(t){return 1===t.tooltip_tables.length?parseFloat(String(t.tooltip_tables[0].filter(function(t){return t[0]===n})[0][1]).replace(/[^\d.-]/g,"")):void 0}),s=i.scale.linear().domain([i.min(o),i.max(o)]).range([r,a]);T(t,e).times.forEach(function(t){1===t.tooltip_tables.length&&(t.size=s(parseFloat(String(t.tooltip_tables[0].filter(function(t){return t[0]===n})[0][1]).replace(/[^\d.-]/g,"")))||r)})}function C(e){var n=T(t,e);n.visible=!n.visible}function P(e){var n=T(t,e);n.collapse?(n.collapse=!1,O(n)):D(n)||(n.collapse=!0)}function q(e,n,i){function o(){!function(t,e){var n=M(t,e);Object.keys(n).forEach(function(t){n[t].forEach(function(e){e.color=s(t)})})}(n,r(this).prop("innerHTML")),A()}function l(){E(n,r(this).prop("innerHTML")),A()}function u(){L(n,r(this).prop("innerHTML"),2,c),A()}e.qtip({content:{text:""},events:{render:function(e,s){"color"===i?clickHandler=o:"split"===i?clickHandler=l:"size"===i?clickHandler=u:console.log("Unknown clickHandler for clinical attributes tooltip.");for(var c=r.parseHTML("<div class='color-by-attr-tooltip'></div>"),f=function(t,e){return a.union.apply(a,T(t,e).times.map(function(t){return a.union.apply(a,t.tooltip_tables.map(function(t){return t.map(function(t){return t[0]})}))}))}(t,n),d=0;d<f.length;d++){var p=r.parseHTML("<a href='#' onClick='return false'>"+f[d]+"</a>");r(p).on("click",clickHandler),r(c).append(p),r(c).append("<br />")}r(this).html(c)}},show:{event:"click"},hide:{fixed:!0,delay:0,event:"mouseout"},style:{classes:"qtip-light qtip-rounded qtip-wide"},position:{my:"left middle",at:"top middle",viewport:r(window)}})}function B(t,e){return Math.max(t,e)-Math.min(t,e)}return A.addDataPointTooltip=function(t){function e(t){return{sDom:"t",bJQueryUI:!0,bDestroy:!0,aaData:t,aoColumnDefs:[{aTargets:[0],sClass:"left-align-td",mRender:function(t,e,n){return"<b>"+t+"</b>"}},{aTargets:[1],sClass:"left-align-td",bSortable:!1}],fnDrawCallback:function(t){r(t.nTHead).hide()},aaSorting:[]}}t.qtip({content:{text:"table"},events:{render:function(n,i){var a,o=r.parseHTML("<div></div>"),s=t.prop("__data__");if("tooltip_tables"in s)for(var l=0;l<s.tooltip_tables.length;l++)0!==l&&r(o).append("<hr />"),a=r.parseHTML("<table style='text-align:left; background-color: white;'></table>"),r(a).dataTable(e(s.tooltip_tables[l])),r(o).append(a);else"tooltip"in s&&(a=r.parseHTML("<table style='text-align:left; background-color: white;'></table>"),r(a).dataTable(e(s.tooltip)),r(o).append(a));r(this).html(o),r(this).addClass(f.substr(1)+"-qtip"),i.elements.target.click(function(t){i.wasClicked?(i.hide(),i.wasClicked=!1):i.wasClicked=!i.wasClicked})},hide:function(t,e){if(e.wasClicked&&"mouseleave"===t.originalEvent.type||!e.wasClicked&&"click"===t.originalEvent.type)try{t.preventDefault()}catch(t){console.log(t.message)}}},show:{event:"mouseover"},hide:{event:"mouseleave"},style:{classes:"qtip-light qtip-rounded qtip-wide"},position:{my:"top middle",at:"bottom middle",viewport:r(window)}})},A.daysToTimeObject=function(t){var e={},n=d.timelineConstants.DAYS_PER_YEAR,r=d.timelineConstants.DAYS_PER_MONTH;return e.daysPerYear=n,e.daysPerMonth=r,e.y=t>0?Math.floor(t/n):Math.ceil(t/n),e.m=t>0?Math.floor(t%n/r):Math.ceil(t%n/r),e.d=Math.floor(t%n%r),e.toDays=function(){return e.y*e.daysPerYear+e.m*e.daysPerMonth+e.d},e.toMonths=function(){return 12*e.y+e.m+e.d/r},e.toYears=function(){return e.y+e.m/12+e.d/n},e},A.formatTime=function(t,e){var n=[];if(d.timelineConstants.ALLOWED_ZOOM_LEVELS.indexOf(e)>-1)if(0===t.y&&0===t.m&&0===t.d)n="0";else switch(e){case"days":case"3days":case"10days":n=function(t){return 12===Math.abs(t.m)&&(t.y=t.y+t.m/12,t.m=0),0!==t.y?0!==t.m?0!==t.d?t.y+"y"+Math.abs(t.m)+"m"+Math.abs(t.d)+"d":t.y+"y"+Math.abs(t.m)+"m":0!==t.d?t.y+"y"+Math.abs(t.d)+"d":t.y+"y":0!==t.m?0!==t.d?t.m+"m"+Math.abs(t.d)+"d":t.m+"m":t.d+"d"}(t);break;case"months":n=function(t){return 12===Math.abs(t.m)&&(t.y=t.y+t.m/12,t.m=0),0!==t.y?0!==t.m?t.y+"y"+Math.abs(t.m)+"m":t.y+"y":t.m+"m"}(t);break;case"years":n=t.y+"y"}else console.log("Undefined zoomLevel");return n},A.computeZoomLevel=function(t,e,n){var r=parseFloat(parseInt(n)/B(parseInt(t),parseInt(e)));return r<1?"years":r<10?"months":r<25?"10days":r<50?"3days":"days"},A.computeZoomFactor=function(t,e,n,r){switch(t){case"years":return.9*B(parseInt(e),parseInt(n))/parseInt(r);case"months":return 19*B(parseInt(e),parseInt(n))/parseInt(r);case"10days":return 34*B(parseInt(e),parseInt(n))/parseInt(r);case"3days":return 49*B(parseInt(e),parseInt(n))/parseInt(r);case"days":return 51*B(parseInt(e),parseInt(n))/parseInt(r);default:throw"Undefined zoomLevel: "+t}},A.getTickValues=function(t,e,n){var r,i=[],a=A.daysToTimeObject(parseInt(e)),o=A.daysToTimeObject(parseInt(t)),s=d.roundDown,l=d.roundUp;if("years"===n)for(r=s(o.toYears(),1);r<=l(a.toYears(),1);r++)i.push(r*a.daysPerYear);else if("months"===n)for(r=s(o.toMonths(),1);r<=l(a.toMonths(),1);r++)i.push(r*a.daysPerMonth+5*parseInt(r/12));else if("10days"===n)for(r=s(o.toDays(),10);r<=l(a.toDays(),10);r+=10)i.push(r);else if("3days"===n)for(r=s(o.toDays(),3);r<=l(a.toDays(),3);r+=3)i.push(r);else for(r=o.toDays();r<=a.toDays();r++)i.push(r);return i},A.enableTrackTooltips=function(t){return arguments.length?(e=t,A):e},A.width=function(t){return arguments.length?(p=t,A):p},A.overviewAxisWidth=function(t){return arguments.length?(k=t,A):k},A.stackSlack=function(){return arguments.length?A:g},A.data=function(e){return arguments.length?(t=e,A):t},A.divId=function(t){return arguments.length?(f=t,A):f},A.plugins=function(t){return arguments.length?(n=t,A):n},A.pluginSetOrGetState=function(t,e){n.forEach(function(n,r){if(n.obj.id===t){if("boolean"!=typeof e)return n.enabled;n.enabled=e,A()}})},A.zoomFactor=function(t){if(!arguments.length)return h;h=t},A.overviewX=function(t){if(!arguments.length)return _;_=t},A.translateX=function(t){if(!arguments.length)return v;v=t},A.getReadOnlyVars=function(){return o},A.collapseAll=function(){var e=t.filter(function(t){return!D(t)});return e.forEach(j),e.forEach(function(t){t.collapse=!0}),A},A.orderTracks=function(e){if(!arguments.length)return t=a.sortBy(t,"label"),A;for(var n,r=[],i=0;i<e.length;i++)(n=T(t,e[i]))&&(r=r.concat(n));return r=r.concat(a.sortBy(t.filter(function(t){return-1===e.indexOf(t.label)}),"label")),t=r,A},A.orderTrackTooltipTables=function(e,n){var r=T(t,e);if(0===r.times.length)return A;var i,o=a.uniq(r.times.map(function(t){return t.tooltip_tables.map(function(t){return t.map(function(t){if(-1===n.indexOf(t[0]))return t[0]})})}).reduce(function(t,e){return t.concat(e)},[]).reduce(function(t,e){return t.concat(e)},[])).sort();return i=o&&o[0]?n.concat(o):n,r.times.forEach(function(t){for(var e=0;e<t.tooltip_tables.length;e++){for(var n=t.tooltip_tables[e],r=[],a=0;a<i.length;a++){var o=n.filter(function(t){return t[0]===i[a]})[0];o&&(r=r.concat([o]))}t.tooltip_tables[e]=r}}),A},A.orderAllTooltipTables=function(e){return t.forEach(function(t){A.orderTrackTooltipTables(t.label,e)}),A},A.splitByClinicalAttributes=function(e,n){return T(t,e)&&E(e,n),A},A.sizeByClinicalAttribute=function(e,n){var r=T(t,e);return r&&1===r.times[0].tooltip_tables[0].filter(function(t){return t[0]===n}).length&&L(e,n,2,c),A},A.toggleTrackCollapse=function(e){return T(t,e)&&P(e),A},A.setTimepointsDisplay=function(e,n){var r=T(t,e);return r&&r.times.forEach(function(t){1===t.tooltip_tables.length&&(t.display=n)}),A},A.addPostTimelineHook=function(t){return m=m.concat(t),A},A},e.trimClinicalTimeline=f,e.clinicalTimelineZoom=h,e.clinicalTimelineParser=v},1139:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();function a(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t){function e(){var e=Reflect.construct(t,Array.from(arguments));return Object.setPrototypeOf(e,Object.getPrototypeOf(this)),e}return e.prototype=Object.create(t.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t,e}var l=e.ParameterValidationError=function(t){function e(t){o(this,e);var n=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.name=n.constructor.name,n.message=t,Error.captureStackTrace&&Error.captureStackTrace(n,n.constructor.name),n}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}(e,s(Error)),e}(),c=function(){function t(e){if(o(this,t),e){var n=e.defaultValidation;if(void 0!==n&&"function"!=typeof n)throw new l("The optional defaultValidation parameter provided is not a function.");this._defaultValidation=e.defaultValidation}}return i(t,[{key:"validate",value:function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};n=this._getExtractedParamsObject(n);var o=this._getValidationErrorSubclass(i);if(!t)throw new o("A params object is required.");if(!Array.isArray(e))throw new Error("paramRequirements must be an array.");var s=i.addPrefix||"";if("string"!=typeof s)throw new Error("addPrefix option must be a string if provided.");var l=[],c=!0,u=!1,f=void 0;try{for(var d,p=e[Symbol.iterator]();!(c=(d=p.next()).done);c=!0){var h=d.value;if(Array.isArray(h)&&h.length){var m=this._performLogicalOrParamValidation(t,h);this._assignProperties(n,m.params,s),l.push.apply(l,a(m.errors))}else if("object"===(void 0===h?"undefined":r(h)))for(var g in h){var v=h[g],y=this._executeValidationFunction(t,g,v);this._assignProperties(n,y.params,s),l.push.apply(l,a(y.errors))}else if("string"==typeof h&&h){var b=this._executeValidationFunction(t,h,this.defaultValidation);this._assignProperties(n,b.params,s),l.push.apply(l,a(b.errors))}}}catch(t){u=!0,f=t}finally{try{!c&&p.return&&p.return()}finally{if(u)throw f}}if(l.length){var w="",x=!0,k=!1,_=void 0;try{for(var T,A=l[Symbol.iterator]();!(x=(T=A.next()).done);x=!0){w+=T.value+" "}}catch(t){k=!0,_=t}finally{try{!x&&A.return&&A.return()}finally{if(k)throw _}}throw new o(w=w.slice(0,-1))}return n}},{key:"validateAsync",value:function(){for(var t=this,e=arguments.length,n=Array(e),r=0;r<e;r++)n[r]=arguments[r];return Promise.resolve().then(function(){return t.validate.apply(t,n)})}},{key:"_assignProperties",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";for(var r in e)t[n+r]=e[r]}},{key:"_getExtractedParamsObject",value:function(t){if([null,void 0].includes(t))return{};if(["object","function"].includes(void 0===t?"undefined":r(t)))return t;throw new Error("Invalid value of '"+t+"' was provided for the extractedParams parameter.")}},{key:"_getValidationErrorSubclass",value:function(t){if("object"!==(void 0===t?"undefined":r(t))||void 0===t.errorClass)return l;var e=t.errorClass;if(e===Error||e.prototype instanceof Error)return e;throw new Error("The errorClass provided was of type "+(void 0===e?"undefined":r(e))+" and was not an Error subclass.")}},{key:"_performLogicalOrParamValidation",value:function(t,e){var n={},r=[],i=this.defaultValidation,a=!0,o=!1,s=void 0;try{for(var l,c=e[Symbol.iterator]();!(a=(l=c.next()).done);a=!0){var u=l.value;i(t[u])&&(n[u]=t[u])}}catch(t){o=!0,s=t}finally{try{!a&&c.return&&c.return()}finally{if(o)throw s}}if(!Object.keys(n).length){var f="One of the following parameters must be included: ",d=!0,p=!1,h=void 0;try{for(var m,g=e[Symbol.iterator]();!(d=(m=g.next()).done);d=!0)f+="'"+(u=m.value)+"', "}catch(t){p=!0,h=t}finally{try{!d&&g.return&&g.return()}finally{if(p)throw h}}f=f.slice(0,-2)+".",r.push(f)}return{errors:r,params:n}}},{key:"_executeValidationFunction",value:function(t,e,n){var r=[],i={};if("function"!=typeof n)throw new Error("A paramRequirement value provided for the parameter "+e+" is not a function.");return!0===n(t[e])?i[e]=t[e]:r.push("Invalid value of '"+t[e]+"' was provided for parameter '"+e+"'."),{errors:r,params:i}}},{key:"isDefined",value:function(t){return void 0!==t}},{key:"defaultValidation",get:function(){return this._defaultValidation||this.isDefined}}]),t}();e.default=c;var u=new c;e.validate=u.validate.bind(u),e.validateAsync=u.validateAsync.bind(u)},587:function(t,e,n){},755:function(t,e,n){},796:function(t,e,n){},881:function(t,e,n){var r,i,a;r={},i=0,a=function(t){var e=document.getElementsByTagName("script")[0];e.parentNode.insertBefore(t,e)},t.exports=function(t,e,n){var o;e&&"function"!=typeof e&&(n=e.context||n,o=e.setup,e=e.callback);var s,l,c=document.createElement("script"),u=!1,f=function(){u||(u=!0,l(),e&&e.call(n,s))},d=function(){s=new Error(t||"EMPTY"),f()};if(!c.readyState||"async"in c)l=function(){c.onload=c.onerror=null},c.onerror=d,c.onload=f,c.async=!0,c.charset="utf-8",o&&o.call(n,c),c.src=t,a(c);else{var p=i++,h={loaded:!0,complete:!0},m=!1;l=function(){c.onreadystatechange=c.onerror=null,r[p]=void 0},c.onreadystatechange=function(){var t=c.readyState;if(!s){if(!m&&h[t]&&(m=!0,a(c)),"loaded"===t&&(c.children,"loading"===c.readyState))return d();"complete"===c.readyState&&f()}},c.onerror=d,r[p]=c,o&&o.call(n,c),c.src=t}}}}]);