(self.webpackChunkcbioportal_frontend=self.webpackChunkcbioportal_frontend||[]).push([[218],{28775:(e,t,n)=>{"use strict";n.d(t,{Z:()=>tn});var o,r,i,a,l=n(88034),s=n(57930),c=n.n(s),u=n(78566),p=n(76127),h=n.n(p),d=n(19483),f=n(36903),m=n(79280),y=n(59280),b=n(19160),v=n(27808),g=n(72685),C=n.n(g),E=n(65497),S=n.n(E),O=n(65587),P=n(54615),w=n(77906),_=n.n(w);function T(e){var t={};return e.forEach((function(e){var n=function(e){for(var t=[],n=e.start.position,o=e.end.position,r=n;r<=o;r++)t.push({resi:r});return e.start.insertionCode&&(t[0].icode=e.start.insertionCode),t.length>1&&e.end.insertionCode&&(t[t.length-1].icode=e.end.insertionCode),t}(e.positionRange),o=c().groupBy(n,"resi");c().each(c().keys(o),(function(n){t[n]||(t[n]=[]),c().each(o[n],(function(o){t[n].push({selector:o,residue:e})}))}))})),t}function k(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}!function(e){e[e.CARTOON=0]="CARTOON",e[e.SPACE_FILLING=1]="SPACE_FILLING",e[e.TRACE=2]="TRACE",e[e.BALL_AND_STICK=3]="BALL_AND_STICK",e[e.RIBBON=4]="RIBBON"}(o||(o={})),function(e){e[e.UNIFORM=0]="UNIFORM",e[e.SECONDARY_STRUCTURE=1]="SECONDARY_STRUCTURE",e[e.NC_RAINBOW=2]="NC_RAINBOW",e[e.ATOM_TYPE=3]="ATOM_TYPE"}(r||(r={})),function(e){e[e.ALL=0]="ALL",e[e.SELECTED=1]="SELECTED",e[e.NONE=2]="NONE"}(i||(i={})),function(e){e[e.UNIFORM=0]="UNIFORM",e[e.MUTATION_TYPE=1]="MUTATION_TYPE",e[e.NONE=2]="NONE"}(a||(a={}));var I=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,(n=[{key:"updateVisualStyle",value:function(e,t,n){var o=this.updateScheme(n);this.updateBaseVisualStyle(o,n),this.updateChainVisualStyle(t,o,n),this.updateResidueStyle(e,t,n,o),this.updateBoundMolecules(n)}},{key:"updateScheme",value:function(e){var t=this.selectAll();return this.setScheme(e.proteinScheme,t)}},{key:"updateBaseVisualStyle",value:function(t,n){var o=e.defaultProps,r=this.selectAll();this.setColor(n.baseColor||o.baseColor,r,t),this.setTransparency(n.baseTranslucency||o.baseTranslucency,r,t)}},{key:"updateChainVisualStyle",value:function(t,n,o){var i=e.defaultProps,a=this.selectChain(t);this.setColor(o.chainColor||i.chainColor,a,n),this.setTransparency(o.chainTranslucency||i.chainTranslucency,a,n),o.proteinColor===r.ATOM_TYPE?(a=this.selectChain(t),this.cpkColor(a,n)):o.proteinColor===r.SECONDARY_STRUCTURE?(a=this.selectAlphaHelix(t),this.setColor((o.structureColors||i.structureColors).alphaHelix,a,n),a=this.selectBetaSheet(t),this.setColor((o.structureColors||i.structureColors).betaSheet,a,n)):o.proteinColor===r.NC_RAINBOW&&(a=this.selectChain(t),this.rainbowColor(a,n))}},{key:"updateBoundMolecules",value:function(e){e.displayBoundMolecules||this.hideBoundMolecules()}},{key:"convertPositionsToResCode",value:function(e){var t=[];return e.forEach((function(e){t=t.concat(function(e){for(var t=[],n=e.start.position,o=e.end.position,r=n;r<=o;r++)t.push("".concat(r));return e.start.insertionCode&&(t[0]+="^"+e.start.insertionCode),t.length>1&&e.end.insertionCode&&(t[t.length-1]+="^"+e.end.insertionCode),t}(e))})),t}}])&&k(t.prototype,n),o&&k(t,o),e}();Object.defineProperty(I,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{pdbUri:"https://files.rcsb.org/view/",proteinScheme:o.CARTOON,displayBoundMolecules:!0,backgroundColor:"#FFFFFF",baseColor:"#DDDDDD",structureColors:{alphaHelix:"#FFA500",betaSheet:"#0000FF",loop:"#DDDDDD"},baseTranslucency:5,chainColor:"#888888",chainTranslucency:0,proteinColor:r.UNIFORM,mutationColor:a.MUTATION_TYPE,uniformMutationColor:"#8A2BE2",highlightColor:"#FFDD00",sideChain:i.SELECTED}});const D=I;var M=n(71082),R=n.n(M);function N(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function j(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function V(e,t,n){return(V="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=x(e)););return e}(e,t);if(o){var r=Object.getOwnPropertyDescriptor(o,t);return r.get?r.get.call(n):r.value}})(e,t,n||e)}function x(e){return(x=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function B(e,t){return(B=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e){return(A="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var U=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":A(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},F=function(e){function t(e,n,o){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),r=function(e,t){return!t||"object"!==A(t)&&"function"!=typeof t?j(e):t}(this,x(t).call(this)),Object.defineProperty(j(r),"_3dMolDiv",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(j(r),"_3dMolViewer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(j(r),"_3dMol",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(j(r),"props",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(j(r),"_prevProps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(j(r),"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(j(r),"_prevState",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(j(r),"_loadingPdb",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(j(r),"stateChangeReaction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),r._3dMol=o||R(),r._3dMolDiv=e,r.props=Object.assign(Object.assign({},D.defaultProps),n),r.state={pdbId:"",chainId:"",residues:[]},r._prevState={pdbId:"",chainId:"",residues:[]},r.updateViewer=r.updateViewer.bind(j(r)),(0,u.makeObservable)(j(r)),r.stateChangeReaction=(0,u.reaction)((function(){return r.state}),(function(e){r.onStateChange(e)})),r}var n,r,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&B(e,t)}(t,e),n=t,l=[{key:"PROTEIN_SCHEME_PRESETS",get:function(){var e={};return e[o.CARTOON]={cartoon:{}},e[o.TRACE]={cartoon:{style:"trace"}},e[o.SPACE_FILLING]={sphere:{scale:.6}},e[o.BALL_AND_STICK]={stick:{},sphere:{scale:.25}},e[o.RIBBON]={cartoon:{style:"ribbon"}},e}},{key:"ALL_PROTEINS",get:function(){var e=["asp","glu","arg","lys","his","asn","thr","cys","gln","tyr","ser","gly","ala","leu","val","ile","met","trp","phe","pro"],t=e.map((function(e){return e.toUpperCase()}));return e.concat(t)}}],(r=[{key:"setState",value:function(e){this._prevState=Object.assign({},this.state),this.state=Object.assign(Object.assign({},this.state),e)}},{key:"onStateChange",value:function(e){this._prevState&&!this._loadingPdb&&(this.updateVisualStyle(e.residues,e.chainId,this.props),this._3dMolViewer.render())}},{key:"setProps",value:function(e){this._prevProps=this.props,this.props=e}},{key:"init",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.state.residues,o=arguments.length>3?arguments[3]:void 0;if(o?this._3dMolViewer=o:this._3dMolDiv&&(this._3dMolViewer=this._3dMol.createViewer(_()(this._3dMolDiv),{defaultcolors:this._3dMol.elementColors.rasmol})),this._3dMolViewer){var r=this.formatColor(this.props.backgroundColor||D.defaultProps.backgroundColor);this._3dMolViewer.setBackgroundColor(r),this.loadPdb(e,t,n)}}},{key:"loadPdb",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.state.residues,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.props,i={doAssembly:!0,pdbUri:r.pdbUri};this._loadingPdb=!0,this.setState({pdbId:e,chainId:t,residues:o}),this._3dMolViewer?(this._3dMolViewer.clear(),this._3dMol.download("pdb:".concat(e.toUpperCase()),this._3dMolViewer,i,(function(){n._loadingPdb=!1,n.onStateChange(n.state)}))):this._loadingPdb=!1}},{key:"updateViewer",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.state.residues,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.props;this.setProps(n),this.setState({chainId:e,residues:t})}},{key:"resize",value:function(){this._3dMolViewer&&this._3dMolViewer.resize()}},{key:"selectAll",value:function(){return{}}},{key:"selectChain",value:function(e){return{chain:e}}},{key:"setScheme",value:function(e,n){var o=t.PROTEIN_SCHEME_PRESETS[e];return this.applyStyleForSelector(n,o),o}},{key:"setColor",value:function(e,t,n){var o=this.formatColor(e);n&&(c().each(n,(function(e){e.color=o})),this.applyStyleForSelector(t,n))}},{key:"formatColor",value:function(e){return e.replace("#","0x")}},{key:"setTransparency",value:function(e,t,n){n&&(this.addTransparencyToStyle(e,n),this.applyStyleForSelector(t,n))}},{key:"addTransparencyToStyle",value:function(e,t){c().each(t,(function(t,n){"sphere"!==n&&(t.opacity=(10-e)/10)}))}},{key:"rainbowColor",value:function(e,t){this.setColor("spectrum",e,t)}},{key:"cpkColor",value:function(e,t){var n=this;t&&(c().each(t,(function(e){delete e.color,e.colors=n._3dMol.elementColors.defaultColors})),this.applyStyleForSelector(e,t))}},{key:"selectAlphaHelix",value:function(e){return{chain:e,ss:"h"}}},{key:"selectBetaSheet",value:function(e){return{chain:e,ss:"s"}}},{key:"hideBoundMolecules",value:function(){var e={resn:t.ALL_PROTEINS,invert:!0};this._3dMolViewer.setStyle(e,{sphere:{hidden:!0}})}},{key:"enableBallAndStick",value:function(e,n,r){var i=Object.assign(Object.assign({},r),t.PROTEIN_SCHEME_PRESETS[o.BALL_AND_STICK]);if(e){var a=this.formatColor(e);i.sphere||(i.sphere={}),i.sphere.color=a,i.stick||(i.stick={}),i.stick.color=a}this._3dMolViewer.setStyle(n,i)}},{key:"updateResidueStyle",value:function(e,n){var o=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.props,l=arguments.length>3?arguments[3]:void 0,s=D.defaultProps;l||(l=t.PROTEIN_SCHEME_PRESETS[r.proteinScheme],this.addTransparencyToStyle(r.chainTranslucency||s.chainTranslucency,l));var c=this.residuesToUpdate;c.forEach((function(e){var t,c=e.residue,u=o.selectResidue(e.selector,n);t=c.highlighted?o.props.highlightColor||s.highlightColor:r.mutationColor===a.MUTATION_TYPE?c.color:r.mutationColor===a.UNIFORM?r.uniformMutationColor||s.uniformMutationColor:r.chainColor||s.chainColor,o.setColor(t,u,l),(r.sideChain===i.ALL||!0===c.highlighted&&r.sideChain===i.SELECTED)&&o.updateSideChain(n,e.selector,r.proteinScheme,t,l)}))}},{key:"updateScheme",value:function(e){return this.needToUpdateResiduesOnly?void 0:V(x(t.prototype),"updateScheme",this).call(this,e)}},{key:"updateBaseVisualStyle",value:function(e,n){this.needToUpdateResiduesOnly||V(x(t.prototype),"updateBaseVisualStyle",this).call(this,e,n)}},{key:"updateChainVisualStyle",value:function(e,n,o){this.needToUpdateResiduesOnly||V(x(t.prototype),"updateChainVisualStyle",this).call(this,e,n,o)}},{key:"updateVisualStyle",value:function(e,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.props;V(x(t.prototype),"updateVisualStyle",this).call(this,e,n,o)}},{key:"selectResidues",value:function(e,t){return{rescode:e,chain:t}}},{key:"selectResidue",value:function(e,t){return Object.assign({chain:t},e)}},{key:"selectSideChains",value:function(e,t){return this.selectResidue(e,t)}},{key:"updateSideChain",value:function(e,t,n,r,i){if(n!==o.SPACE_FILLING){var a=this.selectSideChains(t,e);this.enableBallAndStick(r,a,i)}}},{key:"applyStyleForSelector",value:function(e,t){this._3dMolViewer.setStyle(e,t)}},{key:"residuesToUpdate",get:function(){return this.needToUpdateResiduesOnly?(e=this.currentResidueToPositionMap,t=this.prevResidueToPositionMap,n=[],c().each(c().keys(e),(function(o){c().isEqual(e[o],t[o])||(n=n.concat(e[o]))})),n):c().flatten(c().values(this.currentResidueToPositionMap));var e,t,n}},{key:"needToUpdateResiduesOnly",get:function(){return this._prevState.pdbId===this.state.pdbId&&this._prevState.chainId===this.state.chainId&&this.visualPropsUnchanged&&this.residuePositionsUnchanged}},{key:"residuePositionsUnchanged",get:function(){return c().isEqual(c().keys(this.currentResidueToPositionMap).sort(),c().keys(this.prevResidueToPositionMap).sort())}},{key:"currentResidueToPositionMap",get:function(){return T(this.state.residues)}},{key:"prevResidueToPositionMap",get:function(){return T(this._prevState.residues)}},{key:"visualPropsUnchanged",get:function(){return c().isEqual(c().omit(this.props,["pdbId","chainId","residues"]),c().omit(this._prevProps,["pdbId","chainId","residues"]))}}])&&N(n.prototype,r),l&&N(n,l),t}(D);function L(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function H(e){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function W(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Y(e,t){return(Y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}U([u.observable],F.prototype,"props",void 0),U([u.observable],F.prototype,"_prevProps",void 0),U([u.observable],F.prototype,"state",void 0),U([u.observable],F.prototype,"_prevState",void 0),U([u.action],F.prototype,"setState",null),U([u.action],F.prototype,"setProps",null),U([u.computed],F.prototype,"residuesToUpdate",null),U([u.computed],F.prototype,"needToUpdateResiduesOnly",null),U([u.computed],F.prototype,"residuePositionsUnchanged",null),U([u.computed],F.prototype,"currentResidueToPositionMap",null),U([u.computed],F.prototype,"prevResidueToPositionMap",null),U([u.computed],F.prototype,"visualPropsUnchanged",null),U([u.action],F.prototype,"updateVisualStyle",null);var G=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":Z(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},z=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t){return!t||"object"!==Z(t)&&"function"!=typeof t?W(e):t}(this,H(t).call(this,e)),Object.defineProperty(W(n),"_3dMolDiv",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(W(n),"_pdbId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(W(n),"wrapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),n.divHandler=n.divHandler.bind(W(n)),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Y(e,t)}(t,e),n=t,(o=[{key:"render",value:function(){return l.createElement("div",{ref:this.divHandler,style:{height:this.props.bounds.height,width:this.props.bounds.width,padding:0},className:"borderedChart"})}},{key:"componentDidMount",value:function(){this._3dMolDiv&&(this.wrapper=new F(this._3dMolDiv,this.props),this.wrapper.init(this.props.pdbId,this.props.chainId,this.props.residues),this._pdbId=this.props.pdbId)}},{key:"componentDidUpdate",value:function(e){this.wrapper&&(this.props.pdbId!==this._pdbId?(this._pdbId=this.props.pdbId,this.wrapper.loadPdb(this._pdbId,this.props.chainId,this.props.residues,this.props)):this.wrapper.updateViewer(this.props.chainId,this.props.residues,this.props),c().isEqual(this.props.bounds,e.bounds)||this.wrapper.resize())}},{key:"divHandler",value:function(e){this._3dMolDiv=e,this.props.containerRef&&this.props.containerRef(e)}}])&&L(n.prototype,o),r&&L(n,r),t}(l.Component);const X=z=G([v.observer],z);var K=n(96725),q=n(34754),J=n.n(q);function $(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Q(e){return(Q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ee(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function te(e,t){return(te=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ne(e){return(ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var oe=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":ne(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},re=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t){return!t||"object"!==ne(t)&&"function"!=typeof t?ee(e):t}(this,Q(t).call(this,e)),Object.defineProperty(ee(n),"isTextTruncated",{enumerable:!0,configurable:!0,writable:!0,value:!0}),(0,u.makeObservable)(ee(n)),n.toggleText=n.toggleText.bind(ee(n)),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&te(e,t)}(t,e),n=t,(o=[{key:"render",value:function(){var e=this.props.text;return"string"==typeof this.props.text&&(e=l.createElement(J(),{text:this.props.text,line:this.props.line,truncateText:this.props.truncateText,textTruncateChild:l.createElement("a",{onClick:this.toggleText,style:{cursor:"pointer"}},this.props.expandIndicator)})),l.createElement(y.If,{condition:this.isTextTruncated},l.createElement(y.Then,null,e),l.createElement(y.Else,null,l.createElement("span",null,l.createElement("span",null,this.props.text," "),l.createElement("span",null,l.createElement("a",{onClick:this.toggleText,style:{cursor:"pointer"}},this.props.collapseIndicator)))))}},{key:"toggleText",value:function(){this.isTextTruncated=!this.isTextTruncated}}])&&$(n.prototype,o),r&&$(n,r),t}(l.Component);Object.defineProperty(re,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{line:1,expandIndicator:"[...]",collapseIndicator:"[^]",truncateText:" "}}),oe([u.observable],re.prototype,"isTextTruncated",void 0);const ie=re=oe([v.observer],re);function ae(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function le(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function se(e,t){return!t||"object"!==pe(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ce(e){return(ce=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ue(e,t){return(ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pe(e){return(pe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var he=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":pe(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},de=function(e){function t(){return ae(this,t),se(this,ce(t).apply(this,arguments))}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ue(e,t)}(t,e),n=t,(o=[{key:"render",value:function(){var e=null,t=null;if(this.props.cache){var n=this.props.cache.get(this.props.pdbId);if(null===n)e=l.createElement(O.Y6,{status:O.kW.LOADING}),t=l.createElement(O.Y6,{status:O.kW.LOADING});else if("error"===n.status)e=l.createElement(O.Y6,{status:O.kW.ERROR}),t=l.createElement(O.Y6,{status:O.kW.ERROR});else if(null===n.data)e=l.createElement(O.Y6,{status:O.kW.NA}),t=l.createElement(O.Y6,{status:O.kW.NA});else{var o=(0,K.sU)(n.data,this.props.chainId);e=o.pdbInfo,t=o.moleculeInfo}}return l.createElement("div",{className:this.props.truncateText?"col col-sm-12":""},l.createElement("div",{className:this.props.truncateText?"row":""},l.createElement("div",{className:"pull-left",style:{paddingRight:5}},l.createElement("span",{style:{fontWeight:this.props.summaryFormat?"bold":"normal"}},l.createElement("span",null,this.props.summaryFormat?"pdb":"PDB"),!this.props.summaryFormat&&l.createElement("span",{style:{paddingLeft:5}},l.createElement("a",{href:"http://www.rcsb.org/pdb/explore/explore.do?structureId=".concat(this.props.pdbId),target:"_blank"},l.createElement("b",null,this.props.pdbId))),l.createElement("span",null,":"))),l.createElement("div",{"data-test":"pdbChainInfoText"},this.props.truncateText?l.createElement(ie,{text:e}):l.createElement("span",null,e))),l.createElement("div",{className:this.props.truncateText?"row":""},l.createElement("div",{className:"pull-left",style:{paddingRight:5}},l.createElement("span",{style:{fontWeight:this.props.summaryFormat?"bold":"normal"}},l.createElement("span",null,this.props.summaryFormat?"chain":"Chain"),!this.props.summaryFormat&&l.createElement("span",{style:{paddingLeft:3}},l.createElement("b",null,this.props.chainId)),l.createElement("span",null,":"))),l.createElement("div",null,this.props.truncateText?l.createElement(ie,{text:t}):l.createElement("span",null,t))))}}])&&le(n.prototype,o),r&&le(n,r),t}(l.Component);const fe=de=he([v.observer],de);function me(e){return(me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function ye(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function be(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function ve(e,t){return!t||"object"!==me(t)&&"function"!=typeof t?Ce(e):t}function ge(e){return(ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ce(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ee(e,t){return(Ee=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var Se=function(e){function t(){var e;return ye(this,t),e=ve(this,ge(t).apply(this,arguments)),Object.defineProperty(Ce(e),"_script",{enumerable:!0,configurable:!0,writable:!0,value:[]}),e}var n,r,l;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ee(e,t)}(t,e),n=t,l=[{key:"PROTEIN_SCHEME_PRESETS",get:function(){var e={};return e[o.CARTOON]="hide everything; show cartoon;",e[o.SPACE_FILLING]="hide everything; show spheres;",e[o.BALL_AND_STICK]="hide everything; show spheres; show sticks; alter all, vdw=0.50",e[o.RIBBON]="hide everything; show ribbon;",e[o.TRACE]=e[o.RIBBON],e}}],(r=[{key:"generateScript",value:function(e,t,n,o){return this._script=[],this.reinitialize(),this.bgColor(o.backgroundColor||D.defaultProps.backgroundColor),this.loadPdb(e),this.updateVisualStyle(n,t,o),this.selectNone(),this._script.join("\n")}},{key:"reinitialize",value:function(){this._script.push("reinitialize;")}},{key:"bgColor",value:function(e){this._script.push("bg_color ".concat(this.formatColor(e),";"))}},{key:"loadPdb",value:function(e){this._script.push("fetch ".concat(e,", async=0;"))}},{key:"setScheme",value:function(e){this._script.push(t.PROTEIN_SCHEME_PRESETS[e])}},{key:"setColor",value:function(e){this._script.push("color ".concat(this.formatColor(e),", sele;"))}},{key:"selectChain",value:function(e){this._script.push("select chain ".concat(e,";"))}},{key:"selectAlphaHelix",value:function(e){this._script.push("select (chain ".concat(e,") and (ss h);"))}},{key:"selectBetaSheet",value:function(e){this._script.push("select (chain ".concat(e,") and (ss s);"))}},{key:"selectResidues",value:function(e,t){this._script.push("select (resi ".concat(e.join(","),") and (chain ").concat(t,");"))}},{key:"selectSideChains",value:function(e,t){this._script.push("select ((resi ".concat(e.join(","),") and (chain ").concat(t,") and (not name c+n+o));"))}},{key:"setTransparency",value:function(e){this._script.push("set transparency, ".concat(e/10,", sele;")),this._script.push("set cartoon_transparency, ".concat(e/10,", sele;")),this._script.push("set sphere_transparency, ".concat(e/10,", sele;")),this._script.push("set stick_transparency, ".concat(e/10,", sele;"))}},{key:"enableBallAndStick",value:function(){this._script.push("show spheres, sele; show sticks, sele; alter sele, vdw=0.50;")}},{key:"disableBallAndStick",value:function(){this._script.push("hide spheres, sele; hide sticks, sele;")}},{key:"rainbowColor",value:function(){return this._script.push("spectrum count, rainbow_rev, sele;")}},{key:"cpkColor",value:function(){this._script.push("util.cbaw sele;")}},{key:"hideBoundMolecules",value:function(){this._script.push("hide everything, not resn ".concat("asp+glu+arg+lys+his+asn+thr+cys+gln+tyr+ser+gly+ala+leu+val+ile+met+trp+phe+pro",";"))}},{key:"formatColor",value:function(e){return e.replace("#","0x")}},{key:"selectAll",value:function(){this._script.push("select all;")}},{key:"selectNone",value:function(){this._script.push("select none;")}},{key:"updateResidueStyle",value:function(e,t,n){var o=this,r=D.defaultProps,l=n.highlightColor||r.highlightColor,s=c().groupBy(e,(function(e){return e.highlighted?l:e.color}));c().each(c().keys(s),(function(e){var l=s[e].map((function(e){return e.positionRange})),c=o.convertPositionsToResCode(l);s[e][0].highlighted?(o.selectResidues(c,t),o.setColor(n.highlightColor||r.highlightColor)):n.mutationColor===a.MUTATION_TYPE?(o.selectResidues(c,t),o.setColor(e)):n.mutationColor===a.UNIFORM&&(o.selectResidues(c,t),o.setColor(n.uniformMutationColor||r.uniformMutationColor));var u=n.sideChain===i.ALL||!0===s[e][0].highlighted&&n.sideChain===i.SELECTED;o.updateSideChains(t,c,u,n)}))}},{key:"updateSideChains",value:function(e,t,n,r){n&&r.proteinScheme!==o.SPACE_FILLING&&(this.selectSideChains(t,e),this.enableBallAndStick())}}])&&be(n.prototype,r),l&&be(n,l),t}(D),Oe=n(10816),Pe=n.n(Oe);function we(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Te(e){return(Te=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ke(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ie(e,t){return(Ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function De(e){return(De="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Me=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":De(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Re=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t){return!t||"object"!==De(t)&&"function"!=typeof t?ke(e):t}(this,Te(t).call(this,e)),Object.defineProperty(ke(n),"isCollapsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(ke(n),"isIncreasedSize",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(ke(n),"proteinScheme",{enumerable:!0,configurable:!0,writable:!0,value:o.CARTOON}),Object.defineProperty(ke(n),"proteinColor",{enumerable:!0,configurable:!0,writable:!0,value:r.UNIFORM}),Object.defineProperty(ke(n),"sideChain",{enumerable:!0,configurable:!0,writable:!0,value:i.SELECTED}),Object.defineProperty(ke(n),"mutationColor",{enumerable:!0,configurable:!0,writable:!0,value:a.MUTATION_TYPE}),Object.defineProperty(ke(n),"displayBoundMolecules",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(ke(n),"_3dMolDiv",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),(0,u.makeObservable)(ke(n)),n.containerRefHandler=n.containerRefHandler.bind(ke(n)),n.toggleCollapse=n.toggleCollapse.bind(ke(n)),n.toggleDoubleSize=n.toggleDoubleSize.bind(ke(n)),n.handleProteinSchemeChange=n.handleProteinSchemeChange.bind(ke(n)),n.handleProteinColorChange=n.handleProteinColorChange.bind(ke(n)),n.handleSideChainChange=n.handleSideChainChange.bind(ke(n)),n.handleMutationColorChange=n.handleMutationColorChange.bind(ke(n)),n.handleBoundMoleculeChange=n.handleBoundMoleculeChange.bind(ke(n)),n.handlePyMolDownload=n.handlePyMolDownload.bind(ke(n)),n}var n,s,p;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ie(e,t)}(t,e),n=t,(s=[{key:"selectionTitle",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"top",o=null;return t&&(o=this.defaultInfoTooltip(t,n)),l.createElement("span",null,e," ",o,":")}},{key:"defaultInfoTooltip",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"top",n=function(){return e};return l.createElement(O.ZD,{placement:t,overlay:n,arrowContent:l.createElement("div",{className:"rc-tooltip-arrow-inner"}),destroyTooltipOnHide:!0},l.createElement("i",{className:"fa fa-info-circle"}))}},{key:"proteinColorTooltipContent",value:function(){return l.createElement("div",{style:{maxWidth:400,maxHeight:200,overflowY:"auto"}},"Color options for the protein structure. ",l.createElement("br",null),l.createElement("br",null),l.createElement("b",null,"Uniform:")," Colors the entire protein structure with a",l.createElement("span",{className:Pe().loop}," single color"),". ",l.createElement("br",null),l.createElement("b",null,"Secondary structure:")," Colors the protein by secondary structure. Assigns different colors for"," ",l.createElement("span",{className:Pe()["alpha-helix"]},"alpha helices"),",",l.createElement("span",{className:Pe()["beta-sheet"]}," beta sheets"),", and",l.createElement("span",{className:Pe().loop}," loops"),". This color option is not available for the space-filling protein scheme."," ",l.createElement("br",null),l.createElement("b",null,"N-C rainbow:")," Colors the protein with a rainbow gradient from red (N-terminus) to blue (C-terminus). ",l.createElement("br",null),l.createElement("b",null,"Atom Type:")," Colors the structure with respect to the atom type (CPK color scheme). This color option is only available for the space-filling protein scheme. ",l.createElement("br",null),l.createElement("br",null),"The selected chain is always displayed with full opacity while the rest of the structure has some transparency to help better focusing on the selected chain.")}},{key:"sideChainTooltipContent",value:function(){return l.createElement("div",{style:{maxWidth:400,maxHeight:200,overflowY:"auto"}},"Display options for the side chain atoms. ",l.createElement("br",null),l.createElement("br",null),l.createElement("b",null,"All:")," Displays the side chain atoms for every mapped residue. ",l.createElement("br",null),l.createElement("b",null,"Selected:")," Displays the side chain atoms only for the selected mutations. ",l.createElement("br",null),l.createElement("b",null,"None:")," Hides the side chain atoms. ",l.createElement("br",null),l.createElement("br",null),"This option has no effect for the space-filling protein scheme.")}},{key:"mutationColorTooltipContent",value:function(){return l.createElement("div",{style:{maxWidth:400,maxHeight:200,overflowY:"auto"}},"Color options for the mapped mutations. ",l.createElement("br",null),l.createElement("br",null),l.createElement("b",null,"Uniform:")," Colors all mutated residues with a",l.createElement("span",{className:Pe()["uniform-mutation"]}," ","single color"),". ",l.createElement("br",null),l.createElement("b",null,"Mutation type:")," Enables residue coloring by mutation type. Mutation types and corresponding color codes are as follows:",l.createElement("ul",null,l.createElement("li",null,l.createElement("span",{className:Pe()["missense-mutation"]},"Missense Mutations")),l.createElement("li",null,l.createElement("span",{className:Pe()["trunc-mutation"]},"Truncating Mutations"),l.createElement("span",null," (Nonsense, Nonstop, FS del, FS ins)")),l.createElement("li",null,l.createElement("span",{className:Pe()["inframe-mutation"]},"Inframe Mutations"),l.createElement("span",null," (IF del, IF ins)"))),l.createElement("b",null,"None:")," Disables coloring of the mutated residues except for manually selected (highlighted) residues. ",l.createElement("br",null),l.createElement("br",null),"Highlighted residues are colored with"," ",l.createElement("span",{className:Pe().highlighted},"yellow"),".")}},{key:"boundMoleculesTooltipContent",value:function(){return l.createElement("div",{style:{maxWidth:400,maxHeight:200,overflowY:"auto"}},"Displays co-crystalized molecules. This option has no effect if the current structure does not contain any co-crystalized bound molecules.")}},{key:"helpTooltipContent",value:function(){return l.createElement("div",{style:{maxWidth:400,maxHeight:200,overflowY:"auto"}},l.createElement("b",null,"Zoom in/out:")," Press and hold the SHIFT key and the left mouse button, and then move the mouse backward/forward.",l.createElement("br",null),l.createElement("b",null,"Pan:")," Press and hold the CTRL key, click and hold the left mouse button, and then move the mouse in the desired direction.",l.createElement("br",null),l.createElement("b",null,"Rotate:")," Press and hold the left mouse button, and then move the mouse in the desired direction to rotate along the x and y axes.",l.createElement("br",null))}},{key:"proteinStyleMenu",value:function(){return l.createElement("span",null,l.createElement("div",{className:"row text-center"},l.createElement("span",null,"Protein Style")),l.createElement("div",{className:"row"},l.createElement("div",{className:"col col-sm-10 col-sm-offset-1"},l.createElement("hr",null))),l.createElement("div",{className:"row"},l.createElement(m.Checkbox,{checked:this.displayBoundMolecules,onChange:this.handleBoundMoleculeChange},"Display bound molecules"," ",this.defaultInfoTooltip(this.boundMoleculesTooltipContent()))),l.createElement("div",{className:"row"},l.createElement("div",{className:"col col-sm-6"},l.createElement("div",{className:"row"},this.selectionTitle("Scheme")),l.createElement("div",{className:"row"},l.createElement(m.FormControl,{className:Pe()["default-option-select"],componentClass:"select",value:"".concat(this.proteinScheme),onChange:this.handleProteinSchemeChange},l.createElement("option",{value:o.CARTOON},"cartoon"),l.createElement("option",{value:o.SPACE_FILLING},"space-filling"),l.createElement("option",{value:o.TRACE},"trace")))),l.createElement("div",{className:"col col-sm-6"},l.createElement("div",{className:"row"},this.selectionTitle("Color",this.proteinColorTooltipContent())),l.createElement("div",{className:"row"},l.createElement(m.FormControl,{className:Pe()["default-option-select"],componentClass:"select",value:"".concat(this.proteinColor),onChange:this.handleProteinColorChange},l.createElement("option",{value:r.UNIFORM},"uniform"),l.createElement("option",{value:r.SECONDARY_STRUCTURE,disabled:this.colorBySecondaryStructureDisabled},"secondary structure"),l.createElement("option",{value:r.NC_RAINBOW,disabled:this.colorByNCRainbowDisabled},"N-C rainbow"),l.createElement("option",{value:r.ATOM_TYPE,disabled:this.colorByAtomTypeDisabled},"atom type"))))))}},{key:"mutationStyleMenu",value:function(){return l.createElement("span",null,l.createElement("div",{className:"row text-center"},l.createElement("span",null,"Mutation Style")),l.createElement("div",{className:"row"},l.createElement("div",{className:"col col-sm-10 col-sm-offset-1"},l.createElement("hr",null))),l.createElement("div",{className:"row"},l.createElement("div",{className:"col col-sm-6"},l.createElement("div",{className:"row"},this.selectionTitle("Side Chain",this.sideChainTooltipContent())),l.createElement("div",{className:"row"},l.createElement(m.FormControl,{className:Pe()["default-option-select"],componentClass:"select",value:"".concat(this.sideChain),onChange:this.handleSideChainChange},l.createElement("option",{value:i.ALL},"all"),l.createElement("option",{value:i.SELECTED},"selected"),l.createElement("option",{value:i.NONE},"none")))),l.createElement("div",{className:"col col-sm-6"},l.createElement("div",{className:"row"},this.selectionTitle("Color",this.mutationColorTooltipContent(),"left")),l.createElement("div",{className:"row"},l.createElement(m.FormControl,{className:Pe()["default-option-select"],componentClass:"select",value:"".concat(this.mutationColor),onChange:this.handleMutationColorChange},l.createElement("option",{value:a.UNIFORM},"uniform"),l.createElement("option",{value:a.MUTATION_TYPE},"mutation type"),l.createElement("option",{value:a.NONE},"none"))))))}},{key:"topToolbar",value:function(){return l.createElement("div",{className:"row"},l.createElement("div",{className:"col col-sm-6"},l.createElement(m.ButtonGroup,null,l.createElement(O.ZD,{overlay:l.createElement("span",null,"Download PyMol script"),placement:"top"},l.createElement(m.Button,{className:"btn-sm",onClick:this.handlePyMolDownload},l.createElement("i",{className:"fa fa-cloud-download"})," PyMol")))),l.createElement("div",{className:"col col-sm-6"},l.createElement("span",{className:"pull-right"},"how to pan/zoom/rotate?"," ",this.defaultInfoTooltip(this.helpTooltipContent(),"left"))))}},{key:"header",value:function(){return l.createElement("div",{className:h()("row",Pe().header)},l.createElement("div",{className:"col col-sm-10"},l.createElement("span",null,"3D Structure")),l.createElement("div",{className:"col col-sm-2"},l.createElement("span",{className:"pull-right"},l.createElement("i",{className:h()("fa",{"fa-compress":this.isIncreasedSize,"fa-expand":!this.isIncreasedSize}),onClick:this.toggleDoubleSize,style:{marginRight:5,cursor:"pointer"}}),l.createElement("i",{className:"fa fa-minus-circle",onClick:this.toggleCollapse,style:{marginRight:5,cursor:"pointer"}}),l.createElement("i",{className:"fa fa-times-circle",onClick:this.props.onClose,style:{cursor:"pointer"}}))))}},{key:"mainContent",value:function(){return this.pdbId&&this.chainId&&this.residues?l.createElement("span",null,l.createElement("div",{className:"row"},l.createElement(fe,{pdbId:this.pdbId,chainId:this.chainId,cache:this.props.pdbHeaderCache,truncateText:!0})),l.createElement(y.If,{condition:this.residueWarning.length>0},l.createElement("div",{className:"row"},l.createElement("div",{className:"col col-sm-12 text-center"},l.createElement("span",{className:"text-danger"},this.residueWarning)))),l.createElement("div",{className:"row",style:{paddingTop:5,paddingBottom:5}},l.createElement(X,{displayBoundMolecules:this.displayBoundMolecules,proteinScheme:this.proteinScheme,proteinColor:this.proteinColor,sideChain:this.sideChain,mutationColor:this.mutationColor,pdbId:this.pdbId,chainId:this.chainId,residues:this.residues,bounds:this.structureViewerBounds,containerRef:this.containerRefHandler}))):l.createElement("div",{style:{textAlign:"center"}},l.createElement(b.JD,{size:25,style:{display:"inline-block",padding:25}}))}},{key:"render",value:function(){return l.createElement(C(),{handle:".structure-viewer-header"},l.createElement("div",{className:h()(Pe()["main-3d-panel"],we({},Pe()["increased-size-panel"],this.isIncreasedSize))},l.createElement("div",{className:"structure-viewer-header row"},this.header(),l.createElement("hr",{style:{borderTopColor:"#BBBBBB"}})),l.createElement("div",{className:h()(Pe().body,we({},Pe()["collapsed-panel"],this.isCollapsed))},this.mainContent(),l.createElement("div",{className:"row"},this.topToolbar(),l.createElement("hr",null)),l.createElement("div",{className:"row"},l.createElement("div",{className:"col col-sm-6"},this.proteinStyleMenu()),l.createElement("div",{className:"col col-sm-6"},this.mutationStyleMenu())))))}},{key:"containerRefHandler",value:function(e){this._3dMolDiv=e}},{key:"toggleCollapse",value:function(){this.isCollapsed=!this.isCollapsed}},{key:"toggleDoubleSize",value:function(){this.isIncreasedSize=!this.isIncreasedSize}},{key:"handleProteinSchemeChange",value:function(e){this.proteinScheme=parseInt(e.target.value,10),(this.proteinScheme!==o.SPACE_FILLING||this.proteinColor!==r.NC_RAINBOW&&this.proteinColor!==r.SECONDARY_STRUCTURE)&&(this.proteinScheme!==o.TRACE&&this.proteinScheme!==o.CARTOON||this.proteinColor!==r.ATOM_TYPE)||(this.proteinColor=r.UNIFORM)}},{key:"handleProteinColorChange",value:function(e){this.proteinColor=parseInt(e.target.value,10)}},{key:"handleSideChainChange",value:function(e){this.sideChain=parseInt(e.target.value,10)}},{key:"handleMutationColorChange",value:function(e){this.mutationColor=parseInt(e.target.value,10)}},{key:"handleBoundMoleculeChange",value:function(){this.displayBoundMolecules=!this.displayBoundMolecules}},{key:"handlePyMolDownload",value:function(){if(this.pdbId&&this.chainId){var e="".concat(this.pdbId,"_").concat(this.chainId,".pml");S()(this.pyMolScript,e)}}},{key:"structureViewerBounds",get:function(){var e,t;return this.isIncreasedSize?(e=this._3dMolDiv?Math.floor(this._3dMolDiv.offsetWidth*(5/3)):698,t=this._3dMolDiv?2*this._3dMolDiv.offsetHeight:350):(e=this._3dMolDiv?Math.floor(this._3dMolDiv.offsetWidth/(5/3)):450,t=this._3dMolDiv?this._3dMolDiv.offsetHeight/2:350),{width:e,height:t}}},{key:"pdbId",get:function(){return this.pdbChain?this.pdbChain.pdbId:void 0}},{key:"chainId",get:function(){return this.pdbChain?this.pdbChain.chain:void 0}},{key:"pdbChain",get:function(){var e=this.props.pdbChainDataStore.sortedFilteredSelectedData;return 0===e.length&&(e=this.props.pdbChainDataStore.allData),0===e.length?void 0:e[0]}},{key:"residueWarning",get:function(){var e="";if(0===this.proteinPositions.length||this.residueMappingData&&0===this.residueMappingData.filter((function(e){return null===e||null!==e.data})).length)e="None of the mutations can be mapped onto this structure";else{var t=c().keys(this.selectedMutationsByPosition).length,n=t-this.mappedSelectedPositions.length;1===t&&1===n?e="Selected mutation cannot be mapped onto this structure":n>0&&(e="".concat(n," of the selections cannot be mapped onto this structure"))}return e}},{key:"residues",get:function(){var e=this;if(this.residueMappingData){var t=[];return this.residueMappingData.forEach((function(n){if(n&&n.data){var o=e.mutationsByPosition[n.data.queryPosition],r=e.props.mutationDataStore&&(e.props.mutationDataStore.isPositionSelected(n.data.queryPosition)||e.props.mutationDataStore.isPositionHighlighted(n.data.queryPosition))||!1;o&&o.length>0&&t.push({positionRange:{start:{position:n.data.pdbPosition},end:{position:n.data.pdbPosition}},color:(0,P.bv)(o,e.props),highlighted:r})}})),c().uniq(t)}}},{key:"residueMappingData",get:function(){if(0!==this.alignmentIds.length){var e=[];if(this.props.residueMappingCache&&this.props.uniprotId&&this.pdbId&&this.chainId&&this.proteinPositions.length>0){var t=this.props.residueMappingCache.get({uniprotId:this.props.uniprotId,pdbId:this.pdbId,chainId:this.chainId,uniprotPositions:this.proteinPositions});t.result&&(e=t.result)}return e}}},{key:"mappedSelectedPositions",get:function(){var e=this;if(!this.residueMappingData)return[];var t=[];return this.residueMappingData.forEach((function(n){n&&n.data&&e.props.mutationDataStore&&e.props.mutationDataStore.isPositionSelected(n.data.queryPosition)&&t.push(n.data.queryPosition)})),c().uniq(t)}},{key:"alignmentIds",get:function(){var e=[];return this.pdbChain&&this.props.pdbAlignmentIndex&&(e=void 0===this.props.pdbAlignmentIndex[this.pdbChain.pdbId][this.pdbChain.chain]?[]:this.props.pdbAlignmentIndex[this.pdbChain.pdbId][this.pdbChain.chain].map((function(e){return e.alignmentId}))),c().uniq(e)}},{key:"mutationsByPosition",get:function(){return this.props.mutationDataStore?(0,P.V1)(this.props.mutationDataStore.sortedFilteredData):{}}},{key:"selectedMutationsByPosition",get:function(){return this.props.mutationDataStore?(0,P.V1)(this.props.mutationDataStore.sortedFilteredSelectedData):{}}},{key:"proteinPositions",get:function(){var e=[];return this.props.mutationDataStore&&this.pdbChain&&(e=(0,P.SR)(this.props.mutationDataStore.sortedFilteredData,this.pdbChain.uniprotStart,this.pdbChain.uniprotEnd)),e}},{key:"pyMolScript",get:function(){var e=new Se,t={displayBoundMolecules:this.displayBoundMolecules,proteinScheme:this.proteinScheme,proteinColor:this.proteinColor,sideChain:this.sideChain,mutationColor:this.mutationColor};return this.pdbId&&this.chainId?e.generateScript(this.pdbId,this.chainId,this.residues||[],t):""}},{key:"colorBySecondaryStructureDisabled",get:function(){return this.proteinScheme===o.SPACE_FILLING}},{key:"colorByNCRainbowDisabled",get:function(){return this.proteinScheme===o.SPACE_FILLING}},{key:"colorByAtomTypeDisabled",get:function(){return this.proteinScheme!==o.SPACE_FILLING}}])&&_e(n.prototype,s),p&&_e(n,p),t}(l.Component);Me([u.observable],Re.prototype,"isCollapsed",void 0),Me([u.observable],Re.prototype,"isIncreasedSize",void 0),Me([u.observable],Re.prototype,"proteinScheme",void 0),Me([u.observable],Re.prototype,"proteinColor",void 0),Me([u.observable],Re.prototype,"sideChain",void 0),Me([u.observable],Re.prototype,"mutationColor",void 0),Me([u.observable],Re.prototype,"displayBoundMolecules",void 0),Me([u.computed],Re.prototype,"structureViewerBounds",null),Me([u.computed],Re.prototype,"pdbId",null),Me([u.computed],Re.prototype,"chainId",null),Me([u.computed],Re.prototype,"pdbChain",null),Me([u.computed],Re.prototype,"residueWarning",null),Me([u.computed],Re.prototype,"residues",null),Me([u.computed],Re.prototype,"residueMappingData",null),Me([u.computed],Re.prototype,"mappedSelectedPositions",null),Me([u.computed],Re.prototype,"alignmentIds",null),Me([u.computed],Re.prototype,"mutationsByPosition",null),Me([u.computed],Re.prototype,"selectedMutationsByPosition",null),Me([u.computed],Re.prototype,"proteinPositions",null),Me([u.computed],Re.prototype,"pyMolScript",null),Me([u.computed],Re.prototype,"colorBySecondaryStructureDisabled",null),Me([u.computed],Re.prototype,"colorByNCRainbowDisabled",null),Me([u.computed],Re.prototype,"colorByAtomTypeDisabled",null);const Ne=Re=Me([v.observer],Re);function je(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var Ve=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperty(this,"regions",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.regions=t?xe(t):[]}var t,n,o;return t=e,(n=[{key:"check",value:function(e,t){void 0===t&&(t=e);for(var n,o,r=this.regions,i=0,a=r.length,l=!1;i<a;)if((o=r[n=Math.floor((i+a)/2)])[0]>t)a=n;else{if(!(o[1]<e)){l=!0;break}i=n+1}return l}},{key:"add",value:function(e,t){this.regions.push([e,t]),this.regions=xe(this.regions)}},{key:"_getHotspotRegions",value:function(){return this.regions}}])&&je(t.prototype,n),o&&je(t,o),e}();function xe(e){if(0===e.length)return[];e.sort((function(e,t){return e[0]<t[0]?-1:1}));for(var t,n=[],o=[e[0][0],e[0][1]],r=1;r<=e.length;)r===e.length?n.push(o):(t=e[r])[0]>o[1]?(n.push(o),o=[e[r][0],e[r][1]]):o[1]=Math.max(o[1],t[1]),r++;return n}function Be(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ae(e){return(Ae=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Ue(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Fe(e,t){return(Fe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Le(e){return(Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var He=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":Le(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},We=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t){return!t||"object"!==Le(t)&&"function"!=typeof t?Ue(e):t}(this,Ae(t).call(this,e)),(0,u.makeObservable)(Ue(n)),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Fe(e,t)}(t,e),n=t,(o=[{key:"render",value:function(){var e=this;return l.createElement("g",{key:this.props.uniqueHitZoneClassName},this.segmentsAndGaps.map((function(t){return t.gap?l.createElement("line",{stroke:"#666666",strokeWidth:"0.5",x1:e.props.positionToX(t.start),x2:e.props.positionToX(t.end),y1:e.props.y+e.props.height/2,y2:e.props.y+e.props.height/2}):l.createElement("rect",{fill:"#3366cc",fillOpacity:e.props.opacity,stroke:"#666666",strokeWidth:"0.5",x:e.props.positionToX(t.start),y:e.props.y,width:e.props.positionToX(t.end)-e.props.positionToX(t.start),height:e.props.height})})),l.createElement("rect",{stroke:"#FF9900",strokeWidth:"2",fillOpacity:"0",strokeOpacity:+!!this.props.highlighted,height:this.props.height,width:this.props.positionToX(this.props.end)-this.props.positionToX(this.props.start),x:this.props.positionToX(this.props.start),y:this.props.y,className:this.props.uniqueHitZoneClassName}))}},{key:"segmentsAndGaps",get:function(){var e=[],t=c().sortBy(this.props.gaps,(function(e){return e.start}));if(0===t.length)e.push({gap:!1,start:this.props.start,end:this.props.end});else{t[0].start>this.props.start&&e.push({gap:!1,start:this.props.start,end:t[0].start}),e.push({gap:!0,start:t[0].start,end:t[0].end});for(var n=1;n<t.length;n++)e.push({gap:!1,start:t[n-1].end,end:t[n].start}),e.push({gap:!0,start:t[n].start,end:t[n].end});var o=t[t.length-1];o.end<this.props.end&&e.push({gap:!1,start:o.end,end:this.props.end})}return e}}])&&Be(n.prototype,o),r&&Be(n,r),t}(l.Component);He([u.computed],We.prototype,"segmentsAndGaps",null);const Ye=We=He([v.observer],We);function Ze(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Ge(e){return(Ge=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ze(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Xe(e,t){return(Xe=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ke(e){return(Ke="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var qe=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":Ke(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Je="chain-",$e=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t){return!t||"object"!==Ke(t)&&"function"!=typeof t?ze(e):t}(this,Ge(t).call(this,e)),Object.defineProperty(ze(n),"rowHeight",{enumerable:!0,configurable:!0,writable:!0,value:6}),Object.defineProperty(ze(n),"rowPadding",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(ze(n),"chainComponents",{enumerable:!0,configurable:!0,writable:!0,value:{}}),(0,u.makeObservable)(ze(n)),n.onMouseOver=n.onMouseOver.bind(ze(n)),n.positionToX=n.positionToX.bind(ze(n)),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Xe(e,t)}(t,e),n=t,(o=[{key:"positionToX",value:function(e){return e*this.props.width/this.props.proteinLength}},{key:"makeChainIdClass",value:function(e){return"".concat(Je).concat(e)}},{key:"getChainId",value:function(e){var t=e.split(/[\s]+/g).map((function(e){return e.match(new RegExp("^(".concat(Je,".*)$")))})).find((function(e){return null!==e}));return t&&t[1]||null}},{key:"chainY",value:function(e){return e*(this.rowHeight+this.rowPadding)}},{key:"onMouseOver",value:function(e){var t=e.target,n=t.getAttribute("class")||"",o=this.getChainId(n);if(null!==o){var r=this.chainComponents[o];r&&this.props.setHitZone&&this.props.setHitZone({x:parseInt(t.getAttribute("x")||"0",10),y:parseInt(t.getAttribute("y")||"0",10),width:parseInt(t.getAttribute("width")||"0",10),height:parseInt(t.getAttribute("height")||"0",10)},r.props.uid)}}},{key:"render",value:function(){return l.createElement("div",null,l.createElement("div",{onMouseOver:this.onMouseOver},l.createElement("svg",{width:this.props.width,height:this.svgHeight},this.rows)))}},{key:"rowSpecs",get:function(){var e=[[]],t=[new Ve],n=!0,o=!1,r=void 0;try{for(var i,a=function(){var n=i.value,o=c().findIndex(t,(function(e){return!e.check(n.start,n.end)}));-1===o&&(o=e.length,e.push([]),t.push(new Ve)),e[o].push(n),t[o].add(n.start,n.end)},l=this.props.chains[Symbol.iterator]();!(n=(i=l.next()).done);n=!0)a()}catch(e){o=!0,r=e}finally{try{n||null==l.return||l.return()}finally{if(o)throw r}}return e}},{key:"rows",get:function(){var e=this,t=0;this.chainComponents={};var n={},o=this.rowSpecs.map((function(o,r){return l.createElement("g",{key:r},o.map((function(o){var i=e.makeChainIdClass(t++),a=o.uid,s=e.chainY(r);return n[a]=s,l.createElement(Ye,{ref:function(t){null!==t&&(e.chainComponents[i]=t)},positionToX:e.positionToX,y:s,height:e.rowHeight,uniqueHitZoneClassName:i,start:o.start,end:o.end,gaps:o.gaps,opacity:o.opacity,uid:a,highlighted:e.props.selectedChainUid===o.uid})})))}));return this.props.setChainUidToY&&this.props.setChainUidToY(n),o}},{key:"svgHeight",get:function(){return this.rows.length*this.rowHeight+(this.rows.length-1)*this.rowPadding}}])&&Ze(n.prototype,o),r&&Ze(n,r),t}(l.Component);qe([u.observable],$e.prototype,"rowHeight",void 0),qe([u.observable],$e.prototype,"rowPadding",void 0),qe([u.computed],$e.prototype,"rowSpecs",null),qe([u.computed],$e.prototype,"rows",null),qe([u.computed],$e.prototype,"svgHeight",null);const Qe=$e=qe([v.observer],$e);var et=n(6240);function tt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var nt=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,o;return t=e,o=[{key:"getOrganism",value:function(e,t){var n="NA";return c().find(e.compound,(function(o){if(-1!=c().indexOf(o.chain,t.toLowerCase())&&null!=e.source[o.mol_id])return n=e.source[o.mol_id].organism_scientific||n,o})),n}},{key:"getOrganismFromCache",value:function(t,n){if(!t)return"";var o=t.get(n.pdbId);return o&&o.data?e.getOrganism(o.data,n.chain):""}}],(n=null)&&tt(t.prototype,n),o&&tt(t,o),e}(),ot=n(48305);function rt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function it(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function at(e,t){return!t||"object"!==pt(t)&&"function"!=typeof t?lt(e):t}function lt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function st(e){return(st=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ct(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ut(e,t)}function ut(e,t){return(ut=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function pt(e){return(pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var ht=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":pt(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},dt=function(e){function t(){return it(this,t),at(this,st(t).apply(this,arguments))}return ct(t,e),t}(et.ZP),ft=function(e){function t(e){var n;return it(this,t),n=at(this,st(t).call(this,e)),(0,u.makeObservable)(lt(n)),n}var n,o,r;return ct(t,e),n=t,(o=[{key:"render",value:function(){return l.createElement(dt,{showColumnVisibility:!1,showCopyDownload:!1,itemsLabel:"PDB chain",itemsLabelPlural:"PDB chains",paginationProps:{showItemsPerPageSelector:!1,showMoreButton:!1},initialItemsPerPage:6,columns:this.columns,dataStore:this.props.dataStore,pageToHighlight:!0})}},{key:"columns",get:function(){var e=this,t=[];return t.push({name:"PDB Id",render:function(e){return l.createElement("a",{href:"http://www.rcsb.org/pdb/explore/explore.do?structureId=".concat(e.pdbId),target:"_blank"},e.pdbId)},sortBy:function(e){return e.pdbId},filter:function(e,t,n){return e.pdbId.toUpperCase().indexOf(n)>-1}}),t.push({name:"Chain",render:function(t){return l.createElement("span",null,l.createElement("span",{style:{float:"left",fontWeight:"bold",fontStyle:"italic"}},t.chain),l.createElement("a",{style:{float:"right",fontWeight:"bold",cursor:"pointer"},onClick:function(){e.props.dataStore.selectUid(e.props.dataStore.getChainUid(t))}},"3D"))},sortBy:function(e){return e.chain},filter:function(e,t,n){return e.chain.toUpperCase().indexOf(n)>-1}}),t.push({name:"Uniprot Positions",render:function(e){return l.createElement("span",null,"".concat(e.uniprotStart,"-").concat(e.uniprotEnd))},sortBy:function(e){return[e.uniprotStart,e.uniprotEnd]},filter:function(e,t){return(e.uniprotStart+"").indexOf(t)>-1||(e.uniprotEnd+"").indexOf(t)>-1}}),t.push({name:"Organism",render:(0,ot.Z)((function(t){return e.props.cache?e.props.cache.get(t.pdbId):null}),(function(e,t){return l.createElement("span",null,nt.getOrganism(e,t.chain))})),sortBy:function(t){return nt.getOrganismFromCache(e.props.cache,t)},filter:function(t,n,o){return(nt.getOrganismFromCache(e.props.cache,t)||"").toUpperCase().indexOf(o)>-1},visible:!!this.props.cache}),t.push({name:"Summary",render:function(t){return l.createElement(fe,{pdbId:t.pdbId,chainId:t.chain,cache:e.props.cache,truncateText:!1,summaryFormat:!0})},filter:function(t,n,o){if(!e.props.cache)return!1;var r=e.props.cache.get(t.pdbId);if(r&&r.data){var i=(0,K.sU)(r.data,t.chain);return i.pdbInfo.toUpperCase().indexOf(o)>-1||(i.moleculeInfo||"").toUpperCase().indexOf(o)>-1}return!1},visible:!!this.props.cache}),t}}])&&rt(n.prototype,o),r&&rt(n,r),t}(l.Component);ht([u.computed],ft.prototype,"columns",null);const mt=ft=ht([v.observer],ft);var yt=n(30080),bt=n(76865),vt=n(31294);function gt(){return(gt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function Ct(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function Et(e){return(Et=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function St(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Ot(e,t){return(Ot=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Pt(e){return(Pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var wt=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":Pt(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},_t=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t){return!t||"object"!==Pt(t)&&"function"!=typeof t?St(e):t}(this,Et(t).call(this,e)),Object.defineProperty(St(n),"isExpanded",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(St(n),"pdbChainTableShown",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(St(n),"hoveredChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(St(n),"hitZoneConfig",{enumerable:!0,configurable:!0,writable:!0,value:{x:0,y:0,width:0,height:0,onClick:function(){}}}),Object.defineProperty(St(n),"chainDiv",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(St(n),"_chainScrollY",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(St(n),"collapseTimeout",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(St(n),"expandTimeout",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(St(n),"chainUidToY",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(St(n),"onChainSelectReaction",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(St(n),"expandDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:750}),Object.defineProperty(St(n),"collapseDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:3e3}),Object.defineProperty(St(n),"handlers",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),(0,u.makeObservable)(St(n)),n.handlers={onMouseEnter:(0,u.action)((function(){n.expandTimeout=window.setTimeout((function(){n.isExpanded=!0}),n.expandDelayMs),n.collapseTimeout&&window.clearTimeout(n.collapseTimeout)})),onMouseLeave:(0,u.action)((function(){n.collapseTimeout=window.setTimeout((function(){n.isExpanded=!1}),n.collapseDelayMs),n.expandTimeout&&window.clearTimeout(n.expandTimeout)})),chainDivRef:function(e){n.chainDiv=e},onChainScroll:function(){n.chainDiv&&n.isExpanded&&(n._chainScrollY=n.chainDiv.scrollTop)},togglePDBTable:(0,u.action)((function(){n.pdbChainTableShown=!n.pdbChainTableShown})),getTooltipContent:function(){return n.hoveredChain?l.createElement(fe,{pdbId:n.hoveredChain.pdbId,chainId:n.hoveredChain.chain,cache:n.props.pdbHeaderCache}):null},setHitZone:function(e,t){n.hitZoneConfig.x=e.x,n.hitZoneConfig.y=e.y,n.hitZoneConfig.width=e.width,n.hitZoneConfig.height=e.height,n.hitZoneConfig.onClick=function(){n.selectChain(t)},n.hoveredChain=n.props.store.pdbChainDataStore.getPdbChain(t)},setChainUidToY:function(e){n.chainUidToY=e}},n.onChainSelectReaction=(0,u.reaction)((function(){return n.props.store.pdbChainDataStore.selectedUid}),(function(e){var t=n.chainUidToY[e];if(void 0!==t&&(t<n.chainDiv.scrollTop||t>n.chainDiv.scrollTop+n.props.maxChainsHeight)){var o=n.props.maxChainsHeight/2;n.chainDiv.scrollTop=t-o}})),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Ot(e,t)}(t,e),n=t,(o=[{key:"componentWillUnmount",value:function(){this.onChainSelectReaction()}},{key:"selectChain",value:function(e){this.props.store.pdbChainDataStore.selectUid(e)}},{key:"componentDidMount",value:function(){var e=this;(0,vt.Z)((function(){return e.props.store.pdbChainDataStore.selectFirstChain()}))}},{key:"componentDidUpdate",value:function(){var e=this;(0,vt.Z)((function(){e.chainDiv&&(e.chainDiv.scrollTop=e.chainScrollY)}))}},{key:"helpTooltipContent",value:function(){return l.createElement("div",{style:{maxWidth:400}},"This panel displays a list of PDB chains for the corresponding uniprot ID. PDB chains are ranked with respect to their sequence similarity ratio, and aligned to the y-axis of the mutation diagram. Highly ranked chains have darker color than the lowly ranked ones.",l.createElement("br",null),l.createElement("br",null),"Each chain is represented by a single rectangle. Gaps within the chains are represented by a thin line connecting the segments of the chain.",l.createElement("br",null),l.createElement("br",null),"By default, only a first few rows are displayed. To see more chains, use the scroll bar next to the panel. To see the detailed list of all available PDB chains in a table click on the link below the panel.",l.createElement("br",null),l.createElement("br",null),"To select a chain, simply click on it. Selected chain is highlighted with a different frame color. You can also select a chain by clicking on a row in the table. Selecting a chain reloads the PDB data for the 3D structure visualizer.")}},{key:"render",value:function(){var e={};return this.tooltipVisible||(e.visible=!1),l.createElement("div",{onMouseEnter:this.handlers.onMouseEnter,onMouseLeave:this.handlers.onMouseLeave},l.createElement(yt.Collapse,{isOpened:this.isOpen},l.createElement("div",{style:{position:"relative"}},l.createElement("div",{className:"small",style:{position:"absolute"}},l.createElement("span",{style:{marginLeft:16}},"PDB Chains"),l.createElement(O.ZD,{placement:"left",overlay:this.helpTooltipContent,destroyTooltipOnHide:!0},l.createElement("i",{className:"fa fa-info-circle",style:{paddingLeft:3}}))),l.createElement("div",{ref:this.handlers.chainDivRef,style:{overflowY:"scroll",maxHeight:this.props.maxChainsHeight,marginLeft:this.props.geneXOffset,position:"relative"},onScroll:this.handlers.onChainScroll},l.createElement(Qe,{width:this.props.geneWidth,chains:this.chains,proteinLength:this.proteinLength,setHitZone:this.handlers.setHitZone,selectedChainUid:this.props.store.pdbChainDataStore.selectedUid,setChainUidToY:this.handlers.setChainUidToY}),l.createElement(O.ZD,gt({placement:"top",overlay:this.handlers.getTooltipContent},e),this.hitZone)),l.createElement("br",null),l.createElement("div",{style:{display:this.isExpanded?"inherit":"none"}},l.createElement("button",{onClick:this.handlers.togglePDBTable,className:"btn btn-default"},this.pdbChainTableShown?"Hide PDB Chain Table":"Show PDB Chain Table"),l.createElement("div",{style:{display:this.pdbChainTableShown?"inherit":"none",maxWidth:this.props.geneWidth}},l.createElement(mt,{dataStore:this.props.store.pdbChainDataStore,cache:this.props.pdbHeaderCache}))),l.createElement("br",null))))}},{key:"chainScrollY",get:function(){return this.isExpanded?this._chainScrollY:0}},{key:"isOpen",get:function(){return!!this.props.store.pdbChainDataStore.selectedChain}},{key:"displayChains",get:function(){return this.props.store.pdbChainDataStore.selectedChain?this.isExpanded?this.props.store.pdbChainDataStore.allData:[this.props.store.pdbChainDataStore.selectedChain]:[]}},{key:"chains",get:function(){var e=this;return this.displayChains.map((function(t){for(var n=[],o=-1,r=t.alignment,i=0;i<r.length;i++)r[i]===bt.rG?-1===o&&(o=i):-1!==o&&(n.push({start:t.uniprotStart+o,end:t.uniprotStart+i}),o=-1);return{start:t.uniprotStart,end:t.uniprotEnd+1,gaps:n,opacity:t.identityPerc,uid:e.props.store.pdbChainDataStore.getChainUid(t)}}))}},{key:"proteinLength",get:function(){var e=this.props.store.canonicalTranscript.result&&this.props.store.canonicalTranscript.result.proteinLength||0;return Math.max(e,1)}},{key:"tooltipVisible",get:function(){return null!==this.handlers.getTooltipContent()}},{key:"hitZone",get:function(){return l.createElement(O.Vd,{x:this.hitZoneConfig.x,y:this.hitZoneConfig.y,width:this.hitZoneConfig.width,height:this.hitZoneConfig.height,onClick:this.hitZoneConfig.onClick,cursor:"pointer"})}}])&&Ct(n.prototype,o),r&&Ct(n,r),t}(l.Component);wt([u.observable],_t.prototype,"isExpanded",void 0),wt([u.observable],_t.prototype,"pdbChainTableShown",void 0),wt([u.observable],_t.prototype,"hoveredChain",void 0),wt([u.observable],_t.prototype,"hitZoneConfig",void 0),wt([u.computed],_t.prototype,"chainScrollY",null),wt([u.action],_t.prototype,"selectChain",null),wt([u.computed],_t.prototype,"isOpen",null),wt([u.computed],_t.prototype,"displayChains",null),wt([u.computed],_t.prototype,"chains",null),wt([u.computed],_t.prototype,"proteinLength",null),wt([u.computed],_t.prototype,"tooltipVisible",null),wt([u.computed],_t.prototype,"hitZone",null);const Tt=_t=wt([v.observer],_t);var kt=n(22157),It=n(64577),Dt=n(65463),Mt=n.n(Dt),Rt=n(425),Nt=n.n(Rt);function jt(){return(jt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function Vt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function xt(e){return(xt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Bt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function At(e,t){return(At=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ut(e){return(Ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var Ft=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":Ut(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},Lt=[O.M7.MISSENSE_PUTATIVE_DRIVER,O.M7.TRUNCATING_PUTATIVE_DRIVER,O.M7.INFRAME_PUTATIVE_DRIVER,O.M7.SPLICE_PUTATIVE_DRIVER,O.M7.FUSION_PUTATIVE_DRIVER],Ht=[O.M7.MISSENSE_UNKNOWN_SIGNIFICANCE,O.M7.TRUNCATING_UNKNOWN_SIGNIFICANCE,O.M7.INFRAME_UNKNOWN_SIGNIFICANCE,O.M7.SPLICE_UNKNOWN_SIGNIFICANCE,O.M7.FUSION_UNKNOWN_SIGNIFICANCE];function Wt(e,t,n,o){var r=[];return t.includes(e)?r=o:n.length!==o.length&&(r=n.map((function(e){return e.value}))),r}var Yt=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t){return!t||"object"!==Ut(t)&&"function"!=typeof t?Bt(e):t}(this,xt(t).call(this,e)),Object.defineProperty(Bt(n),"settingMenuVisible",{enumerable:!0,configurable:!0,writable:!0,value:!1}),(0,u.makeObservable)(Bt(n)),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&At(e,t)}(t,e),n=t,(o=[{key:"getDriverVsVusOptionLabel",value:function(e){var t=l.createElement("button",{style:{marginLeft:5,marginRight:5,padding:"0px 4px 0px 4px",height:18},className:"btn btn-primary",onClick:this.onSettingMenuClick},l.createElement("i",{className:"fa fa-sliders",style:{fontSize:12,display:"flex",alignItems:"center",justifyContent:"center"}}));return e.value===O.Ou.DRIVER?l.createElement("span",null,e.label||e.value,l.createElement("span",{className:Nt()["driver-annotation-setting"]},l.createElement(O.ZD,{placement:"top",overlay:l.createElement("span",null,"Change driver filtering in"," ",t)},t))):l.createElement("span",null,e.label||e.value)}},{key:"onDriverVsVusSelect",value:function(e,t){var n=Wt(O.Ou.DRIVER,e,this.selectedDriverMutationTypeValues,Lt),o=Wt(O.Ou.VUS,e,this.selectedVUSMutationTypeValues,Ht);this.props.onSelect&&this.props.onSelect(n.concat(o),t)}},{key:"onSettingMenuClick",value:function(e){e.stopPropagation(),this.settingMenuVisible=!this.settingMenuVisible,this.props.onClickSettingMenu&&this.props.onClickSettingMenu(this.settingMenuVisible)}},{key:"render",value:function(){return l.createElement("div",{className:Nt()["legend-panel"]},l.createElement(d.jI,jt({options:this.driverVsVusOptions,getOptionLabel:this.getDriverVsVusOptionLabel,getBadgeLabel:d.H$,selectedValues:this.selectedDriverVsVusValues.map((function(e){return{value:e}}))},this.props,{onSelect:this.onDriverVsVusSelect})),l.createElement("hr",{style:{marginBottom:5}}),l.createElement(d.jI,jt({options:this.options,getOptionLabel:d.Mn,getBadgeLabel:d.H$},this.props,{onSelect:this.props.onSelect})))}},{key:"selectedMutationTypeValues",get:function(){return(0,d.L5)((0,d.EV)(this.options),this.props.filter)}},{key:"selectedDriverMutationTypeValues",get:function(){return this.selectedMutationTypeValues.filter((function(e){return Lt.includes(e.value)}))}},{key:"selectedVUSMutationTypeValues",get:function(){return this.selectedMutationTypeValues.filter((function(e){return Ht.includes(e.value)}))}},{key:"selectedDriverVsVusValues",get:function(){if(this.props.annotatedProteinImpactTypeFilter){var e=[];return c().intersection(this.props.annotatedProteinImpactTypeFilter.values,Lt).length===Lt.length&&e.push(O.Ou.DRIVER),c().intersection(this.props.annotatedProteinImpactTypeFilter.values,Ht).length===Ht.length&&e.push(O.Ou.VUS),e}return[O.Ou.DRIVER,O.Ou.VUS]}},{key:"optionDisplayValueMap",get:function(){return(0,P.Oi)(this.proteinImpactTypeColors)}},{key:"proteinImpactTypeColors",get:function(){return(0,P.av)(this.props.colors)}},{key:"options",get:function(){var e=this;return P.mW.map((function(t){return{value:t,label:e.optionDisplayValueMap[t],badgeContent:e.props.counts?e.props.counts[t]:void 0,badgeStyleOverride:{backgroundColor:e.proteinImpactTypeColors[t]}}})).filter((function(e){return!(e.value===O.M7.OTHER&&0===e.badgeContent)}))}},{key:"driverVsVusOptions",get:function(){var e=this;return[{value:O.Ou.DRIVER,label:this.optionDisplayValueMap[O.Ou.DRIVER],badgeContent:this.props.counts?c().reduce(Lt,(function(t,n){return t+e.props.counts[n]}),0):void 0,badgeStyleOverride:{backgroundColor:this.proteinImpactTypeColors[O.Ou.DRIVER]}},{value:O.Ou.VUS,label:this.optionDisplayValueMap[O.Ou.VUS],badgeContent:this.props.counts?c().reduce(Ht,(function(t,n){return t+e.props.counts[n]}),0):void 0,badgeStyleOverride:{backgroundColor:this.proteinImpactTypeColors[O.Ou.VUS]}}]}}])&&Vt(n.prototype,o),r&&Vt(n,r),t}(d.$h);Object.defineProperty(Yt,"defaultProps",{enumerable:!0,configurable:!0,writable:!0,value:{colors:d.tf,alignColumns:!0,unselectOthersWhenAllSelected:!1,numberOfColumnsPerRow:2}}),Ft([u.observable],Yt.prototype,"settingMenuVisible",void 0),Ft([u.computed],Yt.prototype,"selectedMutationTypeValues",null),Ft([u.computed],Yt.prototype,"selectedDriverMutationTypeValues",null),Ft([u.computed],Yt.prototype,"selectedVUSMutationTypeValues",null),Ft([u.computed],Yt.prototype,"selectedDriverVsVusValues",null),Ft([u.action.bound],Yt.prototype,"getDriverVsVusOptionLabel",null),Ft([u.action.bound],Yt.prototype,"onDriverVsVusSelect",null),Ft([u.action.bound],Yt.prototype,"onSettingMenuClick",null);const Zt=Yt=Ft([v.observer],Yt);var Gt=n(41940);function zt(){return(zt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}).apply(this,arguments)}function Xt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Kt(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function qt(e){return(qt=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Jt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $t(e,t){return($t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Qt(e){return(Qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var en=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":Qt(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var l=e.length-1;l>=0;l--)(r=e[l])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},tn=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=function(e,t){return!t||"object"!==Qt(t)&&"function"!=typeof t?Jt(e):t}(this,qt(t).call(this,e)),Object.defineProperty(Jt(n),"legendColorCodes",{enumerable:!0,configurable:!0,writable:!0,value:l.createElement("div",{style:{maxWidth:700,marginTop:5}},l.createElement("strong",{style:{color:"#2153AA"}},"Color Codes"),l.createElement("p",null,"Mutation diagram circles are colored with respect to the corresponding mutation types. In case of different mutation types at a single position, color of the circle is determined with respect to the most frequent mutation type."),l.createElement("br",null),l.createElement("div",null,"Mutation types and corresponding color codes are as follows:",l.createElement("ul",null,l.createElement("li",null,l.createElement("strong",{style:{color:d.tf.missenseColor}},"Missense Mutations"),void 0!==n.props.isPutativeDriver&&l.createElement("span",null,"(putative driver)")),void 0!==n.props.isPutativeDriver&&l.createElement("li",null,l.createElement("strong",{style:{color:d.tf.missenseVusColor}},"Missense Mutations"),void 0!==n.props.isPutativeDriver&&l.createElement("span",null,"(unknown significance)")),l.createElement("li",null,l.createElement("strong",{style:{color:d.tf.truncatingColor}},"Truncating Mutations"),void 0!==n.props.isPutativeDriver&&l.createElement("span",null,"(putative driver)"),": Nonsense, Nonstop, Frameshift deletion, Frameshift insertion, Splice site"),void 0!==n.props.isPutativeDriver&&l.createElement("li",null,l.createElement("strong",{style:{color:d.tf.truncatingVusColor}},"Truncating Mutations"),void 0!==n.props.isPutativeDriver&&l.createElement("span",null,"(unknown significance)"),": Nonsense, Nonstop, Frameshift deletion, Frameshift insertion, Splice site"),l.createElement("li",null,l.createElement("strong",{style:{color:d.tf.inframeColor}},"Inframe Mutations"),void 0!==n.props.isPutativeDriver&&l.createElement("span",null,"(putative driver)"),": Inframe deletion, Inframe insertion"),void 0!==n.props.isPutativeDriver&&l.createElement("li",null,l.createElement("strong",{style:{color:d.tf.inframeVusColor}},"Inframe Mutations"),void 0!==n.props.isPutativeDriver&&l.createElement("span",null,"(unknown significance)"),": Inframe deletion, Inframe insertion"),l.createElement("li",null,l.createElement("strong",{style:{color:d.tf.spliceColor}},"Splice Mutations"),void 0!==n.props.isPutativeDriver&&l.createElement("span",null,"(putative driver)")),void 0!==n.props.isPutativeDriver&&l.createElement("li",null,l.createElement("strong",{style:{color:d.tf.spliceVusColor}},"Splice Mutations"),void 0!==n.props.isPutativeDriver&&l.createElement("span",null,"(unknown significance)")),l.createElement("li",null,l.createElement("strong",{style:{color:d.tf.fusionColor}},"Fusion Mutations")),l.createElement("li",null,l.createElement("strong",{style:{color:d.tf.otherColor}},"Other Mutations"),": All other types of mutations"))))}),(0,u.makeObservable)(Jt(n)),n}var n,o,r;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&$t(e,t)}(t,e),n=t,(o=[{key:"getTrackDataStatus",value:function(){var e,t,n=this.props.store.oncoKbData.status;"complete"===n&&c().isEmpty(this.props.store.oncoKbDataByProteinPosStart)&&(n="empty");var o=this.props.store.indexedHotspotData.status;"complete"===o&&c().isEmpty(this.props.store.hotspotsByPosition)&&(o="empty");var r=this.props.store.alignmentData.status;"complete"===r&&0===this.props.store.pdbChainDataStore.allData.length&&(r="empty");var i=this.props.store.ptmData.status,a=i,l=i;"complete"===i&&(this.props.store.ptmData.result?(0===this.props.store.ptmData.result.filter((function(e){return e.source===Gt.XJ.dbPTM})).length&&(a="empty"),0===this.props.store.ptmData.result.filter((function(e){return e.source===Gt.XJ.Uniprot})).length&&(l="empty")):(a="empty",l="empty"));var s=this.props.store.uniprotTopologyData.status;return"complete"===s&&0===(null===(t=this.props.store.uniprotTopologyData.result)||void 0===t?void 0:t.length)&&(s="empty"),Xt(e={},d.hh.OncoKB,n),Xt(e,d.hh.CancerHotspots,o),Xt(e,d.hh.dbPTM,a),Xt(e,d.hh.UniprotPTM,l),Xt(e,d.hh.PDB,r),Xt(e,d.hh.Exon,"complete"),Xt(e,d.hh.UniprotTopology,s),e}},{key:"getWindowWrapper",value:function(){return It.Z}},{key:"getMutationRateSummary",value:function(){return null}},{key:"groupDataByProteinImpactType",value:function(e){var t=Object.values(O.M7).map((function(e){return{group:e,filter:{type:d.O7.PROTEIN_IMPACT_TYPE,values:[e]}}})),n=(0,d.__)(t,e,(0,P.o9)(this.props.isPutativeDriver));return c().keyBy(n,(function(e){return e.group}))}},{key:"render",value:function(){return l.createElement("div",null,this.structureViewerPanel,l.createElement(f.Z,{center:!0,size:"big",isLoading:this.isLoading}),!this.isLoading&&l.createElement("div",null,l.createElement("div",{style:{display:"flex"}},l.createElement("div",{className:"borderedChart",style:{marginRight:10}},this.mutationPlot,this.proteinChainPanel),l.createElement("div",{className:"mutationMapperMetaColumn"},this.geneSummary,this.mutationRateSummary,this.mutationFilterPanel,this.view3dButton)),l.createElement("hr",{style:{marginTop:20}}),this.mutationTable))}},{key:"open3dPanel",value:function(){this.trackVisibility[d.hh.PDB]="visible"}},{key:"close3dPanel",value:function(){this.trackVisibility[d.hh.PDB]="hidden"}},{key:"toggle3dPanel",value:function(){this.is3dPanelOpen?this.close3dPanel():this.open3dPanel()}},{key:"onTrackVisibilityChange",value:function(e){var t=this;"hidden"===this.trackVisibility[d.hh.PDB]&&e.includes(d.hh.PDB)?this.open3dPanel():"visible"!==this.trackVisibility[d.hh.PDB]||e.includes(d.hh.PDB)||this.close3dPanel(),Object.keys(this.trackVisibility).forEach((function(e){return t.trackVisibility[e]="hidden"})),e.forEach((function(e){return t.trackVisibility[e]="visible"}))}},{key:"onProteinImpactTypeSelect",value:function(e,t){(0,d.UK)(e.map((function(e){return e.toLowerCase()})),t,this.store.dataStore,void 0===this.props.isPutativeDriver?d.O7.PROTEIN_IMPACT_TYPE:P.F4,void 0===this.props.isPutativeDriver?kt.Sb:P.$5)}},{key:"is3dPanelOpen",get:function(){return"visible"===this.trackVisibility[d.hh.PDB]}},{key:"multipleMutationInfo",get:function(){var e=this.props.store.dataStore.duplicateMutationCountInMultipleSamples,t=1===e?"mutation":"mutations";return e>0?": includes ".concat(e," duplicate ").concat(t," in patients with multiple samples"):""}},{key:"itemsLabelPlural",get:function(){return"Mutations".concat(this.multipleMutationInfo)}},{key:"proteinImpactTypeFilter",get:function(){return(0,kt.eK)(this.store.dataStore.dataFilters)}},{key:"annotatedProteinImpactTypeFilter",get:function(){return this.store.dataStore.dataFilters.find((function(e){return e.type===P.F4}))}},{key:"mutationFilterPanel",get:function(){return l.createElement("div",null,this.props.isPutativeDriver?l.createElement("div",{style:{paddingBottom:this.props.compactStyle?5:15}},l.createElement(Zt,{filter:this.proteinImpactTypeFilter,counts:this.mutationCountsByProteinImpactType,onSelect:this.onProteinImpactTypeSelect,onClickSettingMenu:this.props.onClickSettingMenu,annotatedProteinImpactTypeFilter:this.annotatedProteinImpactTypeFilter})):l.createElement("div",{style:{paddingBottom:15,paddingTop:15}},l.createElement(d.$h,{filter:this.proteinImpactTypeFilter,counts:this.mutationCountsByProteinImpactType,onSelect:this.onProteinImpactTypeSelect})))}},{key:"mutationsGroupedByProteinImpactType",get:function(){var e=this,t=this.store.dataStore.dataFilters.filter((function(e){return e.type!==d.O7.PROTEIN_IMPACT_TYPE&&e.type!==P.F4})),n=(0,d.XN)(this.store.dataStore.allData,t,this.store.dataStore.applyFilter);return n=n.filter((function(t){return e.store.dataStore.applyLazyMobXTableFilter(t)})),this.groupDataByProteinImpactType(n)}},{key:"mutationCountsByProteinImpactType",get:function(){var e=this,t={};return Object.keys(this.mutationsGroupedByProteinImpactType).forEach((function(n){var o=e.mutationsGroupedByProteinImpactType[n];t[o.group]=o.data.length})),t}},{key:"structureViewerPanel",get:function(){return this.is3dPanelOpen?l.createElement(Ne,zt({mutationDataStore:this.props.store.dataStore,pdbChainDataStore:this.props.store.pdbChainDataStore,pdbAlignmentIndex:this.props.store.indexedAlignmentData,pdbHeaderCache:this.props.pdbHeaderCache,residueMappingCache:this.props.store.residueMappingCache,uniprotId:this.props.store.uniprotId.result,onClose:this.close3dPanel},d.tf)):null}},{key:"mutationPlot",get:function(){var e=this;return l.createElement(d.Dt,{store:this.props.store,pubMedCache:this.props.pubMedCache,mutationAlignerCache:this.mutationAlignerCache,onXAxisOffset:this.onXAxisOffset,geneWidth:this.geneWidth,tracks:this.tracks,trackVisibility:this.trackVisibility,trackDataStatus:this.trackDataStatus,onTrackVisibilityChange:this.onTrackVisibilityChange,getLollipopColor:function(t){return(0,d.bv)(t,void 0,void 0,e.props.isPutativeDriver)},isPutativeDriver:this.props.isPutativeDriver,filterResetPanel:this.props.store.dataStore.showingAllData||null===this.filterResetPanel?void 0:this.filterResetPanel,legend:this.legendColorCodes})}},{key:"tracks",get:function(){var e=[];return this.props.enableHotspot&&e.push(d.hh.CancerHotspots),this.props.enableOncoKb&&e.push(d.hh.OncoKB),this.props.ptmSources?(this.props.ptmSources.includes(Gt.XJ.dbPTM)&&e.push(d.hh.dbPTM),this.props.ptmSources.includes(Gt.XJ.Uniprot)&&e.push(d.hh.UniprotPTM)):e.push(d.hh.dbPTM),e.push(d.hh.Exon),e.push(d.hh.UniprotTopology),e.push(d.hh.PDB),e}},{key:"proteinChainPanel",get:function(){return this.is3dPanelOpen?l.createElement(Tt,{store:this.props.store,pdbHeaderCache:this.props.pdbHeaderCache,geneWidth:this.geneWidth,geneXOffset:this.lollipopPlotGeneX,maxChainsHeight:200}):null}},{key:"view3dButton",get:function(){return l.createElement("button",{className:"btn btn-default btn-sm",disabled:0===this.props.store.pdbChainDataStore.allData.length,onClick:this.toggle3dPanel,"data-test":"view3DStructure"},"View 3D Structure")}},{key:"filterResetPanel",get:function(){var e=this.props.store.dataStore;return l.createElement(d.$S,{resetFilters:function(){return e.resetFilters()},filterInfo:"Showing ".concat(e.tableData.length," of ").concat(e.allData.length," mutations."),className:h()("alert","alert-success",Mt().filterResetPanel),buttonClass:"btn btn-default btn-xs"})}},{key:"isMutationTableDataLoading",get:function(){return!1}},{key:"mutationTableComponent",get:function(){return null}}])&&Kt(n.prototype,o),r&&Kt(n,r),t}(d.$C);en([u.computed],tn.prototype,"is3dPanelOpen",null),en([u.computed],tn.prototype,"multipleMutationInfo",null),en([u.computed],tn.prototype,"itemsLabelPlural",null),en([u.computed],tn.prototype,"proteinImpactTypeFilter",null),en([u.computed],tn.prototype,"annotatedProteinImpactTypeFilter",null),en([u.computed],tn.prototype,"mutationsGroupedByProteinImpactType",null),en([u.computed],tn.prototype,"mutationCountsByProteinImpactType",null),en([u.computed],tn.prototype,"tracks",null),en([u.action],tn.prototype,"open3dPanel",null),en([u.action.bound],tn.prototype,"close3dPanel",null),en([u.action.bound],tn.prototype,"toggle3dPanel",null),en([u.action.bound],tn.prototype,"onTrackVisibilityChange",null),en([u.action.bound],tn.prototype,"onProteinImpactTypeSelect",null)},83724:(e,t,n)=>{"use strict";function o(e){return{genomeNexusUrl:e.genomenexus_url||void 0,isoformOverrideSource:e.isoformOverrideSource,myGeneInfoUrlTemplate:e.mygene_info_url||void 0,uniprotIdUrlTemplate:e.uniprot_id_url||void 0,transcriptSummaryUrlTemplate:e.ensembl_transcript_url||void 0,enableOncoKb:e.show_oncokb,enableGenomeNexus:e.show_genomenexus,enableHotspot:e.show_hotspot,enableMyCancerGenome:e.mycancergenome_show,enableCivic:e.show_civic}}n.d(t,{R:()=>o})},2213:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var o=n(78566),r=n(19483),i=n(9337);function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var s=function(e,t,n,o){var r,i=arguments.length,a=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"===("undefined"==typeof Reflect?"undefined":l(Reflect))&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(i<3?r(a):i>3?r(t,n,a):r(t,n))||a);return i>3&&a&&Object.defineProperty(t,n,a),a},c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Object.defineProperty(this,"trackVisibility",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"columnVisibility",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"mergeOncoKbIcons",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),(0,o.makeObservable)(this),this.trackVisibility=(0,r.C6)(),this.mergeOncoKbIcons=(0,i.BZ)().mergeIcons}var t,n,l;return t=e,(n=[{key:"storeColumnVisibility",value:function(e){JSON.stringify(this.columnVisibility)!==JSON.stringify(e)&&(this.columnVisibility=e)}}])&&a(t.prototype,n),l&&a(t,l),e}();s([o.observable],c.prototype,"trackVisibility",void 0),s([o.observable],c.prototype,"columnVisibility",void 0),s([o.observable],c.prototype,"mergeOncoKbIcons",void 0),s([o.action.bound],c.prototype,"storeColumnVisibility",null)},425:e=>{e.exports={portalWidth:"badgeSelector-module__portalWidth__K0PY9",framedImage:"badgeSelector-module__framedImage__2U7ev","driver-annotation-setting":"badgeSelector-module__driver-annotation-setting__2XBQz","legend-panel":"badgeSelector-module__legend-panel__9F7Oe"}},65463:e=>{e.exports={portalWidth:"mutationMapper-module__portalWidth__t9qnu",framedImage:"mutationMapper-module__framedImage__2WV_N",filterResetPanel:"mutationMapper-module__filterResetPanel__2aFDu"}},10816:e=>{e.exports={portalWidth:"structureViewer-module__portalWidth__250aJ",framedImage:"structureViewer-module__framedImage__3OjST","main-3d-panel":"structureViewer-module__main-3d-panel__2asbr",header:"structureViewer-module__header__243uA",body:"structureViewer-module__body__3BGGR","collapsed-panel":"structureViewer-module__collapsed-panel__3T7vs","increased-size-panel":"structureViewer-module__increased-size-panel__1nCD-","default-option-select":"structureViewer-module__default-option-select__3EsrF","alpha-helix":"structureViewer-module__alpha-helix__3U1NC","beta-sheet":"structureViewer-module__beta-sheet__2rza2",loop:"structureViewer-module__loop__25tQU",highlighted:"structureViewer-module__highlighted__9IwJz","uniform-mutation":"structureViewer-module__uniform-mutation__2nUW-","missense-mutation":"structureViewer-module__missense-mutation__3m1Or","trunc-mutation":"structureViewer-module__trunc-mutation__1VdGC","inframe-mutation":"structureViewer-module__inframe-mutation__bSE4n"}}}]);