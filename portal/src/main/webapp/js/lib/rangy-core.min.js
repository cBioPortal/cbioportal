(function(w,R){"function"==typeof define&&define.amd?define(w):"undefined"!=typeof module&&"object"==typeof exports?module.exports=w():R.rangy=w()})(function(){function w(a,b){var g=typeof a[b];return"function"==g||!("object"!=g||!a[b])||"unknown"==g}function R(a,b){return!("object"!=typeof a[b]||!a[b])}function ya(a,b){return"undefined"!=typeof a[b]}function qa(a){return function(b,g){for(var h=g.length;h--;)if(!a(b,g[h]))return!1;return!0}}function za(a){return a&&ra(a,Ja)&&sa(a,Ka)}function Aa(a){return R(a,
"body")?a.body:a.getElementsByTagName("body")[0]}function W(a){"undefined"!=typeof console&&w(console,"log")&&console.log(a)}function P(a){k.initialized=!0;k.supported=!1;a="Rangy is not supported in this environment. Reason: "+a;E&&k.config.alertOnFail?alert(a):W(a)}function ta(){if(E&&!k.initialized){var a,b=!1,g=!1;w(document,"createRange")&&(a=document.createRange(),ra(a,La)&&sa(a,Ma)&&(b=!0));if((a=Aa(document))&&"body"==a.nodeName.toLowerCase())if(a&&w(a,"createTextRange")&&(a=a.createTextRange(),
za(a)&&(g=!0)),b||g){k.initialized=!0;k.features={implementsDomRange:b,implementsTextRange:g};var h,N;for(N in X)(h=X[N])instanceof na&&h.init(h,k);g=0;for(h=ua.length;g<h;++g)try{ua[g](k)}catch(C){b="Rangy init listener threw an exception. Continuing. Detail: "+(C.message||C.description||String(C)),W(b)}}else P("Neither Range nor TextRange are available");else P("No body element found")}}function Ba(a,b,g){g&&(a+=" in module "+g.name);k.warn("DEPRECATED: "+a+" is deprecated. Please use "+b+" instead.")}
function Ca(a,b,g,h){a[b]=function(){Ba(b,g,h);return a[g].apply(a,F.toArray(arguments))}}function Na(a){a=a||window;ta();for(var b=0,g=va.length;b<g;++b)va[b](a)}function na(a,b,g){this.name=a;this.dependencies=b;this.supported=this.initialized=!1;this.initializer=g}function Da(a,b,g){b=new na(a,b,function(b){if(!b.initialized){b.initialized=!0;try{g(k,b),b.supported=!0}catch(N){W("Module '"+a+"' failed to load: "+(N.message||N.description||String(N))),N.stack&&W(N.stack)}}});return X[a]=b}function Ea(){}
var Ma="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" "),La="setStart setStartBefore setStartAfter setEnd setEndBefore setEndAfter collapse selectNode selectNodeContents compareBoundaryPoints deleteContents extractContents cloneContents insertNode surroundContents cloneRange toString detach".split(" "),Ka="boundingHeight boundingLeft boundingTop boundingWidth htmlText text".split(" "),Ja="collapse compareEndPoints duplicate moveToElementText parentElement select setEndPoint getBoundingClientRect".split(" "),
ra=qa(w),Y=qa(R),sa=qa(ya),X={},E="undefined"!=typeof window&&"undefined"!=typeof document,F={isHostMethod:w,isHostObject:R,isHostProperty:ya,areHostMethods:ra,areHostObjects:Y,areHostProperties:sa,isTextRange:za,getBody:Aa,forEach:[].forEach?function(a,b){a.forEach(b)}:function(a,b){for(var g=0,h=a.length;g<h;++g)b(a[g],g)}},k={version:"1.3.1-dev",initialized:!1,isBrowser:E,supported:!0,util:F,features:{},modules:X,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:"undefined"==
typeof rangyAutoInitialize?!0:rangyAutoInitialize}};k.fail=P;k.warn=function(a){a="Rangy warning: "+a;E&&k.config.alertOnWarn?alert(a):W(a)};var oa;({}).hasOwnProperty?(F.extend=oa=function(a,b,g){var h,N,k;for(k in b)b.hasOwnProperty(k)&&(h=a[k],N=b[k],g&&null!==h&&"object"==typeof h&&null!==N&&"object"==typeof N&&oa(h,N,!0),a[k]=N);b.hasOwnProperty("toString")&&(a.toString=b.toString);return a},F.createOptions=function(a,b){var g={};oa(g,b);a&&oa(g,a);return g}):P("hasOwnProperty not supported");
E||P("Rangy can only run in a browser");(function(){var a;if(E){var b=document.createElement("div");b.appendChild(document.createElement("span"));var g=[].slice;try{1==g.call(b.childNodes,0)[0].nodeType&&(a=function(a){return g.call(a,0)})}catch(h){}}a||(a=function(a){for(var b=[],g=0,k=a.length;g<k;++g)b[g]=a[g];return b});F.toArray=a})();var pa;E&&(w(document,"addEventListener")?pa=function(a,b,g){a.addEventListener(b,g,!1)}:w(document,"attachEvent")?pa=function(a,b,g){a.attachEvent("on"+b,g)}:
P("Document does not have required addEventListener or attachEvent method"),F.addListener=pa);var ua=[];F.deprecationNotice=Ba;F.createAliasForDeprecatedMethod=Ca;k.init=ta;k.addInitListener=function(a){k.initialized?a(k):ua.push(a)};var va=[];k.addShimListener=function(a){va.push(a)};E&&(k.shim=k.createMissingNativeApi=Na,Ca(k,"createMissingNativeApi","shim"));na.prototype={init:function(){for(var a=this.dependencies||[],b=0,g=a.length,h,k;b<g;++b){k=a[b];h=X[k];if(!(h&&h instanceof na))throw Error("required module '"+
k+"' not found");h.init();if(!h.supported)throw Error("required module '"+k+"' not supported");}this.initializer(this)},fail:function(a){this.initialized=!0;this.supported=!1;throw Error(a);},warn:function(a){k.warn("Module "+this.name+": "+a)},deprecationNotice:function(a,b){k.warn("DEPRECATED: "+a+" in module "+this.name+" is deprecated. Please use "+b+" instead")},createError:function(a){return Error("Error in Rangy "+this.name+" module: "+a)}};k.createModule=function(a){var b,g;2==arguments.length?
(b=arguments[1],g=[]):(b=arguments[2],g=arguments[1]);b=Da(a,g,b);k.initialized&&k.supported&&b.init()};k.createCoreModule=function(a,b,g){Da(a,b,g)};k.RangePrototype=Ea;k.rangePrototype=new Ea;k.selectionPrototype=new function(){};k.createCoreModule("DomUtil",[],function(a,b){function g(n){for(var a=0;n=n.previousSibling;)++a;return a}function h(n,a){var b=[],d;for(d=n;d;d=d.parentNode)b.push(d);for(d=a;d;d=d.parentNode)if(r(b,d))return d;return null}function k(n,a,b){for(a=b?a:a.parentNode;a;){if(a===
n)return!0;a=a.parentNode}return!1}function C(n,a,b){for(b=b?n:n.parentNode;b;){n=b.parentNode;if(n===a)return b;b=n}return null}function ma(a){a=a.nodeType;return 3==a||4==a||8==a}function z(a,f){var b=f.nextSibling,d=f.parentNode;b?d.insertBefore(a,b):d.appendChild(a);return a}function x(a){if(9==a.nodeType)return a;if("undefined"!=typeof a.ownerDocument)return a.ownerDocument;if("undefined"!=typeof a.document)return a.document;if(a.parentNode)return x(a.parentNode);throw b.createError("getDocument: no document found for node");
}function K(a){a=x(a);if("undefined"!=typeof a.defaultView)return a.defaultView;if("undefined"!=typeof a.parentWindow)return a.parentWindow;throw b.createError("Cannot get a window object for node");}function Fa(a){if("undefined"!=typeof a.contentDocument)return a.contentDocument;if("undefined"!=typeof a.contentWindow)return a.contentWindow.document;throw b.createError("getIframeDocument: No Document object found for iframe element");}function Q(a){return a&&l.isHostMethod(a,"setTimeout")&&l.isHostObject(a,
"document")}function w(a){return a?ma(a)?'"'+a.data+'"':1==a.nodeType?"<"+a.nodeName+(a.id?' id="'+a.id+'"':"")+">[index:"+g(a)+",length:"+a.childNodes.length+"]["+(a.innerHTML||"[innerHTML not supported]").slice(0,25)+"]":a.nodeName:"[No node]"}function O(a){this._next=this.root=a}function I(a,f){this.node=a;this.offset=f}function d(a){this.code=this[a];this.codeName=a;this.message="DOMException: "+this.codeName}var l=a.util,G=l.getBody;l.areHostMethods(document,["createDocumentFragment","createElement",
"createTextNode"])||b.fail("document missing a Node creation method");l.isHostMethod(document,"getElementsByTagName")||b.fail("document missing getElementsByTagName method");var y=document.createElement("div");l.areHostMethods(y,["insertBefore","appendChild","cloneNode"])||b.fail("Incomplete Element implementation");l.isHostProperty(y,"innerHTML")||b.fail("Element is missing innerHTML property");y=document.createTextNode("test");l.areHostMethods(y,["splitText","deleteData","insertData","appendData",
"cloneNode"])||b.fail("Incomplete Text Node implementation");var r=function(a,f){for(var b=a.length;b--;)if(a[b]===f)return!0;return!1},p=!1;(function(){var n=document.createElement("b");n.innerHTML="1";n.innerHTML="<br />";p=!1;a.features.crashyTextNodes=p})();var q;"undefined"!=typeof window.getComputedStyle?q=function(a,f){return K(a).getComputedStyle(a,null)[f]}:"undefined"!=typeof document.documentElement.currentStyle?q=function(a,f){return a.currentStyle?a.currentStyle[f]:""}:b.fail("No means of obtaining computed style properties found");
O.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next,f;if(this._current){f=a.firstChild;if(!f)for(f=null;a!==this.root&&!(f=a.nextSibling);)a=a.parentNode;this._next=f}return this._current},detach:function(){this._current=this._next=this.root=null}};I.prototype={equals:function(a){return!!a&&this.node===a.node&&this.offset==a.offset},inspect:function(){return"[DomPosition("+w(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}};
d.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24};d.prototype.toString=function(){return this.message};a.dom={arrayContains:r,isHtmlNamespace:function(a){var f;return"undefined"==typeof a.namespaceURI||null===(f=a.namespaceURI)||"http://www.w3.org/1999/xhtml"==f},parentElement:function(a){a=a.parentNode;return 1==a.nodeType?a:null},getNodeIndex:g,getNodeLength:function(a){switch(a.nodeType){case 7:case 10:return 0;
case 3:case 8:return a.length;default:return a.childNodes.length}},getCommonAncestor:h,isAncestorOf:k,isOrIsAncestorOf:function(a,f){return k(a,f,!0)},getClosestAncestorIn:C,isCharacterDataNode:ma,isTextOrCommentNode:function(a){if(!a)return!1;a=a.nodeType;return 3==a||8==a},insertAfter:z,splitDataNode:function(a,f,b){var d=a.cloneNode(!1);d.deleteData(0,f);a.deleteData(f,a.length-f);z(d,a);if(b)for(var l=0,h;h=b[l++];)h.node==a&&h.offset>f?(h.node=d,h.offset-=f):h.node==a.parentNode&&h.offset>g(a)&&
++h.offset;return d},getDocument:x,getWindow:K,getIframeWindow:function(a){if("undefined"!=typeof a.contentWindow)return a.contentWindow;if("undefined"!=typeof a.contentDocument)return a.contentDocument.defaultView;throw b.createError("getIframeWindow: No Window object found for iframe element");},getIframeDocument:Fa,getBody:G,isWindow:Q,getContentDocument:function(a,f,b){var d;a?l.isHostProperty(a,"nodeType")?d=1==a.nodeType&&"iframe"==a.tagName.toLowerCase()?Fa(a):x(a):Q(a)&&(d=a.document):d=document;
if(!d)throw f.createError(b+"(): Parameter must be a Window object or DOM node");return d},getRootContainer:function(a){for(var f;f=a.parentNode;)a=f;return a},comparePoints:function(a,f,d,l){var G;if(a==d)return f===l?0:f<l?-1:1;if(G=C(d,a,!0))return f<=g(G)?-1:1;if(G=C(a,d,!0))return g(G)<l?-1:1;f=h(a,d);if(!f)throw Error("comparePoints error: nodes have no common ancestor");a=a===f?f:C(a,f,!0);d=d===f?f:C(d,f,!0);if(a===d)throw b.createError("comparePoints got to case 4 and childA and childB are the same!");
for(f=f.firstChild;f;){if(f===a)return-1;if(f===d)return 1;f=f.nextSibling}},isBrokenNode:function(a){return!1},inspectNode:w,getComputedStyleProperty:q,createTestElement:function(a,f,b){var d=G(a);a=a.createElement("div");a.contentEditable=""+!!b;f&&(a.innerHTML=f);(f=d.firstChild)?d.insertBefore(a,f):d.appendChild(a);return a},removeNode:function(a){return a.parentNode.removeChild(a)},fragmentFromNodeChildren:function(a){for(var f=x(a).createDocumentFragment(),d;d=a.firstChild;)f.appendChild(d);
return f},createIterator:function(a){return new O(a)},DomPosition:I};a.DOMException=d});k.createCoreModule("DomRange",["DomUtil"],function(a,b){function g(a,c){return 3!=a.nodeType&&(m(a,c.startContainer)||m(a,c.endContainer))}function h(a){return a.document||U(a.startContainer)}function k(a){return new H(a.parentNode,V(a))}function C(a){return new H(a.parentNode,V(a)+1)}function ma(a,c,e){var f=11==a.nodeType?a.firstChild:a;A(c)?e==c.length?u.insertAfter(a,c):c.parentNode.insertBefore(a,0==e?c:P(c,
e)):e>=c.childNodes.length?c.appendChild(a):c.insertBefore(a,c.childNodes[e]);return f}function z(a,c,e){f(a);f(c);if(h(c)!=h(a))throw new B("WRONG_DOCUMENT_ERR");var d=D(a.startContainer,a.startOffset,c.endContainer,c.endOffset);a=D(a.endContainer,a.endOffset,c.startContainer,c.startOffset);return e?0>=d&&0<=a:0>d&&0<a}function x(a){for(var c,e,f=h(a.range).createDocumentFragment();e=a.next();){c=a.isPartiallySelectedSubtree();e=e.cloneNode(!c);c&&(c=a.getSubtreeIterator(),e.appendChild(x(c)),c.detach());
if(10==e.nodeType)throw new B("HIERARCHY_REQUEST_ERR");f.appendChild(e)}return f}function K(a,c,e){var f,d;for(e=e||{stop:!1};f=a.next();)if(a.isPartiallySelectedSubtree())if(!1===c(f)){e.stop=!0;break}else{if(f=a.getSubtreeIterator(),K(f,c,e),f.detach(),e.stop)break}else for(f=u.createIterator(f);d=f.next();)if(!1===c(d)){e.stop=!0;return}}function w(a){for(var c;a.next();)a.isPartiallySelectedSubtree()?(c=a.getSubtreeIterator(),w(c),c.detach()):a.remove()}function Q(a){for(var c,e=h(a.range).createDocumentFragment(),
f;c=a.next();){a.isPartiallySelectedSubtree()?(c=c.cloneNode(!1),f=a.getSubtreeIterator(),c.appendChild(Q(f)),f.detach()):a.remove();if(10==c.nodeType)throw new B("HIERARCHY_REQUEST_ERR");e.appendChild(c)}return e}function E(a,c,e){var f=!(!c||!c.length),d,b=!!e;f&&(d=new RegExp("^("+c.join("|")+")$"));var v=[];K(new I(a,!1),function(c){if(!f||d.test(c.nodeType))if(!b||e(c)){var ha=a.startContainer;c==ha&&A(ha)&&a.startOffset==ha.length||(ha=a.endContainer,c==ha&&A(ha)&&0==a.endOffset||v.push(c))}});
return v}function O(a){return"["+("undefined"==typeof a.getName?"Range":a.getName())+"("+u.inspectNode(a.startContainer)+":"+a.startOffset+", "+u.inspectNode(a.endContainer)+":"+a.endOffset+")]"}function I(a,c){this.range=a;this.clonePartiallySelectedTextNodes=c;if(!a.collapsed){this.sc=a.startContainer;this.so=a.startOffset;this.ec=a.endContainer;this.eo=a.endOffset;var e=a.commonAncestorContainer;this.sc===this.ec&&A(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=
this.sc):(this._first=this._next=this.sc!==e||A(this.sc)?aa(this.sc,e,!0):this.sc.childNodes[this.so],this._last=this.ec!==e||A(this.ec)?aa(this.ec,e,!0):this.ec.childNodes[this.eo-1])}}function d(a){return function(c,e){for(var f,d=e?c:c.parentNode;d;){f=d.nodeType;if(da(a,f))return d;d=d.parentNode}return null}}function l(a,c){if(v(a,c))throw new B("INVALID_NODE_TYPE_ERR");}function G(a,c){if(!da(c,a.nodeType))throw new B("INVALID_NODE_TYPE_ERR");}function y(a,c){if(0>c||c>(A(a)?a.length:a.childNodes.length))throw new B("INDEX_SIZE_ERR");
}function r(a,e){if(c(a,!0)!==c(e,!0))throw new B("WRONG_DOCUMENT_ERR");}function p(a){if(e(a,!0))throw new B("NO_MODIFICATION_ALLOWED_ERR");}function q(a,c){return c<=(A(a)?a.length:a.childNodes.length)}function n(a){return!!a.startContainer&&!!a.endContainer&&!(ia&&(u.isBrokenNode(a.startContainer)||u.isBrokenNode(a.endContainer)))&&J(a.startContainer)==J(a.endContainer)&&q(a.startContainer,a.startOffset)&&q(a.endContainer,a.endOffset)}function f(a){if(!n(a))throw Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+
a.inspect()+")");}function T(a,c){f(a);var e=a.startContainer,d=a.startOffset,b=a.endContainer,v=a.endOffset,l=e===b;A(b)&&0<v&&v<b.length&&P(b,v,c);A(e)&&0<d&&d<e.length&&(e=P(e,d,c),l?(v-=d,b=e):b==e.parentNode&&v>=V(e)&&v++,d=0);a.setStartAndEnd(e,d,b,v)}function Z(a){f(a);var c=a.commonAncestorContainer.parentNode.cloneNode(!1);c.appendChild(a.cloneContents());return c.innerHTML}function Ga(a){a.START_TO_START=0;a.START_TO_END=1;a.END_TO_END=2;a.END_TO_START=3;a.NODE_BEFORE=0;a.NODE_AFTER=1;a.NODE_BEFORE_AND_AFTER=
2;a.NODE_INSIDE=3}function ca(a){Ga(a);Ga(a.prototype)}function F(a,c){return function(){f(this);var e=this.startContainer,d=this.startOffset,b=this.commonAncestorContainer,v=new I(this,!0);e!==b&&(e=aa(e,b,!0),d=C(e),e=d.node,d=d.offset);K(v,p);v.reset();b=a(v);v.detach();c(this,e,d,e,d);return b}}function ba(c,e){function d(a,c){return function(e){G(e,ja);G(J(e),ka);e=(a?k:C)(e);(c?b:v)(this,e.node,e.offset)}}function b(a,c,t){var f=a.endContainer,d=a.endOffset;if(c!==a.startContainer||t!==a.startOffset){if(J(c)!=
J(f)||1==D(c,t,f,d))f=c,d=t;e(a,c,t,f,d)}}function v(a,c,t){var f=a.startContainer,d=a.startOffset;if(c!==a.endContainer||t!==a.endOffset){if(J(c)!=J(f)||-1==D(c,t,f,d))f=c,d=t;e(a,f,d,c,t)}}var h=function(){};h.prototype=a.rangePrototype;c.prototype=new h;ea.extend(c.prototype,{setStart:function(a,c){l(a,!0);y(a,c);b(this,a,c)},setEnd:function(a,c){l(a,!0);y(a,c);v(this,a,c)},setStartAndEnd:function(){var a=arguments,c=a[0],t=a[1],f=c,d=t;switch(a.length){case 3:d=a[2];break;case 4:f=a[2],d=a[3]}e(this,
c,t,f,d)},setBoundary:function(a,c,e){this["set"+(e?"Start":"End")](a,c)},setStartBefore:d(!0,!0),setStartAfter:d(!1,!0),setEndBefore:d(!0,!1),setEndAfter:d(!1,!1),collapse:function(a){f(this);a?e(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):e(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(a){l(a,!0);e(this,a,0,a,la(a))},selectNode:function(a){l(a,!1);G(a,ja);var c=k(a);a=C(a);e(this,c.node,c.offset,a.node,a.offset)},
extractContents:F(Q,e),deleteContents:F(w,e),canSurroundContents:function(){f(this);p(this.startContainer);p(this.endContainer);var a=new I(this,!0),c=a._first&&g(a._first,this)||a._last&&g(a._last,this);a.detach();return!c},splitBoundaries:function(){T(this)},splitBoundariesPreservingPositions:function(a){T(this,a)},normalizeBoundaries:function(){f(this);var a=this.startContainer,c=this.startOffset,t=this.endContainer,d=this.endOffset,b=function(a){var c=a.nextSibling;c&&c.nodeType==a.nodeType&&
(t=a,d=a.length,a.appendData(c.data),S(c))},v=function(e){var f=e.previousSibling;if(f&&f.nodeType==e.nodeType){a=e;var b=e.length;c=f.length;e.insertData(0,f.data);S(f);a==t?(d+=c,t=a):t==e.parentNode&&(f=V(e),d==f?(t=e,d=b):d>f&&d--)}},l=!0;A(t)?d==t.length?b(t):0==d&&(b=t.previousSibling)&&b.nodeType==t.nodeType&&(d=b.length,a==t&&(l=!1),b.appendData(t.data),S(t),t=b):(0<d&&(l=t.childNodes[d-1])&&A(l)&&b(l),l=!this.collapsed);l?A(a)?0==c?v(a):c==a.length&&(b=a.nextSibling)&&b.nodeType==a.nodeType&&
(t==b&&(t=a,d+=a.length),a.appendData(b.data),S(b)):c<a.childNodes.length&&(b=a.childNodes[c])&&A(b)&&v(b):(a=t,c=d);e(this,a,c,t,d)},collapseToPoint:function(a,c){l(a,!0);y(a,c);this.setStartAndEnd(a,c)}});ca(c)}function fa(a){a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset;a.commonAncestorContainer=a.collapsed?a.startContainer:u.getCommonAncestor(a.startContainer,a.endContainer)}function L(a,c,e,f,d){a.startContainer=c;a.startOffset=e;a.endContainer=f;a.endOffset=d;a.document=
u.getDocument(c);fa(a)}function M(a){this.startContainer=a;this.startOffset=0;this.endContainer=a;this.endOffset=0;this.document=a;fa(this)}var u=a.dom,ea=a.util,H=u.DomPosition,B=a.DOMException,A=u.isCharacterDataNode,V=u.getNodeIndex,m=u.isOrIsAncestorOf,U=u.getDocument,D=u.comparePoints,P=u.splitDataNode,aa=u.getClosestAncestorIn,la=u.getNodeLength,da=u.arrayContains,J=u.getRootContainer,ia=a.features.crashyTextNodes,S=u.removeNode;I.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,
reset:function(){this._current=null;this._next=this._first},hasNext:function(){return!!this._next},next:function(){var a=this._current=this._next;a&&(this._next=a!==this._last?a.nextSibling:null,A(a)&&this.clonePartiallySelectedTextNodes&&(a===this.ec&&(a=a.cloneNode(!0)).deleteData(this.eo,a.length-this.eo),this._current===this.sc&&(a=a.cloneNode(!0)).deleteData(0,this.so)));return a},remove:function(){var a=this._current,c,e;!A(a)||a!==this.sc&&a!==this.ec?a.parentNode&&S(a):(c=a===this.sc?this.so:
0,e=a===this.ec?this.eo:a.length,c!=e&&a.deleteData(c,e-c))},isPartiallySelectedSubtree:function(){return g(this._current,this.range)},getSubtreeIterator:function(){var a;if(this.isSingleCharacterDataNode)a=this.range.cloneRange(),a.collapse(!1);else{a=new M(h(this.range));var c=this._current,e=c,f=0,d=c,b=la(c);m(c,this.sc)&&(e=this.sc,f=this.so);m(c,this.ec)&&(d=this.ec,b=this.eo);L(a,e,f,d,b)}return new I(a,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=
this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var ja=[1,3,4,5,7,8,10],ka=[2,9,11],R=[1,3,4,5,7,8,10,11],ga=[1,3,4,5,7,8],c=d([9,11]),e=d([5,6,10,12]),v=d([6,10,12]),Ha=document.createElement("style"),wa=!1;try{Ha.innerHTML="<b>x</b>",wa=3==Ha.firstChild.nodeType}catch(t){}a.features.htmlParsingConforms=wa;var xa="startContainer startOffset endContainer endOffset collapsed commonAncestorContainer".split(" ");ea.extend(a.rangePrototype,{compareBoundaryPoints:function(a,c){f(this);r(this.startContainer,
c.startContainer);var e=3==a||0==a?"start":"end",d=1==a||0==a?"start":"end";return D(this[e+"Container"],this[e+"Offset"],c[d+"Container"],c[d+"Offset"])},insertNode:function(a){f(this);G(a,R);p(this.startContainer);if(m(a,this.startContainer))throw new B("HIERARCHY_REQUEST_ERR");a=ma(a,this.startContainer,this.startOffset);this.setStartBefore(a)},cloneContents:function(){f(this);var a,c;if(this.collapsed)return h(this).createDocumentFragment();if(this.startContainer===this.endContainer&&A(this.startContainer))return a=
this.startContainer.cloneNode(!0),a.data=a.data.slice(this.startOffset,this.endOffset),c=h(this).createDocumentFragment(),c.appendChild(a),c;c=new I(this,!0);a=x(c);c.detach();return a},canSurroundContents:function(){f(this);p(this.startContainer);p(this.endContainer);var a=new I(this,!0),c=a._first&&g(a._first,this)||a._last&&g(a._last,this);a.detach();return!c},surroundContents:function(a){G(a,ga);if(!this.canSurroundContents())throw new B("INVALID_STATE_ERR");var c=this.extractContents();if(a.hasChildNodes())for(;a.lastChild;)a.removeChild(a.lastChild);
ma(a,this.startContainer,this.startOffset);a.appendChild(c);this.selectNode(a)},cloneRange:function(){f(this);for(var a=new M(h(this)),c=xa.length,e;c--;)e=xa[c],a[e]=this[e];return a},toString:function(){f(this);var a=this.startContainer;if(a===this.endContainer&&A(a))return 3==a.nodeType||4==a.nodeType?a.data.slice(this.startOffset,this.endOffset):"";var c=[],a=new I(this,!0);K(a,function(a){3!=a.nodeType&&4!=a.nodeType||c.push(a.data)});a.detach();return c.join("")},compareNode:function(a){f(this);
var c=a.parentNode,e=V(a);if(!c)throw new B("NOT_FOUND_ERR");a=this.comparePoint(c,e);c=this.comparePoint(c,e+1);return 0>a?0<c?2:0:0<c?1:3},comparePoint:function(a,c){f(this);if(!a)throw new B("HIERARCHY_REQUEST_ERR");r(a,this.startContainer);return 0>D(a,c,this.startContainer,this.startOffset)?-1:0<D(a,c,this.endContainer,this.endOffset)?1:0},createContextualFragment:wa?function(a){var c=this.startContainer,e=U(c);if(!c)throw new B("INVALID_STATE_ERR");var d=null;1==c.nodeType?d=c:A(c)&&(d=u.parentElement(c));
d=null===d||"HTML"==d.nodeName&&u.isHtmlNamespace(U(d).documentElement)&&u.isHtmlNamespace(d)?e.createElement("body"):d.cloneNode(!1);d.innerHTML=a;return u.fragmentFromNodeChildren(d)}:function(a){var c=h(this).createElement("body");c.innerHTML=a;return u.fragmentFromNodeChildren(c)},toHtml:function(){return Z(this)},intersectsNode:function(a,c){f(this);if(J(a)!=J(this.startContainer))return!1;var e=a.parentNode,d=V(a);if(!e)return!0;var b=D(e,d,this.endContainer,this.endOffset),e=D(e,d+1,this.startContainer,
this.startOffset);return c?0>=b&&0<=e:0>b&&0<e},isPointInRange:function(a,c){f(this);if(!a)throw new B("HIERARCHY_REQUEST_ERR");r(a,this.startContainer);return 0<=D(a,c,this.startContainer,this.startOffset)&&0>=D(a,c,this.endContainer,this.endOffset)},intersectsRange:function(a){return z(this,a,!1)},intersectsOrTouchesRange:function(a){return z(this,a,!0)},intersection:function(a){if(this.intersectsRange(a)){var c=D(this.startContainer,this.startOffset,a.startContainer,a.startOffset),e=D(this.endContainer,
this.endOffset,a.endContainer,a.endOffset),d=this.cloneRange();-1==c&&d.setStart(a.startContainer,a.startOffset);1==e&&d.setEnd(a.endContainer,a.endOffset);return d}return null},union:function(a){if(this.intersectsOrTouchesRange(a)){var c=this.cloneRange();-1==D(a.startContainer,a.startOffset,this.startContainer,this.startOffset)&&c.setStart(a.startContainer,a.startOffset);1==D(a.endContainer,a.endOffset,this.endContainer,this.endOffset)&&c.setEnd(a.endContainer,a.endOffset);return c}throw new B("Ranges do not intersect");
},containsNode:function(a,c){return c?this.intersectsNode(a,!1):3==this.compareNode(a)},containsNodeContents:function(a){return 0<=this.comparePoint(a,0)&&0>=this.comparePoint(a,la(a))},containsRange:function(a){var c=this.intersection(a);return null!==c&&a.equals(c)},containsNodeText:function(a){var c=this.cloneRange();c.selectNode(a);var e=c.getNodes([3]);return 0<e.length?(c.setStart(e[0],0),a=e.pop(),c.setEnd(a,a.length),this.containsRange(c)):this.containsNodeContents(a)},getNodes:function(a,
c){f(this);return E(this,a,c)},getDocument:function(){return h(this)},collapseBefore:function(a){this.setEndBefore(a);this.collapse(!1)},collapseAfter:function(a){this.setStartAfter(a);this.collapse(!0)},getBookmark:function(c){var e=h(this),d=a.createRange(e);c=c||u.getBody(e);d.selectNodeContents(c);var e=this.intersection(d),f=0,b=0;e&&(d.setEnd(e.startContainer,e.startOffset),f=d.toString().length,b=f+e.toString().length);return{start:f,end:b,containerNode:c}},moveToBookmark:function(a){var c=
a.containerNode,e=0;this.setStart(c,0);this.collapse(!0);for(var c=[c],d,f=!1,b=!1,v,l;!b&&(d=c.pop());)if(3==d.nodeType)v=e+d.length,!f&&a.start>=e&&a.start<=v&&(this.setStart(d,a.start-e),f=!0),f&&a.end>=e&&a.end<=v&&(this.setEnd(d,a.end-e),b=!0),e=v;else for(l=d.childNodes,v=l.length;v--;)c.push(l[v])},getName:function(){return"DomRange"},equals:function(a){return M.rangesEqual(this,a)},isValid:function(){return n(this)},inspect:function(){return O(this)},detach:function(){}});ba(M,L);ea.extend(M,
{rangeProperties:xa,RangeIterator:I,copyComparisonConstants:ca,createPrototypeRange:ba,inspect:O,toHtml:Z,getRangeDocument:h,rangesEqual:function(a,c){return a.startContainer===c.startContainer&&a.startOffset===c.startOffset&&a.endContainer===c.endContainer&&a.endOffset===c.endOffset}});a.DomRange=M});k.createCoreModule("WrappedRange",["DomRange"],function(a,b){var g,h,k=a.dom,C=a.util,w=k.DomPosition,z=a.DomRange,x=k.getBody,K=k.getContentDocument,E=k.isCharacterDataNode;a.features.implementsDomRange&&
function(){function d(a){for(var d=h.length,b;d--;)b=h[d],a[b]=a.nativeRange[b];a.collapsed=a.startContainer===a.endContainer&&a.startOffset===a.endOffset}var l,h=z.rangeProperties,y;g=function(a){if(!a)throw b.createError("WrappedRange: Range must be specified");this.nativeRange=a;d(this)};z.createPrototypeRange(g,function(a,d,b,l,g){var h=a.startContainer!==d||a.startOffset!=b,k=a.endContainer!==l||a.endOffset!=g,G=!a.equals(a.nativeRange);if(h||k||G)a.setEnd(l,g),a.setStart(d,b)});l=g.prototype;
l.selectNode=function(a){this.nativeRange.selectNode(a);d(this)};l.cloneContents=function(){return this.nativeRange.cloneContents()};l.surroundContents=function(a){this.nativeRange.surroundContents(a);d(this)};l.collapse=function(a){this.nativeRange.collapse(a);d(this)};l.cloneRange=function(){return new g(this.nativeRange.cloneRange())};l.refresh=function(){d(this)};l.toString=function(){return this.nativeRange.toString()};var r=document.createTextNode("test");x(document).appendChild(r);var p=document.createRange();
p.setStart(r,0);p.setEnd(r,0);try{p.setStart(r,1),l.setStart=function(a,b){this.nativeRange.setStart(a,b);d(this)},l.setEnd=function(a,b){this.nativeRange.setEnd(a,b);d(this)},y=function(a){return function(b){this.nativeRange[a](b);d(this)}}}catch(f){l.setStart=function(a,b){try{this.nativeRange.setStart(a,b)}catch(f){this.nativeRange.setEnd(a,b),this.nativeRange.setStart(a,b)}d(this)},l.setEnd=function(a,b){try{this.nativeRange.setEnd(a,b)}catch(f){this.nativeRange.setStart(a,b),this.nativeRange.setEnd(a,
b)}d(this)},y=function(a,b){return function(f){try{this.nativeRange[a](f)}catch(l){this.nativeRange[b](f),this.nativeRange[a](f)}d(this)}}}l.setStartBefore=y("setStartBefore","setEndBefore");l.setStartAfter=y("setStartAfter","setEndAfter");l.setEndBefore=y("setEndBefore","setStartBefore");l.setEndAfter=y("setEndAfter","setStartAfter");l.selectNodeContents=function(a){this.setStartAndEnd(a,0,k.getNodeLength(a))};p.selectNodeContents(r);p.setEnd(r,3);y=document.createRange();y.selectNodeContents(r);
y.setEnd(r,4);y.setStart(r,2);-1==p.compareBoundaryPoints(p.START_TO_END,y)&&1==p.compareBoundaryPoints(p.END_TO_START,y)?l.compareBoundaryPoints=function(a,d){d=d.nativeRange||d;a==d.START_TO_END?a=d.END_TO_START:a==d.END_TO_START&&(a=d.START_TO_END);return this.nativeRange.compareBoundaryPoints(a,d)}:l.compareBoundaryPoints=function(a,d){return this.nativeRange.compareBoundaryPoints(a,d.nativeRange||d)};y=document.createElement("div");y.innerHTML="123";var q=y.firstChild,n=x(document);n.appendChild(y);
p.setStart(q,1);p.setEnd(q,2);p.deleteContents();"13"==q.data&&(l.deleteContents=function(){this.nativeRange.deleteContents();d(this)},l.extractContents=function(){var a=this.nativeRange.extractContents();d(this);return a});n.removeChild(y);n=null;C.isHostMethod(p,"createContextualFragment")&&(l.createContextualFragment=function(a){return this.nativeRange.createContextualFragment(a)});x(document).removeChild(r);l.getName=function(){return"WrappedRange"};a.WrappedRange=g;a.createNativeRange=function(a){a=
K(a,b,"createNativeRange");return a.createRange()}}();if(a.features.implementsTextRange){var Q=function(a,b,g,h,r){var p=a.duplicate();p.collapse(g);var q=p.parentElement();k.isOrIsAncestorOf(b,q)||(q=b);if(!q.canHaveHTML)return q=new w(q.parentNode,k.getNodeIndex(q)),{boundaryPosition:q,nodeInfo:{nodeIndex:q.offset,containerElement:q.node}};b=k.getDocument(q).createElement("span");b.parentNode&&k.removeNode(b);var n,f=g?"StartToStart":"StartToEnd",x=r&&r.containerElement==q?r.nodeIndex:0,C=q.childNodes.length,
z=C;for(r=z;;){r==C?q.appendChild(b):q.insertBefore(b,q.childNodes[r]);p.moveToElementText(b);n=p.compareEndPoints(f,a);if(0==n||x==z)break;else if(-1==n)if(z==x+1)break;else x=r;else z=z==x+1?x:r;r=Math.floor((x+z)/2);q.removeChild(b)}f=b.nextSibling;if(-1==n&&f&&E(f)){p.setEndPoint(g?"EndToStart":"EndToEnd",a);if(/[\r\n]/.test(f.data))for(g=p.duplicate(),h=g.text.replace(/\r\n/g,"\r").length,h=g.moveStart("character",h);-1==g.compareEndPoints("StartToEnd",g);)h++,g.moveStart("character",1);else h=
p.text.length;g=new w(f,h)}else a=(h||!g)&&b.previousSibling,g=(g=(h||g)&&b.nextSibling)&&E(g)?new w(g,0):a&&E(a)?new w(a,a.data.length):new w(q,k.getNodeIndex(b));k.removeNode(b);return{boundaryPosition:g,nodeInfo:{nodeIndex:r,containerElement:q}}},F=function(a,b){var g,h,r=a.offset,p=k.getDocument(a.node),q=x(p).createTextRange(),n=E(a.node);n?(g=a.node,h=g.parentNode):(g=a.node.childNodes,g=r<g.length?g[r]:null,h=a.node);p=p.createElement("span");p.innerHTML="&#feff;";g?h.insertBefore(p,g):h.appendChild(p);
q.moveToElementText(p);q.collapse(!b);h.removeChild(p);if(n)q[b?"moveStart":"moveEnd"]("character",r);return q};h=function(a){this.textRange=a;this.refresh()};h.prototype=new z(document);h.prototype.refresh=function(){var a,b,g;g=this.textRange;a=g.parentElement();var h=g.duplicate();h.collapse(!0);b=h.parentElement();h=g.duplicate();h.collapse(!1);g=h.parentElement();b=b==g?b:k.getCommonAncestor(b,g);b=b==a?b:k.getCommonAncestor(a,b);a=this.textRange;0==a.compareEndPoints("StartToEnd",a)?b=a=Q(this.textRange,
b,!0,!0).boundaryPosition:(g=Q(this.textRange,b,!0,!1),a=g.boundaryPosition,b=Q(this.textRange,b,!1,!1,g.nodeInfo).boundaryPosition);this.setStart(a.node,a.offset);this.setEnd(b.node,b.offset)};h.prototype.getName=function(){return"WrappedTextRange"};z.copyComparisonConstants(h);var O=function(a){if(a.collapsed)return F(new w(a.startContainer,a.startOffset),!0);var b=F(new w(a.startContainer,a.startOffset),!0),g=F(new w(a.endContainer,a.endOffset),!1);a=x(z.getRangeDocument(a)).createTextRange();
a.setEndPoint("StartToStart",b);a.setEndPoint("EndToEnd",g);return a};h.rangeToTextRange=O;h.prototype.toTextRange=function(){return O(this)};a.WrappedTextRange=h;if(!a.features.implementsDomRange||a.config.preferTextRange){var I=Function("return this;")();"undefined"==typeof I.Range&&(I.Range=h);a.createNativeRange=function(a){a=K(a,b,"createNativeRange");return x(a).createTextRange()};a.WrappedRange=h}}a.createRange=function(d){d=K(d,b,"createRange");return new a.WrappedRange(a.createNativeRange(d))};
a.createRangyRange=function(a){a=K(a,b,"createRangyRange");return new z(a)};C.createAliasForDeprecatedMethod(a,"createIframeRange","createRange");C.createAliasForDeprecatedMethod(a,"createIframeRangyRange","createRangyRange");a.addShimListener(function(b){var g=b.document;"undefined"==typeof g.createRange&&(g.createRange=function(){return a.createRange(g)});g=b=null})});k.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(a,b){function g(a){return"string"==typeof a?/^backward(s)?$/i.test(a):
!!a}function h(a,e){if(a){if(n.isWindow(a))return a;if(a instanceof d)return a.win;var f=n.getContentDocument(a,b,e);return n.getWindow(f)}return window}function k(a){return h(a,"getWinSelection").getSelection()}function w(a){return h(a,"getDocSelection").document.selection}function E(a){var e=!1;a.anchorNode&&(e=1==n.comparePoints(a.anchorNode,a.anchorOffset,a.focusNode,a.focusOffset));return e}function z(a,e,b){var d=b?"end":"start";b=b?"start":"end";a.anchorNode=e[d+"Container"];a.anchorOffset=
e[d+"Offset"];a.focusNode=e[b+"Container"];a.focusOffset=e[b+"Offset"]}function x(a){a.anchorNode=a.focusNode=null;a.anchorOffset=a.focusOffset=0;a.rangeCount=0;a.isCollapsed=!0;a._ranges.length=0}function K(c){var e;c instanceof Z?(e=a.createNativeRange(c.getDocument()),e.setEnd(c.endContainer,c.endOffset),e.setStart(c.startContainer,c.startOffset)):c instanceof R?e=c.nativeRange:L.implementsDomRange&&c instanceof n.getWindow(c.startContainer).Range&&(e=c);return e}function F(a){var e=a.getNodes(),
d;a:if(e.length&&1==e[0].nodeType){d=1;for(var f=e.length;d<f;++d)if(!n.isAncestorOf(e[0],e[d])){d=!1;break a}d=!0}else d=!1;if(!d)throw b.createError("getSingleElementFromRange: range "+a.inspect()+" did not consist of a single element");return e[0]}function Q(a){return!!a&&"undefined"!=typeof a.text}function P(a,e){var b=new R(e);a._ranges=[b];z(a,b,!1);a.rangeCount=1;a.isCollapsed=b.collapsed}function O(c){c._ranges.length=0;if("None"==c.docSelection.type)x(c);else{var e=c.docSelection.createRange();
if(Q(e))P(c,e);else{c.rangeCount=e.length;for(var b,d=M(e.item(0)),f=0;f<c.rangeCount;++f)b=a.createRange(d),b.selectNode(e.item(f)),c._ranges.push(b);c.isCollapsed=1==c.rangeCount&&c._ranges[0].collapsed;z(c,c._ranges[c.rangeCount-1],!1)}}}function I(a,e){for(var d=a.docSelection.createRange(),f=F(e),g=M(d.item(0)),g=u(g).createControlRange(),h=0,k=d.length;h<k;++h)g.add(d.item(h));try{g.add(f)}catch(l){throw b.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)");
}g.select();O(a)}function d(a,e,b){this.nativeSelection=a;this.docSelection=e;this._ranges=[];this.win=b;this.refresh()}function l(a){a.win=a.anchorNode=a.focusNode=a._ranges=null;a.rangeCount=a.anchorOffset=a.focusOffset=0;a.detached=!0}function G(a,e){for(var b=S.length,d,f;b--;)if(d=S[b],f=d.selection,"deleteAll"==e)l(f);else if(d.win==a)return"delete"==e?(S.splice(b,1),!0):f;"deleteAll"==e&&(S.length=0);return null}function y(a,e){for(var d=M(e[0].startContainer),d=u(d).createControlRange(),f=
0,g,h=e.length;f<h;++f){g=F(e[f]);try{d.add(g)}catch(k){throw b.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)");}}d.select();O(a)}function r(a,e){if(a.win.document!=M(e))throw new ca("WRONG_DOCUMENT_ERR");}function p(c){return function(e,b){var d;this.rangeCount?(d=this.getRangeAt(0),d["set"+(c?"Start":"End")](e,b)):(d=a.createRange(this.win.document),d.setStartAndEnd(e,b));this.setSingleRange(d,this.isBackward())}}
function q(a){var e=[],b=new W(a.anchorNode,a.anchorOffset),d=new W(a.focusNode,a.focusOffset),f="function"==typeof a.getName?a.getName():"Selection";if("undefined"!=typeof a.rangeCount)for(var g=0,h=a.rangeCount;g<h;++g)e[g]=Z.inspect(a.getRangeAt(g));return"["+f+"(Ranges: "+e.join(", ")+")(anchor: "+b.inspect()+", focus: "+d.inspect()+"]"}a.config.checkSelectionRanges=!0;var n=a.dom,f=a.util,T=f.isHostMethod,Z=a.DomRange,R=a.WrappedRange,ca=a.DOMException,W=n.DomPosition,ba,fa,L=a.features,M=n.getDocument,
u=n.getBody,ea=Z.rangesEqual,H=T(window,"getSelection"),B=f.isHostObject(document,"selection");L.implementsWinGetSelection=H;var A=(L.implementsDocSelection=B)&&(!H||a.config.preferTextRange);if(A)ba=w,a.isSelectionValid=function(a){a=h(a,"isSelectionValid").document;var e=a.selection;return"None"!=e.type||M(e.createRange().parentElement())==a};else if(H)ba=k,a.isSelectionValid=function(){return!0};else return b.fail("Neither document.selection or window.getSelection() detected."),!1;a.getNativeSelection=
ba;H=ba();if(!H)return b.fail("Native selection was null (possibly issue 138?)"),!1;var V=a.createNativeRange(document),m=u(document),U=f.areHostProperties(H,["anchorNode","focusNode","anchorOffset","focusOffset"]);L.selectionHasAnchorAndFocus=U;var D=T(H,"extend");L.selectionHasExtend=D;var X="number"==typeof H.rangeCount;L.selectionHasRangeCount=X;var aa=!1,la=!0,da=D?function(c,e){var b=Z.getRangeDocument(e),b=a.createRange(b);b.collapseToPoint(e.endContainer,e.endOffset);c.addRange(K(b));c.extend(e.startContainer,
e.startOffset)}:null;f.areHostMethods(H,["addRange","getRangeAt","removeAllRanges"])&&"number"==typeof H.rangeCount&&L.implementsDomRange&&function(){var c=window.getSelection();if(c){for(var e=c.rangeCount,b=1<e,d=[],f=E(c),g=0;g<e;++g)d[g]=c.getRangeAt(g);var g=n.createTestElement(document,"",!1),h=g.appendChild(document.createTextNode("\u00a0\u00a0\u00a0")),k=document.createRange();k.setStart(h,1);k.collapse(!0);c.removeAllRanges();c.addRange(k);la=1==c.rangeCount;c.removeAllRanges();b||((b=window.navigator.appVersion.match(/Chrome\/(.*?) /))&&
36<=parseInt(b[1])?aa=!1:(b=k.cloneRange(),k.setStart(h,0),b.setEnd(h,3),b.setStart(h,2),c.addRange(k),c.addRange(b),aa=2==c.rangeCount));n.removeNode(g);c.removeAllRanges();for(g=0;g<e;++g)0==g&&f?da?da(c,d[g]):(a.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),c.addRange(d[g])):c.addRange(d[g])}}();L.selectionSupportsMultipleRanges=aa;L.collapsedNonEditableSelectionsSupported=la;var J=!1;
m&&T(m,"createControlRange")&&(m=m.createControlRange(),f.areHostProperties(m,["item","add"])&&(J=!0));L.implementsControlRange=J;fa=U?function(a){return a.anchorNode===a.focusNode&&a.anchorOffset===a.focusOffset}:function(a){return a.rangeCount?a.getRangeAt(a.rangeCount-1).collapsed:!1};var ia;T(H,"getRangeAt")?ia=function(a,e){try{return a.getRangeAt(e)}catch(b){return null}}:U&&(ia=function(c){var e=M(c.anchorNode),e=a.createRange(e);e.setStartAndEnd(c.anchorNode,c.anchorOffset,c.focusNode,c.focusOffset);
e.collapsed!==this.isCollapsed&&e.setStartAndEnd(c.focusNode,c.focusOffset,c.anchorNode,c.anchorOffset);return e});d.prototype=a.selectionPrototype;var S=[],ja=function(a){if(a&&a instanceof d)return a.refresh(),a;a=h(a,"getNativeSelection");var e=G(a),b=ba(a),f=B?w(a):null;e?(e.nativeSelection=b,e.docSelection=f,e.refresh()):(e=new d(b,f,a),S.push({win:a,selection:e}));return e};a.getSelection=ja;f.createAliasForDeprecatedMethod(a,"getIframeSelection","getSelection");m=d.prototype;if(!A&&U&&f.areHostMethods(H,
["removeAllRanges","addRange"]))m.removeAllRanges=function(){this.nativeSelection.removeAllRanges();x(this)},m.addRange=X?function(c,e){if(J&&B&&"Control"==this.docSelection.type)I(this,c);else if(g(e)&&D)da(this.nativeSelection,c),this.refresh();else{var b;aa?b=this.rangeCount:(this.removeAllRanges(),b=0);var d=K(c).cloneRange();try{this.nativeSelection.addRange(d)}catch(f){}this.rangeCount=this.nativeSelection.rangeCount;this.rangeCount==b+1?(a.config.checkSelectionRanges&&(b=ia(this.nativeSelection,
this.rangeCount-1))&&!ea(b,c)&&(c=new R(b)),this._ranges[this.rangeCount-1]=c,z(this,c,ga(this.nativeSelection)),this.isCollapsed=fa(this)):this.refresh()}}:function(a,e){g(e)&&D?da(this.nativeSelection,a):this.nativeSelection.addRange(K(a));this.refresh()},m.setRanges=function(a){if(J&&B&&1<a.length)y(this,a);else{this.removeAllRanges();for(var e=0,b=a.length;e<b;++e)this.addRange(a[e])}};else if(T(H,"empty")&&T(V,"select")&&J&&A)m.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=
this.docSelection.type){var a;if(this.anchorNode)a=M(this.anchorNode);else if("Control"==this.docSelection.type){var e=this.docSelection.createRange();e.length&&(a=M(e.item(0)))}a&&(u(a).createTextRange().select(),this.docSelection.empty())}}catch(b){}x(this)},m.addRange=function(c){"Control"==this.docSelection.type?I(this,c):(a.WrappedTextRange.rangeToTextRange(c).select(),this._ranges[0]=c,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,z(this,c,!1))},m.setRanges=function(a){this.removeAllRanges();
var e=a.length;1<e?y(this,a):e&&this.addRange(a[0])};else return b.fail("No means of selecting a Range or TextRange was found"),!1;m.getRangeAt=function(a){if(0>a||a>=this.rangeCount)throw new ca("INDEX_SIZE_ERR");return this._ranges[a].cloneRange()};var ka;if(A)ka=function(c){var e;a.isSelectionValid(c.win)?e=c.docSelection.createRange():(e=u(c.win.document).createTextRange(),e.collapse(!0));"Control"==c.docSelection.type?O(c):Q(e)?P(c,e):x(c)};else if(T(H,"getRangeAt")&&"number"==typeof H.rangeCount)ka=
function(c){if(J&&B&&"Control"==c.docSelection.type)O(c);else if(c._ranges.length=c.rangeCount=c.nativeSelection.rangeCount,c.rangeCount){for(var e=0,b=c.rangeCount;e<b;++e)c._ranges[e]=new a.WrappedRange(c.nativeSelection.getRangeAt(e));z(c,c._ranges[c.rangeCount-1],ga(c.nativeSelection));c.isCollapsed=fa(c)}else x(c)};else if(U&&"boolean"==typeof H.isCollapsed&&"boolean"==typeof V.collapsed&&L.implementsDomRange)ka=function(a){var e;e=a.nativeSelection;e.anchorNode?(e=ia(e,0),a._ranges=[e],a.rangeCount=
1,e=a.nativeSelection,a.anchorNode=e.anchorNode,a.anchorOffset=e.anchorOffset,a.focusNode=e.focusNode,a.focusOffset=e.focusOffset,a.isCollapsed=fa(a)):x(a)};else return b.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;m.refresh=function(a){var e=a?this._ranges.slice(0):null,b=this.anchorNode,d=this.anchorOffset;ka(this);if(a){a=e.length;if(a!=this._ranges.length||this.anchorNode!=b||this.anchorOffset!=d)return!0;for(;a--;)if(!ea(e[a],this._ranges[a]))return!0;
return!1}};var Y=function(a,e){var b=a.getAllRanges();a.removeAllRanges();for(var d=0,f=b.length;d<f;++d)ea(e,b[d])||a.addRange(b[d]);a.rangeCount||x(a)};m.removeRange=J&&B?function(a){if("Control"==this.docSelection.type){var e=this.docSelection.createRange();a=F(a);for(var b=M(e.item(0)),b=u(b).createControlRange(),d,f=!1,g=0,h=e.length;g<h;++g)d=e.item(g),d!==a||f?b.add(e.item(g)):f=!0;b.select();O(this)}else Y(this,a)}:function(a){Y(this,a)};var ga;!A&&U&&L.implementsDomRange?(ga=E,m.isBackward=
function(){return ga(this)}):ga=m.isBackward=function(){return!1};m.isBackwards=m.isBackward;m.toString=function(){for(var a=[],e=0,b=this.rangeCount;e<b;++e)a[e]=""+this._ranges[e];return a.join("")};m.collapse=function(c,e){r(this,c);var b=a.createRange(c);b.collapseToPoint(c,e);this.setSingleRange(b);this.isCollapsed=!0};m.collapseToStart=function(){if(this.rangeCount){var a=this._ranges[0];this.collapse(a.startContainer,a.startOffset)}else throw new ca("INVALID_STATE_ERR");};m.collapseToEnd=function(){if(this.rangeCount){var a=
this._ranges[this.rangeCount-1];this.collapse(a.endContainer,a.endOffset)}else throw new ca("INVALID_STATE_ERR");};m.selectAllChildren=function(c){r(this,c);var b=a.createRange(c);b.selectNodeContents(c);this.setSingleRange(b)};m.deleteFromDocument=function(){if(J&&B&&"Control"==this.docSelection.type){for(var a=this.docSelection.createRange(),b;a.length;)b=a.item(0),a.remove(b),n.removeNode(b);this.refresh()}else if(this.rangeCount&&(a=this.getAllRanges(),a.length)){this.removeAllRanges();b=0;for(var d=
a.length;b<d;++b)a[b].deleteContents();this.addRange(a[d-1])}};m.eachRange=function(a,b){for(var d=0,f=this._ranges.length;d<f;++d)if(a(this.getRangeAt(d)))return b};m.getAllRanges=function(){var a=[];this.eachRange(function(b){a.push(b)});return a};m.setSingleRange=function(a,b){this.removeAllRanges();this.addRange(a,b)};m.callMethodOnEachRange=function(a,b){var d=[];this.eachRange(function(f){d.push(f[a].apply(f,b||[]))});return d};m.setStart=p(!0);m.setEnd=p(!1);a.rangePrototype.select=function(a){ja(this.getDocument()).setSingleRange(this,
a)};m.changeEachRange=function(a){var b=[],d=this.isBackward();this.eachRange(function(d){a(d);b.push(d)});this.removeAllRanges();d&&1==b.length?this.addRange(b[0],"backward"):this.setRanges(b)};m.containsNode=function(a,b){return this.eachRange(function(d){return d.containsNode(a,b)},!0)||!1};m.getBookmark=function(a){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[a])}};m.moveToBookmark=function(c){for(var b=[],d=0,f,g;f=c.rangeBookmarks[d++];)g=a.createRange(this.win),
g.moveToBookmark(f),b.push(g);c.backward?this.setSingleRange(b[0],"backward"):this.setRanges(b)};m.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}};m.restoreRanges=function(a){this.removeAllRanges();for(var b=0,d;d=a.ranges[b];++b)this.addRange(d,a.backward&&0==b)};m.toHtml=function(){var a=[];this.eachRange(function(b){a.push(Z.toHtml(b))});return a.join("")};L.implementsTextRange&&(m.getNativeTextRange=function(){var c;if(c=this.docSelection){c=
c.createRange();if(Q(c))return c;throw b.createError("getNativeTextRange: selection is a control selection");}if(0<this.rangeCount)return a.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw b.createError("getNativeTextRange: selection contains no range");});m.getName=function(){return"WrappedSelection"};m.inspect=function(){return q(this)};m.detach=function(){G(this.win,"delete");l(this)};d.detachAll=function(){G(null,"deleteAll")};d.inspect=q;d.isDirectionBackward=g;a.Selection=d;a.selectionPrototype=
m;a.addShimListener(function(a){"undefined"==typeof a.getSelection&&(a.getSelection=function(){return ja(a)});a=null})});var Ia=!1,Y=function(a){Ia||(Ia=!0,!k.initialized&&k.config.autoInitialize&&ta())};E&&("complete"==document.readyState?Y():(w(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",Y,!1),pa(window,"load",Y)));return k},this);
