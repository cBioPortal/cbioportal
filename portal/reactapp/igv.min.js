function ZStream(){}function Inflate(){this.was=[0]}function InfBlocks(e,t,i){this.hufts=new Int32Array(3*MANY),this.window=new Uint8Array(i),this.end=i,this.checkfn=t,this.mode=IB_TYPE,this.reset(e,null),this.left=0,this.table=0,this.index=0,this.blens=null,this.bb=new Int32Array(1),this.tb=new Int32Array(1),this.codes=new InfCodes,this.last=0,this.bitk=0,this.bitb=0,this.read=0,this.write=0,this.check=0,this.inftree=new InfTree}function InfCodes(){}function InfTree(){}function inflate_trees_fixed(e,t,i,r,n){return e[0]=fixed_bl,t[0]=fixed_bd,i[0]=fixed_tl,r[0]=fixed_td,Z_OK}function arrayCopy(e,t,i,r,n){if(0!=n){if(!e)throw"Undef src";if(!i)throw"Undef dest";0==t&&n==e.length?arrayCopy_fast(e,i,r):hasSubarray?arrayCopy_fast(e.subarray(t,t+n),i,r):1==e.BYTES_PER_ELEMENT&&n>100?arrayCopy_fast(new Uint8Array(e.buffer,e.byteOffset+t,n),i,r):arrayCopy_slow(e,t,i,r,n)}}function arrayCopy_slow(e,t,i,r,n){for(var a=0;a<n;++a)i[r+a]=e[t+a]}function arrayCopy_fast(e,t,i){t.set(e,i)}function adler32(e,t,i,r){if(null==t)return 1;for(var n,a=65535&e,o=e>>16&65535;r>0;){for(r-=n=r<ADLER_NMAX?r:ADLER_NMAX;n>=16;)o+=a+=255&t[i++],o+=a+=255&t[i++],o+=a+=255&t[i++],o+=a+=255&t[i++],o+=a+=255&t[i++],o+=a+=255&t[i++],o+=a+=255&t[i++],o+=a+=255&t[i++],o+=a+=255&t[i++],o+=a+=255&t[i++],o+=a+=255&t[i++],o+=a+=255&t[i++],o+=a+=255&t[i++],o+=a+=255&t[i++],o+=a+=255&t[i++],o+=a+=255&t[i++],n-=16;if(0!=n)do{o+=a+=255&t[i++]}while(0!=--n);a%=ADLER_BASE,o%=ADLER_BASE}return o<<16|a}function jszlib_inflate_buffer(e,t,i,r){e=t?new Uint8Array(e,t,i):new Uint8Array(e);var n=new ZStream;n.inflateInit(DEF_WBITS,!0),n.next_in=e,n.next_in_index=0,n.avail_in=e.length;for(var a=[],o=0;;){var s=new Uint8Array(32e3);n.next_out=s,n.next_out_index=0,n.avail_out=s.length;var h=n.inflate(Z_NO_FLUSH);if(h!=Z_OK&&h!=Z_STREAM_END)throw n.msg;if(0!=n.avail_out){var c=new Uint8Array(s.length-n.avail_out);arrayCopy(s,0,c,0,s.length-n.avail_out),s=c}if(a.push(s),o+=s.length,h==Z_STREAM_END)break}if(r&&(r[0]=(t||0)+n.next_in_index),1==a.length)return a[0].buffer;for(var l=new Uint8Array(o),u=0,d=0;d<a.length;++d){var p=a[d];arrayCopy(p,0,l,u,p.length),u+=p.length}return l.buffer}var igv=function(e){function t(t){var i;this.flanking=t.flanking,this.type=t.type||"IGV",this.crossDomainProxy=t.crossDomainProxy,this.formats=t.formats,this.trackDefaults=t.trackDefaults,t.search?this.searchConfig={type:"json",url:t.search.url,coords:void 0===t.search.coords?1:t.search.coords,chromosomeField:t.search.chromosomeField||"chromosome",startField:t.search.startField||"start",endField:t.search.endField||"end",resultsField:t.search.resultsField}:(i=t.reference&&t.reference.id?t.reference.id:t.genome?t.genome:"hg19",this.searchConfig={type:"plain",url:e.geneNameLookupPathTemplate(i),coords:0,chromosomeField:"chromosome",startField:"start",endField:"end"})}function i(t){var i=t.splitLines(),r=[],n=[];return i.forEach((function(e){""===e||r.push(e)})),r.forEach((function(t){var i,r,a,o=t.split("\t");o.length>=3&&(a=(r=o[1].split(":"))[1].split("-"),i=o[2].trim(),n.push({gene:o[0],chromosome:e.browser.genome.getChromosomeName(r[0].trim()),start:parseInt(a[0].replace(/,/g,"")),end:parseInt(a[1].replace(/,/g,"")),type:"gtex"===i?"snp":"gene"}))})),n}function n(t,i,r,n,o){e.browser.selection=new e.GtexSelection("gtex"===o||"snp"===o?{snp:t}:{gene:t}),void 0===n&&(n=r+1),e.browser.flanking&&(r=Math.max(0,r-e.browser.flanking),n+=e.browser.flanking),e.browser.goto(i,r,n),a.call(e.browser,t,o)}function a(e,t){this.trackViews.forEach((function(i){var r=i.track;r.onsearch&&r.onsearch(e,t)}))}return e.Browser=function(i,r){this.config=i,e.browser=this,e.browser.$root=$('<div id="igvRootDiv" class="igv-root-div">'),t.call(this,i),$("input[id='trackHeightInput']").val(this.trackHeight),this.trackContainerDiv=r,function(t){function i(t){o||e.browser.$cursorTrackingGuide&&t.toElement===e.browser.$cursorTrackingGuide.get(0)&&"mouseleave"===t.type||(h&&(e.browser.fireEvent("trackdragend"),h=!1),s=!1,l=c=void 0,r=n=void 0,a=void 0)}var r,n,a,o=!1,s=!1,h=!1,c=void 0,l=void 0;$(t).mousedown((function(t){var i,h;return t.preventDefault(),e.popover&&e.popover.hide(),h=$(t.target),r=h.parents(".igv-viewport-div"),0===_.size(r)?void(r=void 0):void((o=!!h.parents("div[data-ruler-track='rulerTrack']").get(0))||(s=!0,i=e.translateMouseCoordinates(t,r.get(0)),l=c=i.x,n=e.Viewport.viewportWithID(r.data("viewport")),a=n.genomicState.referenceFrame,e.Viewport.viewportsWithLocusIndex(r.data("locusindex"))))})),$(t).mousemove((function(i){var r,n,a=e.browser.$cursorTrackingGuide;i.preventDefault(),r=e.translateMouseCoordinates(i,t),n=Math.max(50,r.x-5),n=Math.min(e.browser.trackContainerDiv.clientWidth-65,n),a.css({left:n+"px"})})),$(t).mousemove(e.throttle((function(t){var i,u;if(t.preventDefault(),!0!==o&&void 0!==r&&(r&&(i=e.translateMouseCoordinates(t,r.get(0))),a&&s)){if(l&&Math.abs(i.x-l)>e.browser.constants.dragThreshold){if(e.browser.loadInProgress())return;h=!0,a.shiftPixels(c-i.x),a.start=Math.max(0,a.start),u=e.browser.genome.getChromosome(a.chrName).bpLength-n.$viewport.width()*a.bpPerPixel,a.start>u&&(a.start=u),e.browser.updateLocusSearchWithGenomicState(_.first(e.browser.genomicStateList)),e.browser.repaintWithLocusIndex(n.genomicState.locusIndex),e.browser.fireEvent("trackdrag")}c=i.x}}),10)),$(t).mouseup(i),$(t).mouseleave(i)}(this.trackContainerDiv),this.trackViews=[],this.trackLabelsVisible=!0,this.featureDB={},this.constants={dragThreshold:3,defaultColor:"rgb(0,0,150)",doubleClickDelay:i.doubleClickDelay||500},this.eventHandlers={},window.onresize=e.throttle((function(){e.browser.resize()}),10),$(document).mousedown((function(t){e.browser.isMouseDown=!0})),$(document).mouseup((function(t){e.browser.isMouseDown=void 0,e.browser.dragTrackView&&e.browser.dragTrackView.$trackDragScrim.hide(),e.browser.dragTrackView=void 0})),$(document).click((function(t){var i=t.target;e.browser.$root.get(0).contains(i)||e.popover.hide()}))},e.Browser.hasKnownFileExtension=function(t){var i=e.getExtension(t);return void 0!==i&&e.Browser.knownFileExtensions.has(i)},e.Browser.prototype.disableZoomWidget=function(){this.$zoomContainer.find(".fa-minus-circle").off(),this.$zoomContainer.find(".fa-plus-circle").off()},e.Browser.prototype.enableZoomWidget=function(e){this.$zoomContainer.find(".fa-minus-circle").on(e.out),this.$zoomContainer.find(".fa-plus-circle").on(e.in)},e.Browser.prototype.toggleCursorGuide=function(e){_.size(e)>1||"all"===_.first(e).locusSearchString?(this.$cursorTrackingGuide.is(":visible")&&this.$cursorTrackingGuideToggle.click(),this.$cursorTrackingGuideToggle.hide()):this.$cursorTrackingGuideToggle.show()},e.Browser.prototype.toggleCenterGuide=function(e){_.size(e)>1||"all"===_.first(e).locusSearchString?(this.centerGuide.$container.is(":visible")&&this.centerGuide.$centerGuideToggle.click(),this.centerGuide.$centerGuideToggle.hide()):this.centerGuide.$centerGuideToggle.show()},e.Browser.prototype.loadTracksWithConfigList=function(e){var t=this,i=[];return _.each(e,(function(e){var r=t.loadTrack(e);r&&i.push(r)})),_.each(this.trackViews,(function(e){e.resize()})),i},e.Browser.prototype.loadTrack=function(t){var i,r,n,a=this;if(e.inferTrackTypes(t),this.trackDefaults&&t.type&&(i=this.trackDefaults[t.type]))for(r in i)i.hasOwnProperty(r)&&void 0===t[r]&&(t[r]=i[r]);return void 0===(n=e.createTrackWithConfiguration(t))?(e.presentAlert("Unknown file type: "+t.url),n):(void 0===n.order&&(n.order=this.trackViews.length),"function"==typeof n.getFileHeader?n.getFileHeader().then((function(e){a.addTrack(n)})).catch((function(t){e.presentAlert(t)})):a.addTrack(n),n)},e.Browser.prototype.addTrack=function(t){var i;void 0!==e.popover&&e.popover.hide(),i=new e.TrackView(t,this),this.trackViews.push(i),this.reorderTracks(),i.resize()},e.Browser.prototype.reorderTracks=function(){var e=this;this.trackViews.sort((function(e,t){return(e.track.order||0)-(t.track.order||0)})),$(this.trackContainerDiv).children("igv-track-div").detach(),this.trackViews.forEach((function(t){e.trackContainerDiv.appendChild(t.trackDiv)}))},e.Browser.prototype.removeTrackByName=function(e){var t;t=_.first(_.filter(this.trackViews,(function(t){return e===t.track.name}))),this.removeTrack(t.track)},e.Browser.prototype.removeTrack=function(e){for(var t,i=0;i<this.trackViews.length;i++)if(e===this.trackViews[i].track){t=this.trackViews[i];break}t&&(this.trackViews.splice(i,1),this.trackContainerDiv.removeChild(t.trackDiv),this.fireEvent("trackremoved",[t.track]))},e.Browser.prototype.findTracks=function(e,t){var i=[];return this.trackViews.forEach((function(r){t===r.track[e]&&i.push(r.track)})),i},e.Browser.prototype.reduceTrackOrder=function(e){var t,i,r=[];1!==this.trackViews.length&&(this.trackViews.forEach((function(i,n,a){r.push({trackView:i,index:n}),e===i&&(t=r[n])})),0!==t.index&&(i=t.trackView.track.order,t.trackView.track.order=r[t.index-1].trackView.track.order,r[t.index-1].trackView.track.order=i,this.reorderTracks()))},e.Browser.prototype.increaseTrackOrder=function(e){var t,i,r=[];1!==this.trackViews.length&&(this.trackViews.forEach((function(i,n,a){r.push({trackView:i,index:n}),e===i&&(t=r[n])})),this.trackViews.length-1!==t.index&&(i=t.trackView.track.order,t.trackView.track.order=r[1+t.index].trackView.track.order,r[1+t.index].trackView.track.order=i,this.reorderTracks()))},e.Browser.prototype.setTrackHeight=function(e){this.trackHeight=e,this.trackViews.forEach((function(t){t.setTrackHeight(e)}))},e.Browser.prototype.resize=function(){var e;!0===function(e){var t,i,r;return _.size(e)>0?(i=_.first(e),_.size(i.viewports)>0?t=(r=_.first(i.viewports)).$viewport.width()*r.genomicState.referenceFrame.bpPerPixel>r.genomicState.chromosome.bpLength:t=!1):t=!1,t}(this.trackViews)?(e=_.first(_.first(this.trackViews).viewports),this.parseSearchInput(e.genomicState.chromosome.name)):_.each(_.union([this.ideoPanel,this.karyoPanel,this.centerGuide],this.trackViews),(function(e){e&&e.resize()}))},e.Browser.prototype.repaint=function(){_.each(_.union([this.ideoPanel,this.karyoPanel,this.centerGuide],this.trackViews),(function(e){e&&e.repaint()}))},e.Browser.prototype.repaintWithLocusIndex=function(t){this.karyoPanel&&this.karyoPanel.repaint(),this.ideoPanel&&e.IdeoPanel.repaintPanel(this.ideoPanel.panelWithLocusIndex(t)),_.each(e.Viewport.viewportsWithLocusIndex(t),(function(e){e.repaint()}))},e.Browser.prototype.update=function(){this.updateLocusSearchWithGenomicState(_.first(this.genomicStateList)),this.windowSizePanel.updateWithGenomicState(_.first(this.genomicStateList)),_.each([this.ideoPanel,this.karyoPanel,this.centerGuide],(function(e){e&&e.repaint()})),e.browser.findTracks("type","seg")[0].sortSamples(this.genomicStateList[0].chromosome.name,this.genomicStateList[0].start,this.genomicStateList[0].end,"DESC"),_.each(this.trackViews,(function(e){e.update()}))},e.Browser.prototype.updateWithLocusIndex=function(t){e.browser.updateLocusSearchWithGenomicState(_.first(this.genomicStateList)),0===t&&this.windowSizePanel.updateWithGenomicState(this.genomicStateList[t]),this.ideoPanel&&e.IdeoPanel.repaintPanel(this.ideoPanel.panelWithLocusIndex(t)),this.karyoPanel&&this.karyoPanel.repaint(),_.each(e.Viewport.viewportsWithLocusIndex(t),(function(e){e.update()})),this.centerGuide&&this.centerGuide.repaint()},e.Browser.prototype.loadInProgress=function(){var e;return e=!1,_.each(this.trackViews,(function(t){!1===e&&(e=t.isLoading())})),e},e.Browser.prototype.updateLocusSearchWithGenomicState=function(t){var i,r,n,a,o,s;0===t.locusIndex&&1===t.locusCount?"all"===t.locusSearchString?this.$searchInput.val(t.locusSearchString):(i=t.referenceFrame,this.$searchInput&&(o=i.start+i.bpPerPixel*(this.viewportContainerWidth()/t.locusCount),this.genome&&((s=this.genome.getChromosome(i.chrName))&&(o=Math.min(o,s.bpLength))),r=e.numberFormatter(Math.floor(i.start+1)),n=e.numberFormatter(Math.floor(o)),a=i.chrName+":"+r+"-"+n,this.$searchInput.val(a)),this.fireEvent("locuschange",[i,a])):this.$searchInput.val("")},e.Browser.prototype.syntheticViewportContainerBBox=function(){var e,t=$(this.trackContainerDiv),i=$('<div class="igv-track-div">'),r=$('<div class="igv-viewport-container igv-viewport-container-shim">');return t.append(i),i.append(r),e={position:r.position(),width:r.width(),height:r.height()},i.remove(),e},e.Browser.prototype.syntheticViewportContainerWidth=function(){return this.syntheticViewportContainerBBox().width},e.Browser.prototype.viewportContainerWidth=function(){return this.trackViews&&this.trackViews.length>0?this.trackViews[0].$viewportContainer.width():this.syntheticViewportContainerWidth()},e.Browser.prototype.minimumBasesExtent=function(){return this.config.minimumBases},e.Browser.prototype.goto=function(t,i,r){var n,a,o,s,h;return e.popover&&e.popover.hide(),void 0===this.genome?void console.log("Missing genome - bailing ..."):((n=_.first(this.genomicStateList)).chromosome=this.genome.getChromosome(t),a=e.browser.viewportContainerWidth()/n.locusCount,(o=n.referenceFrame).chrName=n.chromosome.name,void 0===r?(s=Math.round(a*o.bpPerPixel/2),i=Math.max(0,i-s)):o.bpPerPixel=(r-i)/a,n.chromosome?(n.chromosome.bpLength||(n.chromosome.bpLength=1),h=n.chromosome.bpLength/a,o.bpPerPixel>h&&(o.bpPerPixel=h),void 0===r&&(r=i+a*o.bpPerPixel),n.chromosome&&r>n.chromosome.bpLength&&(i-=r-n.chromosome.bpLength)):console&&console.log&&console.log("Could not find chromsome "+o.chrName),o.start=i,void this.update())},e.Browser.prototype.zoomIn=function(){var e=this;this.loadInProgress()||_.each(_.range(_.size(this.genomicStateList)),(function(t){!function(e,t){var i,r,n,a,o=e.genomicStateList[t],s=o.referenceFrame,h=Math.floor(e.viewportContainerWidth()/o.locusCount);r=e.minimumBasesExtent(),n=h,a=s.bpPerPixel/2,r>Math.floor(n*a)||(i=s.start+s.bpPerPixel*(h/2),s.start=i-h/2*(s.bpPerPixel/2),s.bpPerPixel/=2,e.updateWithLocusIndex(t))}(e,t)}))},e.Browser.prototype.zoomOut=function(){var t=this;this.loadInProgress()||_.each(_.range(_.size(this.genomicStateList)),(function(i){!function(t,i){var r,n,a,o,s,h,c=e.browser.genomicStateList[i],l=c.referenceFrame,u=Math.floor(t.viewportContainerWidth()/c.locusCount);n=2*l.bpPerPixel,s=25e7,t.genome&&(r=t.genome.getChromosome(l.chrName))&&(s=r.bpLength),n>(a=s/u)&&(n=a),o=l.start+l.bpPerPixel*u/2,h=n*u,l.start=Math.round(o-h/2),l.start<0?l.start=0:l.start>s-h&&(l.start=s-h),l.bpPerPixel=n,t.updateWithLocusIndex(i)}(t,i)}))},e.Browser.prototype.selectMultiLocusPanelWithGenomicState=function(e){this.multiLocusPanelLayoutWithTruthFunction((function(t){return _.isEqual(t,e)}))},e.Browser.prototype.closeMultiLocusPanelWithGenomicState=function(e){this.multiLocusPanelLayoutWithTruthFunction((function(t){return!_.isEqual(t,e)}))},e.Browser.prototype.multiLocusPanelLayoutWithTruthFunction=function(t){var i,r=this,n=$("#igv-content-header");!0===this.config.showIdeogram&&e.IdeoPanel.$empty(n),this.emptyViewportContainers($(".igv-track-container-div")),i=_.filter(_.clone(this.genomicStateList),(function(e){return t(e)})),this.genomicStateList=_.map(i,(function(e,t,i){return e.locusIndex=t,e.locusCount=_.size(i),e.referenceFrame.bpPerPixel=(e.end-e.start)/(r.viewportContainerWidth()/e.locusCount),e})),!0===this.config.showIdeogram&&this.ideoPanel.buildPanels(n),this.buildViewportsWithGenomicStateList(this.genomicStateList),this.toggleCenterGuide(this.genomicStateList),this.toggleCursorGuide(this.genomicStateList),this.resize()},e.Browser.prototype.emptyViewportContainers=function(e){e.find(".igv-scrollbar-outer-div").remove(),e.find(".igv-viewport-div").remove(),_.each(this.trackViews,(function(e){e.viewports=[],e.scrollbar=void 0}))},e.Browser.prototype.buildViewportsWithGenomicStateList=function(t){_.each(this.trackViews,(function(i){_.each(_.range(_.size(t)),(function(t){i.viewports.push(new e.Viewport(i,t)),i.configureViewportContainer(i.$viewportContainer,i.viewports)}))}))},e.Browser.prototype.parseSearchInput=function(t){var i=this,r=t.split(" ");this.getGenomicStateList(r,this.viewportContainerWidth(),(function(r){var n,a=$("#igv-content-header");_.size(r)>0?(_.each(r,(function(t,n){t.locusIndex=n,t.locusCount=_.size(r),t.referenceFrame=new e.ReferenceFrame(t.chromosome.name,t.start,(t.end-t.start)/(i.viewportContainerWidth()/t.locusCount)),t.initialReferenceFrame=JSON.parse(JSON.stringify(t.referenceFrame))})),i.genomicStateList=r,i.emptyViewportContainers($(".igv-track-container-div")),i.updateLocusSearchWithGenomicState(_.first(i.genomicStateList)),1===_.size(i.genomicStateList)&&"all"===_.first(i.genomicStateList).locusSearchString?i.disableZoomWidget():i.enableZoomWidget(i.zoomHandlers),i.toggleCenterGuide(i.genomicStateList),i.toggleCursorGuide(i.genomicStateList),!0===i.config.showIdeogram&&(e.IdeoPanel.$empty(a),i.ideoPanel.buildPanels(a)),i.buildViewportsWithGenomicStateList(r),i.update()):(n="Unrecognized locus "+t,e.presentAlert(n))}))},e.Browser.prototype.getGenomicStateList=function(t,r,n){function a(t){var r,n,a,o,s,h,c,l;return r="plain"===p.type?i(t):JSON.parse(t),p.resultsField&&(r=r[p.resultsField]),0===_.size(r)?void 0:1===_.size(r)?(a=(n=_.first(r))[p.chromosomeField],o=n[p.startField]-p.coords,void 0===(s=n[p.endField])&&(s=o+1),e.browser.flanking&&(o=Math.max(0,o-e.browser.flanking),s+=e.browser.flanking),c=a+":"+o.toString()+"-"+s.toString(),l={},e.Browser.isLocusChrNameStartEnd(c,d.genome,l)?(h=n.featureType||n.type,l.locusSearchString=_.first(t.split("\t")),l.selection=new e.GtexSelection("gtex"===h||"snp"===h?{snp:n.gene}:{gene:n.gene}),l):void 0):void 0}var o,s,h,c,l,u,d=this,p=e.browser.searchConfig,f=[];return o=[],_.each(t,(function(t){h={},e.Browser.isLocusChrNameStartEnd(t,d.genome,h)&&(h.selection=void 0,h.locusSearchString=t,f.push(h),o.push(t))})),s=_.difference(t,o),_.size(s)>0?(l=[],c=[],_.each(s,(function(t){var i,r;(i=d.featureDB[t.toUpperCase()])?(r=function(t){var i,r,n,a;return r=void 0===t.end?1+t.start:t.end,e.browser.flanking&&(i=Math.max(0,t.start-e.browser.flanking),r+=e.browser.flanking),n=t.chr+":"+i.toString()+"-"+r.toString(),a={},e.Browser.isLocusChrNameStartEnd(n,d.genome,a)?(a.selection=new e.GtexSelection({gene:t.name}),a):void 0}(i))?(r.locusSearchString=t,c.push(r)):l.push(t):l.push(t)})),_.size(l)>0?(u=_.map(l,(function(e){var t=p.url.replace("$FEATURE$",e);return t.indexOf("$GENOME$")>-1&&t.replace("$GENOME$",d.genome.id?d.genome.id:"hg19"),igvxhr.loadString(t)})),void Promise.all(u).then((function(e){var t,i;t=_.filter(e,(function(e){return""!==e})),i=_.filter(_.map(t,a),(function(e){return void 0!==e})),n(_.union(f,c,i))}))):void n(_.union(f,c))):void n(f)},e.Browser.prototype.on=function(e,t){this.eventHandlers[e]||(this.eventHandlers[e]=[]),this.eventHandlers[e].push(t)},e.Browser.prototype.un=function(e,t){if(this.eventHandlers[e]){var i=this.eventHandlers[e].indexOf(t);-1!==i&&this.eventHandlers[e].splice(i,1)}},e.Browser.prototype.fireEvent=function(e,t,i){var r,n;if(void 0!==this.eventHandlers[e])return r=i||window,n=_.map(this.eventHandlers[e],(function(e){return e.apply(r,t)})),_.first(n)},e.Browser.isLocusChrNameStartEnd=function(t,i,r){var n,a,o,s;return n=t.split(":"),void 0!==i.getChromosome(_.first(n))&&(r&&(r.chromosome=i.getChromosome(_.first(n)),r.start=0,r.end=r.chromosome.bpLength),1===_.size(n)||(a=_.last(n).split("-"),!(_.size(a)>2)&&(1===_.size(a)?(o=_.first(a).replace(/\,/g,""),!0===(s=!isNaN(o))&&r&&(r.start=parseInt(o,10),r.end=void 0)):2===_.size(a)&&(s=!0,_.each(a,(function(e,t){!0===s&&(o=e.replace(/\,/g,""),!0===(s=!isNaN(o))&&r&&(r[0===t?"start":"end"]=parseInt(o,10)))}))),!0===s&&r&&e.Browser.validateLocusExtent(r.chromosome,r),s)))},e.Browser.validateLocusExtent=function(t,i){var r=i.start,n=i.end;void 0===n?(n=(r-=e.browser.minimumBasesExtent()/2)+e.browser.minimumBasesExtent())>t.bpLength?r=(n=t.bpLength)-e.browser.minimumBasesExtent():r<0&&(r=0,n=e.browser.minimumBasesExtent()):n-r<e.browser.minimumBasesExtent()&&(center=(n+r)/2,center-e.browser.minimumBasesExtent()/2<0?n=(r=0)+e.browser.minimumBasesExtent():center+e.browser.minimumBasesExtent()/2>t.bpLength?r=(n=t.bpLength)-e.browser.minimumBasesExtent():n=(r=center-e.browser.minimumBasesExtent()/2)+e.browser.minimumBasesExtent()),i.start=Math.ceil(r),i.end=Math.floor(n)},e.Browser.prototype.search=function(t,a,o){var s,h,c,l,u,d,p;if(void 0===e.browser||void 0===e.browser.genome)return e.browser.initialLocus=t,void(a&&a());if(e.Browser.isLocusChrNameStartEnd(t,this.genome,void 0)){var f=e.gotoLocusFeature(t,this.genome,this);(o||!0===f)&&a&&a()}else if(p=this.featureDB[t.toUpperCase()])n(p.name,p.chrName,p.start,p.end,"");else if(this.searchConfig){if(d=this.searchConfig.url.replace("$FEATURE$",t),u=this.searchConfig,d.indexOf("$GENOME$")>-1){var g=this.genome.id?this.genome.id:"hg19";d.replace("$GENOME$",g)}igvxhr.loadString(d).then((function(o){var d="plain"===u.type?i(o):JSON.parse(o);u.resultsField&&(d=d[u.resultsField]),0==d.length?e.presentAlert('No feature found with name "'+t+'"'):1==d.length?(r=d[0],h=r[u.chromosomeField],c=r[u.startField]-u.coords,l=r[u.endField],s=r.featureType||r.type,n(t,h,c,l,s)):function(t,i,r){e.browser.$searchResultsTable.empty(),e.browser.$searchResults.show(),t.forEach((function(t){var a=$("<tr>");a.text(t.locusString),a.click((function(){e.browser.$searchResults.hide(),n(r,t[i.chromosomeField],t[i.startField]-i.coords,t[i.endField],t.featureType||t.type)})),e.browser.$searchResultsTable.append(a)}))}(d,u,t),a&&a()}))}},e.gotoLocusFeature=function(t,i,r){var n,o,s,h,c,l,u;return"locus",n=t.split(":"),(c=i.getChromosomeName(n[0]))&&(o=i.getChromosome(c)),o&&(s=h=void 0,1===n.length?(s=0,h=o.bpLength):(l=n[1].split("-"),s=Math.max(0,parseInt(l[0].replace(/,/g,""))-1),2===l.length&&((h=Math.min(o.bpLength,parseInt(l[1].replace(/,/g,""))))<0&&(h=o.bpLength))),u={start:s,end:h},e.Browser.validateLocusExtent(o,u),s=u.start,h=u.end),void 0===o||isNaN(s)||s>h?(e.presentAlert("Unrecognized feature or locus: "+t),!1):(r.goto(c,s,h),a.call(e.browser,t,"locus"),!0)},e}((igv=function(e){function t(e,t){this.block=e,this.offset=t}return e.BinaryParser=function(e,t){this.littleEndian=!t||t,this.position=0,this.view=e,this.length=e.byteLength},e.BinaryParser.prototype.available=function(){return this.length-this.position},e.BinaryParser.prototype.remLength=function(){return this.length-this.position},e.BinaryParser.prototype.hasNext=function(){return this.position<this.length-1},e.BinaryParser.prototype.getByte=function(){var e=this.view.getUint8(this.position,this.littleEndian);return this.position++,e},e.BinaryParser.prototype.getShort=function(){var e=this.view.getInt16(this.position,this.littleEndian);return this.position+=2,e},e.BinaryParser.prototype.getUShort=function(){var e=this.view.getUint16(this.position,this.littleEndian);return this.position+=2,e},e.BinaryParser.prototype.getInt=function(){var e=this.view.getInt32(this.position,this.littleEndian);return this.position+=4,e},e.BinaryParser.prototype.getUInt=function(){var e=this.view.getUint32(this.position,this.littleEndian);return this.position+=4,e},e.BinaryParser.prototype.getLong=function(){var e=[];e[0]=this.view.getUint8(this.position),e[1]=this.view.getUint8(this.position+1),e[2]=this.view.getUint8(this.position+2),e[3]=this.view.getUint8(this.position+3),e[4]=this.view.getUint8(this.position+4),e[5]=this.view.getUint8(this.position+5),e[6]=this.view.getUint8(this.position+6),e[7]=this.view.getUint8(this.position+7);var t=0;if(this.littleEndian)for(var i=e.length-1;i>=0;i--)t=256*t+e[i];else for(i=0;i<e.length;i++)t=256*t+e[i];return this.position+=8,t},e.BinaryParser.prototype.getString=function(e){for(var t,i="";0!=(t=this.view.getUint8(this.position++))&&(i+=String.fromCharCode(t),!e||i.length!=e););return i},e.BinaryParser.prototype.getFixedLengthString=function(e){var t,i,r="";for(t=0;t<e;t++)(i=this.view.getUint8(this.position++))>0&&(r+=String.fromCharCode(i));return r},e.BinaryParser.prototype.getFixedLengthTrimmedString=function(e){var t,i,r="";for(t=0;t<e;t++)(i=this.view.getUint8(this.position++))>32&&(r+=String.fromCharCode(i));return r},e.BinaryParser.prototype.getFloat=function(){var e=this.view.getFloat32(this.position,this.littleEndian);return this.position+=4,e},e.BinaryParser.prototype.getDouble=function(){var e=this.view.getFloat64(this.position,this.littleEndian);return this.position+=8,e},e.BinaryParser.prototype.skip=function(e){return this.position+=e,this.position},e.BinaryParser.prototype.getVPointer=function(){var e=this.position,i=this.view.getUint8(e+1)<<8|this.view.getUint8(e),r=4294967296*(255&this.view.getUint8(e+6))+16777216*(255&this.view.getUint8(e+5))+65536*(255&this.view.getUint8(e+4))+256*(255&this.view.getUint8(e+3))+(255&this.view.getUint8(e+2));return this.position+=8,new t(r,i)},t.prototype.isLessThan=function(e){return this.block<e.block||this.block===e.block&&this.offset<e.offset},t.prototype.isGreaterThan=function(e){return this.block>e.block||this.block===e.block&&this.offset>e.offset},t.prototype.print=function(){return this.block+":"+this.offset},e}((igv=function(e){function t(){var e=this.basesCovered;e>0&&(this.mean=this.sumData/e,this.stddev=Math.sqrt(this.sumSquares/(e-1)),this.minVal<0&&(this.mean,this.stddev),this.maxVal>0&&(this.mean,this.stddev),this.defaultRange={min:0,max:this.mean+3*this.stddev})}return e.BWTotalSummary=function(e){e?(this.basesCovered=e.getLong(),this.minVal=e.getDouble(),this.maxVal=e.getDouble(),this.sumData=e.getDouble(),this.sumSquares=e.getDouble(),t.call(this)):(this.basesCovered=0,this.minVal=0,this.maxVal=0,this.sumData=0,this.sumSquares=0,this.mean=0,this.stddev=0)},e.BWTotalSummary.prototype.updateStats=function(e){this.basesCovered+=e.count,this.sumData+=status.sumData,this.sumSquares+=sumSquares,this.minVal=MIN(_minVal,min),this.maxVal=MAX(_maxVal,max),t.call(this)},e}((igv=function(e){function t(t,i,r,n,a,o){var s,h=new e.BinaryParser(t),c=h.getInt(),l=h.getInt(),u=h.getInt(),d=h.getInt(),p=h.getInt(),f=h.getByte(),g=(h.getByte(),h.getUShort());if(c===r)for(;g-- >0;){switch(f){case 1:l=h.getInt(),u=h.getInt(),s=h.getFloat();break;case 2:l=h.getInt(),s=h.getFloat(),u=l+p;break;case 3:s=h.getFloat(),u=l+p,l+=d}if(l>=a)break;u>n&&Number.isFinite(s)&&o.push({chr:i,start:l,end:u,value:s})}}function i(t,i,r,n,a,o){for(var s,h,c,l,u,d=new e.BinaryParser(t);d.remLength()>=32;)if(d.getInt()===r){if(s=d.getInt(),h=d.getInt(),c=d.getInt(),d.getFloat(),d.getFloat(),l=d.getFloat(),d.getFloat(),u=0==c?0:l/c,s>=a)break;h>n&&Number.isFinite(u)&&o.push({chr:i,start:s,end:h,value:u})}}function r(t,i,r,n,a,o){for(var s,h,c,l,u,d,p,f,g,v,m,w=new e.BinaryParser(t);w.remLength()>=13;)if(w.getInt()==r&&(s=w.getInt(),h=w.getInt(),c=w.getString(),u={chr:i,start:s,end:h},s<a&&h>=n&&(o.push(u),(l=c.split("\t")).length>0&&(u.name=l[0]),l.length>1&&(u.score=parseFloat(l[1])),l.length>2&&(u.strand=l[2]),l.length>3&&(u.cdStart=parseInt(l[3])),l.length>4&&(u.cdEnd=parseInt(l[4])),l.length>5&&"."!==l[5]&&"0"!==l[5]&&(u.color=e.createColorString(l[5])),l.length>8))){d=parseInt(l[6]),p=l[7].split(","),f=l[8].split(","),g=[];for(var b=0;b<d;b++)m=(v=start+parseInt(f[b]))+parseInt(p[b]),g.push({start:v,end:m});u.exons=g}}return e.BWSource=function(t){this.reader=new e.BWReader(t),this.bufferedReader=new e.BufferedReader(t)},e.BWSource.prototype.getFeatures=function(e,n,a,o){var s=this;return new Promise((function(h,c){s.reader.getZoomHeaders().then((function(l){var u,d,p=s.reader,f=s.bufferedReader,g=function(e,t){var i,r,n=null;for(i=0;i<t.length;i++)if((r=t[i]).reductionLevel>e){n=r;break}return null==n&&(n=t[t.length-1]),n&&n.reductionLevel<4*e?n:null}(o,l);g?(u=g.indexOffset,d=i):(u=p.header.fullIndexOffset,d="BigWig"===p.type?t:r),p.loadRPTree(u).then((function(t){var i=s.reader.chromTree.dictionary[e];void 0===i?h(null):t.findLeafItemsOverlapping(i,n,a).then((function(t){var r=[];t&&0!=t.length||h([]),t.forEach((function(t){r.push(new Promise((function(r,o){var s=[];f.dataViewForRange({start:t.dataOffset,size:t.dataSize},!0).then((function(t){var o=new Zlib.Inflate(t).decompress();d(new DataView(o.buffer),e,i,n,a,s),r(s)})).catch(o)})))})),Promise.all(r).then((function(e){var t,i=e[0];if(e.length>1)for(t=1;t<e.length;t++)i=i.concat(e[t]);i.sort((function(e,t){return e.start-t.start})),h(i)})).catch(c)})).catch(c)})).catch(c)})).catch(c)}))},e.BWSource.prototype.getDefaultRange=function(){return null!=this.reader.totalSummary?this.reader.totalSummary.defaultRange:void 0},e}((igv=function(e){function t(){var t=i,n=this;return new Promise((function(i,a){var o={start:t,size:n.header.fullDataOffset-t+5};igvxhr.loadArrayBuffer(n.path,e.buildOptions(n.config,{range:o})).then((function(a){var o,s,h=n.header.nZoomLevels,c=new e.BinaryParser(new DataView(a));for(n.zoomLevelHeaders=[],n.firstZoomDataOffset=Number.MAX_VALUE,o=0;o<h;o++)s=new r(h-o,c),n.firstZoomDataOffset=Math.min(s.dataOffset,n.firstZoomDataOffset),n.zoomLevelHeaders.push(s);n.header.autoSqlOffset>0&&(c.position=n.header.autoSqlOffset-t,n.autoSql=c.getString()),n.header.totalSummaryOffset>0&&(c.position=n.header.totalSummaryOffset-t,n.totalSummary=new e.BWTotalSummary(c)),n.header.chromTreeOffset>0&&(c.position=n.header.chromTreeOffset-t,n.chromTree=new e.BPTree(c,t)),c.position=n.header.fullDataOffset-t,n.dataCount=c.getInt(),i()})).catch(a)}))}var i=64;e.BWReader=function(e){this.path=e.url,this.headPath=e.headURL||this.path,this.rpTreeCache={},this.config=e},e.BWReader.prototype.getZoomHeaders=function(){var e=this;return new Promise((function(t,i){e.zoomLevelHeaders?t(e.zoomLevelHeaders):e.loadHeader().then((function(){t(e.zoomLevelHeaders)})).catch((function(e){i(e)}))}))},e.BWReader.prototype.loadHeader=function(){var r=this;return new Promise((function(n,a){igvxhr.loadArrayBuffer(r.path,e.buildOptions(r.config,{range:{start:0,size:i}})).then((function(i){if(i){r.littleEndian=!0;var o=new e.BinaryParser(new DataView(i));if(2291137574===(s=o.getUInt()))r.type="BigWig";else if(2273964779==s)r.type="BigBed";else{var s;r.littleEndian=!1,o.littleEndian=!1,o.position=0,654085990===(s=o.getUInt())?r.type="BigWig":3958540679==s&&(r.type="BigBed")}r.header={},r.header.bwVersion=o.getUShort(),r.header.nZoomLevels=o.getUShort(),r.header.chromTreeOffset=o.getLong(),r.header.fullDataOffset=o.getLong(),r.header.fullIndexOffset=o.getLong(),r.header.fieldCount=o.getUShort(),r.header.definedFieldCount=o.getUShort(),r.header.autoSqlOffset=o.getLong(),r.header.totalSummaryOffset=o.getLong(),r.header.uncompressBuffSize=o.getInt(),r.header.reserved=o.getLong(),t.call(r).then(n).catch(a)}})).catch((function(e){a(e)}))}))},e.BWReader.prototype.loadRPTree=function(t){var i=this;return new Promise((function(r,n){var a=i.rpTreeCache[t];a?r(a):(a=new e.RPTree(t,i.contentLength,i.config,i.littleEndian),i.rpTreeCache[t]=a,a.load().then((function(){r(a)})).catch(n))}))};var r=function(e,t){this.index=e,this.reductionLevel=t.getInt(),this.reserved=t.getInt(),this.dataOffset=t.getLong(),this.indexOffset=t.getLong()};return e}((igv=function(e){function t(e){this.items=e;var t,i,r=Number.MAX_VALUE,n=0,a=Number.MAX_VALUE,o=0;for(t=0;t<e.length;t++)i=e[t],r=Math.min(r,i.startChrom),n=Math.max(n,i.endChrom),a=Math.min(a,i.startBase),o=Math.max(o,i.endBase);this.startChrom=r,this.endChrom=n,this.startBase=a,this.endBase=o}function i(e,t,i,r){return e?(t>e.startChrom||t==e.startChrom&&r>=e.startBase)&&(t<e.endChrom||t==e.endChrom&&i<e.endBase):(console.log("null item"),!1)}RPTREE_NODE_CHILD_ITEM_SIZE=24;var r=512e3;return e.RPTree=function(e,t,i,r){this.config=i,this.filesize=t,this.fileOffset=e,this.path=i.url,this.littleEndian=r},e.RPTree.prototype.load=function(){var t=this;return new Promise((function(i,n){var a=t.fileOffset+48,o=new e.BufferedReader(t.config,t.filesize,r);t.readNode(a,o).then((function(e){t.rootNode=e,i(t)})).catch(n)}))},e.RPTree.prototype.readNode=function(i,r){var n=this;return new Promise((function(a,o){r.dataViewForRange({start:i,size:4},!1).then((function(s){var h=new e.BinaryParser(s,n.littleEndian),c=1===h.getByte(),l=(h.getByte(),h.getUShort());i+=4;var u=l*(c?32:RPTREE_NODE_CHILD_ITEM_SIZE),d={start:i,size:u};r.dataViewForRange(d,!1).then((function(i){var r,n=new Array(l),o=new e.BinaryParser(i);if(c){for(r=0;r<l;r++){var s={isLeaf:!0,startChrom:o.getInt(),startBase:o.getInt(),endChrom:o.getInt(),endBase:o.getInt(),dataOffset:o.getLong(),dataSize:o.getLong()};n[r]=s}a(new t(n))}else{for(r=0;r<l;r++){s={isLeaf:!1,startChrom:o.getInt(),startBase:o.getInt(),endChrom:o.getInt(),endBase:o.getInt(),childOffset:o.getLong()};n[r]=s}a(new t(n))}})).catch(o)})).catch(o)}))},e.RPTree.prototype.findLeafItemsOverlapping=function(t,n,a){var o=this;return new Promise((function(s,h){var c=[],l=new Set,u=new e.BufferedReader(o.config,o.filesize,r);l.add(0),function e(r,d){i(r,t,n,a)&&r.items.forEach((function(r){i(r,t,n,a)&&(r.isLeaf?c.push(r):r.childNode?e(r.childNode):(l.add(r.childOffset),o.readNode(r.childOffset,u).then((function(t){r.childNode=t,e(t,r.childOffset)})).catch(h)))})),null!=d&&l.delete(d),l.isEmpty()&&s(c)}(o.rootNode,0)}))},e}((igv=function(e){return e.BPTree=function(t,i){var r=e.browser?e.browser.genome:null;this.header={},this.header.magic=t.getInt(),this.header.blockSize=t.getInt(),this.header.keySize=t.getInt(),this.header.valSize=t.getInt(),this.header.itemCount=t.getLong(),this.header.reserved=t.getLong(),this.dictionary={},function e(t,n,a,o){n>=0&&(t.position=n);var s,h,c,l,u,d=t.getByte(),p=(t.getByte(),t.getUShort());if(1==d)for(s=0;s<p;s++)h=t.getFixedLengthTrimmedString(a),c=t.getInt(),t.getInt(),r&&(h=r.getChromosomeName(h)),o[h]=c;else for(s=0;s<p;s++)h=t.getFixedLengthTrimmedString(a),l=t.getLong()-i,u=t.position,e(t,l,a,o),t.position=u}(t,-1,this.header.keySize,this.dictionary),this.header.keySize},e}((igv=function(e){return e.BufferedReader=function(e,t,i){this.path=e.url,this.contentLength=t,this.bufferSize=i||512e3,this.range={start:-1,size:-1},this.config=e},e.BufferedReader.prototype.dataViewForRange=function(t,i){var r=this;return new Promise((function(n,a){function o(e,t,i){var r=e.data.byteLength,a=t.start-e.range.start,o=i?new Uint8Array(e.data,a,r-a):new DataView(e.data,a,r-a);n(o)}var s,h;r.data&&r.range.start<=t.start&&r.range.start+r.range.size>=t.start+t.size?o(r,t,i):(s=Math.max(r.bufferSize,t.size),h=r.contentLength>0&&t.start+s>r.contentLength?{start:t.start}:{start:t.start,size:s},igvxhr.loadArrayBuffer(r.path,e.buildOptions(r.config,{range:h})).then((function(e){r.data=e,r.range=h,o(r,t,i)})).catch(a))}))},e}((igv=function(e){return e.isb={querySegByStudy:function(e,t){var i='SELECT * FROM [isb-cgc:tcga_201510_alpha.Copy_Number_segments] WHERE ParticipantBarcode IN (SELECT ParticipantBarcode FROM [isb-cgc:tcga_201510_alpha.Clinical_data] WHERE Study = "'+e+'")';return t&&(i+=" limit "+t),i},decodeSeg:function(e){var t={};return t.ParticipantBarcode=e.f[0].v,t.Study=e.f[4].v,t.Chromosome=e.f[6].v,t.Start=e.f[7].v,t.End=e.f[8].v,t.Num_Probes=e.f[9].v,t.Segment_mean=e.f[10].v,t}},e}((igv=function(e){return e.PairedAlignment=function(e){this.firstAlignment=e,this.chr=e.chr,this.readName=e.readName,e.start<e.mate.position?(this.start=e.start,this.end=Math.max(e.mate.position,e.start+e.lengthOnRef),this.connectingStart=e.start+e.lengthOnRef,this.connectingEnd=e.mate.position):(this.start=e.mate.position,this.end=e.start+e.lengthOnRef,this.connectingStart=e.mate.position,this.connectingEnd=e.start),this.lengthOnRef=this.end-this.start},e.PairedAlignment.prototype.setSecondAlignment=function(e){this.secondAlignment=e,e.start>this.firstAlignment.start?(this.end=e.start+e.lengthOnRef,this.connectingEnd=e.start):(this.start=e.start,this.connectingStart=e.start+e.lengthOnRef),this.lengthOnRef=this.end-this.start},e.PairedAlignment.prototype.popupData=function(e){var t=[];return t=t.concat(this.firstAlignment.popupData(e)),this.secondAlignment&&(t.push("-------------------------------"),t=t.concat(this.secondAlignment.popupData(e))),t},e.PairedAlignment.prototype.isPaired=function(){return!0},e.PairedAlignment.prototype.firstOfPairStrand=function(){return this.firstAlignment.isFirstOfPair()?this.firstAlignment.strand:this.secondAlignment&&this.secondAlignment.isFirstOfPair()?this.secondAlignment.strand:this.firstAlignment.mate.strand},e}((igv=function(e){function t(){this.posA=0,this.negA=0,this.posT=0,this.negT=0,this.posC=0,this.negC=0,this.posG=0,this.negG=0,this.posN=0,this.negN=0,this.pos=0,this.neg=0,this.qualA=0,this.qualT=0,this.qualC=0,this.qualG=0,this.qualN=0,this.qual=0,this.total=0}return e.CoverageMap=function(e,i,r,n,a){var o=this;this.refSeq=a,this.chr=e,this.bpStart=i,this.length=r-i,this.coverage=new Array(this.length),this.maximum=0,n.forEach((function(e){e.blocks.forEach((function(i){var r,n,a,s,h;for(a=i.start-o.bpStart,s=0;s<i.len;a++,s++)o.coverage[a]||(o.coverage[a]=new t),n=i.seq.charAt(s),r=e.strand?"pos"+n:"neg"+n,h=i.qual[s],o.coverage[a][r]+=1,o.coverage[a]["qual"+n]+=h,o.coverage[a].total+=1,o.coverage[a].qual+=h,o.maximum=Math.max(o.coverage[a].total,o.maximum)}))}))},e.CoverageMap.threshold=.2,e.CoverageMap.qualityWeight=!0,t.prototype.isMismatch=function(t){var i,r=this,n=e.CoverageMap.threshold*(e.CoverageMap.qualityWeight&&this.qual?this.qual:this.total);return i=0,["A","T","C","G"].forEach((function(n){n!==t&&(i+=e.CoverageMap.qualityWeight&&r.qual?r["qual"+n]:r["pos"+n]+r["neg"+n])})),i>=n},e}((igv=function(e){return e.unbgzf=function(e,t){var i=[],r=[0],n=0;for(t=t||e.byteLength-18;r[0]<t;){var a=new Uint8Array(e,r[0],18),o=a[11]<<8|a[10],s=(a[12],a[13],a[15],a[14],a[17]<<8|a[16]+1),h=12+o+r[0],c=e.byteLength-h;if(c<s+8)break;var l=jszlib_inflate_buffer(e,h,c,r);r[0]+=8,n+=l.byteLength,i.push(l)}if(1==i.length)return i[0];for(var u=new Uint8Array(n),d=0,p=0;p<i.length;++p){var f=new Uint8Array(i[p]);arrayCopy(f,0,u,d,f.length),d+=f.length}return u.buffer},e.BGZFile=function(e){this.filePosition=0,this.config=e},e.BGZFile.prototype.nextBlock=function(){var t=this;return new Promise((function(i,r){igvxhr.loadArrayBuffer(t.path,e.buildOptions(t.config,{range:{start:t.filePosition,size:18}})).then((function(n){var a=new Uint8Array(n),o=(a[11],a[10],a[12],a[13],a[15],a[14],a[17]<<8|a[16]+1);t.filePosition+=18,igvxhr.loadArrayBuffer(t.path,e.buildOptions(t.config,{range:{start:t.filePosition,size:o}})).then((function(e){var r=jszlib_inflate_buffer(e);t.filePosition+=o+8,i(r)})).catch(r)})).catch(r)}))},e}((igv=function(e){function t(t,i,r){var n,a=e.nucleotideColorComponents[i];if(a)return n=t<5?.1:Math.max(.1,Math.min(1,.1+.9*(t-5)/15)),(n=Math.round(10*n)/10)>=1?e.nucleotideColors[i]:"rgba("+a[0]+","+a[1]+","+a[2]+","+n+")"}function i(t){var i,r,n=this,a=n.colorBy;switch(r=n.parent.color,a){case"strand":r=t.strand?n.posStrandColor:n.negStrandColor;break;case"firstOfPairStrand":t instanceof e.PairedAlignment?r=t.firstOfPairStrand()?n.posStrandColor:n.negStrandColor:t.isPaired()&&(t.isFirstOfPair()?r=t.strand?n.posStrandColor:n.negStrandColor:t.isSecondOfPair()?r=t.strand?n.negStrandColor:n.posStrandColor:console.log("ERROR. Paired alignments are either first or second."));break;case"tag":void 0!==(i=t.tags()[n.colorByTag])&&(r=n.bamColorTag===n.colorByTag?"rgb("+i+")":n.tagColors.getColor(i));break;default:r=n.parent.color}return r}var r=0;return e.BAMTrack=function(t){this.featureSource=new e.BamSource(t),void 0===t.height&&(t.height=300),e.configTrack(this,t),void 0===t.coverageTrackHeight&&(t.coverageTrackHeight=50),this.coverageTrack=new CoverageTrack(t,this),this.alignmentTrack=new AlignmentTrack(t,this),this.visibilityWindow=t.visibilityWindow||3e4,this.viewAsPairs=t.viewAsPairs,this.pairsSupported=void 0===t.pairsSupported,this.color=t.color||"rgb(185, 185, 185)",this.sortOption=t.sortOption||{sort:"NUCLEOTIDE"},this.sortDirection=!0,this.filterOption=t.filterOption||{name:"mappingQuality",params:[30,void 0]}},e.BAMTrack.prototype.getFeatures=function(e,t,i){return this.featureSource.getAlignments(e,t,i)},e.BAMTrack.filters={noop:function(){return function(e){return!1}},strand:function(e){return function(t){return t.strand===e}},mappingQuality:function(e,t){return function(i){return!!(e&&i.mq<e)||!!(t&&i.mq>t)}}},e.BAMTrack.prototype.altClick=function(e,t,i){this.alignmentTrack.sortAlignmentRows(e,this.sortOption),this.trackView.viewports[0].redrawTile(this.featureSource.alignmentContainer),this.trackView.viewports[0].$viewport.scrollTop(0),this.sortDirection=!this.sortDirection},e.BAMTrack.prototype.computePixelHeight=function(e){return this.coverageTrack.computePixelHeight(e)+this.alignmentTrack.computePixelHeight(e)},e.BAMTrack.prototype.draw=function(e){this.coverageTrack.height>0&&this.coverageTrack.draw(e),this.alignmentTrack.draw(e)},e.BAMTrack.prototype.paintAxis=function(e,t,i){this.coverageTrack.paintAxis(e,t,this.coverageTrackHeight)},e.BAMTrack.prototype.popupMenuItemList=function(e){var t,i,r=this,n=[];return(t=$("<div>")).text("Sort by base"),i=function(){r.alignmentTrack.sortAlignmentRows(e.genomicLocation,r.sortOption),e.viewport.redrawTile(r.featureSource.alignmentContainer),e.viewport.$viewport.scrollTop(0),r.sortDirection=!r.sortDirection,e.popover.hide()},n.push({name:void 0,object:t,click:i,init:void 0}),!1===r.viewAsPairs&&((t=$("<div>")).text("View mate in split screen"),i=function(){r.alignmentTrack.popupMenuItemList(e)},n.push({name:void 0,object:t,click:i,init:void 0})),n},e.BAMTrack.prototype.popupData=function(e,t,i,r){return i>=this.coverageTrack.top&&i<this.coverageTrack.height?this.coverageTrack.popupData(e,t,this.coverageTrack.top,r):this.alignmentTrack.popupData(e,t,i-this.alignmentTrack.top,r)},e.BAMTrack.prototype.popupDataWithConfiguration=function(e){return e.y>=this.coverageTrack.top&&e.y<this.coverageTrack.height?this.coverageTrack.popupDataWithConfiguration(e):this.alignmentTrack.popupDataWithConfiguration(e)},e.BAMTrack.prototype.menuItemList=function(t){var i,r,n,a,o=this,s=[],h=[];return s.push(e.colorPickerMenuItem(t,this.trackView)),s.push(function(t){var i;return(i=$("<div>")).text("Sort by base"),{name:void 0,object:i,click:function(){var i,r,n=_.first(e.browser.genomicStateList),a=n.referenceFrame;t.hide(),r=Math.floor(e.browser.viewportContainerWidth()/n.locusCount*.5),i=Math.floor(a.start+a.toBP(r)),o.altClick(i,void 0,void 0),"show center guide"===e.browser.centerGuide.$centerGuideToggle.text()&&e.browser.centerGuide.$centerGuideToggle.trigger("click")},init:void 0}}(t)),h.push({key:"none",label:"track color"}),o.viewAsPairs||h.push({key:"strand",label:"read strand"}),o.pairsSupported&&o.alignmentTrack.hasPairs&&h.push({key:"firstOfPairStrand",label:"first-of-pair strand"}),n="tag"+(o.alignmentTrack.colorByTag?" ("+o.alignmentTrack.colorByTag+")":""),h.push({key:"tag",label:n}),(i=$('<div class="igv-track-menu-category igv-track-menu-border-top">')).text("Color by"),s.push({name:void 0,object:i,click:void 0,init:void 0}),h.forEach((function(t){var i,r,n;a=o.alignmentTrack.colorBy===t.key,s.push((i=t,r=a,(n=[]).push("<div>"),n.push(r?'<i class="fa fa-check"></i>':'<i class="fa fa-check fa-check-hidden"></i>'),"tag"===i.key?n.push('<span id="color-by-tag">'):n.push("<span>"),n.push(i.label),n.push("</span>"),n.push("</div>"),{name:void 0,object:$(n.join("")),click:function(){e.popover.hide(),"tag"===i.key?(e.dialog.configure((function(){return"Tag Name"}),o.alignmentTrack.colorByTag?o.alignmentTrack.colorByTag:"",(function(){var t=e.dialog.$dialogInput.val().trim();o.alignmentTrack.colorBy="tag",t!==o.alignmentTrack.colorByTag&&(o.alignmentTrack.colorByTag=e.dialog.$dialogInput.val().trim(),o.alignmentTrack.tagColors=new e.PaletteColorTable("Set1"),$("#color-by-tag").text(o.alignmentTrack.colorByTag)),o.trackView.update()})),e.dialog.show($(o.trackView.trackDiv))):(o.alignmentTrack.colorBy=i.key,o.trackView.update())},init:void 0}))})),r=[],o.pairsSupported&&o.alignmentTrack.hasPairs&&(r.push('<div class="igv-track-menu-border-top">'),r.push(!0===o.viewAsPairs?'<i class="fa fa-check">':'<i class="fa fa-check fa-check-hidden">'),r.push("</i>"),r.push("View as pairs"),r.push("</div>"),s.push({object:$(r.join("")),click:function(){var e=$(this).find("i");t.hide(),o.viewAsPairs=!o.viewAsPairs,!0===o.viewAsPairs?e.removeClass("fa-check-hidden"):e.addClass("fa-check-hidden"),o.featureSource.setViewAsPairs(o.viewAsPairs),o.trackView.update()}})),s},CoverageTrack=function(t,i){this.parent=i,this.featureSource=i.featureSource,this.top=0,this.height=t.coverageTrackHeight,this.dataRange={min:0},this.paintAxis=e.paintAxis},CoverageTrack.prototype.computePixelHeight=function(e){return this.height},CoverageTrack.prototype.draw=function(t){var i,r,n,a,o,s,h,c,l,u,d,p=this,f=t.features,g=t.context,v=t.bpPerPixel,m=t.bpStart,w=m+t.pixelWidth*v+1,b=f.coverageMap;for(this.top&&g.translate(0,top),b.refSeq&&(d=b.refSeq.toUpperCase()),this.dataRange.max=b.maximum,a=Math.max(1,Math.ceil(1/v)),h=0,c=b.coverage.length;h<c;h++)if(!((i=b.bpStart+h)<m)){if(i>w)break;(l=b.coverage[h])&&(o=Math.round(l.total/this.dataRange.max*this.height),n=this.height-o,r=Math.floor((i-m)/v),e.graphics.setProperties(g,{fillStyle:this.parent.color,strokeStyle:this.color}),e.graphics.fillRect(g,r,n,a,o))}if(d)for(h=0,c=b.coverage.length;h<c;h++)if(!((i=b.bpStart+h)<m)){if(i>w)break;(l=b.coverage[h])&&(o=l.total/this.dataRange.max*this.height,n=this.height-o,r=Math.floor((i-m)/v),s=d[h],l.isMismatch(s)&&(e.graphics.setProperties(g,{fillStyle:e.nucleotideColors[s]}),e.graphics.fillRect(g,r,n,a,o),u=0,["A","C","T","G"].forEach((function(t){var i;i=(l["pos"+t]+l["neg"+t])/p.dataRange.max*p.height,n=p.height-i-u,u+=i,e.graphics.setProperties(g,{fillStyle:e.nucleotideColors[t]}),e.graphics.fillRect(g,r,n,a,i)}))))}},CoverageTrack.prototype.popupDataWithConfiguration=function(e){return this.popupData(e.genomicLocation,e.x,this.top,e.viewport.genomicState.referenceFrame)},CoverageTrack.prototype.popupData=function(t,i,r,n){var a,o,s=this.featureSource.alignmentContainer.coverageMap,h=[];return a=t-s.bpStart,(o=s.coverage[a])&&(h.push(n.chrName+":"+e.numberFormatter(1+t)),h.push({name:"Total Count",value:o.total}),tmp=o.posA+o.negA,tmp>0&&(tmp=tmp.toString()+" ("+Math.floor((o.posA+o.negA)/o.total*100)+"%)"),h.push({name:"A",value:tmp}),tmp=o.posC+o.negC,tmp>0&&(tmp=tmp.toString()+" ("+Math.floor(tmp/o.total*100)+"%)"),h.push({name:"C",value:tmp}),tmp=o.posG+o.negG,tmp>0&&(tmp=tmp.toString()+" ("+Math.floor(tmp/o.total*100)+"%)"),h.push({name:"G",value:tmp}),tmp=o.posT+o.negT,tmp>0&&(tmp=tmp.toString()+" ("+Math.floor(tmp/o.total*100)+"%)"),h.push({name:"T",value:tmp}),tmp=o.posN+o.negN,tmp>0&&(tmp=tmp.toString()+" ("+Math.floor(tmp/o.total*100)+"%)"),h.push({name:"N",value:tmp})),h},AlignmentTrack=function(e,t){this.parent=t,this.featureSource=t.featureSource,this.top=0==e.coverageTrackHeight?0:e.coverageTrackHeight+5,this.alignmentRowHeight=e.alignmentRowHeight||14,this.negStrandColor=e.negStrandColor||"rgba(150, 150, 230, 0.75)",this.posStrandColor=e.posStrandColor||"rgba(230, 150, 150, 0.75)",this.insertionColor=e.insertionColor||"rgb(138, 94, 161)",this.deletionColor=e.deletionColor||"black",this.skippedColor=e.skippedColor||"rgb(150, 170, 170)",this.colorBy=e.colorBy||"none",this.colorByTag=e.colorByTag,this.bamColorTag=void 0===e.bamColorTag?"YC":e.bamColorTag,this.sortOption=e.sortOption||{sort:"NUCLEOTIDE"},this.sortDirection=!0,this.hasPairs=!1},AlignmentTrack.prototype.computePixelHeight=function(e){if(e.packedAlignmentRows){var t=0;return e.hasDownsampledIntervals()&&(t+=10),t+this.alignmentRowHeight*e.packedAlignmentRows.length+5}return this.height},AlignmentTrack.prototype.draw=function(n){function a(t,r,n){var a=i.call(s,t.firstAlignment),o=(t.connectingStart-u)/l,h=(t.connectingEnd-u)/l,d=r+n/2;t.connectingEnd<u||t.connectingStart>p||(t.mq<=0&&(a=e.addAlphaToRGB(a,"0.15")),e.graphics.setProperties(c,{fillStyle:a,strokeStyle:"alignmentColor"}),e.graphics.strokeLine(c,o,d,h,d))}function o(r,n,a){function o(i){var o,p,f,y,k,x,S,_,C=i.start-h.start,T=(i.start-u)/l,I=(i.start+i.len-u)/l,A=Math.max(1,I-T),P=s.alignmentRowHeight/2,R=i.seq.toUpperCase(),$=s.skippedColor,E=s.deletionColor,M=n+a/2;if(void 0!==i.gapType&&void 0!==I&&void 0!==d&&("D"===i.gapType?e.graphics.strokeLine(c,d,M,T,M,{strokeStyle:E}):e.graphics.strokeLine(c,d,M,T,M,{strokeStyle:$})),d=I,!0===r.strand&&v===b.length-1?(x=[T,I,I+P,I,T,T],S=[n,n,n+a/2,n+a,n+a,n],e.graphics.fillPolygon(c,x,S,{fillStyle:m}),s.highlightedAlignmentReadNamed===r.readName&&e.graphics.strokePolygon(c,x,S,{strokeStyle:"red"}),r.mq<=0&&e.graphics.strokePolygon(c,x,S,{strokeStyle:w})):!1===r.strand&&0===v?(x=[I,T,T-P,T,I,I],S=[n,n,n+a/2,n+a,n+a,n],e.graphics.fillPolygon(c,x,S,{fillStyle:m}),s.highlightedAlignmentReadNamed===r.readName&&e.graphics.strokePolygon(c,x,S,{strokeStyle:"red"}),r.mq<=0&&e.graphics.strokePolygon(c,x,S,{strokeStyle:w})):(e.graphics.fillRect(c,T,n,A,a,{fillStyle:m}),r.mq<=0&&(c.save(),c.strokeStyle=w,c.strokeRect(T,n,A,a),c.restore())),g&&"*"!==R)for(_=0,len=R.length;_<len;_++)p=R.charAt(_),o=g.charAt(C+_),"="===p&&(p=o),"X"!==p&&o===p||(i.qual&&i.qual.length>_?k=t(i.qual[_],p,i.start):k=e.nucleotideColors[p],k&&(f=(i.start+_-u)/l,y=Math.max(1,1/l),e.graphics.fillRect(c,f,n,y,a,{fillStyle:k})))}var d,f,v,m=i.call(s,r),w="alignmentColor",b=r.blocks;if(!(r.start+r.lengthOnRef<u||r.start>p))for(r.mq<=0&&(m=e.addAlphaToRGB(m,"0.15")),e.graphics.setProperties(c,{fillStyle:m,strokeStyle:w}),v=0;v<b.length;v++)if(!((f=b[v]).start+f.len<u)){if(o(f),f.start+f.len>p)break;r.insertions&&r.insertions.forEach((function(t){var i=(t.start-u)/l-1;e.graphics.fillRect(c,i,n-1,3,a+2,{fillStyle:s.insertionColor})}))}}var s=this,h=n.features,c=n.context,l=n.bpPerPixel,u=n.bpStart,d=n.pixelWidth,p=u+d*l+1,f=h.packedAlignmentRows,g=h.sequence;this.top&&c.translate(0,this.top),g&&(g=g.toUpperCase()),h.hasDownsampledIntervals()?(r=10,h.downsampledIntervals.forEach((function(t){var i=(t.start-u)/l,r=(t.end-u)/l;r-i>5&&(i+=1,r-=1),e.graphics.fillRect(c,i,2,r-i,3,{fillStyle:"black"})}))):r=0,f&&f.forEach((function(t,i){var n,h=r+s.alignmentRowHeight*i,c=s.alignmentRowHeight-2;for(i=0;i<t.alignments.length;i++)if(n=t.alignments[i],s.hasPairs=s.hasPairs||n.isPaired(),!(n.start+n.lengthOnRef<u)){if(n.start>p)break;!0!==n.hidden&&(n instanceof e.PairedAlignment?(a(n,h,c),o(n.firstAlignment,h,c),n.secondAlignment&&o(n.secondAlignment,h,c)):o(n,h,c))}}))},AlignmentTrack.prototype.sortAlignmentRows=function(e,t){var i=this;this.featureSource.alignmentContainer.packedAlignmentRows.forEach((function(r){r.updateScore(e,i.featureSource.alignmentContainer,t)})),this.featureSource.alignmentContainer.packedAlignmentRows.sort((function(e,t){return!0===i.sortDirection?e.score-t.score:t.score-e.score}))},AlignmentTrack.prototype.popupDataWithConfiguration=function(e){var t;return(t=this.getClickedAlignment(e.viewport,e.genomicLocation))?t.popupData(e.genomicLocation):void 0},AlignmentTrack.prototype.popupData=function(e,t,i,n){var a,o,s,h,c,l,u=this.featureSource.alignmentContainer.packedAlignmentRows,d=this.featureSource.alignmentContainer.downsampledIntervals;if((a=Math.floor((i-r)/this.alignmentRowHeight))<0){for(h=0,c=d.length;h<c;h++)if(d[h].start<=e&&d[h].end>=e){s=d[h];break}}else if(a<u.length)for(s=void 0,h=0,c=(o=u[a]).alignments.length;h<c;h++)if((l=o.alignments[h]).start<=e&&l.start+l.lengthOnRef>=e){s=l;break}return s?s.popupData(e):[]},AlignmentTrack.prototype.popupMenuItemList=function(t){var i,r,n,a,o,s;this.highlightedAlignmentReadNamed=void 0,t.popover.hide(),(i=this.getClickedAlignment(t.viewport,t.genomicLocation))&&(this.highlightedAlignmentReadNamed=i.readName,r=_.map(e.browser.genomicStateList,(function(e){return e.locusSearchString})),a=t.viewport.genomicState.locusIndex,o=_.first(r,1+a),s=1===_.size(r)?void 0:_.last(r,_.size(r)-(1+a)),n=function(e,t){var i,r,n;return n=t.$viewport.width()*t.genomicState.referenceFrame.bpPerPixel,r=(e.start+(e.start+e.lengthOnRef))/2,i=e.chr+":"+Math.round(r-n/2).toString()+"-"+Math.round(r+n/2).toString(),r=(e.mate.position+(e.mate.position+e.lengthOnRef))/2,[i,e.chr+":"+Math.round(r-n/2).toString()+"-"+Math.round(r+n/2).toString()]}(i,t.viewport),o.splice(-1,1),Array.prototype.push.apply(o,n),s&&Array.prototype.push.apply(o,s),e.browser.parseSearchInput(o.join(" ")))},AlignmentTrack.prototype.getClickedAlignment=function(e,t){var i,r;return i=e.drawConfiguration.features.packedAlignmentRows,r=void 0,_.each(i,(function(e){void 0===r&&(r=_.filter(e.alignments,(function(e){return e.isPaired()&&e.isMateMapped()&&e.start<=t&&e.start+e.lengthOnRef>=t})))})),r?_.first(r):void 0},e}((igv=function(e){function t(t){var i=[];return t.forEach((function(t){t.alignments.forEach((function(t){t instanceof e.PairedAlignment?(t.firstAlignment&&i.push(t.firstAlignment),t.secondAlignment&&i.push(t.secondAlignment)):i.push(t)}))})),i}function i(t,i,r,n){if(t){if(t.sort((function(e,t){return e.start-t.start})),0===t.length)return[];var a,o,s,h,c=[],l=0,u=0,d=i,p=[],f=Math.max(i,t[0].start);for(t.forEach((function(e){var t=Math.max(0,e.start-f);void 0===c[t]&&(c[t]=[]),c[t].push(e)}));l<t.length&&p.length<n;){for(a=new e.BamAlignmentRow;d<=r;){for(s=void 0;!s&&d<=r;)void 0===c[o=d-f]?++d:s=c[o];if(!s)break;h=s.pop(),0===s.length&&(c[o]=void 0),a.alignments.push(h),d=h.start+h.lengthOnRef+8,++l}if(a.alignments.length>0&&p.push(a),d=f,l===u)break;u=l}return p}}return e.BamSource=function(t){this.config=t,this.alignmentContainer=void 0,this.maxRows=t.maxRows||1e3,"ga4gh"===t.sourceType?this.bamReader=new e.Ga4ghAlignmentReader(t):this.bamReader=new e.BamReader(t),this.viewAsPairs=t.viewAsPairs},e.BamSource.prototype.setViewAsPairs=function(r){var n,a,o;if(this.viewAsPairs!==r&&(this.viewAsPairs=r,this.alignmentContainer)){var s,h=this.alignmentContainer;s=r?(n=h.packedAlignmentRows,a={},o=[],n.forEach((function(t){t.alignments.forEach((function(t){var i;!function(e){return e.isPaired()&&e.isMateMapped()&&e.chr===e.mate.chr&&(e.isFirstOfPair()||e.isSecondOfPair())&&!(e.isSecondary()||e.isSupplementary())}(t)?o.push(t):(i=a[t.readName])?(i.setSecondAlignment(t),a[t.readName]=void 0):(i=new e.PairedAlignment(t),a[t.readName]=i,o.push(i))}))})),o):t(h.packedAlignmentRows),h.packedAlignmentRows=i(s,h.start,h.end,this.maxRows)}},e.BamSource.prototype.getAlignments=function(r,n,a){var o=this;return new Promise((function(s,h){o.alignmentContainer&&o.alignmentContainer.contains(r,n,a)?s(o.alignmentContainer):o.bamReader.readAlignments(r,n,a).then((function(r){var n=o.config.maxRows||500,a=r.alignments;o.viewAsPairs||(a=t([{alignments:a}])),r.packedAlignmentRows=i(a,r.start,r.end,n),r.alignments=void 0,o.alignmentContainer=r,e.browser.genome.sequence.getSequence(r.chr,r.start,r.end).then((function(e){e&&(r.coverageMap.refSeq=e,r.sequence=e,s(r))})).catch(h)})).catch(h)}))},e}((igv=function(e){function t(t){return new Promise((function(i,r){t.index?i(t.index):e.loadBamIndex(t.baiPath,t.config).then((function(e){t.index=e,i(t.index)})).catch(r)}))}function i(e,t){return e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}var r=["=","A","C","x","G","x","x","x","T","x","x","x","x","x","x","N"],n=["M","I","D","N","S","H","P","=","X","?","?","?","?","?","?","?"];return e.BamReader=function(t){this.config=t,this.filter=t.filter||new e.BamFilter,this.bamPath=t.url,this.baiPath=t.indexURL||this.bamPath+".bai",this.headPath=t.headURL||this.bamPath,this.samplingWindowSize=void 0===t.samplingWindowSize?100:t.samplingWindowSize,this.samplingDepth=void 0===t.samplingDepth?50:t.samplingDepth,this.samplingDepth>2500&&(e.log("Warning: attempt to set sampling depth > maximum value of 2500"),this.samplingDepth=2500),t.viewAsPairs?this.pairsSupported=!0:this.pairsSupported=void 0===t.pairsSupported||t.pairsSupported},e.BamReader.prototype.readAlignments=function(a,o,s){function h(e,t){for(var i,r,n,a,o=[],s=0,h=e.start,c=t.length,l=0;l<c;l++){var u=t[l];switch(u.ltr){case"H":case"P":break;case"S":s+=u.len,a="S";break;case"N":h+=u.len,a="N";break;case"D":h+=u.len,a="D";break;case"I":r="*"===e.seq?"*":e.seq.substr(s,u.len),n=e.qual?e.qual.slice(s,u.len):void 0,void 0===i&&(i=[]),i.push({start:h,len:u.len,seq:r,qual:n}),s+=u.len;break;case"M":case"EQ":case"=":case"X":r="*"===e.seq?"*":e.seq.substr(s,u.len),n=e.qual?e.qual.slice(s,u.len):void 0,o.push({start:h,len:u.len,seq:r,qual:n,gapType:a}),s+=u.len,h+=u.len;break;default:console.log("Error processing cigar element: "+u.len+u.ltr)}}return{blocks:o,insertions:i}}var c=this;return new Promise((function(l,u){var d;(d=c,new Promise((function(e,t){d.chrToIndex?e(d.chrToIndex):d.readHeader().then((function(){e(d.chrToIndex)})).catch(t)}))).then((function(d){var p=d[a],f=new e.AlignmentContainer(a,o,s,c.samplingWindowSize,c.samplingDepth,c.pairsSupported);void 0===p?l(f):t(c).then((function(t){var a=t.blocksForRange(p,o,s),d=[];return a?0===a.length?void l(f):(a.forEach((function(t){d.push(new Promise((function(a,l){var u=t.minv.block,d={start:u,size:t.maxv.block+65e3-u+1};igvxhr.loadArrayBuffer(c.bamPath,e.buildOptions(c.config,{range:d})).then((function(l){(function(t,a,o,s,l,u,d){for(var p,f,g,v,m,w,b,y,k,x,S,_,C,T,I,A,P,R,$,E,M,L,D;;){if(a>=t.length)return;if((p=a+i(t,a)+4)>t.length)return;if(f=new e.BamAlignment,v=i(t,a+4),m=i(t,a+8),f.chr=c.indexToChr[v],f.start=m,v<0)return;if(v>u||m>l)return;if(!(v<u)){for(b=(65280&(w=i(t,a+12)))>>8,y=255&w,f.mq=b,x=(4294901760&(k=i(t,a+16)))>>16,S=65535&k,f.flags=x,f.strand=!(16&x),_=i(t,a+20),C=i(t,a+24),T=i(t,a+28),f.fragmentLength=i(t,a+32),I="",A=0;A<y-1;++A)I+=String.fromCharCode(t[a+36+A]);for(f.readName=I,P=a+36+y,R=0,$="",M=[],E=0;E<S;++E){var F=i(t,P),B=F>>4,O=n[15&F];"M"!=O&&"EQ"!=O&&"X"!=O&&"D"!=O&&"N"!=O&&"="!=O||(R+=B),$=$+B+O,P+=4,M.push({len:B,ltr:O})}if(f.cigar=$,f.lengthOnRef=R,f.start+f.lengthOnRef<s)a=p;else{for(L="",D=_+1>>1,A=0;A<D;++A){var N=t[P+A];L+=r[(240&N)>>4],L+=r[15&N]}if(L=L.substring(0,_),P+=D,f.seq=L,1===_&&"*"===String.fromCharCode(t[P+A]+33));else for(f.qual=[],A=0;A<_;++A)f.qual.push(t[P+A]);P+=_,C>=0&&(f.mate={chr:c.indexToChr[C],position:T,strand:!(32&x)}),f.tagBA=new Uint8Array(t.buffer.slice(P,p)),P+=p,(!s||f.start<=l&&f.start+f.lengthOnRef>=s&&d.pass(f))&&(void 0!==u&&v!=u||(g=h(f,M),f.blocks=g.blocks,f.insertions=g.insertions,o.push(f))),a=p}}}})(new Uint8Array(e.unbgzf(l)),t.minv.offset,f,o,s,p,c.filter),a(f)})).catch((function(e){l(e)}))})))})),void Promise.all(d).then((function(e){f.finish(),l(f)})).catch((function(e){u(e)}))):(l(null),void u("Error reading bam index"))})).catch(u)})).catch(u)}))},e.BamReader.prototype.readHeader=function(){var r=this;return new Promise((function(n,a){t(r).then((function(t){var o=t.firstAlignmentBlock+65536;igvxhr.loadArrayBuffer(r.bamPath,e.buildOptions(r.config,{range:{start:0,size:o}})).then((function(t){for(var a=e.unbgzf(t,o),s=new Uint8Array(a),h=(i(s,0),i(s,4)),c=e.browser?e.browser.genome:null,l=0;l<h;++l)String.fromCharCode(s[l+8]);var u=i(s,h+8),d=h+12;r.chrToIndex={},r.indexToChr=[];for(l=0;l<u;++l){for(var p=i(s,d),f="",g=0;g<p-1;++g)f+=String.fromCharCode(s[d+4+g]);i(s,d+p+4),c&&c.getChromosomeName&&(f=c.getChromosomeName(f)),r.chrToIndex[f]=l,r.indexToChr.push(f),d=d+8+p}n()})).catch(a)})).catch(a)}))},e}((igv=function(e){return e.loadBamIndex=function(t,i,r){return new Promise((function(n,a){var o=e.browser?e.browser.genome:null;igvxhr.loadArrayBuffer(t,e.buildOptions(i)).then((function(i){var a,s,h,c,l,u,d,p,f,g,v,m,w,b,y=[],k=Number.MAX_VALUE,x=0;if(i){if(r)i=new Zlib.Gunzip(new Uint8Array(i)).decompress().buffer;if(!(21578050===(a=(l=new e.BinaryParser(new DataView(i))).getInt())||r&&21578324===a))throw new Error(t+" is not a "+(r?"tabix":"bai")+" file");if(c=l.getInt(),r)for(l.getInt(),l.getInt(),l.getInt(),l.getInt(),l.getInt(),l.getInt(),l.getInt(),b={},m=0;m<c;m++){var S=l.getString();o&&(S=o.getChromosomeName(S)),b[S]=m}for(w=0;w<c;w++){for(u={},d=[],s=l.getInt(),v=0;v<s;v++)if(37450===(p=l.getInt()))_=l.getInt(),f=l.getVPointer(),g=l.getVPointer(),l.getLong(),l.getLong();else{u[p]=[];var _=l.getInt();for(m=0;m<_;m++)f=l.getVPointer(),g=l.getVPointer(),f&&g&&(f.block<k&&(k=f.block),g.block>x&&(x=g.block),u[p].push([f,g]))}for(h=l.getInt(),m=0;m<h;m++)f=l.getVPointer(),d.push(f);s>0&&(y[w]={binIndex:u,linearIndex:d})}n(new e.BamIndex(y,k,x,b,r))}else n(null)})).catch(a)}))},e.BamIndex=function(e,t,i,r,n){this.firstAlignmentBlock=t,this.lastAlignmentBlock=i,this.indices=e,this.sequenceIndexMap=r,this.tabix=n},e.BamIndex.prototype.blocksForRange=function(e,t,i){var r,n,a,o,s,h,c,l,u=this.indices[e];if(u){for(r=function(e,t){var i,r=[];for(t>=1<<29&&(t=1<<29),--t,r.push(0),i=1+(e>>26);i<=1+(t>>26);++i)r.push(i);for(i=9+(e>>23);i<=9+(t>>23);++i)r.push(i);for(i=73+(e>>20);i<=73+(t>>20);++i)r.push(i);for(i=585+(e>>17);i<=585+(t>>17);++i)r.push(i);for(i=4681+(e>>14);i<=4681+(t>>14);++i)r.push(i);return r}(t,i),n=[],r.forEach((function(e){if(u.binIndex[e])for(var t=u.binIndex[e],i=t.length,r=0;r<i;++r){var a=t[r][0],o=t[r][1];n.push({minv:a,maxv:o,bin:e})}})),a=u.linearIndex.length,o=null,s=Math.min(t>>14,a-1),h=Math.min(i>>14,a-1),l=s;l<=h;++l)(c=u.linearIndex[l])&&(o&&!c.isLessThan(o)||(o=c));return function(e,t){var i=[],r=null;return 0===e.length?e:(e.sort((function(e,t){var i=e.minv.block-t.minv.block;return 0!=i?i:e.minv.offset-t.minv.offset})),e.forEach((function(e){e.maxv.isGreaterThan(t)&&(null===r?(i.push(e),r=e):e.minv.block-r.maxv.block<65e3?e.maxv.isGreaterThan(r.maxv)&&(r.maxv=e.maxv):(i.push(e),r=e))})),i)}(n,o)}return[]},e}((igv=function(e){return e.BamAlignmentRow=function(){this.alignments=[],this.score=void 0},e.BamAlignmentRow.prototype.findCenterAlignment=function(e,t){var i=void 0;return this.alignments.forEach((function(r){void 0===i&&(r.start+r.lengthOnRef<e||r.start>t||(i=r))})),i},e.BamAlignmentRow.prototype.updateScore=function(e,t,i){this.score=this.calculateScore(e,1+e,t,i)},e.BamAlignmentRow.prototype.calculateScore=function(e,t,i,r){function n(e,t,i){var r=void 0;return e.forEach((function(e){for(var n=0,a=e.start-i,o=e.start,s=e.seq.length;n<s;n++,a++,o++)t===o&&(r={block:e,blockSeqIndex:n,referenceSequenceIndex:a,location:t})})),r}function a(e,t){var i,r,n;return"*"===e.block.seq?3:(i=t.sequence.charAt(e.referenceSequenceIndex),"="===(r=e.block.seq.charAt(e.blockSeqIndex))&&(r=i),"N"===r?2:i===r?3:"X"===r||i!==r?-((n=t.coverageMap.coverage[e.location-t.coverageMap.bpStart])["pos"+r]+n["neg"+r]+(n.qual?n.qual:0)/1e3):void 0)}var o,s,h,c,l,u;return void 0===(c=this.findCenterAlignment(e,t))?Number.MAX_VALUE:(s=h=void 0,"NUCLEOTIDE"===r.sort?(c.blocks&&c.blocks.length>0&&((l=n(c.blocks,e,i.start))&&(s=a(l,i))),c.firstAlignment&&c.firstAlignment.blocks&&c.firstAlignment.blocks.length>0&&((l=n(c.firstAlignment.blocks,e,i.start))&&(s=a(l,i))),c.secondAlignment&&c.secondAlignment.blocks&&c.secondAlignment.blocks.length>0&&((u=n(c.secondAlignment.blocks,e,i.start))&&(h=a(u,i))),void 0===(o=void 0===s?h:s)?Number.MAX_VALUE:o):"STRAND"===r.sort?c.strand?1:-1:"START"===r.sort?c.start:Number.MAX_VALUE)},e}((igv=function(e){function t(e,t){return e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}function i(e,t){return e[t+1]<<8|e[t]}function r(e,t){return new DataView(e.buffer).getFloat32(t,!0)}return e.BamAlignment=function(){this.hidden=!1},e.BamAlignment.prototype.isMapped=function(){return 0==(4&this.flags)},e.BamAlignment.prototype.isPaired=function(){return 0!=(1&this.flags)},e.BamAlignment.prototype.isProperPair=function(){return 0!=(2&this.flags)},e.BamAlignment.prototype.isFirstOfPair=function(){return 0!=(64&this.flags)},e.BamAlignment.prototype.isSecondOfPair=function(){return 0!=(128&this.flags)},e.BamAlignment.prototype.isSecondary=function(){return 0!=(256&this.flags)},e.BamAlignment.prototype.isSupplementary=function(){return 0!=(2048&this.flags)},e.BamAlignment.prototype.isFailsVendorQualityCheck=function(){return 0!=(512&this.flags)},e.BamAlignment.prototype.isDuplicate=function(){return 0!=(1024&this.flags)},e.BamAlignment.prototype.isMateMapped=function(){return 0==(8&this.flags)},e.BamAlignment.prototype.isNegativeStrand=function(){return 0!=(16&this.flags)},e.BamAlignment.prototype.isMateNegativeStrand=function(){return 0!=(32&this.flags)},e.BamAlignment.prototype.tags=function(){return this.tagDict||(this.tagBA?(this.tagDict=function(e){for(var n=0,a=e.length,o={};n<a;){var s,h=String.fromCharCode(e[n])+String.fromCharCode(e[n+1]),c=String.fromCharCode(e[n+2]);if("A"==c)s=String.fromCharCode(e[n+3]),n+=4;else if("i"===c||"I"===c)s=t(e,n+3),n+=7;else if("c"===c||"C"===c)s=e[n+3],n+=4;else if("s"===c||"S"===c)s=i(e,n+3),n+=5;else if("f"===c)s=r(e,n+3),n+=7;else{if("Z"!==c){s="Error unknown type: "+c,o[h]=s;break}for(n+=3,s="";;){var l=e[n++];if(0===l)break;s+=String.fromCharCode(l)}}o[h]=s}return o}(this.tagBA),this.tagBA=void 0):this.tagDict={}),this.tagDict},e.BamAlignment.prototype.popupData=function(t){function i(e){return e?"Yes":"No"}var r,n,a=[];if(this.insertions)for(var o=0;o<this.insertions.length;o+=1){var s=this.insertions[o].start;if(t==s||t==s-1)return a.push({name:"Insertion",value:this.insertions[o].seq}),a.push({name:"Location",value:s}),a}for(var h in a.push({name:"Read Name",value:this.readName}),a.push("<hr>"),a.push({name:"Alignment Start",value:e.numberFormatter(1+this.start),borderTop:!0}),a.push({name:"Read Strand",value:!0===this.strand?"(+)":"(-)",borderTop:!0}),a.push({name:"Cigar",value:this.cigar}),a.push({name:"Mapped",value:i(this.isMapped())}),a.push({name:"Mapping Quality",value:this.mq}),a.push({name:"Secondary",value:i(this.isSecondary())}),a.push({name:"Supplementary",value:i(this.isSupplementary())}),a.push({name:"Duplicate",value:i(this.isDuplicate())}),a.push({name:"Failed QC",value:i(this.isFailsVendorQualityCheck())}),this.isPaired()&&(a.push("<hr>"),a.push({name:"First in Pair",value:!this.isSecondOfPair(),borderTop:!0}),a.push({name:"Mate is Mapped",value:i(this.isMateMapped())}),this.isMateMapped()&&(a.push({name:"Mate Chromosome",value:this.mate.chr}),a.push({name:"Mate Start",value:this.mate.position+1}),a.push({name:"Mate Strand",value:!0===this.mate.strand?"(+)":"(-)"}),a.push({name:"Insert Size",value:this.fragmentLength}))),a.push("<hr>"),r=!0,n=this.tags())n.hasOwnProperty(h)&&(r?(a.push({name:h,value:n[h],borderTop:!0}),r=!1):a.push({name:h,value:n[h]}));return a},e.BamFilter=function(e){e||(e={}),this.vendorFailed=void 0===e.vendorFailed||e.vendorFailed,this.duplicates=void 0===e.duplicates||e.duplicates,this.secondary=e.secondary||!1,this.supplementary=e.supplementary||!1,this.mqThreshold=void 0===e.mqThreshold?0:e.mqThreshold},e.BamFilter.prototype.pass=function(e){return!(this.vendorFailed&&e.isFailsVendorQualityCheck()||this.duplicates&&e.isDuplicate()||this.secondary&&e.isSecondary()||this.supplementary&&e.isSupplementary()||e.mq<this.mqThreshold)},e}((igv=function(e){function t(e){return e.isPaired()&&e.mate&&e.isMateMapped()&&e.chr===e.mate.chr&&(e.isFirstOfPair()||e.isSecondOfPair())&&!(e.isSecondary()||e.isSupplementary())}function i(){this.alignments=this.alignments.concat(this.currentBucket.alignments),this.currentBucket.downsampledCount>0&&this.downsampledIntervals.push(new DownsampledInterval(this.currentBucket.start,this.currentBucket.end,this.currentBucket.downsampledCount)),this.paired=this.paired||this.currentBucket.paired}function r(e,t,i){this.start=e,this.end=t,this.alignments=[],this.downsampledCount=0,this.samplingDepth=i.samplingDepth,this.pairsSupported=i.pairsSupported,this.downsampledReads=i.downsampledReads,this.pairsCache=i.pairsCache}function n(e,t,i){this.chr=e,this.bpStart=t,this.length=i-t,this.coverage=new Array(this.length),this.maximum=0,this.threshold=.2,this.qualityWeight=!0}function a(){this.posA=0,this.negA=0,this.posT=0,this.negT=0,this.posC=0,this.negC=0,this.posG=0,this.negG=0,this.posN=0,this.negN=0,this.pos=0,this.neg=0,this.qualA=0,this.qualT=0,this.qualC=0,this.qualG=0,this.qualN=0,this.qual=0,this.total=0}return e.AlignmentContainer=function(e,t,i,a,o,s){this.chr=e,this.start=t,this.end=i,this.length=i-t,this.coverageMap=new n(e,t,i),this.alignments=[],this.downsampledIntervals=[],this.samplingWindowSize=void 0===a?100:a,this.samplingDepth=void 0===o?50:o,this.pairsSupported=s,this.paired=!1,this.pairsCache={},this.downsampledReads=new Set,this.currentBucket=new r(this.start,this.start+this.samplingWindowSize,this),this.filter=function(e){return e.isMapped()&&!e.isFailsVendorQualityCheck()}},e.AlignmentContainer.prototype.push=function(e){!1!==this.filter(e)&&(this.coverageMap.incCounts(e),this.pairsSupported&&this.downsampledReads.has(e.readName)||(e.start>=this.currentBucket.end&&(i.call(this),this.currentBucket=new r(e.start,e.start+this.samplingWindowSize,this)),this.currentBucket.addAlignment(e)))},e.AlignmentContainer.prototype.forEach=function(e){this.alignments.forEach(e)},e.AlignmentContainer.prototype.finish=function(){if(void 0!==this.currentBucket&&i.call(this),this.pairsSupported){var e=[],t=this.downsampledReads;this.alignments.forEach((function(i){t.has(i.readName)||e.push(i)})),this.alignments=e}this.alignments.sort((function(e,t){return e.start-t.start})),this.pairsCache=void 0,this.downsampledReads=void 0},e.AlignmentContainer.prototype.contains=function(e,t,i){return this.chr==e&&this.start<=t&&this.end>=i},e.AlignmentContainer.prototype.hasDownsampledIntervals=function(){return this.downsampledIntervals&&this.downsampledIntervals.length>0},r.prototype.addAlignment=function(i){var r,n,a,o;this.alignments.length<this.samplingDepth?this.pairsSupported&&t(i)?(o=this.pairsCache[i.readName])?(o.setSecondAlignment(i),this.pairsCache[i.readName]=void 0):(o=new e.PairedAlignment(i),this.paired=!0,this.pairsCache[i.readName]=o,this.alignments.push(o)):this.alignments.push(i):(r=this.samplingDepth/(this.samplingDepth+this.downsampledCount+1),Math.random()<r?(n=Math.floor(Math.random()*(this.alignments.length-1)),a=this.alignments[n],this.pairsSupported&&t(i)?(void 0!==this.pairsCache[a.readName]&&(this.pairsCache[a.readName]=void 0),o=new e.PairedAlignment(i),this.paired=!0,this.pairsCache[i.readName]=o,this.alignments[n]=o):this.alignments[n]=i,this.downsampledReads.add(a.readName)):this.downsampledReads.add(i.readName),this.downsampledCount++)},n.prototype.incCounts=function(e){function t(t){var r,n,o,s,h;for(o=t.start-i.bpStart,s=0;s<t.len;o++,s++)i.coverage[o]||(i.coverage[o]=new a),n=t.seq.charAt(s),r=e.strand?"pos"+n:"neg"+n,h=t.qual[s],i.coverage[o][r]+=1,i.coverage[o]["qual"+n]+=h,i.coverage[o].total+=1,i.coverage[o].qual+=h,i.maximum=Math.max(i.coverage[o].total,i.maximum)}var i=this;void 0===e.blocks?t(e):e.blocks.forEach((function(e){t(e)}))},a.prototype.isMismatch=function(t){var i,r=this,n=e.CoverageMap.threshold*(e.CoverageMap.qualityWeight&&this.qual?this.qual:this.total);return i=0,["A","T","C","G"].forEach((function(n){n!==t&&(i+=e.CoverageMap.qualityWeight&&r.qual?r["qual"+n]:r["pos"+n]+r["neg"+n])})),i>=n},DownsampledInterval=function(e,t,i){this.start=e,this.end=t,this.counts=i},DownsampledInterval.prototype.popupData=function(e){return[{name:"start",value:this.start+1},{name:"end",value:this.end},{name:"# downsampled:",value:this.counts}]},e}(igv||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}),encode=function(e){var t={H3K27AC:"rgb(200, 0, 0)",H3K27ME3:"rgb(130, 0, 4)",H3K36ME3:"rgb(0, 0, 150)",H3K4ME1:"rgb(0, 150, 0)",H3K4ME2:"rgb(0, 150, 0)",H3K4ME3:"rgb(0, 150, 0)",H3K9AC:"rgb(100, 0, 0)",H3K9ME1:"rgb(100, 0, 0)"},i="rgb(3, 116, 178)";return e.EncodeTable=function(r,n,a,o){var s=this;this.initialized=!1,this.genomeID=a,this.$modalTable=$('<table id="encodeModalTable" cellpadding="0" cellspacing="0" border="0" class="display"></table>'),r.append(this.$modalTable),this.$spinner=$("<div>"),this.$modalTable.append(this.$spinner),this.$spinner.append($('<i class="fa fa-lg fa-spinner fa-spin"></i>')),$("#hicEncodeModal").on("shown.bs.modal",(function(t){!0!==s.initialized&&(s.initialized=!0,e.encodeSearch(a,(function(e){s.loadWithDataSource(e)})))})),$("#encodeModalTopCloseButton").on("click",(function(){$("tr.selected").removeClass("selected")})),$("#encodeModalBottomCloseButton").on("click",(function(){$("tr.selected").removeClass("selected")})),$("#encodeModalGoButton").on("click",(function(){var e,r,a,h,c,l;r=s.$modalTable.DataTable(),(e=s.$dataTables.$("tr.selected"))&&(e.removeClass("selected"),c=[],e.each((function(){h=r.row(this).data(),a=h[0],c.push(s.dataSource.jSON.rows[a])})),l=_.map(c,(function(e){var r,n;return{url:e.url,color:(r=e.Target,r&&""!==r?(n=r.toUpperCase(),t[n]?t[n]:i):i),name:e.Name}})),o.call(n,l))}))},e.EncodeTable.prototype.unbindAllMouseHandlers=function(){this.$modalTable.find("tbody").unbind(),$("#hicEncodeModal").unbind(),$("#encodeModalTopCloseButton").unbind(),$("#encodeModalBottomCloseButton").unbind(),$("#encodeModalGoButton").unbind()},e.EncodeTable.prototype.loadWithDataSource=function(t){var i=this;console.log("dataTable - begin"),this.dataSource=new e.EncodeDataSource({jSON:t}),this.dataSource.loadJSON((function(){i.$spinner.hide(),i.$dataTables=i.$modalTable.dataTable({data:i.dataSource.dataTablesData(),paging:!0,scrollX:!1,scrollY:400,scrollCollapse:!1,scroller:!0,fixedColumns:!0,columns:i.dataSource.getColumns()}),console.log("dataTable - end"),i.$modalTable.find("tbody").on("click","tr",(function(){$(this).hasClass("selected")?$(this).removeClass("selected"):$(this).addClass("selected")}))}))},e}((encode=function(e){const t="bigWig";return e.encodeSearch=function(e,i){var r="https://www.encodeproject.org/search/?type=experiment&assembly="+e+"&files.file_format="+"bigWig&format=json&field=lab.title&field=biosample_term_name&field=assay_term_name&field=target.label&field=files.file_format&field=files.output_type&field=files.href&field=files.replicate.technical_replicate_number&field=files.replicate.biological_replicate_number&field=files.assembly&limit=all";console.log("encode search - load json - assembly("+e+") ..."),igvxhr.loadJson(r,{}).then((function(r){var n;console.log("... done"),console.log("parse/sort json ..."),n=[],_.each(r["@graph"],(function(i){var r,a,o,s;r=i.biosample_term_name||"",a=i.target?i.target.label:"",o=_.filter(i.files,(function(i){return t===i.file_format&&e===i.assembly})),s=_.map(o,(function(e){var t=e.replicate?e.replicate.bioligcal_replicate_number:void 0,n=e.replicate?e.replicate.technical_replicate_number:void 0,o=r+" "+a;return t&&(o+=" "+t),n&&(o+=(t?":":"0:")+n),{Assembly:e.assembly,ExperimentID:i["@id"],"Cell Type":r,"Assay Type":i.assay_term_name,Target:a,Lab:i.lab?i.lab.title:"",Format:e.file_format,"Output Type":e.output_type,url:"https://www.encodeproject.org"+e.href,"Bio Rep":t,"Tech Rep":n,Name:o}})),Array.prototype.push.apply(n,s)})),n.sort((function(e,t){var i=e.Assembly,r=t.Assembly,n=e["Cell Type"],a=t["Cell Type"],o=e.Target,s=t.Target;return i===r?n===a?o===s?0:o<s?-1:1:n<a?-1:1:i<r?-1:1})),console.log("... done"),i({columns:["Assembly","Cell Type","Target","Assay Type","Output Type","Lab"],rows:n})}))},e}((encode=function(e){return e.EncodeDataSource=function(e){this.config=e},e.EncodeDataSource.prototype.loadJSON=function(e){this.jSON={},this.config.filePath?this.ingestFile(this.config.filePath,e):this.config.jSON&&this.ingestJSON(this.config.jSON,e)},e.EncodeDataSource.prototype.ingestJSON=function(e,t){var i=this;i.jSON=e,e.rows.forEach((function(e,t){Object.keys(e).forEach((function(r){var n=e[r];i.jSON.rows[t][r]=void 0===n||""===n?"-":n}))})),t()},e.EncodeDataSource.prototype.ingestFile=function(e,t){var i=this;igvxhr.loadString(e).then((function(e){var r,n=e.splitLines();i.jSON.columns=n[0].split("\t"),i.jSON.columns.pop(),r=i.jSON.columns.shift(),i.jSON.columns.push(r),i.jSON.rows=[],n.slice(1,n.length-1).forEach((function(e){var t,n;(t=e.split("\t")).pop(),r=t.shift(),t.push(r),n={},t.forEach((function(e,t,r){var a=i.jSON.columns[t];n[a]=void 0===e||""===e?"-":e})),i.jSON.rows.push(n)})),t()}))},e.EncodeDataSource.prototype.dataTablesData=function(){var e=this,t=[];return this.jSON.rows.forEach((function(i,r){var n=[];n.push(r),e.jSON.columns.forEach((function(e){n.push(i[e])})),t.push(n)})),t},e.EncodeDataSource.prototype.getColumns=function(){var e,t;return e={Assembly:"10%","Cell Type":"10%",Target:"10%","Assay Type":"20%","Output Type":"20%",Lab:"20%"},(t=_.map(this.jSON.columns,(function(t,i){return{title:t,width:e[t]}}))).unshift({title:"index",width:"10%"}),t},e}(encode||{}))||{}))||{});igv=function(e){function t(t,i){var r;!1!==i.showCommandBar&&!1!==i.showControls&&(r=i.createControls?i.createControls(t,i):function(t,i){var r,n,a,o,s,h;return n=$('<div id="igvControlDiv">'),i.showNavigation&&(o=$('<div class="igv-navbar">'),n.append(o),r=$('<div class="igv-logo">'),o.append(r),o.append(t.trackFileLoad.$presentationButton),!0===i.showLoadFileWidget?t.trackFileLoad.$presentationButton.show():t.trackFileLoad.$presentationButton.hide(),s=$('<div class="igv-search-container">'),t.$searchInput=$('<input type="text" placeholder="Locus Search">'),t.$searchInput.change((function(e){t.parseSearchInput($(e.target).val())})),(h=$('<i class="fa fa-search">')).click((function(){t.parseSearchInput(t.$searchInput.val())})),s.append(t.$searchInput),s.append(h),t.$searchResults=$('<div class="igv-search-results">'),t.$searchResultsTable=$("<table>"),t.$searchResults.append(t.$searchResultsTable.get(0)),s.append(t.$searchResults.get(0)),t.$searchResults.hide(),o.append(s),t.windowSizePanel=new e.WindowSizePanel(o),t.zoomHandlers={in:{click:function(e){t.zoomIn()}},out:{click:function(e){t.zoomOut()}}},t.$zoomContainer=(c=$('<div class="igv-zoom-widget">'),c.append($('<i class="fa fa-minus-circle">')),c.append($('<i class="fa fa-plus-circle">')),c),o.append(t.$zoomContainer),t.$cursorTrackingGuide=$('<div class="igv-cursor-tracking-guide">'),$(t.trackContainerDiv).append(t.$cursorTrackingGuide),!0===i.showCursorTrackingGuide?t.$cursorTrackingGuide.show():t.$cursorTrackingGuide.hide(),t.$cursorTrackingGuideToggle=e.makeToggleButton("cursor guide","cursor guide","showCursorTrackingGuide",(function(){return t.$cursorTrackingGuide}),void 0),o.append(t.$cursorTrackingGuideToggle),t.centerGuide=new e.CenterGuide($(t.trackContainerDiv),i),o.append(t.centerGuide.$centerGuideToggle),t.$trackLabelToggle=e.makeToggleButton("track labels","track labels","trackLabelsVisible",(function(){return $(t.trackContainerDiv).find(".igv-track-label")}),void 0),o.append(t.$trackLabelToggle)),void 0===(a=$("#igvKaryoDiv")).get(0)&&(a=$('<div id="igvKaryoDiv" class="igv-karyo-div">'),n.append(a)),t.karyoPanel=new e.KaryoPanel(a,i),o.append(t.karyoPanel.$karyoPanelToggle),!1===i.showKaryo&&(t.karyoPanel.$karyoPanelToggle.hide(),a.hide()),n.get(0);var c}(t,i),t.$root.append($(r)))}return e.version="beta",e.createBrowser=function(i,r){var n,a,o,s,h;return e.browser&&e.removeBrowser(),function(e){void 0===e.showLoadFileWidget&&(e.showLoadFileWidget=!1),void 0===e.minimumBases&&(e.minimumBases=40),void 0===e.showIdeogram&&(e.showIdeogram=!0),void 0===e.showCursorTrackingGuide&&(e.showCursorTrackingGuide=!1),void 0===e.showCenterGuide&&(e.showCenterGuide=!1),void 0===e.showKaryo&&(e.showKaryo=!1),void 0===e.trackLabelsVisible&&(e.trackLabelsVisible=!0),void 0===e.showControls&&(e.showControls=!0),void 0===e.showNavigation&&(e.showNavigation=!0),void 0===e.showRuler&&(e.showRuler=!0),void 0===e.showSequence&&(e.showSequence=!0),void 0===e.flanking&&(e.flanking=1e3),void 0===e.pairsSupported&&(e.pairsSupported=!0),void 0===e.type&&(e.type="IGV"),e.tracks||(e.tracks=[]),e.showSequence&&e.tracks.push({type:"sequence",order:-9999})}(r),h=1,(s=r).tracks&&s.tracks.forEach((function(e){void 0===e.order&&(e.order=h++)})),o=new e.Browser(r,$('<div class="igv-track-container-div">')[0]),$(i).append(o.$root),o.trackFileLoad=new e.TrackFileLoad,o.$root.append(o.trackFileLoad.$container),o.trackFileLoad.$container.hide(),t(o,r),n=$('<div class="igv-content-div">'),o.$root.append(n),a=$('<div id="igv-content-header">'),n.append(a),n.append(o.trackContainerDiv),o.userFeedback=new e.UserFeedback(n),o.userFeedback.hide(),e.popover=new e.Popover(n),e.colorPicker=new e.ColorPicker(o.$root,r.palette),e.colorPicker.hide(),e.alert=new e.AlertDialog(o.$root,"igv-alert"),e.alert.hide(),e.dialog=new e.Dialog(o.$root,e.Dialog.dialogConstructor),e.dialog.hide(),e.dataRangeDialog=new e.DataRangeDialog(o.$root),e.dataRangeDialog.hide(),r.showNavigation||a.append($('<div class="igv-logo-nonav">')),function(e){oauth.google.apiKey=e.apiKey,oauth.google.access_token=e.oauthToken}(r),function(t){function i(t){var i={id:t};switch(t){case"hg18":i.fastaURL="https://s3.amazonaws.com/igv.broadinstitute.org/genomes/seq/hg18/hg18.fasta",i.cytobandURL="https://s3.amazonaws.com/igv.broadinstitute.org/genomes/seq/hg18/cytoBand.txt.gz";break;case"GRCh38":case"hg38":i.fastaURL="https://s3.amazonaws.com/igv.broadinstitute.org/genomes/seq/hg38/hg38.fa",i.cytobandURL="https://s3.amazonaws.com/igv.broadinstitute.org/annotations/hg38/cytoBandIdeo.txt";break;case"hg19":case"GRCh37":i.fastaURL="https://s3.amazonaws.com/igv.broadinstitute.org/genomes/seq/hg19/hg19.fasta",i.cytobandURL="https://s3.amazonaws.com/igv.broadinstitute.org/genomes/seq/hg19/cytoBand.txt";break;case"mm10":case"GRCm38":i.fastaURL="https://s3.amazonaws.com/igv.broadinstitute.org/genomes/seq/mm10/mm10.fa",i.indexURL="https://s3.amazonaws.com/igv.broadinstitute.org/genomes/seq/mm10/mm10.fa.fai",i.cytobandURL="https://s3.amazonaws.com/igv.broadinstitute.org/annotations/mm10/cytoBandIdeo.txt.gz";break;default:e.presentAlert("Uknown genome id: "+t)}return i}if(t.genome?t.reference=i(t.genome):t.fastaURL?t.reference={fastaURL:t.fastaURL,cytobandURL:t.cytobandURL}:t.reference&&void 0!==t.reference.id&&void 0===t.reference.fastaURL&&(t.reference=i(t.reference.id)),!t.reference||!t.reference.fastaURL)throw e.presentAlert("Fatal error:  reference must be defined"),new Error("Fatal error:  reference must be defined")}(r),e.loadGenome(r.reference).then((function(t){function i(t){var i=[];return t.locus&&(Array.isArray(t.locus)?_.each(t.locus,(function(e){i.push(e)})):i.push(t.locus)),0===_.size(i)&&i.push(_.first(e.browser.genome.chromosomeNames)),i}var n;e.browser.genome=t,e.browser.genome.id=r.reference.genomeId,n=e.browser.viewportContainerWidth(),e.browser.getGenomicStateList(i(r),n,(function(t){var o;_.size(t)>0?(e.browser.genomicStateList=_.map(t,(function(i,r){return i.locusIndex=r,i.locusCount=_.size(t),i.referenceFrame=new e.ReferenceFrame(i.chromosome.name,i.start,(i.end-i.start)/(n/i.locusCount)),i.initialReferenceFrame=new e.ReferenceFrame(i.chromosome.name,i.start,(i.end-i.start)/(n/i.locusCount)),i})),e.browser.updateLocusSearchWithGenomicState(_.first(e.browser.genomicStateList)),1===_.size(e.browser.genomicStateList)&&"all"===_.first(e.browser.genomicStateList).locusSearchString?e.browser.disableZoomWidget():e.browser.enableZoomWidget(e.browser.zoomHandlers),e.browser.toggleCenterGuide(e.browser.genomicStateList),e.browser.karyoPanel&&e.browser.karyoPanel.resize(),!0===r.showIdeogram&&(e.browser.ideoPanel=new e.IdeoPanel(a),e.browser.ideoPanel.repaint()),r.showRuler&&(e.browser.rulerTrack=new e.RulerTrack,e.browser.addTrack(e.browser.rulerTrack)),r.tracks&&(e.browser.loadTracksWithConfigList(r.tracks),e.browser.windowSizePanel.updateWithGenomicState(_.first(e.browser.genomicStateList)))):(o="Unrecognized locus "+i(r),e.presentAlert(o))}))})).catch((function(t){e.presentAlert(t),console.log(t)})),o},e.removeBrowser=function(){e.browser.$root.remove(),$(".igv-grid-container-colorpicker").remove(),$(".igv-grid-container-dialog").remove()},e}((igv=function(e){function t(e,t,i){return Math.min(Math.max(e,t),i)}e.hex2Color=function(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);if(null!==t)return"rgb("+parseInt(t[1],16)+","+parseInt(t[2],16)+","+parseInt(t[3],16)+")"},e.rgbaColor=function(e,i,r,n){return"rgba("+(e=t(e,0,255))+","+(i=t(i,0,255))+","+(r=t(r,0,255))+","+(n=t(n,0,1))+")"},e.rgbColor=function(e,i,r){return"rgb("+(e=t(e,0,255))+","+(i=t(i,0,255))+","+(r=t(r,0,255))+")"},e.addAlphaToRGB=function(e,t){return e.startsWith("rgb")?e.replace("rgb","rgba").replace(")",", "+t+")"):(console.log(e+" is not an rgb style string"),e)},e.greyScale=function(e){var i=t(e,0,255);return"rgb("+i+","+i+","+i+")"},e.randomGrey=function(i,r){i=t(i,0,255),r=t(r,0,255);var n=Math.round(e.random(i,r)).toString(10);return"rgb("+n+","+n+","+n+")"},e.randomRGB=function(i,r){return i=t(i,0,255),r=t(r,0,255),"rgb("+Math.round(e.random(i,r)).toString(10)+","+Math.round(e.random(i,r)).toString(10)+","+Math.round(e.random(i,r)).toString(10)+")"},e.randomRGBConstantAlpha=function(i,r,n){return i=t(i,0,255),r=t(r,0,255),"rgba("+Math.round(e.random(i,r)).toString(10)+","+Math.round(e.random(i,r)).toString(10)+","+Math.round(e.random(i,r)).toString(10)+","+n+")"},e.nucleotideColorComponents={A:[0,200,0],C:[0,0,200],T:[255,0,0],G:[209,113,5],a:[0,200,0],c:[0,0,200],t:[255,0,0],g:[209,113,5]},e.nucleotideColors={A:"rgb(  0, 200,   0)",C:"rgb(  0,   0, 200)",T:"rgb(255,   0,   0)",G:"rgb(209, 113,   5)",a:"rgb(  0, 200,   0)",c:"rgb(  0,   0, 200)",t:"rgb(255,   0,   0)",g:"rgb(209, 113,   5)"},e.getCompositeColor=function(e,t,i){return"rgb("+Math.floor(i*t[0]+(1-i)*e[0])+","+Math.floor(i*t[1]+(1-i)*e[1])+","+Math.floor(i*t[2]+(1-i)*e[2])+")"},e.createColorString=function(e){return e.includes(",")?e.startsWith("rgb")?e:"rgb("+e+")":void 0},e.BinnedColorScale=function(e){this.thresholds=e.thresholds,this.colors=e.colors},e.BinnedColorScale.prototype.getColor=function(e){var t,i=this.thresholds.length;for(t=0;t<i;t++)if(e<this.thresholds[t])return this.colors[t];return this.colors[this.colors.length-1]},e.GradientColorScale=function(e){this.scale=e,this.lowColor="rgb("+e.lowR+","+e.lowG+","+e.lowB+")",this.highColor="rgb("+e.highR+","+e.highG+","+e.highB+")",this.diff=e.high-e.low},e.GradientColorScale.prototype.getColor=function(e){var t,i=this.scale;return e<=i.low?this.lowColor:e>=i.high?this.highColor:(t=(e-i.low)/this.diff,"rgb("+Math.floor(i.lowR+t*(i.highR-i.lowR))+","+Math.floor(i.lowG+t*(i.highG-i.lowG))+","+Math.floor(i.lowB+t*(i.highB-i.lowB))+")")};var i={Set1:["rgb(228,26,28)","rgb(55,126,184)","rgb(77,175,74)","rgb(166,86,40)","rgb(152,78,163)","rgb(255,127,0)","rgb(247,129,191)","rgb(153,153,153)","rgb(255,255,51)"],Dark2:["rgb(27,158,119)","rgb(217,95,2)","rgb(117,112,179)","rgb(231,41,138)","rgb(102,166,30)","rgb(230,171,2)","rgb(166,118,29)","rgb(102,102,102)"],Set2:["rgb(102, 194,165)","rgb(252,141,98)","rgb(141,160,203)","rgb(231,138,195)","rgb(166,216,84)","rgb(255,217,47)","rgb(229,196,148)","rgb(179,179,179)"],Set3:["rgb(141,211,199)","rgb(255,255,179)","rgb(190,186,218)","rgb(251,128,114)","rgb(128,177,211)","rgb(253,180,98)","rgb(179,222,105)","rgb(252,205,229)","rgb(217,217,217)","rgb(188,128,189)","rgb(204,235,197)","rgb(255,237,111)"],Pastel1:["rgb(251,180,174)","rgb(179,205,227)","rgb(204,235,197)","rgb(222,203,228)","rgb(254,217,166)","rgb(255,255,204)","rgb(229,216,189)","rgb(253,218,236)"],Pastel2:["rgb(173,226,207)","rgb(253,205,172)","rgb(203,213,232)","rgb(244,202,228)","rgb(230,245,201)","rgb(255,242,174)","rgb(243,225,206)"],Accent:["rgb(127,201,127)","rgb(190,174,212)","rgb(253,192,134)","rgb(255,255,153)","rgb(56,108,176)","rgb(240,2,127)","rgb(191,91,23)"]};return e.PaletteColorTable=function(e){this.colors=i[e],Array.isArray(this.colors)||(this.colors=[]),this.colorTable={},this.nextIdx=0,this.colorGenerator=new RColor},e.PaletteColorTable.prototype.getColor=function(e){return this.colorTable.hasOwnProperty(e)||(this.nextIdx<this.colors.length?this.colorTable[e]=this.colors[this.nextIdx]:this.colorTable[e]=this.colorGenerator.get(),this.nextIdx++),this.colorTable[e]},RColor=function(){this.hue=Math.random(),this.goldenRatio=.618033988749895,this.hexwidth=2},RColor.prototype.hsvToRgb=function(e,t,i){var r=Math.floor(6*e),n=6*e-r,a=i*(1-t),o=i*(1-n*t),s=i*(1-(1-n)*t),h=255,c=255,l=255;switch(r){case 0:h=i,c=s,l=a;break;case 1:h=o,c=i,l=a;break;case 2:h=a,c=i,l=s;break;case 3:h=a,c=o,l=i;break;case 4:h=s,c=a,l=i;break;case 5:h=i,c=a,l=o}return[Math.floor(256*h),Math.floor(256*c),Math.floor(256*l)]},RColor.prototype.padHex=function(e){return e.length>this.hexwidth?e:new Array(this.hexwidth-e.length+1).join("0")+e},RColor.prototype.get=function(e,t){this.hue+=this.goldenRatio,this.hue%=1,"number"!=typeof e&&(e=.5),"number"!=typeof t&&(t=.95);var i=this.hsvToRgb(this.hue,e,t);return"#"+this.padHex(i[0].toString(16))+this.padHex(i[1].toString(16))+this.padHex(i[2].toString(16))},e}((igv=function(e){function t(e,t,i){var r,n=t.length;for(r=0;r<n;r++)t[r]=Math.round(t[r]),i[r]=Math.round(i[r]);for(e.beginPath(),e.moveTo(t[0],i[0]),r=1;r<n;r++)e.lineTo(t[r],i[r]);e.closePath()}return e.graphics={setProperties:function(e,t){for(var i in t)if(t.hasOwnProperty(i)){var r=t[i];e[i]=r}},strokeLine:function(t,i,r,n,a,o){i=Math.floor(i)+.5,r=Math.floor(r)+.5,n=Math.floor(n)+.5,a=Math.floor(a)+.5,t.save(),o&&e.graphics.setProperties(t,o),t.beginPath(),t.moveTo(i,r),t.lineTo(n,a),t.stroke(),t.restore()},fillRect:function(t,i,r,n,a,o){i=Math.round(i),r=Math.round(r),o&&(t.save(),e.graphics.setProperties(t,o)),t.fillRect(i,r,n,a),o&&t.restore()},fillPolygon:function(i,r,n,a){i.save(),a&&e.graphics.setProperties(i,a),t(i,r,n),i.fill(),i.restore()},strokePolygon:function(i,r,n,a){i.save(),a&&e.graphics.setProperties(i,a),t(i,r,n),i.stroke(),i.restore()},fillText:function(t,i,r,n,a,o){if(a&&(t.save(),e.graphics.setProperties(t,a)),t.save(),t.translate(r,n),o)for(var s in o){var h=o[s];"translate"==s&&t.translate(h.x,h.y),"rotate"==s&&t.rotate(h.angle*Math.PI/180)}t.fillText(i,0,0),t.restore(),a&&t.restore()},strokeText:function(t,i,r,n,a,o){if(t.save(),a&&e.graphics.setProperties(t,a),t.translate(r,n),o)for(var s in o){var h=o[s];"translate"==s&&t.translate(h.x,h.y),"rotate"==s&&t.rotate(h.angle*Math.PI/180)}t.strokeText(i,0,0),t.restore()},strokeCircle:function(e,t,i,r){e.beginPath(),e.arc(t,i,r,0,2*Math.PI),e.stroke()},fillCircle:function(e,t,i,r){e.beginPath(),e.arc(t,i,r,0,2*Math.PI),e.fill()},drawArrowhead:function(e,t,i,r,n){e.save(),r||(r=5),n&&(e.lineWidth=n),e.beginPath(),e.moveTo(t,i-r/2),e.lineTo(t,i+r/2),e.lineTo(t+r,i),e.lineTo(t,i-r/2),e.closePath(),e.fill(),e.restore()},dashedLine:function(t,i,r,n,a,o,s){t.save(),i=Math.round(i),r=Math.round(r),n=Math.round(n),a=Math.round(a),o=Math.round(o),s&&e.graphics.setProperties(t,s),null==o&&(o=2),t.moveTo(i,r);for(var h=n-i,c=a-r,l=Math.floor(Math.sqrt(h*h+c*c)/o),u=h/l,d=c/l,p=0;p++<l;)i+=u,r+=d,t[p%2==0?"moveTo":"lineTo"](i,r);t[p%2==0?"moveTo":"lineTo"](n,a),t.restore()}},e}((igv=function(e){return e.IdeoPanel=function(e){e.append($('<div class="igv-ideogram-left-shim"></div>')),this.buildPanels(e)},e.IdeoPanel.setWidth=function(e,t){var i;e.width(t),i=e.width()/e.outerWidth(),e.width(Math.floor(i*t))},e.IdeoPanel.prototype.buildPanels=function(t){this.panels=_.map(e.browser.genomicStateList,(function(i){var r,n,a,o=e.browser.viewportContainerWidth(),s={};return s.genomicState=i,s.$ideogram=$('<div class="igv-ideogram-content-div"></div>'),r=s.$ideogram,n=i.locusIndex,1!==(a=i.locusCount)&&n!==a-1&&r.addClass("igv-ideogram-content-div-border-right"),e.IdeoPanel.setWidth(s.$ideogram,o/i.locusCount),t.append(s.$ideogram),s.$canvas=$("<canvas>"),s.$ideogram.append(s.$canvas),s.$canvas.attr("width",s.$ideogram.width()),s.$canvas.attr("height",s.$ideogram.height()),s.ctx=s.$canvas.get(0).getContext("2d"),s.ideograms={},s.$ideogram.on("click",(function(t){e.IdeoPanel.clickHandler(s,t)})),s}))},e.IdeoPanel.$empty=function(e){e.find(".igv-ideogram-content-div").remove()},e.IdeoPanel.prototype.panelWithLocusIndex=function(e){var t=_.filter(this.panels,(function(t){return e===t.genomicState.locusIndex}));return _.first(t)},e.IdeoPanel.prototype.resize=function(){var t=e.browser.syntheticViewportContainerWidth();_.each(this.panels,(function(i,r){var n=e.browser.genomicStateList[r];i.$ideogram.width(Math.floor(t/n.locusCount)),i.$canvas.attr("width",i.$ideogram.width()),i.ideograms={}})),this.repaint()},e.IdeoPanel.prototype.repaint=function(){_.each(this.panels,(function(t){e.IdeoPanel.repaintPanel(t)}))},e.IdeoPanel.repaintPanel=function(t){function i(e,t){if("c"==t.type)return"rgb(150, 10, 10)";var i=t.stain,r=230;"p"==t.type&&(r=Math.floor(230-i/100*230));var n=e[r];return null==n&&(n="rgb("+r+","+r+","+r+")",e[r]=n),n}try{var r,n,a,o,s,h,c,l,u,d,p,f,g,v,m,w;if(p=t.genomicState.referenceFrame,!(e.browser.genome&&p&&e.browser.genome.getChromosome(p.chrName)))return;if(f=[],s=t.$canvas.width(),h=t.$canvas.height(),t.ctx.clearRect(0,0,s,h),"all"===p.chrName.toLowerCase())return;void 0===(r=t.ideograms[p.chrName])&&((r=document.createElement("canvas")).width=s,r.height=h,function(t,r,n){if(e.browser.genome){var a=e.browser.genome.getCytobands(p.chrName);if(a){var o=0+n/2,s=[],h=[],c=a.length;if(0==c)return;for(var l=r/a[c-1].end,u=-1,d=0;d<a.length;d++){var g=a[d],v=l*g.start,m=l*g.end;m>u&&("c"==g.type?("p"==g.name.charAt(0)?(s[0]=v,h[0]=n+0,s[1]=v,h[1]=0,s[2]=m,h[2]=o):(s[0]=m,h[0]=n+0,s[1]=m,h[1]=0,s[2]=v,h[2]=o),t.fillStyle="rgb(150, 0, 0)",t.strokeStyle="rgb(150, 0, 0)",t.polygon(s,h,1,0)):(t.fillStyle=i(f,g),t.fillRect(v,1,m-v,n-2)))}}t.strokeStyle="black",t.roundRect(1,1,r-2,n-2,(n-2)/2,0,1),u=m}}(r.getContext("2d"),r.width,r.height),t.ideograms[p.chrName]=r),0,t.ctx.drawImage(r,0,0),n=e.browser.genome.getChromosome(p.chrName),l=Math.round(p.bpPerPixel*t.$ideogram.width()),d=p.start,l<n.bpLength&&(a=l/n.bpLength,o=d/n.bpLength,u=Math.floor(o*t.$canvas.width()),c=Math.floor(a*t.$canvas.width()),u=Math.max(0,u),u=Math.min(s-c,u),t.ctx.save(),t.ctx.strokeStyle="red",t.ctx.lineWidth=c<2?1:2,g=u+t.ctx.lineWidth/2,m=c<2?1:c-t.ctx.lineWidth,v=0+t.ctx.lineWidth/2,w=r.height-t.ctx.lineWidth,t.ctx.strokeRect(g,v,m,w),t.ctx.restore())}catch(e){console.log("Error painting ideogram: "+e.message)}},e.IdeoPanel.clickHandler=function(t,i){var r,n,a,o,s,h=t.genomicState,c=h.referenceFrame;(r=e.translateMouseCoordinates(i,t.$ideogram.get(0)).x/t.$ideogram.width())-(a=c.bpPerPixel*t.$ideogram.width()/(n=e.browser.genome.getChromosome(c.chrName)).bpLength)/2<0&&(r=a/2),r+a/2>1&&(r=1-a/2),o=Math.round((r-a/2)*n.bpLength),s=Math.round((r+a/2)*n.bpLength),c.start=Math.round((r-a/2)*n.bpLength),c.bpPerPixel=(s-o)/t.$ideogram.width(),e.browser.updateLocusSearchWithGenomicState(h),e.browser.repaintWithLocusIndex(t.genomicState.locusIndex)},e}((igv=function(e){function t(e){var t=this;return new Promise((function(i,r){var n=t.fragmentSitesCache[e];if(n)i(n);else if(t.fragmentSitesIndex){var a=t.fragmentSitesIndex[e];void 0!==a&&a.nSites>0&&readSites(a.position,a.nSites).then((function(r){t.fragmentSitesCache[e]=r,i(r)})).catch(r)}else i(void 0)}))}function i(e,t,i,r,n){var o=n.getString();n.getInt();for(var s=n.getFloat(),h=(n.getFloat(),n.getFloat(),n.getFloat(),n.getInt()),c=new a(e,t,{unit:o,binSize:h},n.getInt(),n.getInt(),i,r),l=n.getInt(),u={};l-- >0;){var d=n.getInt(),p=n.getLong(),f=n.getInt();u[d]={filePosition:p,size:f}}c.blockIndexMap=u;var g=s/(e.size/h)/(t.size/h);return c.averageCount=g,c}function r(e,t,i,r,n){this.normType=e,this.unit=t,this.binSize=i,this.values=r,this.normFactors=n}function n(e,t,i,r,n){this.type=e,this.chrIdx=t,this.unit=i,this.binSize=r,this.data=n}function a(e,t,i,r,n,a,o){this.chr1=e,this.chr2=t,this.zoom=i,this.blockBinCount=r,this.blockColumnCount=n,this.chr1Sites=a,this.chr2Sites=o}function o(e,t,i){var r=this;this.chr1=e,this.chr2=t,this.bpZoomData=[],this.fragZoomData=[],_.each(i,(function(e){"BP"===e.zoom.unit?r.bpZoomData.push(e):r.fragZoomData.push(e)}))}return e.HiCReader=function(e){this.path=e.url,this.headPath=e.headURL||this.path,this.config=e,this.fragmentSitesCache={}},e.HiCReader.prototype.readHeader=function(){var t=this;return new Promise((function(i,r){igvxhr.loadArrayBuffer(t.path,e.buildOptions(t.config,{range:{start:0,size:64e3}})).then((function(r){if(r){var n=new e.BinaryParser(new DataView(r));t.magic=n.getString(),t.version=n.getInt(),t.masterIndexPos=n.getLong(),t.genomeId=n.getString(),t.attributes={};for(var a=n.getInt();a-- >0;)t.attributes[n.getString()]=n.getString();t.chromosomes=[];for(var o=n.getInt();o-- >0;)t.chromosomes.push({name:n.getString(),size:n.getInt()});t.bpResolutions=[];for(var s=n.getInt();s-- >0;)t.bpResolutions.push(n.getInt());t.fragResolutions=[];for(var h=n.getInt();h-- >0;)t.fragResolutions.push(n.getInt());if(h>0){t.sites=[];for(var c=n.getInt();c-- >0;)t.sites.push(n.getInt())}i(t)}else i(null)})).catch((function(e){r(e)}))}))},e.HiCReader.prototype.readFooter=function(t){var i=this,a={start:this.masterIndexPos,size:1e8};return new Promise((function(t,o){igvxhr.loadArrayBuffer(i.path,e.buildOptions(i.config,{range:a})).then((function(a){var o,s;if(a){var h=new e.BinaryParser(new DataView(a));h.getInt(),i.masterIndex={};for(var c=h.getInt();c-- >0;)m=h.getString(),o=h.getLong(),s=h.getInt(),i.masterIndex[m]={start:o,size:s};for(i.expectedValueVectors={},c=h.getInt();c-- >0;){for(var l="NONE",u=h.getString(),d=h.getInt(),p=h.getInt(),f=[];p-- >0;)f.push(h.getDouble());for(var g=h.getInt(),v={};g-- >0;)v[h.getInt()]=h.getDouble();var m=u+"_"+d+"_"+l;i.expectedValueVectors[m]=new r(l,u,d,f,v)}if(i.version>=6){for(i.normalizedExpectedValueVectors={},c=h.getInt();c-- >0;){for(l=h.getString(),u=h.getString(),d=h.getInt(),p=h.getInt(),f=[];p-- >0;)f.push(h.getDouble());for(g=h.getInt(),v={};g-- >0;)v[h.getInt()]=h.getDouble();m=u+"_"+d+"_"+l;i.normalizedExpectedValueVectors[m]=new r(l,u,d,f,v)}for(i.normVectorIndex={},i.normalizationTypes=[],c=h.getInt();c-- >0;){l=h.getString();var w=h.getInt();u=h.getString(),d=h.getInt();var b=h.getLong(),y=h.getInt();m=n.getKey(l,w,u.binSize),!1===_.contains(i.normalizationTypes,l)&&i.normalizationTypes.push(l),i.normVectorIndex[m]={filePosition:b,sizeInByes:y}}}t(i)}else t(null)})).catch((function(e){o(e)}))}))},e.HiCReader.prototype.readMatrix=function(r){var n=this,a=n.masterIndex[r];return null==a&&fulfill(void 0),new Promise((function(r,s){igvxhr.loadArrayBuffer(n.path,e.buildOptions(n.config,{range:{start:a.start,size:a.size}})).then((function(a){if(a){var h=new e.BinaryParser(new DataView(a)),c=h.getInt(),l=h.getInt(),u=n.chromosomes[c],d=n.chromosomes[l],p=h.getInt(),f=[],g=t.call(n,u.name),v=t.call(n,d.name);Promise.all([g,v]).then((function(e){for(var t=e[0],n=e[1];p-- >0;){var a=i(u,d,t,n,h);f.push(a)}r(new o(c,l,f))})).catch((function(e){s(e)}))}else r(null)})).catch(s)}))},e.HiCReader.prototype.readBlock=function(t,i){var r,n,a=this,o=null,s=i.blockIndexMap;if(null!=s)o=s[t];return null==o?Promise.resolve(new Block):new Promise((function(i,s){igvxhr.loadArrayBuffer(a.path,e.buildOptions(a.config,{range:{start:o.filePosition,size:o.size}})).then((function(o){if(o){o=new Zlib.Inflate(new Uint8Array(o)).decompress().buffer;var h=new e.BinaryParser(new DataView(o)),c=h.getInt(),l=[];if(a.version<7)for(r=0;r<c;r++){var u=h.getInt(),d=h.getInt(),p=h.getFloat();l.add(new ContactRecord(u,d,p))}else{var f=h.getInt(),g=h.getInt(),v=0==h.getByte(),m=h.getByte();if(1===m){var w=h.getShort();for(r=0;r<w;r++){d=g+h.getShort();var b=h.getShort();for(n=0;n<b;n++)u=f+h.getShort(),p=v?h.getShort():h.getFloat(),l.push(new ContactRecord(u,d,p))}}else if(2==m){var y=h.getInt(),k=h.getShort();for(r=0;r<y;r++){var x=r/k,S=f+(r-x*k),_=g+x;v?-32768!=(p=h.getShort())&&l.push(new ContactRecord(S,_,p)):(p=h.getFloat(),isNaN(p)||l.push(new ContactRecord(S,_,p)))}}else s("Unknown block type: "+m)}i(new Block(t,l))}else i(null)})).catch(s)}))},n.getKey=function(e,t,i,r){return e+"_"+t+"_"+i+"_"+r},a.prototype.getKey=function(){return this.chr1.name+"_"+this.chr2.name+"_"+this.zoom.unit+"_"+this.zoom.binSize},o.prototype.getZoomData=function(e){var t,i="BP"===e.unit?this.bpZoomData:this.fragZoomData;for(t=0;t<i.length;t++){var r=i[t];if(e.binSize===r.zoom.binSize)return r}},ContactRecord=function(e,t,i){this.bin1=e,this.bin2=t,this.counts=i},Block=function(e,t){this.blockNumber=e,this.records=t},e}((igv=function(e){function t(e,t){return variants=[],e.variants.forEach((function(e){var i={};e.forEach((function(e){for(var t in e)e.hasOwnProperty(t)&&("POS"===t&&(i.start=e[t]-1),i[t]=e[t])})),i.pvalue=i[t.pvalue][t.dataset][t.trait],i[t.pvalue]=void 0,variants.push(i)})),variants}function i(e,t,i,r){var n=r.trait,a=r.pvalue,o=r.dataset,s={passback:"x",entity:"variant",properties:{cproperty:["VAR_ID","DBSNP_ID","CHROM","POS"],orderBy:["CHROM"],dproperty:{},pproperty:JSON.parse('{"'+a+'": {"'+o+'": ["'+n+'"]}}')},filters:[{dataset_id:"x",phenotype:"x",operand:"CHROM",operator:"EQ",value:e,operand_type:"STRING"},{dataset_id:"x",phenotype:"x",operand:"POS",operator:"GTE",value:t,operand_type:"INTEGER"},{dataset_id:"x",phenotype:"x",operand:"POS",operator:"LTE",value:i,operand_type:"INTEGER"},{dataset_id:o,phenotype:n,operand:a,operator:"LT",value:r.valueThreshold,operand_type:"FLOAT"}]};return JSON.stringify(s)}function r(e,t,i,r){var n=r.url.includes("variant")?a:o,s=r.pvalue?r.pvalue:"PVALUE",h={user_group:"ui",filters:[{operand:"CHROM",operator:"EQ",value:e,filter_type:"STRING"},{operand:"POS",operator:"GT",value:t,filter_type:"FLOAT"},{operand:"POS",operator:"LT",value:i,filter_type:"FLOAT"},{operand:s,operator:"LTE",value:r.valueThreshold,filter_type:"FLOAT"}],columns:n===o?["CHROM","POS","DBSNP_ID","PVALUE","ZSCORE"]:["CHROM","POS",s,"DBSNP_ID"]};return n===o&&(h.trait=r.trait),r.proxy?"url="+r.url+"&data="+JSON.stringify(h):JSON.stringify(h)}function n(e,t){return e.variants.forEach((function(e){e.chr=e.CHROM,e.start=e.POS-1})),e.variants}const a="VARIANT",o="TRAIT";e.T2DVariantSource=function(e){this.config=e,this.url=e.url,this.trait=e.trait,this.dataset=e.dataset,this.pvalue=e.pvalue,void 0===e.valueThreshold&&(e.valueThreshold=.05),void 0===e.dataset?(this.queryJson=e.queryJson||r,this.jsonToVariants=e.jsonToVariants||n):(this.queryJson=e.queryJson||i,this.jsonToVariants=e.jsonToVariants||t)},e.T2DVariantSource.prototype.getFeatures=function(t,i,r){var n=this;return new Promise((function(a,o){if(n.cache&&n.cache.chr===t&&n.cache.end>r&&n.cache.start<i)a(n.cache.featuresBetween(i,r));else{var h=Math.max(r-i,1e7)/2,c=(r+i)/2,l=t.startsWith("chr")?t.substring(3):t,u=Math.max(0,c-h),d=c+h,p=n.config.proxy?n.config.proxy:n.url,f=n.queryJson(l,u,d,n.config);igvxhr.loadJson(p,{sendData:f,withCredentials:n.config.withCredentials}).then((function(i){var r;i?i.error_code?(e.presentAlert("Error querying trait "+n.trait+"  (error_code="+i.error_code+")"),a(null)):((r=n.jsonToVariants(i,n.config)).sort((function(e,t){return e.POS-t.POS})),n.cache=new s(t,u,d,r),a(r)):a(null)})).catch(o)}}))};var s=function(e,t,i,r){var n,a,o;for(this.chr=e,this.start=t,this.end=i,this.binSize=(i-t)/100,this.binIndeces=[0],this.features=r,o=0,n=0;n<r.length;n++)(a=Math.max(0,Math.floor((r[n].POS-this.start)/this.binSize)))>o&&(this.binIndeces.push(n),o=a)};return s.prototype.featuresBetween=function(e,t){var i=Math.max(0,Math.min(Math.floor((e-this.start)/this.binSize)-1,this.binIndeces.length-1)),r=Math.max(0,Math.min(Math.floor((t-this.start)/this.binSize),this.binIndeces.length-1));return this.binIndeces[i],this.binIndeces[r],this.features},e}((igv=function(e){const t=1e8;return e.GWASTrack=function(i){this.config=i,this.url=i.url,this.name=i.name,this.trait=i.trait,this.height=i.height||100,this.minLogP=i.minLogP||0,this.maxLogP=i.maxLogP||15,this.background=i.background,this.divider=i.divider||"rgb(225,225,225)",this.dotSize=i.dotSize||4,this.popoverWindow=void 0===i.popoverWindow?t:i.popoverWindow,this.description=i.description,this.proxy=i.proxy,this.portalURL=i.portalURL?i.portalURL:window.location.origin,this.variantURL=i.variantURL||"http://www.type2diabetesgenetics.org/variant/variantInfo/",this.traitURL=i.traitURL||"http://www.type2diabetesgenetics.org/trait/traitInfo/";var r=i.colorScale||{thresholds:[5e-8,5e-4,.5],colors:["rgb(255,50,50)","rgb(251,100,100)","rgb(251,170,170)","rgb(227,238,249)"]};this.pvalue=i.pvalue?i.pvalue:"PVALUE",this.colorScale=new e.BinnedColorScale(r),i.format&&"gtexGWAS"===i.format?this.featureSource=new e.FeatureSource(i):this.featureSource=new e.T2DVariantSource(i)},e.GWASTrack.prototype.getFeatures=function(e,t,i){return this.featureSource.getFeatures(e,t,i)},e.GWASTrack.prototype.draw=function(i){var r,n,a,o,s,h,c,l,u,d=this,p=i.features,f=i.context,g=i.bpPerPixel,v=i.bpStart,m=i.pixelWidth,w=i.pixelHeight,b=v+m*g+1,y=(d.maxLogP-d.minLogP)/w,k=b-v<t;if(this.po=k?[]:void 0,this.background&&e.graphics.fillRect(f,0,0,m,w,{fillStyle:this.background}),e.graphics.strokeLine(f,0,w-1,m,w-1,{strokeStyle:this.divider}),p){a=p.length;for(var x=0;x<a;x++)if(!((n=(r=p[x]).start)<v)){if(n>b)break;(l=r.pvalue||r[d.pvalue])&&(c=d.colorScale.getColor(l),u=-Math.log(l)/2.302585092994046,o=g,s=Math.round((n-v)/o),h=Math.max(d.dotSize,w-Math.round((u-d.minLogP)/y)),c&&e.graphics.setProperties(f,{fillStyle:c,strokeStyle:"black"}),e.graphics.fillCircle(f,s,h,d.dotSize),k&&d.po.push({x:s,y:h,feature:r}))}}},e.GWASTrack.prototype.paintAxis=function(t,i,r){var n=this,a=(n.maxLogP-n.minLogP)/r,o={font:"normal 10px Arial",textAlign:"right",strokeStyle:"black"};e.graphics.fillRect(t,0,0,i,r,{fillStyle:"rgb(255, 255, 255)"});for(var s=2;s<n.maxLogP;s+=2){var h=r-Math.round((s-n.minLogP)/a);e.graphics.strokeLine(t,45,h-2,50,h-2,o),e.graphics.fillText(t,s,44,h+2,o)}o.textAlign="center",e.graphics.fillText(t,"-log10(pvalue)",i/2,r/2,o,{rotate:{angle:-90}})},e.GWASTrack.prototype.popupDataWithConfiguration=function(e){return this.popupData(e.genomicLocation,e.x,e.y,e.viewport.genomicState.referenceFrame)},e.GWASTrack.prototype.popupData=function(e,t,i,r){var n,a,o,s,h,c,l,u,d=[];if(this.po)for(n=0,a=this.po.length;n<a;n++)o=this.po[n],Math.abs(t-o.x)<this.dotSize&&Math.abs(i-o.y)<=this.dotSize&&(c=o.feature.CHROM||o.feature.chr,l=o.feature.POS||o.feature.start,u=o.feature[this.pvalue]||o.feature.pvalue,(s=o.feature.DBSNP_ID)&&(h=this.variantURL.startsWith("http")?this.variantURL:this.portalURL+"/"+this.variantURL,d.push("<a target='_blank' href='"+h+(h.endsWith("/")?"":"/")+s+"' >"+s+"</a>")),d.push(c+":"+l.toString()),d.push({name:"p-value",value:u}),o.feature.ZSCORE&&d.push({name:"z-score",value:o.feature.ZSCORE}),s&&(h=this.traitURL.startsWith("http")?this.traitURL:this.portalURL+"/"+this.traitURL,d.push("<a target='_blank' href='"+h+(h.endsWith("/")?"":"/")+s+"'>see all available statistics for this variant</a>")),n<a-1&&d.push("<p/>"));else d.push("Popover not available at this resolution.");return d},e.GWASTrack.prototype.popupDataWithConfiguration=function(e){return this.popupData(e.genomicLocation,e.x,e.y,e.viewport.genomicState.referenceFrame)},e}((igv=function(e){return e.ImmVarReader=function(e){this.config=e,this.url=e.url,this.cellConditionId=e.cellConditionId,this.valueThreshold=e.valueThreshold?e.valueThreshold:.05},e.ImmVarReader.prototype.readFeatures=function(e,t,i){var r=this,n=this.url+"?chromosome="+e+"&start="+t+"&end="+i+"&cell_condition_id="+this.cellConditionId;return new Promise((function(e,t){igvxhr.loadJson(n,{withCredentials:r.config.withCredentials}).then((function(t){t?(t.eqtls.forEach((function(e){e.chr=e.chromosome,e.start=e.position,e.end=e.position+1})),e(t.eqtls)):e(null)})).catch((function(e){t(e)}))}))},e}((igv=function(e){return e.GtexReader=function(e){this.config=e,this.url=e.url,this.tissueName=e.tissueName,this.indexed=!0},e.GtexReader.prototype.readFeatures=function(e,t,i){var r=this,n=e.startsWith("chr")?e.substr(3):e,a=t,o=i,s=this.url+"?chromosome="+n+"&start="+a+"&end="+o+"&tissueName="+this.tissueName;return new Promise((function(e,t){igvxhr.loadJson(s,{withCredentials:r.config.withCredentials}).then((function(t){t&&t.singleTissueEqtl?(t.singleTissueEqtl.forEach((function(e){e.chr="chr"+e.chromosome,e.position=e.start,e.start=e.start-1,e.snp=e.snpId,e.geneName=e.geneSymbol,e.geneId=e.gencodeId,e.end=e.start})),e(t.singleTissueEqtl)):e(null)})).catch(t)}))},e}((igv=function(e){e.GtexFileReader=function(e){this.config=e,this.file=e.url,this.codec=this.file.endsWith(".bin")?i:t,this.cache={},this.binary=this.file.endsWith(".bin"),this.compressed=this.file.endsWith(".compressed.bin")},e.GtexFileReader.prototype.readFeatures=function(t,i,r){var n=this;return new Promise((function(i,r){function a(t,i,a){var h=t[i];if(h){var c=h.blocks,l=c[c.length-1],u=l.startPos+l.size-c[0].startPos,d={start:c[0].startPos,size:u};igvxhr.loadArrayBuffer(s,{range:d,withCredentials:n.config.withCredentials}).then((function(t){if(t){var i=new DataView(t),r=new e.BinaryParser(i),n=[];for(r.offset;r.hasNext();){var o=p(r);n.push(o)}a(n)}else a(null)})).catch(r)}else a([]);var p=function(e){return new o(e.getString(),e.getString(),e.getInt(),e.getString(),e.getString(),e.getFloat())}}function o(e,t,i,r,n,a){this.snp=e,this.chr=t,this.position=i,this.start=i,this.end=i+1,this.geneId=r,this.geneName=n,this.pValue=a}var s=n.file,h=n.index;h?a(h,t,i):function(t,i){var r=e.browser?e.browser.genome:null;igvxhr.loadArrayBuffer(t,{range:{start:0,size:200},withCredentials:n.config.withCredentials}).then((function(a){var o=new DataView(a),s=new e.BinaryParser(o),h=(s.getInt(),s.getInt(),s.getLong()),c=s.getInt();igvxhr.loadArrayBuffer(t,{range:{start:h,size:c},withCredentials:n.config.withCredentials}).then((function(t){for(var n=new DataView(t),a=null,o=new e.BinaryParser(n),s=(a={},o.getInt());s-- >0;){var h=o.getString();r&&(h=r.getChromosomeName(h));var c=o.getLong(),l=o.getInt(),u=new Array;u.push(new Block(c,l)),a[h]=new ChrIdx(h,u)}i(a)}))}))}(n.file,(function(e){n.index=e,a(e,t,i)})),o.prototype.description=function(){return"<b>snp</b>:&nbsp"+this.snp+"<br/><b>location</b>:&nbsp"+this.chr+":"+formatNumber(this.position+1)+"<br/><b>gene</b>:&nbsp"+this.geneName+"<br/><b>pValue</b>:&nbsp"+this.pValue+"<br/><b>mLogP</b>:&nbsp"+this.mLogP},Block=function(e,t){this.startPos=e,this.size=t},ChrIdx=function(e,t){this.chr=e,this.blocks=t}}))};var t=function(e){var t=e[0],i=e[1],r=parseInt(e[2])-1,n=e[3],a=e[4],o=e[5],s=parseFloat(e[6]),h=parseFloat(e[7]);return new Eqtl(t,i,r,n,a,o,s,h)},i=function(e){var t=e.getString(),i=e.getString(),r=e.getInt(),n=e.getString(),a=e.getString(),o=e.getFloat();return new Eqtl(t,i,r,n,a,o)};return e}((igv=function(e){e.GtexSelection=function(e){this.geneColors={},this.gene=null,this.snp=null,this.genesCount=0,e.gene&&(this.gene=e.gene.toUpperCase(),this.geneColors[this.gene]=t[this.genesCount++]),e.snp&&(this.snp=e.snp.toUpperCase())},e.GtexSelection.prototype.addGene=function(e){this.geneColors[e.toUpperCase()]||(this.geneColors[e.toUpperCase()]=t[this.genesCount++])},e.GtexSelection.prototype.colorForGene=function(e){return this.geneColors[e.toUpperCase()]};var t=new Array;return t.push("rgb(228,26,28)"),t.push("rgb(55,126,184)"),t.push("rgb(77,175,74)"),t.push("rgb(166,86,40)"),t.push("rgb(152,78,163)"),t.push("rgb(255,127,0)"),t.push("rgb(247,129,191)"),t.push("rgb(153,153,153)"),t.push("rgb(255,255,51)"),t.push("rgb(102, 194, 165"),t.push("rgb(252, 141, 98"),t.push("rgb(141, 160, 203"),t.push("rgb(231, 138, 195"),t.push("rgb(166, 216, 84"),t.push("rgb(255, 217, 47"),t.push("rgb(229, 196, 148"),t.push("rgb(179, 179, 179"),t.push("rgb( 141, 211, 199"),t.push("rgb(255, 255, 179"),t.push("rgb(190, 186, 218"),t.push("rgb(251, 128, 114"),t.push("rgb(128, 177, 211"),t.push("rgb(253, 180, 98"),t.push("rgb(179, 222, 105"),t.push("rgb(252, 205, 229"),t.push("rgb(217, 217, 217"),t.push("rgb(188, 128, 189"),t.push("rgb(204, 235, 197"),t.push("rgb(255, 237, 111"),e}((igv=function(e){function t(t,i){console.log(t+" "+i);var r="gtex"===i?"snp":"gene";this.selection=new GtexSelection("gene"==r?{gene:t}:{snp:t}),e.browser.update()}e.EqtlTrack=function(i){var r=i.url,n=i.name;this.config=i,this.url=r,this.name=n,this.pValueField=i.pValueField||"pValue",this.geneField=i.geneField||"geneName",this.minLogP=i.minLogP||3.5,this.maxLogP=i.maxLogP||25,this.background=i.background,this.divider=i.divider||"rgb(225,225,225)",this.dotSize=i.dotSize||2,this.height=i.height||100,this.autoHeight=!1,this.disableButtons=i.disableButtons,this.featureSource=new e.FeatureSource(i),this.onsearch=function(e,i){t.call(this,e,i)}},e.EqtlTrack.prototype.paintAxis=function(t,i,r){var n=this,a=(n.maxLogP-n.minLogP)/r,o={font:"normal 10px Arial",textAlign:"right",strokeStyle:"black"};e.graphics.fillRect(t,0,0,i,r,{fillStyle:"rgb(255, 255, 255)"});for(var s=4;s<=n.maxLogP;s+=2){var h,c,l,u,d;h=(d=.85*i)-5,c=d,l=u=r-Math.round((s-n.minLogP)/a),e.graphics.strokeLine(t,h,l,c,u,o),e.graphics.fillText(t,s,h-1,l+2,o)}o.textAlign="center",e.graphics.fillText(t,"-log10(pvalue)",i/4,r/2,o,{rotate:{angle:-90}})},e.EqtlTrack.prototype.getFeatures=function(e,t,i){return this.featureSource.getFeatures(e,t,i)},e.EqtlTrack.prototype.draw=function(t){function i(i){var d,p,f,g,v,m,w,b,y,k=i?2*r.dotSize:r.dotSize;for(e.graphics.setProperties(a,{fillStyle:"rgb(180, 180, 180)",strokeStyle:"rgb(180, 180, 180)"}),p=0;p<u;p++)if(w=(d=n[p]).snp.toUpperCase(),b=d[r.geneField].toUpperCase(),m=(y=t.genomicState.selection)&&(y.snp===w||y.gene===b),(!i||m)&&(y&&y.snp===w&&y.addGene(b),i&&y&&(v=y.colorForGene(b)),!(i&&void 0===v||(f=Math.round(d.position-s+.5)/o,f<0)))){if(f>h)break;var x=-Math.log(d[r.pValueField])/Math.LN10;x<r.minLogP||(g=Math.max(0+k,c-Math.round((x-r.minLogP)/l)),d.px=f,d.py=g,v&&e.graphics.setProperties(a,{fillStyle:v,strokeStyle:"black"}),e.graphics.fillCircle(a,f,g,k),e.graphics.strokeCircle(a,f,g,k))}}var r=this,n=t.features,a=t.context,o=t.bpPerPixel,s=t.bpStart,h=t.pixelWidth,c=t.pixelHeight,l=(r.maxLogP-r.minLogP)/c;if(this.background&&e.graphics.fillRect(a,0,0,h,c,{fillStyle:this.background}),e.graphics.strokeLine(a,0,c-1,h,c-1,{strokeStyle:this.divider}),a){var u=n.length;a.save(),i(!1),i(!0),a.restore()}},e.EqtlTrack.prototype.popupDataWithConfiguration=function(e){return this.popupData(e.genomicLocation,e.x,e.y,e.viewport.genomicState.referenceFrame)},e.EqtlTrack.prototype.popupData=function(e,t,i,r){if(this.featureSource.featureCache){var n=r.chrName,a=2*this.dotSize*r.bpPerPixel,o=this.featureSource.featureCache.queryFeatures(n,e-a,e+a),s=this.dotSize,h=this.name;if(o&&o.length>0){var c=[];return o.forEach((function(t){t.end>=e-a&&t.start<=e+a&&t.py-i<2*s&&(c.length>0&&c.push("<hr>"),c.push({name:"snp id",value:t.snp},{name:"gene id",value:t.geneId},{name:"gene name",value:t.geneName},{name:"p value",value:t.pValue},{name:"tissue",value:h}))})),c}}},GtexSelection=function(e){this.geneColors={},this.gene=null,this.snp=null,this.genesCount=0,e.gene&&(this.gene=e.gene.toUpperCase(),this.geneColors[this.gene]=i[this.genesCount++]),e.snp&&(this.snp=e.snp.toUpperCase())},GtexSelection.prototype.addGene=function(e){this.geneColors[e.toUpperCase()]||(this.geneColors[e.toUpperCase()]=i[this.genesCount++])},GtexSelection.prototype.colorForGene=function(e){return this.geneColors[e.toUpperCase()]};var i=new Array;return i.push("rgb(228,26,28)"),i.push("rgb(55,126,184)"),i.push("rgb(77,175,74)"),i.push("rgb(166,86,40)"),i.push("rgb(152,78,163)"),i.push("rgb(255,127,0)"),i.push("rgb(247,129,191)"),i.push("rgb(153,153,153)"),i.push("rgb(255,255,51)"),i.push("rgb(102, 194, 165"),i.push("rgb(252, 141, 98"),i.push("rgb(141, 160, 203"),i.push("rgb(231, 138, 195"),i.push("rgb(166, 216, 84"),i.push("rgb(255, 217, 47"),i.push("rgb(229, 196, 148"),i.push("rgb(179, 179, 179"),i.push("rgb( 141, 211, 199"),i.push("rgb(255, 255, 179"),i.push("rgb(190, 186, 218"),i.push("rgb(251, 128, 114"),i.push("rgb(128, 177, 211"),i.push("rgb(253, 180, 98"),i.push("rgb(179, 222, 105"),i.push("rgb(252, 205, 229"),i.push("rgb(217, 217, 217"),i.push("rgb(188, 128, 189"),i.push("rgb(204, 235, 197"),i.push("rgb(255, 237, 111"),e}((igv=function(e){function t(){var e=this,t={},i=0;e.chromosomeNames.forEach((function(r){t[r]=Math.floor(i);var n=e.getChromosome(r);i+=n.bpLength/1e3})),e.cumulativeOffsets=t}return e.Genome=function(e,t,r){var n,a,o;this.sequence=e,this.chromosomeNames=e.chromosomeNames,this.chromosomes=e.chromosomes,this.ideograms=t,n=this,a=0,_.each(n.chromosomes,(function(e){a+=Math.floor(e.bpLength/1e3)})),n.wgChromosomeNames=[],n.ideograms?_.each(n.chromosomeNames,(function(e){var t=n.ideograms[e];t&&t.length>0&&n.wgChromosomeNames.push(e)})):(o=a/n.chromosomeNames.length*200,a=0,_.each(n.chromosomeNames,(function(e){n.chromosomes[e].bpLength>o&&n.wgChromosomeNames.push(e)}))),n.chromosomes.all={name:"all",bpLength:a};var s={},h=this;this.chromosomeNames.forEach((function(e){var t=e.startsWith("chr")?e.substring(3):"chr"+e;s[t]=e,"chrM"===e&&(s.MT="chrM"),"MT"===e&&(s.chrmM="MT")})),r&&r.forEach((function(e){var t;for(i=0;i<e.length;i++)if(h.chromosomes[e[i]]){t=e[i];break}t&&e.forEach((function(e){e!==t&&(s[e]=t)}))})),this.chrAliasTable=s},e.Genome.prototype.getChromosomeName=function(e){var t=this.chrAliasTable[e];return t||e},e.Genome.prototype.getChromosome=function(e){return e=this.getChromosomeName(e),this.chromosomes[e]},e.Genome.prototype.getCytobands=function(e){return this.ideograms?this.ideograms[e]:null},e.Genome.prototype.getLongestChromosome=function(){var e,t,i=this.chromosomes;for(t in i){if(i.hasOwnProperty(t)){var r=i[t];(void 0===e||r.bpLength>e.bpLength)&&(e=r)}return e}},e.Genome.prototype.getChromosomes=function(){return this.chromosomes},e.Genome.prototype.getGenomeCoordinate=function(e,t){return this.getCumulativeOffset(e)+Math.floor(t/1e3)},e.Genome.prototype.getChromosomeCoordinate=function(e){var i,r,n,a;for(void 0===this.cumulativeOffsets&&t.call(this),n=0;n<this.chromosomeNames.length;n++){a=this.chromosomeNames[n];var o=this.cumulativeOffsets[a];if(o>e)return{chr:i,position:Math.floor((e-r)/1e3)};i=a,r=o}return{chr:_.last(this.chromosomeNames),position:0}},e.Genome.prototype.getCumulativeOffset=function(e){var i=this.getChromosomeName(e);return void 0===this.cumulativeOffsets&&t.call(this),this.cumulativeOffsets[i]},e.Chromosome=function(e,t,i){this.name=e,this.order=t,this.bpLength=i},e.Cytoband=function(e,t,i,r){this.start=e,this.end=t,this.name=i,this.stain=0,"acen"==r?this.type="c":(this.type=r.charAt(1),"p"==this.type&&(this.stain=parseInt(r.substring(4))))},e.GenomicInterval=function(e,t,i,r){this.chr=e,this.start=t,this.end=i,this.features=r},e.GenomicInterval.prototype.contains=function(e,t,i){return this.chr==e&&this.start<=t&&this.end>=i},e.GenomicInterval.prototype.containsRange=function(e){return this.chr===e.chr&&this.start<=e.start&&this.end>=e.end},e.loadGenome=function(t){return new Promise((function(i,r){function n(){!(void 0!==h&&void 0===a||void 0!==c&&void 0===o)&&i(new e.Genome(s,a,o))}var a,o,s,h=t.cytobandURL,c=t.aliasURL;(s=new e.FastaSequence(t)).init().then((function(){s.chromosomeNames,s.chromosomes,h&&function(t,i,r){igvxhr.loadString(t,e.buildOptions(i)).then((function(t){for(var i,n=[],a=0,o=t.splitLines(),s=o.length,h={},c=0;c<s;c++){var l=o[c].split("\t"),u=l[0];if(i||(i=u),u!=i&&(h[i]=n,n=[],i=u,a=0),5==l.length){u=l[0];var d=parseInt(l[1]),p=parseInt(l[2]),f=l[3],g=l[4];n[a++]=new e.Cytoband(d,p,f,g)}}r(h)}))}(h,s.config,(function(e){a=e,n()})),c&&function(t,i,r){igvxhr.loadString(t,e.buildOptions(i)).then((function(e){var t=e.splitLines(),i=[];t.forEach((function(e){!e.startsWith("#")&e.length>0&&i.push(e.split("\t"))})),r(i)}))}(c,s.config,(function(e){o=e,n()})),n()})).catch((function(e){r(e)}))}))},e}((igv=function(e){return e.Google={isGoogleURL:function(e){return e.includes("googleapis")},translateGoogleCloudURL:function(e){var t=e.indexOf("/",5);return t<0?(console.log("Invalid gs url: "+e),e):"https://www.googleapis.com/storage/v1/b/"+e.substring(5,t)+"/o/"+encodeURIComponent(e.substring(t+1))+"?alt=media"},addGoogleHeaders:function(e){e["Cache-Control"]="no-cache";var t=oauth.google.access_token;return t&&!e.hasOwnProperty("Authorization")&&(e.Authorization="Bearer "+t),e},addApiKey:function(e){var t=oauth.google.apiKey,i=e.includes("?")?"&":"?";return void 0===t||e.includes("key=")||t&&(e=e+i+"key="+t),e}},e}((igv=function(e){return e.Ga4ghVariantReader=function(e){this.config=e,this.url=e.url,this.variantSetId=e.variantSetId,this.callSetIds=e.callSetIds,this.includeCalls=void 0===e.includeCalls||e.includeCalls},e.Ga4ghVariantReader.prototype.readHeader=function(){var t=this;return new Promise((function(i,r){if(t.header)i(t.header);else if(t.header={},!1===t.includeCalls)i(t.header);else{var n=t.url+"/callsets/search";e.ga4ghSearch({url:n,fields:"nextPageToken,callSets(id,name)",body:{variantSetIds:Array.isArray(t.variantSetId)?t.variantSetId:[t.variantSetId],pageSize:"10000"},decode:function(e){if(t.callSetIds){var i=[],r=new Set;return r.addAll(t.callSetIds),e.callSets.forEach((function(e){r.has(e.id)&&i.push(e)})),i}return e.callSets}}).then((function(e){t.header.callSets=e,i(t.header)})).catch(r)}}))},e.Ga4ghVariantReader.prototype.readFeatures=function(t,i,r){var n=this;return new Promise((function(a,o){n.readHeader().then((function(s){new Promise((function(t,i){n.chrNameMap?t(n.chrNameMap):n.readMetadata().then((function(i){n.metadata=i.metadata,n.chrNameMap={},i.referenceBounds&&e.browser&&i.referenceBounds.forEach((function(t){var i=t.referenceName,r=e.browser.genome.getChromosomeName(i);n.chrNameMap[r]=i})),t(n.chrNameMap)}))})).then((function(s){var h=s.hasOwnProperty(t)?s[t]:t,c=n.url+"/variants/search";e.ga4ghSearch({url:c,fields:n.includeCalls?void 0:"nextPageToken,variants(id,variantSetId,names,referenceName,start,end,referenceBases,alternateBases,quality, filter, info)",body:{variantSetIds:Array.isArray(n.variantSetId)?n.variantSetId:[n.variantSetId],callSetIds:n.callSetIds?n.callSetIds:void 0,referenceName:h,start:i.toString(),end:r.toString(),pageSize:"10000"},decode:function(t){var i=[];return t.variants.forEach((function(t){i.push(e.createGAVariant(t))})),i}}).then(a).catch(o)})).catch(o)})).catch(o)}))},e.Ga4ghVariantReader.prototype.readMetadata=function(){return e.ga4ghGet({url:this.url,entity:"variantsets",entityId:this.variantSetId})},e}((igv=function(e){return e.ga4ghGet=function(e){var t=e.url+"/"+e.entity+"/"+e.entityId;return igvxhr.loadJson(t,e)},e.ga4ghSearch=function(e){return new Promise((function(t,i){var r=e.results?e.results:[],n=e.url,a=e.body,o=e.decode,s=oauth.google.apiKey,h="?",c=e.fields;s&&(n=n+h+"key="+s,h="&"),c&&(n=n+h+"fields="+c),function e(s){s?a.pageToken=s:null!=a.pageToken&&delete a.pageToken;var h,c,l=JSON.stringify(a);igvxhr.loadJson(n,{sendData:l,contentType:"application/json",headers:(h={},c=oauth.google.access_token,h["Cache-Control"]="no-cache",c&&(h.Authorization="Bearer "+c),h)}).then((function(i){var n,a;i?((a=o?o(i):i)&&a.forEach((function(e){r.push(e)})),(n=i.nextPageToken)?e(n):t(r)):t(r)})).catch((function(e){i(e)}))}()}))},e.ga4ghSearchReadGroupSets=function(t){e.ga4ghSearch({url:t.url+"/readgroupsets/search",body:{datasetIds:[t.datasetId],pageSize:"10000"},decode:function(e){return e.readGroupSets}}).then((function(e){t.success(e)})).catch((function(e){console.log(e)}))},e.ga4ghSearchVariantSets=function(t){e.ga4ghSearch({url:t.url+"/variantsets/search",body:{datasetIds:[t.datasetId],pageSize:"10000"},decode:function(e){return e.variantSets}}).then((function(e){t.success(e)})).catch((function(e){console.log(e)}))},e.ga4ghSearchCallSets=function(t){t.datasetId?e.ga4ghSearchVariantSets({url:t.url,datasetId:t.datasetId,success:function(i){var r=[];i.forEach((function(e){r.push(e.id)})),t.datasetId=void 0,t.variantSetIds=r,e.ga4ghSearchCallSets(t)}}):e.ga4ghSearch({url:t.url+"/callsets/search",body:{variantSetIds:t.variantSetIds,pageSize:"10000"},decode:function(e){return e.callSets&&e.callSets.forEach((function(e){e.variantSetIds=t.variantSetIds})),e.callSets}}).then((function(e){t.success(e)})).catch((function(e){console.log(e)}))},e.ga4ghSearchReadAndCallSets=function(t){e.ga4ghSearchReadGroupSets({url:t.url,datasetId:t.datasetId,success:function(i){e.ga4ghSearchCallSets({url:t.url,datasetId:t.datasetId,success:function(e){var r={};e.forEach((function(e){r[e.name]=e}));var n=[];i.forEach((function(e){var i={readGroupSetId:e.id,name:e.name,datasetId:t.datasetId},a=r[e.name];a&&(i.callSetId=a.id,i.variantSetIds=a.variantSetIds),n.push(i)})),t.success(n)}})}})},e}((igv=function(e){var t={ALIGNMENT_MATCH:"M",INSERT:"I",DELETE:"D",SKIP:"N",CLIP_SOFT:"S",CLIP_HARD:"H",PAD:"P",SEQUENCE_MATCH:"=",SEQUENCE_MISMATCH:"X"};return e.Ga4ghAlignmentReader=function(t){this.config=t,this.url=t.url,this.filter=t.filter||new e.BamFilter,this.readGroupSetIds=t.readGroupSetIds,this.authKey=t.authKey,this.samplingWindowSize=void 0===t.samplingWindowSize?100:t.samplingWindowSize,this.samplingDepth=void 0===t.samplingDepth?100:t.samplingDepth,t.viewAsPairs?this.pairsSupported=!0:this.pairsSupported=void 0===t.pairsSupported||t.pairsSupported},e.Ga4ghAlignmentReader.prototype.readAlignments=function(i,r,n){var a=this;return new Promise((function(o,s){function h(i){function r(e){var i="";return e.forEach((function(e){var r=t[e.operation],n=e.operationLength;i+=n+r})),i}function n(e){var i,r,n,a,o=0,s=[];for(a=0;a<e.length;a++)i=e[a],n=t[i.operation],r=parseInt(i.operationLength),"M"!==n&&"EQ"!==n&&"X"!==n&&"D"!==n&&"N"!==n&&"="!==n||(o+=r),s.push({len:r,ltr:n});return{lengthOnRef:o,array:s}}function o(e,t){for(var i,r,n,a,o=[],s=0,h=e.start,c=t.length,l=0;l<c;l++){var u=t[l];switch(u.ltr){case"H":case"P":break;case"S":s+=u.len,n="S";break;case"N":h+=u.len,n="N";break;case"D":h+=u.len,n="D";break;case"I":r="*"===e.seq?"*":e.seq.substr(s,u.len),a=e.qual?e.qual.slice(s,u.len):void 0,void 0===i&&(i=[]),i.push({start:h,len:u.len,seq:r,qual:a}),s+=u.len;break;case"M":case"EQ":case"=":case"X":r="*"===e.seq?"*":e.seq.substr(s,u.len),a=e.qual?e.qual.slice(s,u.len):void 0,o.push({start:h,len:u.len,seq:r,qual:a,gapType:n}),s+=u.len,h+=u.len;break;default:console.log("Error processing cigar element: "+u.len+u.ltr)}}return{blocks:o,insertions:i}}var s,h,c,l,u=i.alignments,d=u.length,p=[],f=e.browser.genome;for(s=0;s<d;s++)i=u[s],(h=new e.BamAlignment).readName=i.fragmentName,h.properPlacement=i.properPlacement,h.duplicateFragment=i.duplicateFragment,h.numberReads=i.numberReads,h.fragmentLength=i.fragmentLength,h.readNumber=i.readNumber,h.failedVendorQualityChecks=i.failedVendorQualityChecks,h.secondaryAlignment=i.secondaryAlignment,h.supplementaryAlignment=i.supplementaryAlignment,h.seq=i.alignedSequence,h.qual=i.alignedQuality,h.matePos=i.nextMatePosition,h.tagDict=i.info,h.flags=0,i.alignment?(h.mapped=!0,h.chr=i.alignment.position.referenceName,f&&(h.chr=f.getChromosomeName(h.chr)),h.start=parseInt(i.alignment.position.position),h.strand=!i.alignment.position.reverseStrand,h.mq=i.alignment.mappingQuality,h.cigar=r(i.alignment.cigar),c=n(i.alignment.cigar),h.lengthOnRef=c.lengthOnRef,blocks=o(h,c.array),h.blocks=blocks.blocks,h.insertions=blocks.insertions):h.mapped=!1,(l=i.nextMatePosition)&&(h.mate={chr:l.referenceFrame,position:parseInt(l.position),strand:!l.reverseStrand}),a.filter.pass(h)&&p.push(h);return p}new Promise((function(t,i){a.chrNameMap?t(a.chrNameMap):a.readMetadata().then((function(r){if(a.chrNameMap={},e.browser&&r.readGroups&&r.readGroups.length>0){var n=r.readGroups[0].referenceSetId;if(console.log("No reference set specified"),n){var o=a.url+"/references/search";e.ga4ghSearch({url:o,body:{referenceSetId:n},decode:function(e){return e.references}}).then((function(i){i.forEach((function(t){var i=t.name,r=e.browser.genome.getChromosomeName(i);a.chrNameMap[r]=i})),t(a.chrNameMap)})).catch(i)}else(function(e,t){var i;if("461916304629"===t||"337315832689"===t){for(i=1;i<23;i++)e["chr"+i]=i;e.chrX="X",e.chrY="Y",e.chrM="MT"}})(a.chrNameMap,a.config.datasetId),t(a.chrNameMap)}else t(a.chrNameMap)})).catch(i)})).then((function(t){var c=t.hasOwnProperty(i)?t[i]:i,l=a.url+"/reads/search";e.ga4ghSearch({url:l,body:{readGroupSetIds:[a.readGroupSetIds],referenceName:c,start:r,end:n,pageSize:"10000"},decode:h,results:new e.AlignmentContainer(i,r,n,a.samplingWindowSize,a.samplingDepth,a.pairsSupported)}).then(o).catch(s)})).catch(s)}))},e.Ga4ghAlignmentReader.prototype.readMetadata=function(){return e.ga4ghGet({url:this.url,entity:"readgroupsets",entityId:this.readGroupSetIds})},e.decodeGa4ghReadset=function(e){var t=[];return e.fileData.forEach((function(e){e.refSequences.forEach((function(e){t.push(e.name)}))})),t},e}((igv=function(e){var t={ALIGNMENT_MATCH:"M",INSERT:"I",DELETE:"D",SKIP:"N",CLIP_SOFT:"S",CLIP_HARD:"H",PAD:"P",SEQUENCE_MATCH:"=",SEQUENCE_MISMATCH:"X"};return e.Ga4ghAlignment=function(e,r){this.readName=e.fragmentName,this.properPlacement=e.properPlacement,this.duplicateFragment=e.duplicateFragment,this.numberReads=e.numberReads,this.fragmentLength=e.fragmentLength,this.readNumber=e.readNumber,this.failedVendorQualityChecks=e.failedVendorQualityChecks,this.secondaryAlignment=e.secondaryAlignment,this.supplementaryAlignment=e.supplementaryAlignment,this.seq=e.alignedSequence,this.qual=e.alignedQuality,this.tagDict=e.info,alignment=e.alignment,alignment?(this.mapped=!0,this.chr=e.alignment.position.referenceName,r&&(this.chr=r.getChromosomeName(this.chr)),this.start=parseInt(e.alignment.position.position),this.strand=!e.alignment.position.reverseStrand,this.mq=e.alignment.mappingQuality,cigarDecoded=function(e){var r,n,a,o=0,s=[];for(i=0;i<e.length;i++)r=e[i],a=t[r.operation],n=parseInt(r.operationLength),"M"!=a&&"EQ"!=a&&"X"!=a&&"D"!=a&&"N"!=a&&"="!=a||(o+=n),s.push({len:n,ltr:a});return{lengthOnRef:o,array:s}}(e.alignment.cigar),this.lengthOnRef=cigarDecoded.lengthOnRef,this.blocks=function(e,t){for(var i,r,n,a=[],o=0,s=e.start,h=t.length,c=0;c<h;c++){var l=t[c];switch(l.ltr){case"H":case"P":break;case"S":o+=l.len,n="S";break;case"N":s+=l.len,n="N";break;case"D":s+=l.len,n="D";break;case"I":o+=l.len;break;case"M":case"EQ":case"=":case"X":i="*"===e.seq?"*":e.seq.substr(o,l.len),r="*"===e.qual?"*":e.qual.slice(o,l.len),a.push({start:s,len:l.len,seq:i,qual:r,gapType:n}),o+=l.len,s+=l.len;break;default:console.log("Error processing cigar element: "+l.len+l.ltr)}}return a}(this,cigarDecoded.array)):this.mapped=!1,e.nextMatePosition&&(this.mate={chr:e.nextMatePosition.referenceFrame,position:parseInt(e.nextMatePosition.position),strand:!e.nextMatePosition.reverseStrand},this.info=e.info)},e.Ga4ghAlignment.prototype.isMapped=function(){return this.mapped},e.Ga4ghAlignment.prototype.isPaired=function(){return this.numberReads&&this.numberReads>1},e.Ga4ghAlignment.prototype.isProperPair=function(){return void 0===this.properPlacement||this.properPlacement},e.Ga4ghAlignment.prototype.isFirstOfPair=function(){return this.readNumber&&0===this.readNumber},e.Ga4ghAlignment.prototype.isSecondOfPair=function(){return this.readNumber&&1===this.readNumber},e.Ga4ghAlignment.prototype.isSecondary=function(){return this.secondaryAlignment},e.Ga4ghAlignment.prototype.isSupplementary=function(){return this.supplementaryAlignment},e.Ga4ghAlignment.prototype.isFailsVendorQualityCheck=function(){return this.failedVendorQualityChecks},e.Ga4ghAlignment.prototype.isDuplicate=function(){return this.duplicateFragment},e.Ga4ghAlignment.prototype.isMateMapped=function(){return this.mate},e.Ga4ghAlignment.prototype.mateStrand=function(){return this.mate&&this.mate.strand},e.Ga4ghAlignment.prototype.tags=function(){return this.info},e.Ga4ghAlignment.prototype.popupData=function(t){function i(e){return e?"Yes":"No"}var r;for(var n in nameValues=[],nameValues.push({name:"Read Name",value:this.readName}),nameValues.push("<hr>"),nameValues.push({name:"Alignment Start",value:e.numberFormatter(1+this.start),borderTop:!0}),nameValues.push({name:"Read Strand",value:!0===this.strand?"(+)":"(-)",borderTop:!0}),nameValues.push({name:"Cigar",value:this.cigar}),nameValues.push({name:"Mapped",value:i(this.isMapped())}),nameValues.push({name:"Mapping Quality",value:this.mq}),nameValues.push({name:"Secondary",value:i(this.isSecondary())}),nameValues.push({name:"Supplementary",value:i(this.isSupplementary())}),nameValues.push({name:"Duplicate",value:i(this.isDuplicate())}),nameValues.push({name:"Failed QC",value:i(this.isFailsVendorQualityCheck())}),this.isPaired()&&(nameValues.push("<hr>"),nameValues.push({name:"First in Pair",value:!this.isSecondOfPair(),borderTop:!0}),nameValues.push({name:"Mate is Mapped",value:i(this.isMateMapped())}),this.isMapped()&&(nameValues.push({name:"Mate Start",value:this.matePos}),nameValues.push({name:"Mate Strand",value:this.mateStrand()?"(-)":"(+)"}),nameValues.push({name:"Insert Size",value:this.fragmentLength}))),nameValues.push("<hr>"),this.tags(),r=!0,this.tagDict)this.tagDict.hasOwnProperty(n)&&(r?(nameValues.push({name:n,value:this.tagDict[n],borderTop:!0}),r=!1):nameValues.push({name:n,value:this.tagDict[n]}));return nameValues},e}((igv=function(e){return e.WIGTrack=function(t){this.config=t,this.url=t.url,void 0===t.color&&(t.color="rgb(150,150,150)"),e.configTrack(this,t),"bigwig"===t.format?this.featureSource=new e.BWSource(t):"tdf"===t.format?this.featureSource=new e.TDFSource(t):this.featureSource=new e.FeatureSource(t),this.autoscale=t.autoscale,t.max&&(this.dataRange={min:t.min||0,max:t.max}),this.paintAxis=e.paintAxis},e.WIGTrack.prototype.getFeatures=function(e,t,i,r){var n=this;return new Promise((function(a,o){n.featureSource.getFeatures(e,t,i,r).then(a).catch(o)}))},e.WIGTrack.prototype.menuItemList=function(t){var i=this,r=[];return r.push(e.colorPickerMenuItem(t,this.trackView)),r.push(e.dataRangeMenuItem(t,this.trackView)),r.push({object:$(function(e){var t=[];return t.push("<div>"),t.push(!0===e?'<i class="fa fa-check">':'<i class="fa fa-check fa-check-hidden">'),t.push("</i>"),t.push("Autoscale"),t.push("</div>"),t.join("")}(i.autoscale)),click:function(){var e=$(this).find("i");t.hide(),i.autoscale=!i.autoscale,!0===i.autoscale?e.removeClass("fa-check-hidden"):e.addClass("fa-check-hidden"),i.trackView.update()}}),r},e.WIGTrack.prototype.getFileHeader=function(){var e=this;return new Promise((function(t,i){"function"==typeof e.featureSource.getFileHeader?e.featureSource.getFileHeader().then((function(i){i&&(i.name&&!e.config.name&&(e.name=i.name),i.color&&!e.config.color&&(e.color="rgb("+i.color+")")),t(i)})).catch(i):t(null)}))},e.WIGTrack.prototype.draw=function(t){var i,r,n,a,o=this,s=t.features,h=t.context,c=t.bpPerPixel,l=t.bpStart,u=t.pixelWidth,d=t.pixelHeight,p=l+u*c+1;if(s&&s.length>0){if(void 0===o.autoscale&&void 0===o.dataRange&&"function"==typeof o.featureSource.getDefaultRange&&(a=o.featureSource.getDefaultRange(),isNaN(a.min)||isNaN(a.max)||(o.dataRange=a,console.log("Range= "+a.min+" - "+a.max))),o.autoscale||void 0===o.dataRange){var f=function(e){var t=0,i=-Number.MAX_VALUE;return e.forEach((function(e){Number.isNaN(e.value)||(t=Math.min(t,e.value),i=Math.max(i,e.value))})),{min:t,max:i}}(s);i=f.min,r=f.max}else i=void 0===o.dataRange.min?0:o.dataRange.min,r=o.dataRange.max;void 0===o.dataRange&&(o.dataRange={}),o.dataRange.min=i,o.dataRange.max=r,n=r-i,s.forEach((function(t,a,s){var u,f,g,v,m,w,b;t.end<l||t.start>p||(g=Math.floor((t.start-l)/c),m=Math.ceil((t.end-l)/c),v=Math.max(1,m-g),b=r,(w=i)>0&&b<0||w<0&&b>0?t.value<0?(u=r/n,f=-t.value/n):(u=(r-t.value)/n,f=t.value/n):i<0?(u=0,f=-t.value/n):(u=1-t.value/n,f=t.value/n),e.graphics.fillRect(h,g,u*d,v,f*d,{fillStyle:o.color}))}))}},e}((igv=function(e){return e.loadTribbleIndex=function(t,i){var r=e.browser?e.browser.genome:null;return new Promise((function(n){function a(e){var t=e.getString(),i=0;r&&(t=r.getChromosomeName(t));for(var n=(e.getInt(),e.getInt()),a=(e.getInt(),e.getInt(),e.getInt(),new Array),o=e.getLong(),s=(a=new Array,0);s<n;s++){var h=e.getLong();a.push({min:o,max:h}),o=h,h>i&&(i=h)}return{chr:t,blocks:a}}igvxhr.loadArrayBuffer(t,e.buildOptions(i)).then((function(t){if(t){var i={},r=new e.BinaryParser(new DataView(t));!function(e){var t=(e.getInt(),e.getInt(),e.getInt());if(e.getString(),e.getLong(),e.getLong(),e.getString(),flags=e.getInt(),t<3&&(flags,SEQUENCE_DICTIONARY_FLAG,SEQUENCE_DICTIONARY_FLAG),t>=3)for(var i=e.getInt();i-- >0;)e.getString(),e.getString()}(r);for(var o=r.getInt();o-- >0;){var s=a(r);i[s.chr]=s}n(new e.TribbleIndex(i))}else n(null)})).catch((function(e){console.log(e),n(null)}))}))},e.TribbleIndex=function(e){this.chrIndex=e},e.TribbleIndex.prototype.blocksForRange=function(e,t,i){var r=this.chrIndex[e];if(r){var n=r.blocks,a=n[n.length-1];return[{minv:{block:n[0].min,offset:0},maxv:{block:a.max,offset:0}}]}return null},e}((igv=function(e){var t="DESC";return e.SegTrack=function(t){e.configTrack(this,t),this.isLog=void 0!==t.isLog&&t.isLog,this.displayMode=t.displayMode||"SQUISHED",this.maxHeight=t.maxHeight||500,this.sampleSquishHeight=t.sampleSquishHeight||2,this.sampleExpandHeight=t.sampleExpandHeight||12,this.posColorScale=t.posColorScale||new e.GradientColorScale({low:.1,lowR:255,lowG:255,lowB:255,high:1.5,highR:255,highG:0,highB:0}),this.negColorScale=t.negColorScale||new e.GradientColorScale({low:-1.5,lowR:0,lowG:0,lowB:255,high:-.1,highR:255,highG:255,highB:255}),this.sampleCount=0,this.samples={},this.sampleNames=[],this.featureSource=new e.FeatureSource(this.config),this.supportsWholeGenome=!0},e.SegTrack.prototype.menuItemList=function(e){var t=this;return[{name:"SQUISHED"===this.displayMode?"Expand sample hgt":"Squish sample hgt",click:function(){e.hide(),t.toggleSampleHeight()}}]},e.SegTrack.prototype.toggleSampleHeight=function(){this.displayMode="SQUISHED"===this.displayMode?"EXPANDED":"SQUISHED",this.trackView.update()},e.SegTrack.prototype.getFeatures=function(e,t,i){var r=this;return new Promise((function(n,a){0===r.sampleCount&&"function"==typeof r.featureSource.reader.allSamples?r.featureSource.reader.allSamples().then((function(o){o.forEach((function(e){r.samples[e]=r.sampleCount,r.sampleNames.push(e),r.sampleCount++})),r.featureSource.getFeatures(e,t,i).then(n).catch(a)})).catch(a):r.featureSource.getFeatures(e,t,i).then(n).catch(a)}))},e.SegTrack.prototype.draw=function(t){var i,r,n,a,o,s,h,c,l,u,d,p,f,g,v,m,w,b,y,k,x=this;if(y="SQUISHED"===this.displayMode?this.sampleSquishHeight:this.sampleExpandHeight,k="SQUISHED"===this.displayMode?0:1,r=t.context,o=t.pixelWidth,s=t.pixelHeight,e.graphics.fillRect(r,0,0,o,s,{fillStyle:"rgb(255, 255, 255)"}),i=t.features){for(n=t.bpPerPixel,h=(a=t.bpStart)+o*n+1,b=n,d=0,l=i.length;d<l;d++)u=i[d].sample,this.samples.hasOwnProperty(u)||(this.samples[u]=x.sampleCount,this.sampleNames.push(u),this.sampleCount++);for(d=0,l=i.length;d<l;d++)if(!((c=i[d]).end<a)){if(c.start>h)break;p=x.samples[c.sample]*y+k,g=c.value,x.isLog||(g=Math.log2(g/2)),f=g<-.1?x.negColorScale.getColor(g):g>.1?x.posColorScale.getColor(g):"white",v=Math.round((c.start-a)/b),m=Math.round((c.end-a)/b),w=Math.max(1,m-v),e.graphics.fillRect(r,v,p,w,y-2*k,{fillStyle:f})}}else console.log("No feature list")},e.SegTrack.prototype.computePixelHeight=function(e){var t="SQUISHED"===this.displayMode?this.sampleSquishHeight:this.sampleExpandHeight;for(i=0,len=e.length;i<len;i++)sample=e[i].sample,this.samples.hasOwnProperty(sample)||(this.samples[sample]=this.sampleCount,this.sampleNames.push(sample),this.sampleCount++);return this.sampleCount*t},e.SegTrack.prototype.sortSamples=function(e,t,i,r){var n=this,a="ASC"===r?1:-1;this.featureSource.getFeatures(e,t,i).then((function(e){var r,o,s,h,c,l,u={},d=i-t+1;for(h=0;h<e.length;h++)if(!((r=e[h]).end<t)){if(r.start>i)break;o=Math.max(t,r.start),s=(Math.min(i,r.end)-o)/d,(c=u[r.sample])||(c=0),u[r.sample]=c+s*r.value}for((l=Object.keys(n.samples)).sort((function(e,t){var i=u[e],r=u[t];return i||(i=Number.MAX_VALUE),r||(r=Number.MAX_VALUE),i==r?0:i>r?a:-1*a})),h=0;h<l.length;h++)n.samples[l[h]]=h;n.sampleNames=l,n.trackView.update()})).catch((function(e){console.log(e)}))},e.SegTrack.prototype.altClick=function(e,i,r){var n=i.toBP(2.5);this.sortSamples(i.chrName,e-n,e+n,t),t="ASC"===t?"DESC":"ASC"},e.SegTrack.prototype.popupDataWithConfiguration=function(e){return this.popupData(e.genomicLocation,e.x,e.y,e.viewport.genomicState.referenceFrame)},e.SegTrack.prototype.popupData=function(e,t,i,r){var n,a,o,s="SQUISHED"===this.displayMode?this.sampleSquishHeight:this.sampleExpandHeight;if((a=Math.floor(i/s))<this.sampleNames.length){if(n=this.sampleNames[a],o=[{name:"Sample",value:n}],this.featureSource.featureCache){var h=r.chrName;this.featureSource.featureCache.queryFeatures(h,e,e).forEach((function(e){e.sample===n&&o.push({name:"Value",value:e.value})}))}return o}return null},e.SegTrack.prototype.popupMenuItemList=function(e){var t,i=this;return(t=$("<div>")).text("Sort by value"),[{name:void 0,object:t,click:function(){i.altClick(e.genomicLocation,e.viewport.genomicState.referenceFrame),e.popover.hide()},init:void 0}]},e}((igv=function(e){var t=(Number.MAX_VALUE,0);return e.SegParser=function(){},e.SegParser.prototype.parseHeader=function(e){var t,i,r,n=e.splitLines(),a=n.length;for(i=0;i<a;i++)if(!(t=n[i]).startsWith("#"))return r=t.split("\t"),this.header={headings:r,lineCount:i+1},this.header;return this.header},e.SegParser.prototype.parseFeatures=function(e){var i,r,n,a=e?e.splitLines():[],o=a.length,s=[];for(this.header||(this.header=this.parseHeader(e)),n=this.header.headings.length-1,r=this.header.lineCount;r<o;r++)a[r],(i=a[r].split("\t")).length>n&&s.push({sample:i[t],chr:i[1],start:parseInt(i[2]),end:parseInt(i[3]),value:parseFloat(i[n])});return s},e}((igv=function(e){function t(e){var t={},i=[];return e.forEach((function(e){var n,a;r.has(e.type)&&((n=e.id)?(a=new GFFTranscript(e),t[n]=a,i.push(a)):i.push(e))})),e.forEach((function(e){var r,n;o.has(e.type)&&((r=e.id)&&(void 0===(n=t[r])&&(n=new GFFTranscript(e),t[r]=n,i.push(n)),n.addExon(e)))})),e.forEach((function(e){var r,o;(n.has(e.type)||a.has(e.type))&&((r=e.id)&&(void 0===(o=t[r])&&(o=new GFFTranscript(e),t[r]=o,i.push(o)),a.has(e.type)?o.addUTR(e):o.addCDS(e)))})),i.forEach((function(e){e instanceof GFFTranscript&&e.finish()})),i.sort((function(e,t){return e.start-t.start})),i}function i(e){function t(e){return e.parent&&""!==e.parent.trim()?e.parent.trim().split(","):null}var i,s={},h=[];return e.forEach((function(e){var t,i;r.has(e.type)&&((t=e.id)?(i=new GFFTranscript(e),s[t]=i,h.push(i)):h.push(e))})),e.forEach((function(e){var r;o.has(e.type)&&((i=t(e))?i.forEach((function(t){void 0===(r=s[t])&&(r=new GFFTranscript(e),s[t]=r,h.push(r)),r.addExon(e)})):h.push(e))})),e.forEach((function(e){var r;(n.has(e.type)||a.has(e.type))&&((i=t(e))?i.forEach((function(t){void 0===(r=s[t])&&(r=new GFFTranscript(e),s[t]=r,h.push(r)),a.has(e.type)?r.addUTR(e):r.addCDS(e)})):h.push(e))})),h.forEach((function(e){e instanceof GFFTranscript&&e.finish()})),h.sort((function(e,t){return e.start-t.start})),h}var r,n,a,o;return e.GFFHelper=function(e){this.format=e},e.GFFHelper.prototype.combineFeatures=function(e){return void 0===r&&(r=new Set,n=new Set,a=new Set,o=new Set,r.addAll(["transcript","primary_transcript","processed_transcript","mRNA","mrna"]),n.addAll(["CDS","cds","start_codon","stop_codon"]),a.addAll(["5UTR","3UTR","UTR","five_prime_UTR","three_prime_UTR","3'-UTR","5'-UTR"]),o.addAll(["exon","coding-exon"])),"gff3"===this.format?i.call(this,e):t.call(this,e)},GFFTranscript=function(e){Object.assign(this,e),this.exons=[],this.attributeString=e.attributeString},GFFTranscript.prototype.addExon=function(e){this.exons.push({start:e.start,end:e.end}),this.start=Math.min(this.start,e.start),this.end=Math.max(this.end,e.end)},GFFTranscript.prototype.addCDS=function(e){var t,i,r=this.exons;for(t=0;t<r.length;t++)if(r[t].start<=e.start&&r[t].end>=e.end){i=r[t];break}i?(i.cdStart=i.cdStart?Math.min(e.start,i.cdStart):e.start,i.cdEnd=i.cdEnd?Math.max(e.end,i.cdEnd):e.end):r.push({start:e.start,end:e.end,cdStart:e.start,cdEnd:e.end}),this.start=Math.min(this.start,e.start),this.end=Math.max(this.end,e.end),this.cdStart=this.cdStart?Math.min(e.start,this.cdStart):e.start,this.cdEnd=this.cdEnd?Math.max(e.end,this.cdEnd):e.end},GFFTranscript.prototype.addUTR=function(e){var t,i,r=this.exons;for(t=0;t<r.length;t++)if(r[t].start<=e.start&&r[t].end>=e.end){i=r[t];break}i?e.start===i.start&&e.end===i.end&&(i.utr=!0):r.push({start:e.start,end:e.end,utr:!0}),this.start=Math.min(this.start,e.start),this.end=Math.max(this.end,e.end)},GFFTranscript.prototype.finish=function(){var e=this.cdStart,t=this.cdEnd;this.exons.sort((function(e,t){return e.start-t.start})),e&&this.exons.forEach((function(i){(i.end<e||i.start>t)&&(i.utr=!0)}))},e}((igv=function(e){function t(e,t,i){var r=Math.round((e.start-t)/i),n=Math.round((e.end-t)/i),a=n-r;return a<3&&(a=3,r-=1),{px:r,px1:n,pw:a}}function i(i,n,a,o,s,h){var c,l,u,d,p,f,g,v,m,w,b,y,k,x,S,_=t(i,n,a),C=this.featureHeight,T=this.arrowSpacing,I=this.color;if(this.config.colorBy){var A=i[this.config.colorBy.field];A&&(I=this.config.colorBy.pallete[A])}else i.color&&(I=i.color);if(s.fillStyle=I,s.strokeStyle=I,"SQUISHED"===this.displayMode&&void 0!==i.row?(C=this.featureHeight/2,k=this.expandedCallHeight*i.row+2):k="EXPANDED"===this.displayMode&&void 0!==i.row?this.squishedCallHeight*i.row+5:5,b=(d=k+C/2)-(y=C/2)/2,0===(u=i.exons?i.exons.length:0))s.fillRect(_.px,k,_.pw,C);else{for(e.graphics.strokeLine(s,_.px+1,d,_.px1-1,d),p="+"===i.strand?1:-1,c=_.px+T/2;c<_.px1;c+=T)e.graphics.strokeLine(s,c-2*p,d-2,c,d),e.graphics.strokeLine(s,c-2*p,d+2,c,d);for(l=0;l<u;l++)if(f=i.exons[l],g=Math.round((f.start-n)/a),v=Math.round((f.end-n)/a),w=Math.max(1,v-g),f.utr)s.fillRect(g,b,w,y);else if(f.cdStart&&(m=Math.round((f.cdStart-n)/a),s.fillRect(g,b,m-g,y),w-=m-g,g=m),f.cdEnd&&(m=Math.round((f.cdEnd-n)/a),s.fillRect(m,b,v-m,y),w-=v-m,v=m),s.fillRect(g,k,w,C),w>T+5){for(s.fillStyle="white",s.strokeStyle="white",c=g+T/2;c<v;c+=T)e.graphics.strokeLine(s,c-2*p,d-2,c,d),e.graphics.strokeLine(s,c-2*p,d+2,c,d);s.fillStyle=I,s.strokeStyle=I}}S=(x=Math.round(h.viewportContainerX))+h.viewportContainerWidth/(h.genomicState.locusCount||1),r.call(this,s,i,_.px,_.px1,k,x,S,h.genomicState,h)}function r(t,i,r,n,a,o,s,h,c){var l,u,d,p,f,g,v,m,w=e.FeatureTrack.selectedGene?e.FeatureTrack.selectedGene.toUpperCase():void 0;n<o||r>s?(p=r,f=n):(p=Math.max(r,o),f=Math.min(n,s)),h.selection&&"genes"===this.config.type&&void 0!==i.name&&(l=h.selection.colorForGene(i.name)),m=f-p>t.measureText(i.name).width,(void 0!==i.name&&i.name.toUpperCase()===w||(m||l)&&"SQUISHED"!==this.displayMode&&void 0!==i.name)&&(u={font:"10px PT Sans",textAlign:"center",fillStyle:l||i.color||this.color,strokeStyle:l||i.color||this.color},"COLLAPSED"===this.displayMode&&"SLANT"===this.labelDisplayMode&&(d={rotate:{angle:45}},delete u.textAlign),g=p+(f-p)/2,v=function(e,t){return t?e+20:e+25}(a,d),c.labelTransform?(t.save(),c.labelTransform(t,g),e.graphics.fillText(t,i.name,g,v,u,void 0),t.restore()):e.graphics.fillText(t,i.name,g,v,u,d))}function n(e,i,r,n,a){var o,s=t(e,i,r);switch(e.genotype){case"HOMVAR":o=this.homvarColor;break;case"HETVAR":o=this.hetvarColor;break;default:o=this.color}a.fillStyle=o,a.fillRect(s.px,20,s.pw,10)}function a(e,i,r,n,a){var o=(t(e,i,r),5),s="EXPANDED"===this.displayMode?this.squishedCallHeight:this.expandedCallHeight;("SQUISHED"===this.displayMode&&null!=e.row||"EXPANDED"===this.displayMode&&null!=e.row)&&(o=s*e.row);var h=o+.5*s,c=h-.5*s,l=h+.5*s,u=Math.round((e.junction_left-i)/r),d=Math.round((e.junction_right-i)/r);a.beginPath(),a.moveTo(u,h),a.bezierCurveTo(u,c,d,c,d,h),a.lineWidth=1+Math.log(e.num_junction_reads)/Math.log(2),a.strokeStyle="blue",a.stroke();for(var p=e.spanning_frag_coords,f=0;f<p.length;f++){var g=p[f],v=Math.round((g.left-i)/r),m=Math.round((g.right-i)/r);a.beginPath(),a.moveTo(v,h),a.bezierCurveTo(v,l,m,l,m,h),a.lineWidth=1,a.strokeStyle="purple",a.stroke()}}return e.FeatureTrack=function(t){var r,o,s;e.configTrack(this,t),this.displayMode=t.displayMode||"COLLAPSED",this.labelDisplayMode=t.labelDisplayMode,this.variantHeight=t.variantHeight||this.height,this.squishedCallHeight=t.squishedCallHeight||30,this.expandedCallHeight=t.expandedCallHeight||15,this.featureHeight=t.featureHeight||14,void 0===t.maxRows&&(t.maxRows=500),this.maxRows=t.maxRows,t.url&&(e.filenameOrURLHasSuffix(t.url,".bigbed")||e.filenameOrURLHasSuffix(t.url,".bb")||e.filenameOrURLHasSuffix(t.url,".bigwig")||e.filenameOrURLHasSuffix(t.url,".bw"))?this.featureSource=new e.BWSource(t):this.featureSource=new e.FeatureSource(t),t.render?this.render=t.render:"variant"===t.type?(this.render=n,this.homvarColor="rgb(17,248,254)",this.hetvarColor="rgb(34,12,253)"):"FusionJuncSpan"===t.type?(this.render=a,this.height=t.height||50,this.autoHeight=!1):(this.render=i,this.arrowSpacing=30,r=this,o=function(){r.trackView&&r.trackView.tile&&"SQUISHED"!==r.displayMode&&r.trackView.update()},s=function(t){e.browser.un&&r===t&&(e.browser.un("trackdrag",o),e.browser.un("trackremoved",s))},e.browser.on&&(e.browser.on("trackdragend",o),e.browser.on("trackremoved",s)))},e.FeatureTrack.prototype.getFileHeader=function(){var e=this;return new Promise((function(t,i){"function"==typeof e.featureSource.getFileHeader?e.featureSource.getFileHeader().then((function(i){i&&(i.name&&!e.config.name&&(e.name=i.name),i.color&&!e.config.color&&(e.color="rgb("+i.color+")")),t(i)})).catch((function(e){i(e)})):t(null)}))},e.FeatureTrack.prototype.getFeatures=function(e,t,i,r){var n=this;return new Promise((function(a,o){n.featureSource.getFeatures(e,t,i,r).then(a).catch(o)}))},e.FeatureTrack.prototype.computePixelHeight=function(e){if("COLLAPSED"===this.displayMode)return this.variantHeight;var t=0;return e&&"function"==typeof e.forEach&&e.forEach((function(e){e.row&&e.row>t&&(t=e.row)})),Math.max(this.variantHeight,(t+1)*("SQUISHED"===this.displayMode?this.squishedCallHeight:this.expandedCallHeight))},e.FeatureTrack.prototype.draw=function(t){var i,r,n,a=t.features,o=t.context,s=t.bpPerPixel,h=t.bpStart,c=t.pixelWidth,l=t.pixelHeight,u=h+c*s+1;if(e.graphics.fillRect(o,0,0,c,l,{fillStyle:"rgb(255, 255, 255)"}),a){i=e.FeatureTrack.selectedGene?e.FeatureTrack.selectedGene.toUpperCase():void 0;for(var d,p=0,f=a.length;p<f;p++)if(!((d=a[p]).end<h)){if(d.start>u)break;!r&&i&&i===d.name.toUpperCase()?r=d:this.render.call(this,d,h,s,l,o,t)}r&&(n=r.color,r.color="rgb(255,0,0)",this.render.call(this,r,h,s,l,o,t),r.color=n)}else console.log("No feature list")},e.FeatureTrack.prototype.popupDataWithConfiguration=function(e){return this.popupData(e.genomicLocation,e.x,e.y,e.viewport.genomicState.referenceFrame)},e.FeatureTrack.prototype.popupData=function(t,i,r,n){if(this.featureSource.featureCache){var a,o=n.chrName,s=2*n.bpPerPixel,h=this.featureSource.featureCache.queryFeatures(o,t-s,t+s);if("COLLAPSED"!==this.displayMode&&(a="SQUISHED"===this.displayMode?Math.floor(r/this.squishedCallHeight):Math.floor(r/this.expandedCallHeight)),h&&h.length>0){var c=[];return h.forEach((function(i){var r;i.end>=t-s&&i.start<=t+s&&(void 0===a||void 0===i.row||a===i.row)&&((r=i.popupData?i.popupData(t):function(t){var i=[];for(var r in t)t.hasOwnProperty(r)&&"chr"!==r&&"start"!==r&&"end"!==r&&"row"!==r&&e.isStringOrNumber(t[r])&&i.push({name:r,value:t[r]});return i}(i))&&(c.length>0&&c.push("<HR>"),Array.prototype.push.apply(c,r)))})),c}}return null},e.FeatureTrack.prototype.menuItemList=function(t){function i(e,t,i){var r,n;return r={COLLAPSED:"Collapse",SQUISHED:"Squish",EXPANDED:"Expand"},n=0===t?'<div class="igv-track-menu-border-top">':"<div>",e===i?n+'<i class="fa fa-check fa-check-shim"></i>'+r[e]+"</div>":n+'<i class="fa fa-check fa-check-shim fa-check-hidden"></i>'+r[e]+"</div>"}var r,n=this,a=[];return a.push(e.colorPickerMenuItem(t,this.trackView)),r=_.map(["COLLAPSED","SQUISHED","EXPANDED"],(function(e,r){return{object:$(i(e,r,n.displayMode)),click:function(){t.hide(),n.displayMode=e,n.trackView.update()}}})),a.concat(r)},e}((igv=function(e){function t(t){t.forEach((function(t){t.name&&(e.browser.featureDB[t.name.toUpperCase()]=t)}))}function i(e,t){if(null!=e&&0!==e.length){var i={},r=[];e.forEach((function(e){var t=e.chr,n=i[t];n||(n=[],i[t]=n,r.push(t)),n.push(e)})),r.forEach((function(e){!function(e,t){var i=[];e.sort((function(e,t){return e.start-t.start})),i.push(-1e3),e.forEach((function(e){var r,n=Math.min(i.length,t),a=e.start;for(r=0;r<n;r++)if(a>=i[r])return e.row=r,void(i[r]=e.end);e.row=r,i[r]=e.end}))}(i[e],t)}))}}function r(t){return _.map(t,(function(t){var i;return(i=JSON.parse(JSON.stringify(t))).start=e.browser.genome.getGenomeCoordinate(t.chr,t.start),i.end=e.browser.genome.getGenomeCoordinate(t.chr,t.end),i}))}return e.FeatureSource=function(t){this.config=t||{},this.sourceType=void 0===t.sourceType?"file":t.sourceType,"ga4gh"===t.sourceType?this.reader=new e.Ga4ghVariantReader(t):"immvar"===t.sourceType?this.reader=new e.ImmVarReader(t):"eqtl"===t.type?"gtex-ws"===t.sourceType?this.reader=new e.GtexReader(t):this.reader=new e.GtexFileReader(t):"bigquery"===t.sourceType?this.reader=new e.BigQueryFeatureReader(t):void 0!==t.source?this.reader=new e.CustomServiceReader(t.source):this.reader=new e.FeatureFileReader(t),this.visibilityWindow=t.visibilityWindow},e.FeatureSource.prototype.getFileHeader=function(){var r=this,n=this.config.maxRows||500;return new Promise((function(a,o){r.header?a(r.header):"function"==typeof r.reader.readHeader?r.reader.readHeader().then((function(o){if(o){var s=o.features;s&&("gtf"!==r.config.format&&"gff3"!==r.config.format&&"gff"!==r.config.format||(s=new e.GFFHelper(r.config.format).combineFeatures(s)),i(s,n),r.featureCache=new e.FeatureCache(s),r.config.searchable&&t(s))}o&&o.format&&(r.config.format=o.format),a(o)})).catch(o):a(null)}))},e.FeatureSource.prototype.getFeatures=function(n,a,o,s){var h=this;return new Promise((function(s,c){var l,u,d;if(l=new e.GenomicInterval(n,a,o),u=h.featureCache,d=h.config.maxRows||500,"all"===n.toLowerCase())h.reader.supportsWholeGenome?u&&void 0===u.range?s(r(u.allFeatures())):h.reader.readFeatures(n).then((function(t){t&&"function"==typeof t.forEach&&("gtf"!==h.config.format&&"gff3"!==h.config.format&&"gff"!==h.config.format||(t=new e.GFFHelper(h.config.format).combineFeatures(t)),h.featureCache=new e.FeatureCache(t),i(t,d)),s(r(h.featureCache.allFeatures()))})):s(null);else if(u&&(void 0===u.range||u.range.containsRange(l)))s(h.featureCache.queryFeatures(n,a,o));else{if("file"===h.sourceType&&(void 0===h.visibilityWindow||h.visibilityWindow<=0)){l.start=0;var p=e.browser?e.browser.genome.getChromosome(n):void 0;l.end=void 0===p?Number.MAX_VALUE:p.bpLength}h.reader.readFeatures(n,l.start,l.end).then((function(r){if(r&&"function"==typeof r.forEach){var c=h.reader.indexed||"file"!==h.config.sourceType;"gtf"!==h.config.format&&"gff3"!==h.config.format&&"gff"!==h.config.format||(r=new e.GFFHelper(h.config.format).combineFeatures(r)),h.featureCache=c?new e.FeatureCache(r,l):new e.FeatureCache(r),i(r,d),h.config.searchable&&t(r),s(h.featureCache.queryFeatures(n,a,o))}else s(null)})).catch(c)}}))},e}((igv=function(e){function t(e){var t=e.split(/\s+/);return{format:"fixedStep",chrom:t[1].split("=")[1],start:parseInt(t[2].split("=")[1],10),step:parseInt(t[3].split("=")[1],10),span:t.length>4?parseInt(t[4].split("=")[1],10):1,index:0}}function i(e){var t=e.split(/\s+/);return{format:"variableStep",chrom:t[1].split("=")[1],span:t.length>2?parseInt(t[2].split("=")[1],10):1}}function r(e){var t,i,r,n={},a=e.split(/(?:")([^"]+)(?:")|([^\s"]+)(?=\s+|$)/g),o=[];for(t=1;t<a.length;t++)a[t]&&0!==a[t].trim().length&&((i=a[t].trim()).endsWith("=")>0?r=i:r?(o.push(r+i),r=void 0):o.push(i));return o.forEach((function(e){if(e){var t=e.split("=",2);2==t.length&&(n[t[0]]=t[1])}})),n}function n(t,i){var r,n,a,o,s,h,c,l,u,d,p,f,g,v;if(!(t.length<3)){if(r=t[0],n=parseInt(t[1]),a=t.length>2?parseInt(t[2]):n+1,f={chr:r,start:n,end:a,score:1e3},t.length>3){c=(h=t[3].replace(/"/g,"")).split(";");for(var m=0;m<c.length;m++){var w=c[m].split("=");"gene_id"==w[0]&&(o=w[1]),"gene_name"==w[0]&&(s=w[1])}f.id=o||h,f.name=s||h}if(t.length>4&&(f.score=parseFloat(t[4])),t.length>5&&(f.strand=t[5]),t.length>6&&(f.cdStart=parseInt(t[6])),t.length>7&&(f.cdEnd=parseInt(t[7])),t.length>8&&"."!==t[8]&&"0"!==t[8]&&(f.color=e.createColorString(t[8])),t.length>11){l=parseInt(t[9]),u=t[10].split(","),d=t[11].split(","),p=[];for(m=0;m<l;m++){var b={start:g=n+parseInt(d[m]),end:v=g+parseInt(u[m])};(f.cdStart>v||f.cdEnd<f.cdStart)&&(b.utr=!0),f.cdStart>=g&&f.cdStart<=v&&(b.cdStart=f.cdStart),f.cdEnd>=g&&f.cdEnd<=v&&(b.cdEnd=f.cdEnd),p.push(b)}f.exons=p}return f.popupData=function(){var e=[];return f.name&&e.push({name:"Name",value:f.name}),"+"!==f.strand&&"-"!==f.strand||e.push({name:"Strand",value:f.strand}),e},f}}function a(e,t){var i=void 0===this.shift?0:1;if(!(e.length<9+i)){for(var r={name:e[0+i],chr:e[1+i],strand:e[2+i],start:parseInt(e[3+i]),end:parseInt(e[4+i]),cdStart:parseInt(e[5+i]),cdEnd:parseInt(e[6+i]),id:e[0+i]},n=parseInt(e[7+i]),a=e[8+i].split(","),o=e[9+i].split(","),s=[],h=0;h<n;h++)s.push({start:parseInt(a[h]),end:parseInt(o[h])});return r.exons=s,r.popupData=function(){return[{name:"Name",value:r.name}]},r}}function o(e,t){var i=void 0===this.shift?0:1;if(!(e.length<11+i)){for(var r={name:e[11+i],chr:e[1+i],strand:e[2+i],start:parseInt(e[3+i]),end:parseInt(e[4+i]),cdStart:parseInt(e[5+i]),cdEnd:parseInt(e[6+i]),id:e[0+i]},n=parseInt(e[7+i]),a=e[8+i].split(","),o=e[9+i].split(","),s=[],h=0;h<n;h++)s.push({start:parseInt(a[h]),end:parseInt(o[h])});return r.exons=s,r.popupData=function(){return[{name:"Name",value:r.name}]},r}}function s(e,t){var i=void 0===this.shift?0:1;if(!(e.length<10+i)){for(var r={name:e[0+i],id:e[1+i],chr:e[2+i],strand:e[3+i],start:parseInt(e[4+i]),end:parseInt(e[5+i]),cdStart:parseInt(e[6+i]),cdEnd:parseInt(e[7+i])},n=parseInt(e[8+i]),a=e[9+i].split(","),o=e[10+i].split(","),s=[],h=0;h<n;h++)s.push({start:parseInt(a[h]),end:parseInt(o[h])});return r.exons=s,r.popupData=function(){return[{name:"Name",value:r.name}]},r}}function h(e,t){var i,r,n,a,o,s,h;return e.length<9?null:(i=e[0],r=parseInt(e[1]),n=parseInt(e[2]),o=e[3],s=parseFloat(e[4]),a=e[5].trim(),h=parseFloat(e[6]),0===s&&(s=h),{chr:i,start:r,end:n,name:o,score:s,strand:a,signal:h,pValue:parseFloat(e[7]),qValue:parseFloat(e[8])})}function c(e,t){return e.length<3?null:{chr:e[0],start:parseInt(e[1]),end:parseInt(e[2]),value:parseFloat(e[3])}}function l(e,t){var i,r,n;return"fixedStep"===t.format?(r=(i=t.index*t.step+t.start)+t.span,n=parseFloat(e[0]),++t.index,isNaN(n)?null:{chr:t.chrom,start:i,end:r,value:n}):"variableStep"===t.format?e.length<2?null:(r=(i=parseInt(e[0],10))+t.span,n=parseFloat(e[1]),isNaN(n)?null:{chr:t.chrom,start:i,end:r,value:n}):c(e)}function u(e,t){var i,r,n,a;return e.length<4?null:(i=e[1],r=parseInt(e[2]),n=e.length>3?parseInt(e[3]):r+1,a={chr:i,start:r,end:n},e.length>4&&(a.score=parseFloat(e[4]),a.value=a.score),a.popupData=function(){return[{name:"Name",value:a.name}]},a)}function d(e,t){var i=e[0],r=e[1],n=parseInt(e[2]),a=parseInt(e[3]),o=parseInt(e[4]),s=parseInt(e[5]),h=e[6],c={chr:i,name:r,junction_left:n,junction_right:a,num_junction_reads:o,num_spanning_frags:s,spanning_frag_coords:[],start:-1,end:-1},l=n,u=a;if(s>0)for(var d=h.split(","),p=0;p<d.length;p++){var f=d[p].split("-"),g=f[0],v=f[1];g<l&&(l=g),v>u&&(u=v),c.spanning_frag_coords.push({left:g,right:v})}return c.start=l,c.end=u,c.popupData=function(){return[{name:"Name",value:c.name}]},c}function p(e,t){return e.length<8?null:{chr:e[0],start:parseInt(e[1])-1,end:parseInt(e[3].split(":")[1]),pvalue:parseFloat(e[5])}}function f(t,i){var r,n,a,o,s,h,c,l,u,d,p,f,g=this.format;if(t.length<9)return null;r=t[0],s=t[2],n=parseInt(t[3])-1,a=parseInt(t[4]),h="."===t[5]?0:parseFloat(t[5]),o=t[6],"."===t[7]||parseInt(t[7]),c=t[8];var v="gff3"===g?"=":/\s+/,w={};if(c.split(";").forEach((function(t){var i,r,n=t.trim().split(v,2);2==n.length&&(i=n[0].trim(),(r=n[1].trim()).startsWith('"')&&r.endsWith('"')&&(r=r.substr(1,r.length-2)),"ID"===n[0]?l=n[1]:"Parent"===n[0]?u=n[1]:"color"===n[0].toLowerCase()?d=e.createColorString(n[1]):"transcript_id"===n[0]&&(l=n[1]),w[i]=r)})),this.nameField)p=w[this.nameField];else for(f=0;f<m.length;f++)if(w.hasOwnProperty(m[f])){this.nameField=m[f],p=w[this.nameField];break}return{id:l,parent:u,name:p,type:s,chr:r,start:n,end:a,score:h,strand:o,color:d,attributeString:c,popupData:function(){var e,t,i=this.attributeString.split(";"),r=[];return i.forEach((function(i){var n=i.trim().split(v,2);2===n.length&&void 0!==n[1]&&(e=n[0].trim(),(t=n[1].trim()).startsWith('"')&&t.endsWith('"')&&(t=t.substr(1,t.length-2)),r.push({name:e,value:t}))})),r}}}function g(e,t){var i,r,n,a,o=this.format,s=o.coords||0;return e.length<3?null:(r=e[o.chr],n=parseInt(e[o.start])-s,a=void 0!==o.end?parseInt(e[o.end]):n+1,i={chr:r,start:n,end:a},o.fields&&o.fields.forEach((function(t,r){r!=o.chr&&r!=o.start&&r!=o.end&&(i[t]=e[r])})),i)}var v=Number.MAX_VALUE,m=["Name","gene_name","gene","gene_id","alias","locus"];return e.FeatureParser=function(t,i,r){var v;switch(void 0!==t&&(this.format=t.toLowerCase()),this.nameField=r?r.nameField:void 0,this.skipRows=0,i&&(this.decode=i),this.format){case"narrowpeak":case"broadpeak":case"peaks":this.decode=h,this.delimiter=/\s+/;break;case"bedgraph":this.decode=c,this.delimiter=/\s+/;break;case"wig":this.decode=l,this.delimiter=/\s+/;break;case"gff3":case"gff":case"gtf":this.decode=f,this.delimiter="\t";break;case"aneu":this.decode=u,this.delimiter="\t";break;case"fusionjuncspan":this.decode=d,this.delimiter=/\s+/;break;case"gtexgwas":this.skipRows=1,this.decode=p,this.delimiter="\t";break;case"refflat":this.decode=s,this.delimiter=/\s+/;break;case"genepred":this.decode=a,this.delimiter=/\s+/;break;case"genepredext":this.decode=o,this.delimiter=/\s+/;break;case"refgene":this.decode=o,this.delimiter=/\s+/,this.shift=1;break;case"bed":this.decode=n,this.delimiter=r.delimiter||/\s+/;default:void 0!==(v=e.getFormat(t))?(this.decode=g,this.format=v,this.delimiter=v.delimiter||"\t"):(this.decode=n,this.delimiter=/\s+/)}},e.FeatureParser.prototype.parseHeader=function(e){var t,i,n,a=e.splitLines(),o=a.length;for(i=0;i<o&&((t=a[i]).startsWith("track")||t.startsWith("#")||t.startsWith("browser"));i++)t.startsWith("track")?n=r(t):t.startsWith("##gff-version 3")&&(this.format="gff3",n||(n={}),n.format="gff3");return n},e.FeatureParser.prototype.parseFeatures=function(e){if(!e)return null;var r,n,a,o,s,h,c=e.splitLines(),l=c.length,u=[],d=0,p=this.decode,f=this.format,g=this.delimiter||"\t";for(s=this.skipRows;s<l;s++)(o=c[s]).startsWith("track")||o.startsWith("#")||o.startsWith("browser")||("wig"===f&&o.startsWith("fixedStep")?r=t(o):"wig"===f&&o.startsWith("variableStep")?r=i(o):(a=c[s].split(g)).length<1||(n=p.call(this,a,r))&&(u.length<v?u.push(n):(h=Math.floor(Math.random()*d))<v&&(u[h]=n),d++));return u},e}((igv=function(e){return e.FeatureFileReader=function(t){var i;this.config=t||{},e.isFilePath(this.config.url)?this.filename=this.config.url.name:(i=e.parseUri(this.config.url),this.filename=i.file,this.path=i.path),this.format=this.config.format,this.parser=this.getParser(this.format,this.config.decode),this.supportsWholeGenome="seg"===this.format},e.FeatureFileReader.prototype.readFeatures=function(e,t,i){var r=this;return new Promise((function(n,a){function o(e){n(e)}r.index?r.loadFeaturesWithIndex(e,t,i).then(o).catch(a):r.loadFeaturesNoIndex().then(o).catch(a)}))},e.FeatureFileReader.prototype.readHeader=function(){var t=this;return new Promise((function(i,r){t.header?i(t.header):t.getIndex().then((function(n){var a,o;n?(a=e.buildOptions(t.config,{bgz:n.tabix,range:{start:0,size:65e3}}),o=function(e){t.header=t.parser.parseHeader(e),i(t.header)},igvxhr.loadString(t.config.url,a).then(o).catch((function(e){r(e)}))):t.loadFeaturesNoIndex().then((function(e){var r=t.header||{};r.features=e,i(r)})).catch((function(e){r(e)}))})).catch((function(e){r(e)}))}))},e.FeatureFileReader.prototype.getParser=function(t,i){switch(t){case"vcf":return new e.VcfParser;case"seg":return new e.SegParser;default:return new e.FeatureParser(t,i,this.config)}},e.FeatureFileReader.prototype.isIndexable=function(){var e,t;return e=void 0!==this.config.indexURL,t="wig"!==this.format&&"seg"!==this.format,!1!==this.config.indexed&&(e||t)},e.FeatureFileReader.prototype.loadIndex=function(){var t=this.config.indexURL;return this.filename.endsWith(".gz")?(t||(t=this.config.url+".tbi"),e.loadBamIndex(t,this.config,!0)):(t||(t=this.config.url+".idx"),e.loadTribbleIndex(t,this.config))},e.FeatureFileReader.prototype.loadFeaturesNoIndex=function(){var t=this;return new Promise((function(i,r){function n(e){t.config.json?i(e):(t.header=t.parser.parseHeader(e),t.header instanceof String&&t.header.startsWith("##gff-version 3")&&(t.format="gff3"),i(t.parser.parseFeatures(e)))}var a=e.buildOptions(t.config,{method:t.config.method,sendData:t.config.sendData,json:t.config.json,contentType:t.config.contentType});t.config.json?igvxhr.loadJson(t.config.url,a).then(n).catch(r):igvxhr.loadString(t.config.url,a).then(n).catch(r)}))},e.FeatureFileReader.prototype.loadFeaturesWithIndex=function(t,i,r){var n=this;return new Promise((function(a,o){var s,h=n.index&&n.index.tabix?n.index.sequenceIndexMap[t]:t,c=[];(s=n.index.blocksForRange(h,i,r))&&0!==s.length?(s.forEach((function(t){c.push(new Promise((function(a,o){var s,h,c,l=t.minv.block,u=t.minv.offset;s=s=t.maxv.block+65536,h=e.buildOptions(n.config,{range:{start:l,size:s-l+1}}),c=function(t){var o,s,h,c,l,d;for(o=n.index.tabix?igvxhr.arrayBufferToString(e.unbgzf(t)):t,s=u?o.slice(u):o,h=n.parser.parseFeatures(s),c=[],d=0;d<h.length&&!((l=h[d]).start>r);d++)l.end>=i&&l.start<=r&&c.push(l);a(c)},n.index.tabix?igvxhr.loadArrayBuffer(n.config.url,h).then(c).catch(o):igvxhr.loadString(n.config.url,h).then(c).catch(o)})))})),Promise.all(c).then((function(e){var t,i;if(1===e.length)i=e[0];else{for(i=e[0],t=1;t<e.length;t++)i=i.concat(e[t]);i.sort((function(e,t){return e.start-t.start}))}a(i)})).catch(o)):a(null)}))},e.FeatureFileReader.prototype.getIndex=function(){var e=this;return void 0!==e.index||!1===e.config.indexed?Promise.resolve(e.index):new Promise((function(t,i){e.isIndexable()?e.loadIndex().then((function(i){i?(e.index=i,e.indexed=!0):e.indexed=!1,t(e.index)})).catch((function(r){e.indexed=!1,"404"===r.message&&void 0===e.config.indexURL?t(void 0):i(r)})):(e.indexed=!1,t(void 0))}))},e}((igv=function(e){function t(t){var i,r,n,a,o,s,h,c;for(o=new e.IntervalTree,h=t.length,s=Math.max(10,Math.round(h/100)),t.sort((function(e,t){return e.start===t.start?0:e.start>t.start?1:-1})),i=0;i<h;i+=s)r=Math.min(h,i+s),n=(c=t.slice(i,r))[0].start,a=n,c.forEach((function(e){a=Math.max(a,e.end)})),o.insert(n,a,c);return o}return e.FeatureCache=function(r,n){this.treeMap=function(r){var n={},a=[],o={},s=e.browser?e.browser.genome:null;if(r)for(r.forEach((function(e){var t,i=e.chr;s&&(i=s.getChromosomeName(i)),(t=n[i])||(a.push(i),t=[],n[i]=t),t.push(e)})),i=0;i<a.length;i++)chr=a[i],o[chr]=t(n[chr]);return o}(r),this.range=n},e.FeatureCache.prototype.queryFeatures=function(e,t,i){var r,n,a,o,s,h,c;return(h=this.treeMap[e])?0==(c=h.findOverlapping(t,i)).length?[]:(r=[],c.forEach((function(e){for(n=e.value,o=n.length,s=0;s<o&&!((a=n[s]).start>i);s++)a.end>=t&&r.push(a)})),r):[]},e.FeatureCache.prototype.allFeatures=function(){var e=[],t=this.treeMap;if(t)for(var i in t)if(t.hasOwnProperty(i)){t[i].mapIntervals((function(t){e=e.concat(t.value)}))}return e},e}((igv=function(e){return e.CustomServiceReader=function(e){this.config=e,this.supportsWholeGenome=!0},e.CustomServiceReader.prototype.readFeatures=function(e,t,i){var r=this;return new Promise((function(t,i){var n=r.config.url;void 0!==r.config.body&&"all"!==e&&(r.config.body=r.config.body.replace("$CHR",e)),igvxhr.load(n,r.config).then((function(e){if(e){var i="function"==typeof r.config.parser?r.config.parser(e):e;t(i)}else t(null)})).catch((function(e){i(e)}))}))},e}((igv=function(e){function t(){var t=this;return new Promise((function(i,n){var a,o;t.featureSourceRed?i():(a=function(n){n=JSON.parse(n),r("Got json: "+n+", diff :"+n.diff),t.featureSource=new e.AneuFeatureSource(config,n.diff),t.featureSourceRed=new e.AneuFeatureSource(config,n.redline),i()},o=e.buildOptions(t.config,{tokens:t.config.tokens}),igvxhr.loadString(t.config.url,o).then(a))}))}var r=function(e){},n="ASC";return e.AneuTrack=function(t){e.configTrack(this,t),this.maxHeight=t.maxHeight-2||500,this.sampleSquishHeight=t.sampleSquishHeight||20,this.sampleExpandHeight=t.sampleExpandHeight||125,this.sampleHeight=this.sampleExpandHeight,this.highColor=t.highColor||"rgb(30,30,255)",this.lowColor=t.lowColor||"rgb(220,0,0)",this.midColor=t.midColor||"rgb(150,150,150)",this.posColorScale=t.posColorScale||new e.GradientColorScale({low:.1,lowR:255,lowG:255,lowB:255,high:1.5,highR:255,highG:0,highB:0}),this.negColorScale=t.negColorScale||new e.GradientColorScale({low:-1.5,lowR:0,lowG:0,lowB:255,high:-.1,highR:255,highG:255,highB:255}),this.sampleCount=0,this.samples={},this.sampleNames=[],r("AneuTrack: config: "+JSON.stringify(t)),this.config=t},e.AneuTrack.prototype.getSummary=function(e,t,n,a){this.featureSourceRed?this.featureSourceRed.getFeatures(e,t,n,(function(e){var t=[];for(i=0,len=e.length;i<len;i++){var r=e[i];Math.abs(r.score-2)>.5&&r.end-r.start>5e6&&t.push(r)}a(t)})):(r("Aneu track has no summary data yet"),a(null))},e.AneuTrack.prototype.loadSummary=function(t,i,r,n){var a=this;if(!this.featureSourceRed){return afterload=e.buildOptions(a.config,{tokens:a.config.tokens,success:function(o){o&&(o=JSON.parse(o),a.featureSourceRed=new e.AneuFeatureSource(config,o.redline),a.getSummary(t,i,r,n))}}),igvxhr.loadString(a.config.url,afterload),null}this.featureSourceRed.getFeatures(t,i,r,n)},e.AneuTrack.prototype.getFeatures=function(e,i,r){var n=this;return new Promise((function(a,o){t.call(n).then((function(){n.featureSourceRed.getFeatures(e,i,r,(function(t){n.redlinedata=t,n.featureSource.getFeatures(e,i,r,a)}))}))}))},e.AneuTrack.prototype.getColor=function(e){return color=e<2?this.lowColor:e>2?this.highColor:this.midColor,color},e.AneuTrack.prototype.paintAxis=function(t,i,r){function n(e,t,i,r){return r-Math.round((i-e)/t*r)}var a=this,o=(a.maxLogP,a.minLogP,{font:"normal 10px Arial",textAlign:"right",strokeStyle:"black"});e.graphics.fillRect(t,0,0,i,r,{fillStyle:"rgb(255, 255, 255)"});var s=a.max;s||(s=8);var h=49;e.graphics.strokeLine(t,h,n(0,s,0,a.maxheight),h,n(0,s,s,a.maxheight),o),h-=5;for(var c=0;c<=s;c+=1){var l=n(0,s,c,a.maxheight);e.graphics.strokeLine(t,h,l,h+5,l,o),c>0&&c<s&&e.graphics.fillText(t,c,h-4,l+3,o)}o.textAlign="center",e.graphics.fillText(t,"ploidy",h-15,r/2,o,{rotate:{angle:-90}})},e.AneuTrack.prototype.draw=function(t){function i(e,t,i,r){return r-Math.round((i-e)/t*r)}var n,a,o,s,h,c,l,u,d,p,f,g,v,m,w,b,y,k=this;n=t.context,s=t.pixelWidth,h=t.pixelHeight;var x=4,S=0;e.graphics.fillRect(n,0,0,s,h,{fillStyle:"rgb(255, 255, 255)"});var _=this;window.track=_;var C=function(e){for(p=0,u=e.length;p<u;p++){d=e[p].sample;var t=e[p].value;t>x&&(x=t),t<S&&(S=t)}x>10&&(x=10),S=Math.max(S,0),_.max=x},T=function(n,h,u){for(a=t.bpPerPixel,o=t.bpStart,c=o+s*a+1,y=a,p=0,T=h.length;p<T;p++)(d=h[p].sample)&&this.samples&&this.samples.hasOwnProperty(d)&&(this.samples[d]=k.sampleCount,this.sampleNames.push(d),this.sampleCount++);!function(e){var t;if(void 0===k.isLog)for(k.isLog=!1,t=0;t<e.length;t++)if(e[t].value<0)return void(k.isLog=!0)}(h);var _=2;k.isLog&&(S=0,_=0);var C=k.height-4;k.maxheight=C;var T=h.length;for(p=0;p<T;p++)if(!((l=h[p]).end<o)){if(l.start>c)break;if(l.sample?(f=k.samples[l.sample]*k.sampleHeight,r("Got sample y="+f)):f=0,v=l.score,g=k.midColor,k.isLog?(v=Math.log2(v/2))<_-.1?g=k.negColorScale.getColor(v):v>_+.1&&(g=k.posColorScale.getColor(v)):v<_-.2?g=k.lowColor:v>_+.2&&(g=k.highColor),m=Math.round((l.start-o)/y),w=Math.round((l.end-o)/y),b=Math.max(2,w-m),v<=x){var I=i(S,x,v,C);1==u&&r("       Got value "+v+", h="+I+", y+h="+(f+I)+", px="+m+", px1="+w+", pw="+b+", color="+g+", maxh="+C),e.graphics.fillRect(n,m,f+I,b,2,{fillStyle:g})}}},I=k.height-4,A={font:"normal 10px Arial",textAlign:"right",strokeStyle:"rgb(150,150,150)",fillStyle:"rgb(150,150,150)"};if(t.features&&C(t.features),this.redlinedata&&C(this.redlinedata),S<2&&2<x){var P=i(S,x,2,I);console.log("drawing dashed line and solid line at "+P+" to "+s),e.graphics.dashedLine(n,20,P,s,P,4,A);var R=i(S,x,0,I);e.graphics.strokeLine(n,20,R,s,R,A)}else r("NOT drawing line at 2");t.features?T(n,t.features,!1):console.log("No diff feature list. options="+JSON.stringify(t)),this.redlinedata?T(n,this.redlinedata,!1):console.log("No redline feature list")},e.AneuTrack.prototype.computePixelHeight=function(e){for(i=0,len=e.length;i<len;i++)sample=e[i].sample,this.samples&&!this.samples.hasOwnProperty(sample)&&(this.samples[sample]=this.sampleCount,this.sampleNames.push(sample),this.sampleCount++);this.sampleCount=Math.max(1,this.sampleCount);var t=Math.max(30,this.sampleCount*this.sampleHeight);return this.height=t,t},e.AneuTrack.prototype.sortSamples=function(e,t,i,r,n){var a,o,s,h,c,l,u,d=this,p=i-t,f={};this.featureSource.getFeatures(e,t,i,(function(e){for(c=0,p=e.length;c<p;c++)if(!((a=e[c]).end<t)){if(a.start>i)break;o=Math.max(t,a.start),s=Math.min(i,a.end),h=(s-o)/p,(l=f[a.sample])||(l=0),f[a.sample]=l+h*a.value}for((u=Object.keys(d.samples)).sort((function(e,t){var i=f[e],n=f[t];return i||(i=Number.MAX_VALUE),n||(n=Number.MAX_VALUE),i==n?0:i>n?r:-1*r})),c=0;c<u.length;c++)d.samples[u[c]]=c;d.sampleNames=u,n()}))},e.AneuTrack.prototype.altClick=function(e,t,i){var r=t.toBP(2.5);this.sortSamples(t.chr,e-r,e+r,n),n="ASC"===n?"DESC":"ASC"},e.AneuTrack.prototype.popupDataWithConfiguration=function(e){return this.popupData(e.genomicLocation,e.x,e.y,e.viewport.genomicState.referenceFrame)},e.AneuTrack.prototype.popupData=function(e,t,i,n){var a,o,s=Math.floor(i/this.sampleHeight);if(r("popupData for row "+s+", sampleNames="+JSON.stringify(this.sampleNames)),s<this.sampleNames.length){if(a=this.sampleNames[s],o=a?[{name:"Sample",value:a}]:[],this.featureSource.featureCache){var h=n.chrName;this.featureSource.featureCache.queryFeatures(h,e,e).forEach((function(e){e.sample===a&&(o.push({name:"Value",value:e.value}),o.push({name:"Start",value:e.start}),o.push({name:"End",value:e.end}))}))}if(this.featureSourceRed.featureCache){h=n.chrName;this.featureSourceRed.featureCache.queryFeatures(h,e,e).forEach((function(e){e.sample===a&&(o.push({name:"Value",value:e.value}),o.push({name:"Start",value:e.start}),o.push({name:"End",value:e.end}))}))}return o}return null},e}((igv=function(e){return e.AneuFeatureSource=function(t,i){function r(e){var t;return t=e.lastIndexOf("/"),e.substring(0,t+1)}var n;this.config=t||{},e.isFilePath(this.config.url)?this.filename=r(this.config.url.name)+i:(this.config.url=r(this.config.url)+i,this.filename=i,this.headURL=this.config.headURL||i),this.parser=(n="aneu",new e.FeatureParser(n))},e.AneuFeatureSource.prototype.getFeatures=function(t,i,r,n){var a=this,o=new e.GenomicInterval(t,i,r),s=this.featureCache;if(s&&(void 0===s.range||s.range.containsRange(o))){var h=this.featureCache.queryFeatures(t,i,r);n(h)}else this.loadFeatures((function(o){a.featureCache=new e.FeatureCache(o);var s=a.featureCache.queryFeatures(t,i,r);n(s)}),o)},e.AneuFeatureSource.prototype.getFeatureCache=function(t){var i=this;this.featureCache?t(this.featureCache):this.loadFeatures((function(r){i.featureCache=new e.FeatureCache(r),t(i.featureCache)}))},e.AneuFeatureSource.prototype.loadFeatures=function(t,i){var r,n,a,o=this;r=e.buildOptions(o.config,{tokens:o.config.tokensc}),n=function(e){o.header=o.parser.parseHeader(e),a=o.parser.parseFeatures(e),t(a)},igvxhr.loadString(o.config.url,r).then(n)},e}((igv=function(e){function t(t,i,r){var n=this;return new Promise((function(a,o){function s(e,t,i){var r=t-e.start,n=i-t;return e.features?e.features.substr(r,n):null}var h=n.interval;if(h&&h.contains(t,i,r))a(s(h,i,r));else{var c=i,l=r;if(r-i<1e5){var u=r-i,d=Math.round(i+u/2);c=Math.max(0,d-5e4),l=d+5e4}n.readSequence(t,c,l).then((function(o){n.interval=new e.GenomicInterval(t,c,l,o),a(s(n.interval,i,r))})).catch(o)}}))}function i(e,t,i){var r=this;return new Promise((function(n,a){var o=r.sequences[e];o&&o.length>i&&n(o.substring(t,i))}))}var r=new Set(["fastaURL","indexURL","cytobandURL","indexed"]);return e.FastaSequence=function(e){this.file=e.fastaURL,this.indexed=!1!==e.indexed,this.indexed&&(this.indexFile=e.indexURL||e.indexFile||this.file+".fai"),this.withCredentials=e.withCredentials,this.config=function(e){var t,i={};for(t in e)e.hasOwnProperty(t)&&!r.has(t)&&(i[t]=e[t]);return i}(e)},e.FastaSequence.prototype.init=function(){var t=this;return t.indexed?new Promise((function(i,r){t.getIndex().then((function(r){var n=0;t.chromosomes={},t.chromosomeNames.forEach((function(i){var r=t.index[i].size;t.chromosomes[i]=new e.Chromosome(i,n++,r)})),i()})).catch(r)})):t.loadAll()},e.FastaSequence.prototype.getSequence=function(e,r,n){return this.indexed?t.call(this,e,r,n):i.call(this,e,r,n)},e.FastaSequence.prototype.getIndex=function(){var t=this;return new Promise((function(i,r){t.index?i(t.index):igvxhr.load(t.indexFile,e.buildOptions(t.config)).then((function(e){var r=e.splitLines(),n=r.length,a=0;for(t.chromosomeNames=[],t.index={};a<n;){var o=r[a++].split("\t");if(5==o.length){var s=o[0],h={size:parseInt(o[1]),position:parseInt(o[2]),basesPerLine:parseInt(o[3]),bytesPerLine:parseInt(o[4])};t.chromosomeNames.push(s),t.index[s]=h}}i&&i(t.index)})).catch(r)}))},e.FastaSequence.prototype.loadAll=function(){var t=this;return new Promise((function(i,r){t.chromosomeNames=[],t.chromosomes={},t.sequences={},igvxhr.load(t.file,e.buildOptions(t.config)).then((function(r){for(var n,a,o=r.splitLines(),s=o.length,h=0,c="",l=0;h<s;)(n=o[h++].trim()).startsWith("#")||0===n.length||(n.startsWith(">")?(c&&(t.chromosomeNames.push(a),t.sequences[a]=c,t.chromosomes[a]=new e.Chromosome(a,l++,c.length)),a=n.substr(1).split("\\s+")[0],c=""):c+=n);i()})).catch(r)}))},e.FastaSequence.prototype.readSequence=function(t,i,r){var n=this;return new Promise((function(a,o){n.getIndex().then((function(){var s=n.index[t];if(s){var h=Math.max(0,i),c=Math.min(s.size,r),l=s.bytesPerLine,u=s.basesPerLine,d=s.position,p=l-u,f=Math.floor(h/u),g=Math.floor(c/u),v=h-f*u,m=d+f*l+v,w=d+g*l+(c-g*u)-1-m+1;w<=0&&a(null),igvxhr.load(n.file,e.buildOptions(n.config,{range:{start:m,size:w}})).then((function(e){var t,i="",r=0,n=e.length;for(v>0&&(t=Math.min(c-h,u-v),i+=e.substr(r,t),r+=t+p,t);r<n;)t=Math.min(u,n-r),i+=e.substr(r,t),r+=t+p,t;a(i)})).catch(o)}else console.log("No index entry for chr: "+t),n.interval=new e.GenomicInterval(t,i,r,null),a(null)})).catch(o)}))},e}(igv||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{});CanvasRenderingContext2D.prototype.strokeLine=function(e,t,i,r,n){this.save(),this.beginPath(),n&&(this.lineWidth=n),this.moveTo(e,t),this.lineTo(i,r),this.stroke(),this.restore()},CanvasRenderingContext2D.prototype.drawArrowhead=function(e,t,i,r){this.save(),i||(i=5),r&&(this.lineWidth=r),this.beginPath(),this.moveTo(e,t-i/2),this.lineTo(e,t+i/2),this.lineTo(e+i,t),this.lineTo(e,t-i/2),this.closePath(),this.fill(),this.restore()},CanvasRenderingContext2D.prototype.roundRect=function(e,t,i,r,n,a,o){this.save(),void 0===o&&(o=!0),void 0===n&&(n=5),this.beginPath(),this.moveTo(e+n,t),this.lineTo(e+i-n,t),this.quadraticCurveTo(e+i,t,e+i,t+n),this.lineTo(e+i,t+r-n),this.quadraticCurveTo(e+i,t+r,e+i-n,t+r),this.lineTo(e+n,t+r),this.quadraticCurveTo(e,t+r,e,t+r-n),this.lineTo(e,t+n),this.quadraticCurveTo(e,t,e+n,t),this.closePath(),o&&this.stroke(),a&&this.fill(),this.restore()},CanvasRenderingContext2D.prototype.polygon=function(e,t,i,r){this.save(),void 0===r&&(r=!0),this.beginPath();var n=e.length;this.moveTo(e[0],t[0]);for(var a=1;a<n;a++)this.lineTo(e[a],t[a]);this.closePath(),r&&this.stroke(),i&&this.fill(),this.restore()},CanvasRenderingContext2D.prototype.eqTriangle=function(e,t,i){this.save();var r=e*(Math.sqrt(3)/2);this.beginPath(),this.moveTo(t,i-r/2),this.lineTo(t-e/2,i+r/2),this.lineTo(t+e/2,i+r/2),this.lineTo(t,i-r/2),this.closePath(),this.stroke(),this.fill(),this.restore()},void 0===String.prototype.startsWith&&(String.prototype.startsWith=function(e){return!(this.length<e.length)&&this.substr(0,e.length)==e}),void 0===String.prototype.endsWith&&(String.prototype.endsWith=function(e){return!(this.length<e.length)&&this.substr(this.length-e.length,e.length)==e}),void 0===String.prototype.includes&&(String.prototype.includes=function(e){return-1!=this.indexOf(e)}),void 0===String.prototype.splitLines&&Object.defineProperty(String.prototype,"splitLines",{value:function(){return this.split(/\r\n|\n|\r/gm)},enumerable:!1,configurable:!1}),void 0===Uint8Array.prototype.toText&&(Uint8Array.prototype.toText=function(){var e,t,i;for(i="",e=0,t=this.byteLength;e<t;e++)i+=String.fromCharCode(this[e]);return i});var log2=Math.log(2);void 0===Math.log2&&(Math.log2=function(e){return Math.log(e)/log2}),void 0===Function.prototype.bind&&(Function.prototype.bind=function(){var e=this,t=Array.prototype.slice.call(arguments),i=t.shift();return function(){return e.apply(i,t.concat(Array.prototype.slice.call(arguments)))}}),Date.now||(Date.now=function(){return(new Date).getTime()}),Object.keys||(Object.keys=function(){"use strict";var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),i=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=i.length;return function(n){if("object"!=typeof n&&("function"!=typeof n||null===n))throw new TypeError("Object.keys called on non-object");var a,o,s=[];for(a in n)e.call(n,a)&&s.push(a);if(t)for(o=0;o<r;o++)e.call(n,i[o])&&s.push(i[o]);return s}}()),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});igv=function(e){return e.getExtension=function(t){var i,r;if(void 0!==t.url)return(r=(i=(e.isFilePath(t.url)?t.url.name:t.url).toLowerCase()).indexOf("?"))>0&&(i=i.substr(0,r)),i.endsWith(".gz")?i=i.substr(0,i.length-3):(i.endsWith(".txt")||i.endsWith(".tab"))&&(i=i.substr(0,i.length-4)),(r=i.lastIndexOf("."))<0?i:i.substr(1+r)},e.geneNameLookupPathTemplate=function(e){return"https://portals.broadinstitute.org/webservices/igv/locus?genome="+e+"&name=$FEATURE$"},e.geneNameLookupServicePromise=function(t,i){var r;return r=e.geneNameLookupPathTemplate(i).replace("$FEATURE$",t),igvxhr.loadString(r)},e.filenameOrURLHasSuffix=function(e,t){return(e instanceof File?e.name:e).toLowerCase().endsWith(t)},e.isFilePath=function(e){return e instanceof File},e.makeToggleButton=function(t,i,r,n,a){function o(e,t,i,r){e.removeClass("igv-nav-bar-toggle-button-on"),e.removeClass("igv-nav-bar-toggle-button-off"),!0===t?(e.addClass("igv-nav-bar-toggle-button-off"),e.text(r),a&&a()):(e.addClass("igv-nav-bar-toggle-button-on"),e.text(i))}var s=$('<div class="igv-nav-bar-toggle-button">');return o(s,!0===e.browser.config[r],t,i),s.click((function(){var a=n();e.browser.config[r]=!e.browser.config[r],a.toggle(),o($(this),a.is(":visible"),t,i)})),s},e.presentAlert=function(t){e.alert.$dialogLabel.text(t),e.alert.show(void 0),e.popover.hide()},e.attachDialogCloseHandlerWithParent=function(e,t){var i=$("<div>"),r=$('<i class="fa fa-times">');i.append(r),e.append(i),r.hover((function(){r.removeClass("fa-times"),r.addClass("fa-times-circle"),r.css({color:"#222"})}),(function(){r.removeClass("fa-times-circle"),r.addClass("fa-times"),r.css({color:"#444"})})),r.click(t)},e.spinner=function(e){var t,i;return i=$('<i class="fa fa-spinner fa-spin">'),e&&i.css("font-size",e),(t=$('<div class="igv-spinner-container">')).append(i[0]),t[0]},e.getSpinnerObjectWithParentElement=function(e){return $(e).find("div.igv-spinner-container")},e.startSpinnerAtParentElement=function(t){var i=e.getSpinnerObjectWithParentElement(t);i&&i.show()},e.stopSpinnerAtParentElement=function(t){var i=e.getSpinnerObjectWithParentElement(t);i&&i.hide()},e.parseUri=function(t){for(var i=e.parseUri.options,r=i.parser[i.strictMode?"strict":"loose"].exec(t),n={},a=14;a--;)n[i.key[a]]=r[a]||"";return n[i.q.name]={},n[i.key[12]].replace(i.q.parser,(function(e,t,r){t&&(n[i.q.name][t]=r)})),n},e.parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},e.domElementRectAsString=function(e){return" x "+e.clientLeft+" y "+e.clientTop+" w "+e.clientWidth+" h "+e.clientHeight},e.isNumber=function(e){return""!==e&&void 0!==e&&!isNaN(parseFloat(e))&&isFinite(e)},e.guid=function(){return("0000"+(Math.random()*Math.pow(36,4)<<0).toString(36)).slice(-4)},e.random=function(e,t){return Math.random()*(t-e)+e},e.prettyBasePairNumber=function(t){var i,r,n;return t>1e7?(i=" mb",r=t/1e6,(n=Math.floor(r)).toString()+i):t>1e4?(i=" kb",r=t/1e3,n=Math.floor(r),e.numberFormatter(n)+i):e.numberFormatter(t)+" bp"},e.numberFormatter=function(e){var t=String(e).split(/[.,]/);return t[0].split("").reverse().reduce((function(e,t,i){return i%3==0?e+","+t:e+t})).split("").reverse().join("")+(t[1]?"."+t[1]:"")},e.numberUnFormatter=function(e){return e.split(",").join().replace(",","","g")},e.translateMouseCoordinates=function(e,t){var i,r=$(t);return i=$.event.fix(e),void 0===r.offset()&&console.log("igv.translateMouseCoordinates - $target.offset() is undefined."),{x:i.pageX-r.offset().left,y:i.pageY-r.offset().top}},e.formatPopoverText=function(e){var t='<table class="igv-popover-table">';return e.forEach((function(e){t+=e.name?'<tr><td class="igv-popover-td"><div class="igv-popover-name-value"><span class="igv-popover-name">'+e.name+'</span><span class="igv-popover-value">'+e.value+"</span></div></td></tr>":"<tr><td>"+e.toString()+"</td></tr>"})),t+="</table>"},e.throttle=function(e,t,i){var r,n;return t||(t=200),function(){var a=i||this,o=+new Date,s=arguments;r&&o<r+t?(clearTimeout(n),n=setTimeout((function(){r=o,e.apply(a,s)}),t)):(r=o,e.apply(a,s))}},e.splitStringRespectingQuotes=function(e,t){var i,r,n=[],a=e.length,o=0,s=!1;if(a>0)for(n[o]=e.charAt(0),i=1;i<a;i++)'"'===(r=e.charAt(i))?s=!s:s||r!==t?n[o]+=r:n[++o]="";return n},e.addAjaxExtensions=function(){$.ajaxTransport("+binary",(function(e,t,i){return{send:function(t,i){var r=new XMLHttpRequest,n=e.url,a=e.type;if(e.data,r.addEventListener("load",(function(){var t={};t[e.dataType]=r.response,i(r.status,r.statusText,t,r.getAllResponseHeaders())})),r.open(a,n),r.responseType="arraybuffer",e.headers)for(var o in e.headers)e.headers.hasOwnProperty(o)&&r.setRequestHeader(o,e.headers[o])},abort:function(){i.abort()}}}))},e.isStringOrNumber=function(e){return!(!e.substring&&!e.toFixed)},e.constrainBBox=function(e,t){var i,r,n={},a={};return a.left=a.top=0,a.right=t.outerWidth(),a.bottom=t.outerHeight(),r=e.offset(),n.left=r.left-t.offset().left,n.top=r.top-t.offset().top,n.right=n.left+e.outerWidth(),n.bottom=n.top+e.outerHeight(),(i=n.bottom-a.bottom)>0&&(r.top-=i,n.top-=i,n.bottom-=i,(i=n.top-a.top)<0&&(r.top-=i)),r},e.log=function(t){e.enableLogging&&console&&console.log&&console.log(t)},e.buildOptions=function(e,t){var i={oauthToken:e.oauthToken||void 0,headers:e.headers,withCredentials:e.withCredentials};return _.extend(i,t)},e}(igv||{});var igvxhr=function(e){const t=0,i=1,r=2;e.load=function(t,i){function r(r){return r&&(i.token=r),function(t,i){return new Promise((function(r,n){function a(e){if(!n)throw new Error(e);n(new Error(e))}var o,s,h,c,l=new XMLHttpRequest,u=i.sendData||i.body,d=i.method||(u?"POST":"GET"),p=i.range,f=i.responseType,g=i.contentType,v=i.mimeType,m=i.headers||{},w=(0==navigator.vendor.indexOf("Apple")&&/\sSafari\//.test(navigator.userAgent),i.withCredentials);if(t=t.startsWith("gs://")?igv.Google.translateGoogleCloudURL(t):t,i.token&&(m.Authorization="Bearer "+i.token),function(e){return e.includes("googleapis")}(t)&&(t=igv.Google.addApiKey(t),m=m||{},igv.Google.addGoogleHeaders(m)),p&&(t+=t.includes("?")?"&":"?",t+="someRandomSeed="+Math.random().toString(36)),l.open(d,t),p){var b=p.size?p.start+p.size-1:"";l.setRequestHeader("Range","bytes="+p.start+"-"+b)}if(g&&l.setRequestHeader("Content-Type",g),v&&l.overrideMimeType(v),f&&(l.responseType=f),m)for(o=Object.keys(m),c=0;c<o.length;c++)h=m[s=o[c]],l.setRequestHeader(s,h);!0===w&&(l.withCredentials=!0),l.onload=function(e){0==l.status||l.status>=200&&l.status<=300?p&&206!=l.status?a("ERROR: range-byte header was ignored for url: "+t):r(l.response):a(416===l.status?"Unsatisfiable range":l.status)},l.onerror=function(n){(function(e){var t=window.location.origin;return!e.startsWith(t)})(t)&&!i.crossDomainRetried&&igv.browser&&igv.browser.crossDomainProxy&&t!=igv.browser.crossDomainProxy?(i.sendData="url="+t,i.crossDomainRetried=!0,e.load(igv.browser.crossDomainProxy,i).then(r)):a("Error accessing resource: "+t+" Status: "+l.status)},l.ontimeout=function(e){a("Timed out")},l.onabort=function(e){console.log("Aborted"),n(new igv.AbortLoad)};try{l.send(u)}catch(e){n(e)}}))}(t,i)}if(i||(i={}),!i.oauthToken)return r();var n=_.isFunction(i.oauthToken)?i.oauthToken():i.oauthToken;return n.then&&_.isFunction(n.then)?n.then(r):r(n)},e.loadArrayBuffer=function(t,i){return t instanceof File?function(e,t){return new Promise((function(i,r){var n,a,o;(n=new FileReader).onload=function(r){t.bgz||e.name.endsWith(".gz"),i(n.result)},n.onerror=function(t){console.log("reject uploading local file "+e.name),r(null,n)},t.range?(o=t.range.start+t.range.size-1,a=e.slice(t.range.start,o+1),n.readAsArrayBuffer(a)):n.readAsArrayBuffer(e)}))}(t,i):(void 0===i&&(i={}),i.responseType="arraybuffer",e.load(t,i))},e.loadJson=function(t,i){return"POST"!=(i.method||(i.sendData?"POST":"GET"))||i.contentType||(i.contentType="application/json"),new Promise((function(r,n){e.load(t,i).then((function(e){r(e?JSON.parse(e):e)})).catch(n)}))},e.loadString=function(n,a){return n instanceof File?function(n,a){return new Promise((function(o,s){var h=new FileReader;h.onload=function(s){var c,l;c=a.bgz?r:n.name.endsWith(".gz")?i:t,l=e.arrayBufferToString(h.result,c),o(l)},h.onerror=function(e){console.log("reject uploading local file "+n.name),s(null,h)},h.readAsArrayBuffer(n)}))}(n,a):function(n,a){var o,s,h;return void 0===a&&(a={}),s=(h=n.indexOf("?"))>0?n.substring(0,h):n,(o=a.bgz?r:s.endsWith(".gz")?i:t)===t?(a.mimeType="text/plain; charset=x-user-defined",e.load(n,a)):(a.responseType="arraybuffer",new Promise((function(t,i){e.load(n,a).then((function(i){var r=e.arrayBufferToString(i,o);t(r)})).catch(i)})))}(n,a)},e.arrayBufferToString=function(e,t){var n;t===i?n=new Zlib.Gunzip(new Uint8Array(e)).decompress():n=t===r?new Uint8Array(igv.unbgzf(e)):new Uint8Array(e);for(var a="",o=0,s=n.length;o<s;o++)a+=String.fromCharCode(n[o]);return a},igv.AbortLoad=function(){};const n=window.document.location.href;if(!n.includes("localhost")&&!n.includes("127.0.0.1")){e.load("https://data.broadinstitute.org/igv/projects/current/counter_igvjs.php?version=0").then((function(e){console.log(e)})).catch((function(e){console.log(e)}))}return e}(igvxhr||{}),oauth=(igv=function(e){return e.KaryoPanel=function(t,i){var r,n,a,o,s=this;this.$container=$('<div class="igv-karyo-div">'),t.append(this.$container),!0===i.showKaryo?this.$container.show():this.$container.hide(),this.$karyoPanelToggle=e.makeToggleButton("Karyotype Panel","Karyotype Panel","showKaryo",(function(){return s.$container}),void 0),this.ideograms=null,e.guichromosomes=[],r=$('<div class="igv-karyo-content-div"></div>')[0],this.$container.append(r),n=$('<canvas class="igv-karyo-canvas"></canvas>')[0],$(r).append(n),n.setAttribute("width",r.offsetWidth),n.setAttribute("height",r.offsetHeight),this.canvas=n,this.ctx=n.getContext("2d"),(o=document.createElement("canvas")).style.position="absolute",o.style.width="100px",o.style.height="20px",o.style.left="-2000px",o.setAttribute("width","100px"),o.setAttribute("height","20px"),a=o.getContext("2d"),r.appendChild(o),this.canvas.onmousemove=function(t){for(var i=e.translateMouseCoordinates(t,n),r=i.x,s=i.y,h=!1,c=0;c<e.guichromosomes.length;c++){var l=e.guichromosomes[c];if(l.x<r&&l.right>r&&l.y<s&&l.bottom>s){var u=s-l.y,d=Math.round(l.size*u/l.h);o.style.left=Math.round(r+20)+"px",o.style.top=Math.round(s-5)+"px",a.clearRect(0,0,o.width,o.height),a.fillStyle="rgb(255,255,220)",a.fillRect(0,0,o.width,o.height),a.fillStyle="rgb(0,0,0)";var p=Math.round(d/1e6);a.fillText(l.name+" @ "+p+" MB",3,12),h=!0;break}}h||(o.style.left="-2000px")},this.canvas.onclick=function(t){var i=e.translateMouseCoordinates(t,n),r=i.x,a=i.y;e.navigateKaryo(r,a)}},e.navigateKaryo=function(t,i){for(var r=0;r<e.guichromosomes.length;r++){var n=e.guichromosomes[r];if(n.x<t&&n.right>t&&n.y<i&&n.bottom>i){var a=i-n.y,o=Math.round(n.size*a/n.h);e.browser.goto(n.name,o,void 0);break}}e.browser.update()},e.KaryoPanel.prototype.resize=function(){var t;return void 0===e.browser.genomicStateList?void console.log("karyo - resize: undefined === igv.browser.genomicStateList. Bail."):((t=this.canvas).setAttribute("width",t.clientWidth),t.setAttribute("height",t.clientHeight),t.clientWidth,t.clientHeight,this.ideograms=void 0,void this.repaint())},e.KaryoPanel.prototype.repaint=function(){function t(e,t,r,a,o,s,h,c){if(n&&a){var l=n.getCytobands(a.name);if(l){var u=t+s/2,d=[],p=[],f=l.length,g=h/c;e.x=t,e.y=r,e.w=s,e.right=t+s;var v=0,m=-1;if(f>0)v=l[f-1].end,e.h=g*v,e.size=v;else{m=r+5,e.h=5,e.size=5/g}if(e.longest=c,e.bottom=r+e.h,f>0)for(var w=0;w<l.length;w++){var b=l[w],y=g*b.start+r,k=g*b.end+r;if(k>m)if("c"==b.type)"p"==b.name.charAt(0)?(p[0]=y,d[0]=s+t,p[1]=y,d[1]=t,p[2]=k,d[2]=u):(p[0]=k,d[0]=s+t,p[1]=k,d[1]=t,p[2]=y,d[2]=u),o.fillStyle="rgb(220, 150, 100)",o.strokeStyle="rgb(150, 0, 0)",o.polygon(d,p,1,0);else{var x=k-y;o.fillStyle=i(b),o.fillRect(t,y,s,x)}m=k}}o.fillStyle=null,o.lineWidth=1,o.strokeStyle="darkgray";var S=s/2;o.roundRect(t,r-S/2,s,m-r+S,s/2,0,1),o.font="bold 10px Arial",o.fillStyle="rgb(0, 0, 0)";var _=a.name;_.length>3&&(_=_.substring(3)),o.fillText(_,t+s/2-3*_.length,r-10)}}function i(e){if("c"==e.type)return"rgb(150, 10, 10)";var t=e.stain,i=230;"p"==e.type&&(i=Math.floor(230-t/100*230));var r=s[i];return null==r&&(r="rgb("+i+","+i+","+i+")",s[i]=r),r}function r(e,t,i,r,a,o,s){e.getSummary(t,i,r,(function(t){t&&(len=t.length,function(e,t,i,r,a,o,s,h,c,l){if(n&&i&&t&&0!=t.length)for(var u=h/c,d=0;d<t.length;d++){var p=t[d],f="rgb(0,0,150)",g=p.score;e.getColor&&(f=e.getColor(g));var v=u*p.start+a,m=u*p.end+a,w=Math.max(.01,m-v);o.fillStyle=f,o.fillRect(r+s+2*l+1,v,1,w)}}(e,t,a,a.x,a.y,o,g,m,k,s),y.repaint())}))}if(void 0!==this.canvasWidth&&void 0!==this.canvasHeight){var n,a,o,s,h,c;if(void 0===e.browser.genomicStateList)return void console.log("karyo - repaint: undefined === igv.browser.genomicStateList. Bail");if(!(n=e.browser.genome).ideograms)return void console.log("karyo - no ideograms defined");if(o=(a=_.first(e.browser.genomicStateList)).referenceFrame,s=[],h=this.canvas.width,c=this.canvas.height,this.ctx.clearRect(0,0,h,c),n&&o&&n.chromosomes&&o.chrName){var l=n.chromosomes,u=this.ideograms;if(l.length<1)return;var d=24,p=1;h<300&&(p=2);var f=Math.min(50,(h-20)/(d+2)*p),g=Math.min(20,f/2),v=25,m=(c-25)/p-v,w=n.getLongestChromosome(),b=n.getCytobands(w.name);if(b){var y=this,k=b[b.length-1].end;u&&null!=u||function(){(u=document.createElement("canvas")).width=h,u.height=c;var i=u.getContext("2d"),a=0,o=0,s=1,w=v;for(x in e.guichromosomes=[],l){if(a>d)break;1==s&&2==p&&a+1>d/2&&(s=2,o=0,w=w+m+v),a++,o++;var b=n.getChromosome(x);"chrM"!=x||b.bpLength||(b.bpLength=16e3),b.x=o*f,b.y=w;var y=new Object;y.name=x,e.guichromosomes.push(y),t(y,b.x,b.y,b,i,g,m,k)}this.ideograms=u,e.browser.trackViews.length;for(var S=0,_=0;_<e.browser.trackViews.length;_++){var C=e.browser.trackViews[_].track;if(C.getSummary&&C.loadSummary){C.name;var T=C;window.source=C,T.loadSummary("chr1",0,1e6,(function(t){if(t)for(x in a=0,l){var n=e.guichromosomes[a];a++,n&&n.size&&r(T,x,0,n.size,n,i,S)}})),S++}}}.call(this),this.ctx.drawImage(u,0,0),this.ctx.save();var x=o.chrName;this.genome&&(x=this.genome.getChromosomeName(x));var S=e.browser.genome.getChromosome(x);if(S){var C=w.bpLength/m,T=S.y-3+Math.round(o.start/C),I=Math.max(3,e.browser.viewportContainerWidth()/a.locusCount*o.bpPerPixel/C);this.ctx.strokeStyle="rgb(150, 0, 0)",this.ctx.lineWidth=2,this.ctx.strokeRect(S.x-3,T,g+6,I+6),this.ctx.restore()}}}}},e}((igv=function(e){function t(e,i,r){return i.interval.overlaps(e)&&r.push(i.interval),i.left!=h&&i.left.max>=e.low&&t.call(this,e,i.left,r),i.right!=h&&i.right.min<=e.high&&t.call(this,e,i.right,r),r}function i(e){var t=e.right;e.right=t.left,t.left!=h&&(t.left.parent=e),t.parent=e.parent,e.parent==h?this.root=t:e.parent.left==e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t,n.call(this,e)}function r(e){var t=e.left;e.left=t.right,t.right!=h&&(t.right.parent=e),t.parent=e.parent,e.parent==h?this.root=t:e.parent.right==e?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t,n.call(this,e)}function n(e){for(;e!=h;){var t=e.left.max>e.right.max?e.left.max:e.right.max,i=e.interval.high;e.max=t>i?t:i;var r=e.left.min<e.right.min?e.left.min:e.right.min,n=e.interval.low;e.min=r<n?r:n,e=e.parent}}function a(e,t,i){this.low=e,this.high=t,this.value=i}function o(e){this.parent=h,this.left=h,this.right=h,this.interval=e,this.color=s}var s=2,h={color:1};return h.parent=h,h.left=h,h.right=h,e.IntervalTree=function(){this.root=h},e.IntervalTree.prototype.insert=function(e,t,n){var h=new o(new a(e,t,n));for(this.treeInsert(h),h.color=s;h!=this.root&&h.parent.color==s;)if(h.parent==h.parent.parent.left){(c=h.parent.parent.right).color==s?(h.parent.color=1,c.color=1,h.parent.parent.color=s,h=h.parent.parent):(h==h.parent.right&&(h=h.parent,i.call(this,h)),h.parent.color=1,h.parent.parent.color=s,r.call(this,h.parent.parent))}else{var c;(c=h.parent.parent.left).color==s?(h.parent.color=1,c.color=1,h.parent.parent.color=s,h=h.parent.parent):(h==h.parent.left&&(h=h.parent,r.call(this,h)),h.parent.color=1,h.parent.parent.color=s,i.call(this,h.parent.parent))}this.root.color=1},e.IntervalTree.prototype.findOverlapping=function(e,i){var r=new a(e,i,0);if(this.root===h)return[];var n=t.call(this,r,this.root,[]);return n.length>1&&n.sort((function(e,t){return e.low-t.low})),n},e.IntervalTree.prototype.logIntervals=function(){!function e(t,i){for(var r="",n=0;n<i;n++)r+=" ";console.log(r+t.interval.low+" "+t.interval.high),i+=5,t.left!=h&&e(t.left,i),t.right!=h&&e(t.right,i)}(this.root,0)},e.IntervalTree.prototype.mapIntervals=function(e){!function t(i){e(i.interval),i.left!=h&&t(i.left),i.right!=h&&t(i.right)}(this.root)},e.IntervalTree.prototype.treeInsert=function(e){for(var t=this.root,i=h;t!=h;)i=t,t=e.interval.low<=t.interval.low?t.left:t.right;e.parent=i,i==h?(this.root=e,e.left=e.right=h):e.interval.low<=i.interval.low?i.left=e:i.right=e,n.call(this,e)},a.prototype.equals=function(e){return!!e&&(this==e||this.low==otherInterval.low&&this.high==otherInterval.high)},a.prototype.compareTo=function(e){return this.low<e.low?-1:this.low>e.low?1:this.high<e.high?-1:this.high>e.high?1:0},a.prototype.overlaps=function(t){try{return this.low<=t.high&&t.low<=this.high}catch(t){e.presentAlert(t)}},e}(igv||{}))||{}),function(e){if(!e.google){var t;e.google={login:function(t){var i=window.open("https://accounts.google.com/o/oauth2/auth?scope=https://www.googleapis.com/auth/cloud-platform https://www.googleapis.com/auth/genomics https://www.googleapis.com/auth/devstorage.read_only https://www.googleapis.com/auth/userinfo.profile&state=%2Fprofile&redirect_uri=http%3A%2F%2Flocalhost%2Figv-web%2FemptyPage.html&response_type=token&client_id=661332306814-8nt29308rppg325bkq372vli8nm3na14.apps.googleusercontent.com","windowname1","width=800, height=600"),r=window.setInterval((function(){try{if(console.log(i.document.URL),-1!=i.document.URL.indexOf("http://localhost/igv-web/emptyPage.html")){window.clearInterval(r);var n=i.document.URL;e.google.access_token=e.google.gup(n,"access_token"),e.google.gup(n,"token_type"),e.google.gup(n,"expires_in"),i.close(),e.google.validateToken(e.google.access_token),t&&t()}}catch(e){}}),500)},validateToken:function(t){$.ajax({url:"https://www.googleapis.com/oauth2/v1/tokeninfo?access_token="+t,data:null,success:function(t){e.google.getUserInfo(),!0},dataType:"jsonp"})},getUserInfo:function(){$.ajax({url:"https://www.googleapis.com/oauth2/v1/userinfo?access_token="+e.google.access_token,data:null,success:function(e){t=e,console.log(t)},dataType:"jsonp"})},gup:function(e,t){t=t.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i=new RegExp("[\\#&]"+t+"=([^&#]*)").exec(e);return null==i?"":i[1]}}}return e}(oauth||{}));igv=function(e){return e.SequenceTrack=function(e){this.config=e,this.name="",this.id="sequence",this.sequenceType=e.sequenceType||"dna",this.height=15,this.disableButtons=!0,this.order=e.order||9999,this.ignoreTrackMenu=!0,this.supportsWholeGenome=!1},e.SequenceTrack.prototype.getFeatures=function(t,i,r,n){return new Promise((function(a,o){n&&n>1?a(null):e.browser.genome.sequence.getSequence(t,i,r).then(a).catch(o)}))},e.SequenceTrack.prototype.draw=function(t){var i,r,n,a,o,s,h,c,l,u,d=t.features,p=t.context,f=t.bpPerPixel,g=t.bpStart,v=g+t.pixelWidth*f+1;if(d)for(i=d.length,r=1/f,n=this.height/2,a=g;a<=v;a++)(o=a-g)<i&&(s=d[o],h=Math.floor(o*r),c=Math.floor((o+1)*r),l=Math.round((h+c)/2),(u=this.color?this.color:"dna"===this.sequenceType?e.nucleotideColors[s]:"rgb(0, 0, 150)")||(u="gray"),f>.1?e.graphics.fillRect(p,h,0,c-h,this.height,{fillStyle:u}):e.graphics.strokeText(p,s,l,3+n,{strokeStyle:u}))},e}((igv=function(e){function t(e,t,i){this.majorTick=e,this.majorUnit=t,this.unitMultiplier=i}return e.RulerTrack=function(){this.height=50,this.name="",this.id="ruler",this.disableButtons=!0,this.ignoreTrackMenu=!0,this.order=-Number.MAX_VALUE,this.supportsWholeGenome=!1},e.RulerTrack.prototype.locusLabelWithViewport=function(t){var i=$('<div class = "igv-viewport-content-ruler-div">');return i.text(t.genomicState.locusSearchString),i.click((function(i){var r=t.genomicState,n=r.initialReferenceFrame;r.referenceFrame=new e.ReferenceFrame(n.chrName,n.start,n.bpPerPixel),e.browser.selectMultiLocusPanelWithGenomicState(r)})),i},e.RulerTrack.prototype.getFeatures=function(e,t,i){return new Promise((function(e,t){e([])}))},e.RulerTrack.prototype.draw=function(i){function r(e,t){var i=10;switch(t){case 0:i=1;break;case 1:i=10;break;case 2:i=100;break;default:i=1e3}var r=""+Math.abs(Math.round(e*i)/i);-1==r.indexOf(".")&&(r+=".");for(var n=r.substr(0,r.indexOf(".")),a=n-0,o=r.substr(r.indexOf("."));o.length-1<t;)o+="0";if("."==o&&(o=""),a>=1e3){var s=n.length;n=parseInt(""+a/1e3)+","+n.substring(s-3,s)}a>=1e6&&(s=n.length,n=parseInt(""+a/1e6)+","+n.substring(s-7,s));var h=n+o;return e<0&&(h="("+h+")"),h}var n,a,o,s,h,c,l,u;if("all"===i.referenceFrame.chrName)(function(){var t=this,r=0;_.each(e.browser.genome.wgChromosomeNames,(function(n){var a=e.browser.genome.getChromosome(n),o=e.browser.genome.getGenomeCoordinate(n,a.bpLength),s=Math.round((o-i.bpStart)/l),h=n.startsWith("chr")?n.substr(3):n;i.context.textAlign="center",e.graphics.strokeLine(i.context,s,t.height-10,s,t.height-2),e.graphics.fillText(i.context,h,(r+s)/2,t.height-10/.75),r=s})),e.graphics.strokeLine(i.context,0,t.height-2,i.pixelWidth,t.height-2)}).call(this);else{for(u=i.genomicState,i.viewport.$viewport.find(".igv-viewport-content-ruler-div").text(u.locusSearchString),l=i.referenceFrame.bpPerPixel,a=(n=function(e){if(e<10)return new t(1,"",1);var i,r,n=Math.floor((i=e,r=Math.log(10),Math.log(i)/r)),a="",o=1;return n>9&&(a="gb",o=1e9),n>6?(a="mb",o=1e6):n>3&&(a="kb",o=1e3),new t(e/Math.pow(10,n-1)<25?Math.pow(10,n-1):Math.pow(10,n)/2,a,o)}(Math.floor(i.viewportWidth*l))).majorTick,o=Math.floor(i.bpStart/a)-1,s=0;s<i.pixelWidth;){h=Math.floor(o*a),c=2,6,s=Math.round((h-1-i.bpStart+.5)/l);var d=r(h/n.unitMultiplier,0)+" "+n.majorUnit;o%1==0&&e.graphics.fillText(i.context,d,s,this.height-8),e.graphics.strokeLine(i.context,s,this.height-6,s,this.height-c),o++}e.graphics.strokeLine(i.context,0,this.height-c,i.pixelWidth,this.height-c)}},e}((igv=function(e){return e.ReferenceFrame=function(e,t,i){this.chrName=e,this.start=t,this.bpPerPixel=i},e.ReferenceFrame.prototype.toPixels=function(e){return e/this.bpPerPixel},e.ReferenceFrame.prototype.toBP=function(e){return this.bpPerPixel*e},e.ReferenceFrame.prototype.shiftPixels=function(e){this.start+=e*this.bpPerPixel},e.ReferenceFrame.prototype.description=function(){return"ReferenceFrame "+this.chrName+" "+e.numberFormatter(Math.floor(this.start))+" bpp "+this.bpPerPixel},e}((igv=function(e){return e.isBlank=function(e){return!e.match(/\S+/g)},e.isComment=function(e){return 0==e.indexOf("#")},e.getQueryValue=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(window.location.href);return null==t?void 0:t[1]},e}((igv=function(e){return e.oauth=oauth,e}(igv||{}))||{}))||{}))||{}))||{});Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),"undefined"!=typeof Set?(Set.prototype.isEmpty=function(){return 0===this.size},Set.prototype.addAll=function(e){if(Array.isArray(e)||this._isPseudoArray(e))for(var t=0;t<e.length;t++)this.add(e[t]);else if(e instanceof Set){var i=this;e.each((function(e,t){i.add(t,e)}))}}):(Set=function(){this.data={},this.add.apply(this,arguments)},Set.prototype={add:function(){for(var e,t=0;t<arguments.length;t++)if(e=arguments[t],Array.isArray(e)||this._isPseudoArray(e))for(var i=0;i<e.length;i++)this._add(e[i]);else if(e instanceof Set){var r=this;e.each((function(e,t){r._add(t,e)}))}else this._add(e);return this},addAll:function(e){if(Array.isArray(e)||this._isPseudoArray(e))for(var t=0;t<e.length;t++)this._add(e[t]);else if(e instanceof Set){var i=this;e.each((function(e,t){i._add(t,e)}))}return this},_add:function(e,t){return void 0===t&&(t=e),this.data[this._makeKey(e)]=t,this},_getKey:function(e){return e},_makeKey:function(e){return e},_removeItem:function(e){delete this.data[this._getKey(e)]},_isPseudoArray:function(e){return!1},delete:function(e){for(var t,i=0;i<arguments.length;i++)if(t=arguments[i],Array.isArray(t)||this._isPseudoArray(t))for(var r=0;r<t.length;r++)this._removeItem(t[r]);else this._removeItem(t);return this},has:function(e){return e=this._makeKey(e),Object.prototype.hasOwnProperty.call(this.data,e)},hasAll:function(e){var t=this.makeNew.apply(this,arguments),i=this;return t.every((function(e,t){return i.has(t)}))},makeSet:function(e){return e instanceof Set?e:this.makeNew.apply(this,arguments)},equals:function(e){return e=this.makeSet(e),this.isSubset(e)&&this.isSuperset(e)},isEmpty:function(){for(var e in this.data)if(this.has(e))return!1;return!0},size:function(){var e=0;for(var t in this.data)this.has(t)&&e++;return e},keys:function(){var e=[];return this.each((function(t){e.push(t)})),e},clear:function(){return this.data={},this},makeNew:function(){var e=new this.constructor;return arguments.length&&e.add.apply(e,arguments),e},union:function(e){e=this.makeSet(e);var t=this.makeNew(this);return t.add(e),t},intersection:function(e){e=this.makeSet(e);var t=this.makeNew();return this.each((function(i,r){e.has(r)&&t._add(r,i)})),t},difference:function(e){e=this.makeSet(e);var t=this.makeNew();return this.each((function(i,r){e.has(r)||t._add(r,i)})),t},notInBoth:function(e){return e=this.makeSet(e),this.difference(e).add(e.difference(this))},isSubset:function(e){return e=this.makeSet(e),this.eachReturn((function(t,i){if(!e.has(i))return!1}))},isSuperset:function(e){e=this.makeSet(e);var t=this;return e.eachReturn((function(e,i){if(!t.has(i))return!1}))},each:function(e){return this.eachReturn(e),this},eachReturn:function(e){for(var t in this.data)if(this.has(t)&&!1===e.call(this,this.data[t],t))return!1;return!0},filter:function(e){var t=this.makeNew();return this.each((function(i,r){!0===e.call(this,r)&&t._add(r,i)})),t},map:function(e){var t=this.makeNew();return this.each((function(i,r){void 0!==e.call(this,r)&&t._add(r,i)})),t},some:function(e){var t=!1;return this.eachReturn((function(i){if(!0===e.call(this,i))return t=!0,!1})),t},every:function(e){return this.eachReturn(e)}},Set.prototype.constructor=Set);igv=function(e){return e.WindowSizePanel=function(e){this.$content=$('<div class="igv-windowsizepanel-content-div">'),e.append(this.$content)},e.WindowSizePanel.prototype.show=function(){this.$content.show()},e.WindowSizePanel.prototype.hide=function(){this.$content.hide()},e.WindowSizePanel.prototype.updateWithGenomicState=function(t){var i;e.browser.findTracks("type","seg")[0].sortSamples(t.chromosome.name,t.start,t.end,"DESC"),1===t.locusCount&&"all"!==t.locusSearchString?this.show():this.hide(),i=e.Viewport.viewportWidthAtLocusIndex(t.locusIndex)*t.referenceFrame.bpPerPixel,this.$content.text(e.prettyBasePairNumber(Math.round(i)))},e}((igv=function(e){return e.Viewport=function(e,t){this.initializationHelper(e,t)},e.Viewport.prototype.initializationHelper=function(t,i){var r,n,a,o,s,h,c=this;this.trackView=t,this.id=_.uniqueId("viewport_"),this.genomicState=e.browser.genomicStateList[i],this.$viewport=$('<div class="igv-viewport-div">'),this.$viewport.data("viewport",this.id),this.$viewport.data("locusindex",this.genomicState.locusIndex),function(e,t,i){1!==i&&t!==i-1&&e.addClass("igv-viewport-div-border-right")}(this.$viewport,this.genomicState.locusIndex,_.size(e.browser.genomicStateList)),this.setWidth(e.browser.viewportContainerWidth()/this.genomicState.locusCount),this.trackView.$viewportContainer.append(this.$viewport),this.contentDiv=$('<div class="igv-viewport-content-div">')[0],this.$viewport.append(this.contentDiv),t.track instanceof e.SequenceTrack&&this.$viewport.addClass("igv-viewport-sequence"),this.genomicState.locusCount>1&&t.track instanceof e.RulerTrack&&(this.$viewport.addClass("igv-viewport-ruler"),this.$close=$('<div class="igv-viewport-fa-close">'),this.$closeButton=$('<i class="fa fa-times-circle">'),this.$close.append(this.$closeButton),this.$close.click((function(t){e.browser.closeMultiLocusPanelWithGenomicState(c.genomicState)})),this.$viewport.append(this.$close)),this.canvas=$("<canvas>")[0],$(this.contentDiv).append(this.canvas),this.canvas.setAttribute("width",this.contentDiv.clientWidth),this.canvas.setAttribute("height",this.contentDiv.clientHeight),this.ctx=this.canvas.getContext("2d"),this.genomicState.locusCount>1&&t.track instanceof e.RulerTrack&&$(this.contentDiv).append(e.browser.rulerTrack.locusLabelWithViewport(this)),void 0===t.track.visibilityWindow&&t.track.supportsWholeGenome||(c.$zoomInNotice=((h=$("<div>")).text("Zoom in to see features"),(s=$('<div class="zoom-in-notice-container">')).append(h),s.hide(),s),$(this.contentDiv).append(c.$zoomInNotice)),t.track.name&&0===this.genomicState.locusIndex&&(r=t.track.description||t.track.name,(n=$('<div class="igv-track-label">')).html(t.track.name),n.click((function(t){e.popover.presentContent(t.pageX,t.pageY,r)})),this.$viewport.append(n),e.browser.$trackLabelToggle.hasClass("igv-nav-bar-toggle-button-on")&&n.hide()),this.addMouseHandlers(),t.track instanceof e.RulerTrack||((o=this.$viewport.height())>32&&(o=32),(a=$('<div class="igv-viewport-spinner">')).css({"font-size":o+"px"}),a.append($('<i class="fa fa-spinner fa-spin fa-fw">')),this.$viewport.append(a),this.stopSpinner())},e.Viewport.prototype.setWidth=function(e){var t;this.$viewport.width(e),t=this.$viewport.width()/this.$viewport.outerWidth(),this.$viewport.width(Math.floor(t*e))},e.Viewport.prototype.addMouseHandlers=function(){var t,i,r=this,n=void 0,a=void 0,o=0;r.trackView.track instanceof e.RulerTrack?r.addRulerMouseHandlers():(i=e.browser.constants.doubleClickDelay,$(r.canvas).contextmenu((function(t){t.preventDefault(),(t=$.event.fix(t)).stopPropagation(),e.popover.presentTrackPopupMenu(t,r)})),$(r.canvas).mousedown((function(t){var i;t.preventDefault(),!0,i=e.translateMouseCoordinates(t,r.canvas),n=i.x,a=n})),$(r.canvas).click((function(s){var h,c,l,u,d,p;return s.preventDefault(),(s=$.event.fix(s)).stopPropagation(),void 0===(c=r.genomicState.referenceFrame)?void console.log("undefined === referenceFrame"):(h=e.translateMouseCoordinates(s,r.canvas),l=Math.floor(c.start+c.toBP(h.x)),(u=Date.now())-o<i?(t&&(window.clearTimeout(t),t=void 0),e.browser.minimumBasesExtent()>Math.floor(r.$viewport.width()*c.bpPerPixel/2)||(d=Math.round(c.start+h.x*c.bpPerPixel),"all"===c.chrName?(p=e.browser.genome.getChromosomeCoordinate(d).chr,e.browser.search(p)):(r.genomicState.referenceFrame.bpPerPixel/=2,r.genomicState.referenceFrame.start=Math.round((d+r.genomicState.referenceFrame.start)/2),e.browser.updateWithLocusIndex(r.genomicState.locusIndex)))):s.shiftKey?r.trackView.track.shiftClick&&r.tile&&r.trackView.track.shiftClick(l,s):s.altKey?r.trackView.track.altClick&&r.tile&&r.trackView.track.altClick(l,c,s):Math.abs(h.x-a)<=e.browser.constants.dragThreshold&&r.trackView.track.popupDataWithConfiguration&&(t=window.setTimeout((function(){e.popover.presentTrackPopup(s,r),a=void 0,t=void 0}),i)),a=void 0,!1,n=void 0,void(o=u))})))},e.Viewport.prototype.addRulerMouseHandlers=function(){var t,i,r,n=this,a=void 0,o=void 0,s=void 0,h=void 0;this.removeRulerMouseHandlers(),"all"!==this.genomicState.chromosome.name&&(n.$rulerSweeper=$('<div class="igv-ruler-sweeper-div">'),$(n.contentDiv).append(n.$rulerSweeper),this.$viewport.on({mousedown:function(r){r.preventDefault(),$(n.contentDiv).off(),$(n.contentDiv).on({mousedown:function(e){a=!0}}),s=e.translateMouseCoordinates(r,n.contentDiv),t=s.x,i=0,n.$rulerSweeper.css({display:"inline",left:t+"px",width:i+"px"}),o=!0},mousemove:function(c){c.preventDefault(),a&&o&&(h=e.translateMouseCoordinates(c,n.contentDiv),r=h.x-s.x,(i=Math.abs(r))>1&&(n.$rulerSweeper.css({width:i+"px"}),r<0&&(s.x+r<0?(o=!1,t=0):t=s.x+r,n.$rulerSweeper.css({left:t+"px"}))))},mouseup:function(r){var s,h;a&&(a=!1,o=!1,n.$rulerSweeper.css({display:"none",left:"0px",width:"0px"}),h=n.genomicState.referenceFrame,(s={}).start=h.start+t*h.bpPerPixel,s.end=s.start+i*h.bpPerPixel,i>1&&(e.Browser.validateLocusExtent(e.browser.genome.getChromosome(h.chrName),s),n.goto(h.chrName,s.start,s.end)))}}))},e.Viewport.prototype.removeRulerMouseHandlers=function(){$(this.contentDiv).off(),this.$viewport.off()},e.Viewport.prototype.goto=function(t,i,r){e.popover&&e.popover.hide(),this.genomicState.referenceFrame.bpPerPixel=(Math.round(r)-Math.round(i))/this.$viewport.width(),this.genomicState.referenceFrame.start=Math.round(i),e.browser.updateWithLocusIndex(this.genomicState.locusIndex)},e.Viewport.prototype.startSpinner=function(){var e=this.$viewport.find(".fa-spinner");e.addClass("fa-spin"),e.show()},e.Viewport.prototype.stopSpinner=function(){var e=this.$viewport.find(".fa-spinner");e.hide(),e.removeClass("fa-spin")},e.Viewport.prototype.resize=function(){var t=e.browser.viewportContainerWidth()/this.genomicState.locusCount;t>0&&(this.setWidth(t),this.canvas.style.width=this.$viewport.width()+"px",this.canvas.setAttribute("width",this.$viewport.width()),this.update())},e.Viewport.prototype.update=function(){this.tile=null,this.repaint()},e.Viewport.prototype.repaint=function(){var t,i,r,n,a,o,s,h=this,c=h.genomicState,l=c.referenceFrame;if(function(){return e.browser&&e.browser.genomicStateList&&e.browser.genomicStateList[h.genomicState.locusIndex].referenceFrame}.call(this)){if(this.$zoomInNotice&&void 0!==this.trackView.track.visibilityWindow&&this.trackView.track.visibilityWindow>0){if(l.bpPerPixel*this.$viewport.width()>this.trackView.track.visibilityWindow||"all"===l.chrName&&!this.trackView.track.supportsWholeGenome)return this.tile=null,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),h.stopSpinner(),void this.$zoomInNotice.show();this.$zoomInNotice.hide()}if(a=l.chrName,s=(o=l.start)+l.toBP(this.canvas.width),this.tile&&this.tile.containsRange(a,o,s,l.bpPerPixel))this.paintImageWithReferenceFrame(l);else{if(t=3*this.canvas.width,i=Math.round(l.toBP(t)),r=Math.max(0,Math.round(l.start-i/3)),n=r+i,h.loading&&h.loading.start===r&&h.loading.end===n)return;h.loading={start:r,end:n},h.startSpinner(),this.trackView.track.getFeatures(l.chrName,r,n,l.bpPerPixel).then((function(i){var a,o,s;h.loading=void 0,h.stopSpinner(),i?("function"==typeof h.trackView.track.computePixelHeight&&((o=h.trackView.track.computePixelHeight(i))!=h.contentDiv.clientHeight&&h.trackView.setContentHeightForViewport(h,o)),(a=document.createElement("canvas")).width=t,a.height=h.canvas.height,h.drawConfiguration={features:i,context:a.getContext("2d"),pixelWidth:a.width,pixelHeight:a.height,bpStart:r,bpEnd:n,bpPerPixel:l.bpPerPixel,referenceFrame:l,genomicState:c,viewport:h,viewportWidth:h.$viewport.width(),viewportContainerX:c.referenceFrame.toPixels(c.referenceFrame.start-r),viewportContainerWidth:e.browser.viewportContainerWidth()},h.trackView.track.draw(h.drawConfiguration),(s=h.trackView).track.paintAxis&&s.controlCanvas.width>0&&s.controlCanvas.height>0&&function(e){var t;(t=document.createElement("canvas")).width=e.controlCanvas.width,t.height=e.controlCanvas.height,e.track.paintAxis(t.getContext("2d"),t.width,t.height),e.controlCtx.drawImage(t,0,0)}(h.trackView),h.tile=new Tile(l.chrName,r,n,l.bpPerPixel,a),h.paintImageWithReferenceFrame(l)):h.ctx.clearRect(0,0,h.canvas.width,h.canvas.height)})).catch((function(t){h.stopSpinner(),h.loading=!1,t instanceof e.AbortLoad?console.log("Aborted ---"):e.presentAlert(t)}))}}},e.Viewport.prototype.setContentHeight=function(e){e=Math.min(e,32e3),this.trackView.track.minHeight&&(e=Math.max(this.trackView.track.minHeight,e));var t=e+"px";$(this.contentDiv).height(e),this.canvas.style.height=t,this.canvas.setAttribute("height",e)},e.Viewport.prototype.paintImageWithReferenceFrame=function(e){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.tile&&(this.xOffset=Math.round(this.genomicState.referenceFrame.toPixels(this.tile.startBP-this.genomicState.referenceFrame.start)),this.ctx.drawImage(this.tile.image,this.xOffset,0),this.ctx.save(),this.ctx.restore())},e.Viewport.prototype.isLoading=function(){return!(void 0===this.loading)},e.Viewport.viewportWidthAtLocusIndex=function(t){return _.first(e.Viewport.viewportsWithLocusIndex(t)).$viewport.width()},e.Viewport.viewportsWithLocusIndex=function(t){var i=[];return _.each(e.browser.trackViews,(function(e){_.each(e.viewports,(function(e){t===e.genomicState.locusIndex&&i.push(e)}))})),i},e.Viewport.viewportWithID=function(t){var i=void 0;return _.each(e.browser.trackViews,(function(e){void 0===i&&_.each(e.viewports,(function(e){t===e.id&&(i=e)}))})),i},Tile=function(e,t,i,r,n){this.chr=e,this.startBP=t,this.endBP=i,this.scale=r,this.image=n},Tile.prototype.containsRange=function(e,t,i,r){return this.scale===r&&t>=this.startBP&&i<=this.endBP&&e===this.chr},e.Viewport.prototype.redrawTile=function(e){var t;this.tile&&((t=document.createElement("canvas")).width=this.tile.image.width,t.height=this.tile.image.height,this.trackView.track.draw({features:e,context:t.getContext("2d"),bpStart:this.tile.startBP,bpPerPixel:this.tile.scale,pixelWidth:t.width,pixelHeight:t.height}),this.tile=new Tile(this.tile.chr,this.tile.startBP,this.tile.endBP,this.tile.scale,t),this.paintImageWithReferenceFrame(this.genomicState.referenceFrame))},e}((igv=function(e){function t(e){var t,i=this;this.chr=e[0],this.pos=parseInt(e[1]),this.names=e[2],this.referenceBases=e[3],this.alternateBases=e[4],this.quality=parseInt(e[5]),this.filter=e[6],this.info=e[7],(t=this.alternateBases.split(",")).length>0?(this.alleles=[],this.start=Number.MAX_VALUE,this.end=0,t.forEach((function(e){var t,r,n;e.length>0&&((n=i.referenceBases.length-e.length)>0?r=(t=i.pos-1+e.length)+n:n<0?r=(t=i.pos-1+i.referenceBases.length)+1:r=(t=i.pos-1)+e.length,i.alleles.push({allele:e,start:t,end:r}),i.start=Math.min(i.start,t),i.end=Math.max(i.end,r))}))):(this.start=this.pos-1,this.end=this.pos)}return e.VcfParser=function(){},e.VcfParser.prototype.parseHeader=function(t){var i,r,n,a,o,s,h,c,l,u=t.splitLines(),d=u.length,p={};if(!u[0].startsWith("##fileformat"))throw new Error("Invalid VCF file: missing fileformat line");for(p.version=u[0].substr(13),r=1;r<d&&(i=u[r].trim()).startsWith("#");r++)if(o=null,s={},i.startsWith("##")){if(i.startsWith("##INFO")||i.startsWith("##FILTER")||i.startsWith("##FORMAT")){if(h=i.indexOf("<"),c=i.lastIndexOf(">"),!(h>2&&c>0)){console.log("Malformed VCF header line: "+i);continue}p[l=i.substring(2,h-1)]||(p[l]={}),(a=e.splitStringRespectingQuotes(i.substring(h+1,c-1),",")).forEach((function(e){var t=e.split("=");t.length>1&&("ID"===t[0]?o=t[1]:s[t[0]]=t[1])})),o&&(p[l][o]=s)}}else if(i.startsWith("#CHROM")&&(a=i.split("\t")).length>8)for(p.callSets=[],n=9;n<a.length;n++)p.callSets.push({id:n,name:a[n]});return this.header=p,p},e.VcfParser.prototype.parseFeatures=function(e){var i=e.split("\n"),r=[],n=this.header.callSets;return i.forEach((function(e){var i,a,o,s,h;if(!e.startsWith("#")&&((a=e.split("\t")).length>=8&&((i=new t(a)).header=this.header,r.push(i),a.length>9)))for(o=function(e){var t,i={genotypeIndex:-1,genotypeLikelihoodIndex:-1,phasesetIndex:-1,fields:e};for(t=0;t<e.length;t++)"GT"===e[t]?i.genotypeIndex=t:"GL"===e[t]?i.genotypeLikelihoodIndex=t:"PS"===e[t]&&(i.phasesetIndex=t);return i}(a[8].split(":")),i.calls={},s=9;s<a.length;s++){h=a[s];var c=n[s-9],l={callSetName:c.name,info:{}};i.calls[c.id]=l,h.split(":").forEach((function(e,t){switch(t){case o.genotypeIndex:l.genotype=[],e.split(/[\|\/]/).forEach((function(e){l.genotype.push(parseInt(e))}));break;case o.genotypeLikelihoodIndex:l.genotypeLikelihood=[],e.split(",").forEach((function(e){l.genotype.push(parseFloat(e))}));break;case o.phasesetIndex:l.phaseset=e;break;default:l.info[o.fields[t]]=e}}))}})),r},t.prototype.popupData=function(e){var t;return t=[{name:"Names",value:this.names},{name:"Ref",value:this.referenceBases},{name:"Alt",value:this.alternateBases},{name:"Qual",value:this.quality},{name:"Filter",value:this.filter},"<hr>"],this.info.split(";").forEach((function(e){var i=e.split("=");i.length>1&&t.push({name:i[0],value:i[1]})})),t},e}((igv=function(e){function t(){this.callSets?this.callSets.length<10?this.visibilityWindow=i:this.visibilityWindow=1e3+2500/this.callSets.length*40:this.visibilityWindow=i,this.featureSource.visibilityWindow=this.visibilityWindow}var i=1e5;return e.VariantTrack=function(t){this.visibilityWindow=void 0===t.visibilityWindow?"compute":t.visibilityWindow,e.configTrack(this,t),this.displayMode=t.displayMode||"EXPANDED",this.labelDisplayMode=t.labelDisplayMode,this.variantHeight=t.variantHeight||10,this.squishedCallHeight=t.squishedCallHeight||1,this.expandedCallHeight=t.expandedCallHeight||10,this.featureHeight=t.featureHeight||14,this.featureSource=new e.FeatureSource(t),this.homrefColor=t.homrefColor||"rgb(200, 200, 200)",this.homvarColor=t.homvarColor||"rgb(17,248,254)",this.hetvarColor=t.hetvarColor||"rgb(34,12,253)",this.nRows=1},e.VariantTrack.prototype.getFileHeader=function(){var e=this;return new Promise((function(i,r){"function"==typeof e.featureSource.getFileHeader?e.featureSource.getFileHeader().then((function(r){r&&(r.name&&!e.config.name&&(e.name=r.name),r.color&&!e.config.color&&(e.color="rgb("+r.color+")"),e.callSets=r.callSets,"compute"===e.visibilityWindow&&t.call(e)),i(r)})).catch(r):i(null)}))},e.VariantTrack.prototype.getFeatures=function(e,t,i){var r=this;return new Promise((function(n,a){r.featureSource.getFeatures(e,t,i).then((function(e){n(e)})).catch(a)}))},e.VariantTrack.prototype.computePixelHeight=function(e){var t,i,r=this.callSets,n=r?r.length:0;if("COLLAPSED"===this.displayMode)return this.nRows=1,10+this.variantHeight;var a=0;return e&&"function"==typeof e.forEach&&e.forEach((function(e){e.row&&e.row>a&&(a=e.row)})),i=10+(t=a+1)*(this.variantHeight+2),this.nRows=t,n*t*this.expandedCallHeight>2e3&&(this.expandedCallHeight=Math.max(1,2e3/(n*t))),i+2+n*t*("EXPANDED"===this.displayMode?this.expandedCallHeight:this.squishedCallHeight)},e.VariantTrack.prototype.draw=function(t){var i,r,n,a,o,s,h,c,l,u,d,p,f,g=t.features,v=t.context,m=t.bpPerPixel,w=t.bpStart,b=t.pixelWidth,y=t.pixelHeight,k=w+b*m+1,x="EXPANDED"===this.displayMode?this.expandedCallHeight:this.squishedCallHeight;if(this.variantBandHeight=10+this.nRows*(this.variantHeight+2),f=this.callSets,e.graphics.fillRect(v,0,0,b,y,{fillStyle:"rgb(255, 255, 255)"}),f&&f.length>0&&"COLLAPSED"!==this.displayMode&&e.graphics.strokeLine(v,0,this.variantBandHeight,b,this.variantBandHeight,{strokeStyle:"rgb(224,224,224) "}),g){for(s=0,len=g.length;s<len;s++)if(!((h=g[s]).end<w)){if(h.start>k)break;if(a=10+("COLLAPSED"===this.displayMode?0:h.row*(this.variantHeight+2)),o=this.variantHeight,i=Math.round((h.start-w)/m),r=Math.round((h.end-w)/m),(n=Math.max(1,r-i))<3?(n=3,i-=1):n>5&&(i+=1,n-=2),v.fillStyle=this.color,v.fillRect(i,a,n,o),f&&h.calls&&"COLLAPSED"!==this.displayMode)for(o=x,u=0;u<f.length;u++)l=f[u],(c=h.calls[l.id])&&(p=d=!0,c.genotype.forEach((function(e){0!=e&&(d=!1),0==e&&(p=!1)})),v.fillStyle=d?this.homrefColor:p?this.homvarColor:this.hetvarColor,a=this.variantBandHeight+2+(u+h.row)*x,v.fillRect(i,a,n,o))}}else console.log("No feature list")},e.VariantTrack.prototype.popupDataWithConfiguration=function(e){return this.popupData(e.genomicLocation,e.x,e.y,e.viewport.genomicState.referenceFrame)},e.VariantTrack.prototype.popupData=function(e,t,i,r){if(this.featureSource.featureCache){var n=r.chrName,a=Math.floor(2*r.bpPerPixel),o=this.featureSource.featureCache.queryFeatures(n,e-a,e+a),s=[],h=this;return o&&o.length>0&&o.forEach((function(t){var r,n,o,c,l;t.start<=e+a&&t.end>e-a&&(s.length>0&&s.push("<HR>"),"COLLAPSED"==h.displayMode?Array.prototype.push.apply(s,t.popupData(e)):i<=h.variantBandHeight?(r=Math.floor((i-10)/(h.variantHeight+2)),t.row===r&&Array.prototype.push.apply(s,t.popupData(e))):(o=h.callSets)&&t.calls&&(n=h.nRows*("SQUISHED"===h.displayMode?h.squishedCallHeight:h.expandedCallHeight),c=o[r=Math.floor((i-h.variantBandHeight-2)/n)],l=t.calls[c.id],Array.prototype.push.apply(s,function(e,t){var i,r="";return e.genotype.forEach((function(e){r+=0===e?t.referenceBases:t.alternateBases[e-1]})),i=[],void 0!==e.callSetName&&i.push({name:"Name",value:e.callSetName}),i.push({name:"Genotype",value:r}),void 0!==e.phaseset&&i.push({name:"Phase set",value:e.phaseset}),void 0!==e.genotypeLikelihood&&i.push({name:"genotypeLikelihood",value:e.genotypeLikelihood.toString()}),Object.keys(e.info).forEach((function(t){i.push({name:t,value:e.info[t]})})),i}(l,t))))})),s}},e.VariantTrack.prototype.menuItemList=function(t){function i(e,t,i){var r,n;return r={COLLAPSED:"Collapse",SQUISHED:"Squish",EXPANDED:"Expand"},n=0===t?'<div class="igv-track-menu-border-top">':"<div>",e===i?n+'<i class="fa fa-check fa-check-shim"></i>'+r[e]+"</div>":n+'<i class="fa fa-check fa-check-shim fa-check-hidden"></i>'+r[e]+"</div>"}var r,n=this,a=[];return a.push(e.colorPickerMenuItem(t,this.trackView)),r=_.map(["COLLAPSED","SQUISHED","EXPANDED"],(function(e,r){return{object:$(i(e,r,n.displayMode)),click:function(){t.hide(),n.displayMode=e,n.trackView.update()}}})),a.concat(r)},e}((igv=function(e){function t(e){altTokens=e.alternateBases.split(","),altTokens.length>0?(e.alleles=[],e.alleles.push(e.referenceBases),e.start=Number.MAX_VALUE,e.end=0,altTokens.forEach((function(t){var i,r,n;e.alleles.push(t),t.length>0&&((n=e.referenceBases.length-t.length)>0?r=(i=e.pos+t.length)+n:n<0?r=(i=e.pos+e.referenceBases.length)+1:r=(i=e.pos)+t.length,e.start=Math.min(e.start,i),e.end=Math.max(e.end,r))}))):(e.start=e.pos-1,e.end=e.pos)}function i(e){if(e){var t,i="";for(e.length>0&&(i=e[0]),t=1;t<e.length;t++)i+=", "+e[1];return i}}return e.createVCFVariant=function(i){var r=new e.Variant;return r.chr=i[0],r.pos=parseInt(i[1])-1,r.names=i[2],r.referenceBases=i[3],r.alternateBases=i[4],r.quality=parseInt(i[5]),r.filter=i[6],r.info=i[7],t(r),r},e.createGAVariant=function(r){var n=new e.Variant;n.chr=r.referenceName,n.pos=parseInt(r.start),n.names=i(r.names),n.referenceBases=r.referenceBases+"",n.alternateBases=r.alternateBases+"",n.quality=r.quality,n.filter=i(r.filter),n.info=r.info,n.calls={};var a;return r.calls&&r.calls.forEach((function(e){a=e.callSetId,n.calls[a]=e})),t(n),n},e.Variant=function(){},e.Variant.prototype.popupData=function(e){var t,r,n=this;return t=[{name:"Chr",value:this.chr},{name:"Pos",value:this.pos+1},{name:"Names",value:this.names?this.names:""},{name:"Ref",value:this.referenceBases},{name:"Alt",value:this.alternateBases},{name:"Qual",value:this.quality},{name:"Filter",value:this.filter}],this.calls&&1===this.calls.length&&(r=this.alleles[this.calls[0].genotype[0]]+this.alleles[this.calls[0].genotype[1]],t.push({name:"Genotype",value:r})),this.info&&(t.push("<HR>"),Object.keys(this.info).forEach((function(e){t.push({name:e,value:i(n.info[e])})}))),t},e}((igv=function(e){return e.UserFeedback=function(e){var t=this;this.userFeedback=$('<div class="igv-user-feedback">'),e.append(this.userFeedback[0]),this.userFeedbackHeader=$("<div>"),this.userFeedback.append(this.userFeedbackHeader[0]),this.userFeedbackAlert=$('<i class="fa fa-exclamation-triangle">'),this.userFeedbackHeader.append(this.userFeedbackAlert[0]),this.userFeedbackDismiss=$('<i class="fa fa-times-circle">'),this.userFeedbackHeader.append(this.userFeedbackDismiss[0]),this.userFeedbackDismiss.click((function(){t.userFeedbackBodyCopy.html(""),t.userFeedback.hide()})),this.userFeedbackBodyCopy=$("<div>"),this.userFeedback.append(this.userFeedbackBodyCopy[0])},e.UserFeedback.prototype.show=function(){this.userFeedback.show()},e.UserFeedback.prototype.hide=function(){this.userFeedback.hide()},e.UserFeedback.prototype.bodyCopy=function(e){this.userFeedbackBodyCopy.html(e)},e}((igv=function(e){return e.TrackMenuPopupDialog=function(e,t,i,r,n,a){var o,s,h,c=this;h='<div id="dialog-form" title="DIALOG_LABEL"><p class="validateTips"></p><form><fieldset><input type="text" name="name" id="name" value="INPUT_VALUE"></fieldset></form></div>',o=new RegExp("DIALOG_LABEL","g"),h=h.replace(o,t),s=new RegExp("INPUT_VALUE","g"),h=h.replace(s,i),$("body").append($.parseHTML(h)),this.dialogForm=$("#dialog-form"),this.form=this.dialogForm.find("form"),this.name=$("#name"),this.tips=$(".validateTips"),this.dialogForm.dialog({autoOpen:!1,width:n||320,height:a||256,modal:!0,buttons:{ok:r,cancel:function(){c.dialogForm.dialog("close")}},close:function(){c.form[0].reset(),c.dialogForm.remove(),c.dialogForm=void 0,e&&e.hide()}}),this.form.on("submit",(function(e){e.preventDefault(),$("#users").find(" tbody").append("<tr><td>"+c.name.val()+"</td></tr>"),c.dialogForm.dialog("close")}))},e.TrackMenuPopupDialog.prototype.updateTips=function(e){var t=this;this.tips.text(e).addClass("ui-state-highlight"),setTimeout((function(){t.tips.removeClass("ui-state-highlight",1500)}),500)},e}((igv=function(e){function t(t,i){var r,n,a,o=i.genomicState.referenceFrame;if(n=e.translateMouseCoordinates(t,i.canvas),void 0!==(r=Math.floor(o.start+o.toBP(n.x)))&&null!==i.tile)return a=Math.round(o.toPixels(i.tile.startBP-o.start)),{genomicLocation:r,x:n.x-a,y:n.y}}function i(e,t,i){var r,n,a=e,o=$(window).width(),s=($(window).height(),e),h=t;return r=s-=i.$parent.offset().left,a+(n={x:s,y:h-=i.$parent.offset().top,width:i.$popover.outerWidth(),height:i.$popover.outerHeight()}).width>o&&(r=s-n.width),{left:r+"px",top:h+"px"}}return e.Popover=function(e){this.$parent=this.initializationHelper(e)},e.Popover.prototype.initializationHelper=function(t){var i,r=this;return this.$popover=$('<div class="igv-popover">'),t.append(this.$popover),i=$('<div class="igv-popover-header">'),this.$popover.append(i),e.attachDialogCloseHandlerWithParent(i,(function(){r.hide()})),this.$popoverContent=$("<div>"),this.$popover.append(this.$popoverContent),this.$popover.draggable({handle:i}),t},e.Popover.prototype.hide=function(){this.$popover.hide()},e.Popover.prototype.presentTrackGearMenu=function(t,r,n){var a,o;o=e.trackMenuItemList(this,n),_.size(o)>0&&(this.$popoverContent.empty(),this.$popoverContent.removeClass("igv-popover-track-popup-content"),a=$('<div class="igv-track-menu-container">'),this.$popoverContent.append(a),_.each(o,(function(e){e.init&&e.init(),a.append(e.object)})),this.$popover.css(i(t,r,this)),this.$popover.show(),this.$popover.offset(e.constrainBBox(this.$popover,$(e.browser.trackContainerDiv))))},e.Popover.prototype.presentTrackPopupMenu=function(r,n){var a,o,s;n.trackView.track,void 0!==(a=t(r,n))&&(s=e.trackPopupMenuItemList(this,n,a.genomicLocation,a.x,a.y),_.size(s)>0&&(this.$popoverContent.empty(),this.$popoverContent.removeClass("igv-popover-track-popup-content"),o=$('<div class="igv-track-menu-container">'),this.$popoverContent.append(o),_.each(s,(function(e){o.append(e.object)})),this.$popover.css(i(r.pageX,r.pageY,this)),this.$popover.show()))},e.Popover.prototype.presentTrackPopup=function(i,r){var n,a,o,s,h,c=r.trackView.track;r.genomicState.referenceFrame,void 0!==(n=t(i,r))&&(h={popover:this,viewport:r,genomicLocation:n.genomicLocation,x:n.x,y:n.y},a=c.popupDataWithConfiguration(h),void 0===(o=e.browser.fireEvent("trackclick",[c,a]))?_.size(a)>0&&(s=e.formatPopoverText(a)):"string"==typeof o&&(s=o),this.presentContent(i.pageX,i.pageY,s))},e.Popover.prototype.presentContent=function(e,t,r){var n;void 0!==r&&(this.$popoverContent.empty(),this.$popoverContent.addClass("igv-popover-track-popup-content"),n=$('<div class="igv-track-menu-container">'),this.$popoverContent.append(n),this.$popoverContent.html(r),this.$popover.css(i(e,t,this)),this.$popover.show())},e}((igv=function(e){return e.Dialog=function(t,i){var r,n,a=this;this.$container=$('<div class="igv-grid-container-dialog">'),t.append(this.$container[0]),r=$('<div class="igv-grid-header">'),n=$('<div class="igv-grid-header-blurb">'),r.append(n[0]),this.$container.append(r[0]),i(this),e.attachDialogCloseHandlerWithParent(r,(function(){a.hide()}))},e.Dialog.dialogConstructor=function(e){e.$container.append(e.rowOfLabel()[0]),e.$container.append(e.rowOfInput()[0]),e.$container.append(e.rowOfOkCancel()[0]),e.$container.draggable()},e.Dialog.prototype.rowOfOk=function(){var e,t,i,r;return t=$('<div class="igv-grid-dialog">'),i=$('<div class="igv-col igv-col-1-4">'),t.append(i[0]),i=$('<div class="igv-col igv-col-2-4">'),(r=$('<div class="igv-col-filler-ok-button">')).text("OK"),this.$ok=r,i.append(r[0]),t.append(i[0]),(e=$('<div class="igv-grid-rect">')).append(t[0]),e},e.Dialog.prototype.rowOfOkCancel=function(){var e,t,i,r,n=this;return t=$('<div class="igv-grid-dialog">'),i=$('<div class="igv-col igv-col-1-8">'),t.append(i[0]),i=$('<div class="igv-col igv-col-3-8">'),(r=$('<div class="igv-col-filler-ok-button">')).text("OK"),this.$ok=r,i.append(r[0]),t.append(i[0]),i=$('<div class="igv-col igv-col-3-8">'),(r=$('<div class="igv-col-filler-cancel-button">')).text("Cancel"),r.click((function(){n.$dialogInput.val(void 0),n.hide()})),i.append(r[0]),t.append(i[0]),i=$('<div class="igv-col igv-col-1-8">'),t.append(i[0]),(e=$('<div class="igv-grid-rect">')).append(t[0]),e},e.Dialog.prototype.rowOfLabel=function(){var e,t,i;return t=$('<div class="igv-grid-dialog">'),i=$('<div class="igv-col igv-col-4-4">'),this.$dialogLabel=$('<div class="igv-user-input-label">'),i.append(this.$dialogLabel[0]),t.append(i[0]),(e=$('<div class="igv-grid-rect">')).append(t[0]),e},e.Dialog.prototype.rowOfInput=function(){var e,t,i;return t=$('<div class="igv-grid-dialog">'),i=$('<div class="igv-col igv-col-4-4">'),this.$dialogInput=$('<input class="igv-user-input-dialog" type="text" value="#000000">'),i.append(this.$dialogInput[0]),t.append(i[0]),(e=$('<div class="igv-grid-rect">')).append(t[0]),e},e.Dialog.prototype.configure=function(e,t,i){var r=this;e?(r.$dialogLabel.html(e()),r.$dialogLabel.show()):r.$dialogLabel.hide(),void 0!==t?(r.$dialogInput.val(t),r.$dialogInput.unbind(),r.$dialogInput.change((function(){i&&i(),r.hide()})),r.$dialogInput.show()):r.$dialogInput.hide(),r.$ok.unbind(),r.$ok.click((function(){i&&i(),r.hide()}))},e.Dialog.prototype.hide=function(){this.$container.hasClass("igv-grid-container-dialog")&&this.$container.offset({left:0,top:0}),this.$container.hide()},e.Dialog.prototype.show=function(e){var t,i,r;t=$("body").scrollTop(),this.$container.hasClass("igv-grid-container-dialog")&&(i=e.offset().top+t,r=e.outerWidth()-300,this.$container.offset({left:r,top:i})),this.$container.show()},e}((igv=function(e){return e.DataRangeDialog=function(t){var i,r,n,a=this;this.container=$('<div class="igv-grid-container-dialog">'),t.append(this.container),this.container.draggable(),this.header=$('<div class="igv-grid-header">'),this.headerBlurb=$('<div class="igv-grid-header-blurb">'),this.header.append(this.headerBlurb),e.attachDialogCloseHandlerWithParent(this.header,(function(){a.hide()})),this.container.append(this.header),a.container.append((n=$('<div class="igv-grid-rect">'),i=$('<div class="igv-grid-dialog">'),r=$('<div class="spacer10">'),i.append(r),r=$('<div class="igv-col igv-col-3-8">'),a.minLabel=$('<div class="igv-data-range-input-label">'),a.minLabel.text("Minimum"),r.append(a.minLabel),i.append(r),r=$('<div class="igv-col igv-col-3-8">'),a.minInput=$('<input class="igv-data-range-input" type="text" value="125">'),r.append(a.minInput),i.append(r),n.append(i),i=$('<div class="igv-grid-dialog">'),r=$('<div class="igv-col igv-col-3-8">'),a.maxLabel=$('<div class="igv-data-range-input-label">'),a.maxLabel.text("Maximum"),r.append(a.maxLabel),i.append(r),r=$('<div class="igv-col igv-col-3-8">'),a.maxInput=$('<input class="igv-data-range-input" type="text" value="250">'),r.append(a.maxInput),i.append(r),n.append(i),n)),a.container.append(function(){var e,t,i,r;return t=$('<div class="igv-grid-dialog">'),i=$('<div class="igv-col igv-col-1-8">'),t.append(i),i=$('<div class="igv-col igv-col-3-8">'),a.ok=$('<div class="igv-col-filler-ok-button">'),a.ok.text("OK"),i.append(a.ok),t.append(i),i=$('<div class="igv-col igv-col-3-8">'),(r=$('<div class="igv-col-filler-cancel-button">')).text("Cancel"),r.click((function(){a.hide()})),i.append(r),t.append(i),i=$('<div class="igv-col igv-col-1-8">'),t.append(i),(e=$('<div class="igv-grid-rect">')).append(t),e}())},e.DataRangeDialog.prototype.configureWithTrackView=function(t){var i,r,n,a=this;this.trackView=t,(i=this.trackView.dataRange())?(r=i.min,n=i.max):(r=0,n=100),this.minInput.val(r),this.maxInput.val(n),this.ok.unbind(),this.ok.click((function(){r=parseFloat(a.minInput.val()),n=parseFloat(a.maxInput.val()),isNaN(r)||isNaN(n)?e.presentAlert("Must input numeric values"):t.setDataRange(r,n,!1),a.hide()}))},e.DataRangeDialog.prototype.hide=function(){this.container.offset({left:0,top:0}),this.container.hide()},e.DataRangeDialog.prototype.show=function(){var t=$("body").scrollTop(),i=$(this.trackView.trackDiv).offset(),r=$(this.trackView.trackDiv).outerWidth();$(this.trackView.trackDiv).outerHeight();this.container.show(),this.container.offset({left:r-300,top:i.top+t}),this.container.offset(e.constrainBBox(this.container,$(e.browser.trackContainerDiv)))},e}((igv=function(e){return e.ColorPicker=function(t,i){function r(e){var t,i=$('<div class="igv-grid-rect-hidden">'),r=$('<div class="igv-grid-colorpicker">');for(t=0;t<8;t++)r.append(a(null));return i.append(r),i}function n(e){var t,i=$('<div class="igv-grid-rect">'),r=$('<div class="igv-grid-colorpicker">');for(t=0;t<Math.min(8,e.length);t++)r.append(a(e[t]));return i.append(r),i}function a(e){var t=$('<div class="igv-col igv-col-1-8">'),i=$("<div>");return t.append(i),null!==e?(i.addClass("igv-col-filler"),i.css("background-color",e),i.click((function(){l.trackView.setColor($(this).css("background-color"))}))):(i.addClass("igv-col-filler-no-color"),i.css("background-color","white")),t}var o,s,h,c,l=this,u=i||["#666666","#0000cc","#009900","#cc0000","#ffcc00","#9900cc","#00ccff","#ff6600","#ff6600"],d=Math.ceil(u.length/8);for(this.rgb_re=/^\s*(0|[1-9]\d?|1\d\d?|2[0-4]\d|25[0-5])\s*,\s*(0|[1-9]\d?|1\d\d?|2[0-4]\d|25[0-5])\s*,\s*(0|[1-9]\d?|1\d\d?|2[0-4]\d|25[0-5])\s*$/,this.hex_re=new RegExp("^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$"),this.$container=$('<div class="igv-grid-container-colorpicker">'),t.append(this.$container),this.$container.draggable(),this.$header=$('<div class="igv-grid-header">'),this.$headerBlurb=$('<div class="igv-grid-header-blurb">'),this.$header.append(this.$headerBlurb),e.attachDialogCloseHandlerWithParent(this.$header,(function(){l.hide()})),this.$container.append(this.$header),o=0;o<d;o++)l.$container.append(n(u.slice(8*o)));l.$container.append($('<hr class="igv-grid-dividing-line">')),l.$container.append(function(){function t(t){var i,r;return null!==(i=l.rgb_re.exec(t))?"rgb("+i[0]+")":null!==(r=l.hex_re.exec(t))?e.hex2Color(r[0]):void 0}function i(e){void 0===l.userColorsIndex?(l.userColorsIndex=0,l.userColorsRowIndex=0):8===l.userColorsRowIndex&&(l.userColorsRowIndex=0,l.userColorsIndex=(1+l.userColorsIndex)%l.userColors.length),function(e,t,i){var r,n;(r=l.userColors[t]).removeClass("igv-grid-rect-hidden"),r.addClass("igv-grid-rect"),(n=r.find(".igv-grid-colorpicker").find(".igv-col").find("div").eq(i)).removeClass("igv-col-filler-no-color"),n.removeClass("igv-grid-rect-hidden"),n.addClass("igv-col-filler"),n.css("background-color",e),n.click((function(){l.trackView.setColor($(this).css("background-color"))}))}(e,l.userColorsIndex,l.userColorsRowIndex),++l.userColorsRowIndex}var n,o,s,h,c;for(l.userColors=[],c=0;c<5;c++)o=r(c),l.userColors.push(o),l.$container.append(o[0]),o.find(".igv-col-filler-no-color").addClass("igv-grid-rect-hidden");return l.userColorsIndex=void 0,l.userColorsRowIndex=0,o=$('<div class="igv-grid-colorpicker">'),s=$('<div class="igv-col igv-col-7-8">'),(h=$('<input class="igv-user-input-colorpicker" type="text" placeholder="Ex: #ff0000 or 255,0,0">')).change((function(){var e=t($(this).val());e?(l.trackView.setColor(e),i(e),$(this).val(""),$(this).attr("placeholder","Ex: #ff0000 or 255,0,0"),l.$userColorFeeback.css("background-color","white"),l.$userColorFeeback.hide()):l.$userError.show()})),h.mousedown((function(){$(this).attr("placeholder","")})),h.keyup((function(){var e;""===$(this).val()&&(l.$userError.hide(),$(this).attr("placeholder","Ex: #ff0000 or 255,0,0")),void 0!==(e=t($(this).val()))?(l.$userColorFeeback.css("background-color",e),l.$userColorFeeback.show()):(l.$userColorFeeback.css("background-color","white"),l.$userColorFeeback.hide())})),s.append(h),o.append(s),s=a(null),l.$userColorFeeback=s.find("div").first(),o.append(s),l.$userColorFeeback.hide(),(n=$('<div class="igv-grid-rect">')).append(o),l.$userError=$("<span>"),l.$userError.text("ERROR.    Ex: #ff0000 or 255,0,0"),l.$userError.hide(),(o=$('<div class="igv-grid-colorpicker-user-error">')).append(l.$userError),n.append(o),n}()),l.$container.append((h=$('<div class="igv-grid-colorpicker">'),l.$previousColor=$('<div class="igv-col-filler">'),l.$previousColor.css("background-color","#eee"),(c=$('<div class="igv-col igv-col-1-8">')).append(l.$previousColor),c.click((function(){l.trackView.setColor($(this).find(".igv-col-filler").css("background-color"))})),h.append(c),(c=$('<div class="igv-col igv-col-7-8 igv-col-label">')).text("Previous Color"),h.append(c),(s=$('<div class="igv-grid-rect">')).append(h),s)),l.$container.append(function(){var e,t,i;return t=$('<div class="igv-grid-colorpicker">'),l.$defaultColor=$('<div class="igv-col-filler">'),l.$defaultColor.css("background-color","#eee"),(i=$('<div class="igv-col igv-col-1-8">')).append(l.$defaultColor),i.click((function(){l.trackView.setColor($(this).find(".igv-col-filler").css("background-color"))})),t.append(i),(i=$('<div class="igv-col igv-col-7-8 igv-col-label">')).text("Default Color"),t.append(i),(e=$('<div class="igv-grid-rect">')).append(t),e}())},e.ColorPicker.prototype.configure=function(t){this.trackView=t,this.$defaultColor.css("background-color",t.track.config.color||e.browser.constants.defaultColor),this.$previousColor.css("background-color",t.track.color)},e.ColorPicker.prototype.hide=function(){$(this.$container).offset({left:0,top:0}),this.$container.hide()},e.ColorPicker.prototype.show=function(){var t,i=$("body").scrollTop(),r=$(this.trackView.trackDiv).offset(),n=$(this.trackView.trackDiv).outerWidth();$(this.trackView.trackDiv).outerHeight();$(this.$container).outerWidth(),$(this.$container).outerHeight(),$(this.$container).offset({left:n-300,top:r.top+i}),(t=$(".igv-user-input-color")).val(""),t.attr("placeholder","Ex: #ff0000 or 255,0,0"),this.$container.show(),this.$userError.hide(),$(this.$container).offset(e.constrainBBox($(this.$container),$(e.browser.trackContainerDiv)))},e}((igv=function(e){return e.CenterGuide=function(t,i){var r=this;this.$container=$('<div class="igv-center-guide igv-center-guide-thin">'),t.append(this.$container),!0===i.showCenterGuide?this.$container.show():this.$container.hide(),this.$centerGuideToggle=e.makeToggleButton("center line","center line","showCenterGuide",(function(){return r.$container}),(function(){r.repaint()}))},e.CenterGuide.prototype.repaint=function(){var t,i,r,n,a,o,s,h;void 0!==e.browser.genomicStateList&&(1/(h=e.browser.genomicStateList[0].referenceFrame).bpPerPixel>1?(t=(s=e.browser.syntheticViewportContainerBBox()).position,i=.5*s.width,n=t.left+i-.5*(r=h.toPixels(1)),a=Math.round(n).toString()+"px",o=Math.round(r).toString()+"px",this.$container.css({left:a,width:o}),this.$container.removeClass("igv-center-guide-thin"),this.$container.addClass("igv-center-guide-wide")):(this.$container.css({left:"50%",width:"1px"}),this.$container.removeClass("igv-center-guide-wide"),this.$container.addClass("igv-center-guide-thin")))},e.CenterGuide.prototype.resize=function(){this.repaint()},e}((igv=function(e){return e.AlertDialog=function(t,i){var r,n,a=this;this.$container=$("<div>",{id:i,class:"igv-grid-container-alert-dialog"}),t.append(this.$container),r=$('<div class="igv-grid-header">'),n=$('<div class="igv-grid-header-blurb">'),r.append(n),e.attachDialogCloseHandlerWithParent(r,(function(){a.hide()})),this.$container.append(r),this.$container.append(this.alertTextContainer()),this.$container.append(this.rowOfOk())},e.AlertDialog.prototype.alertTextContainer=function(){var e;return e=$('<div class="igv-grid-rect">'),this.$dialogLabel=$("<div>",{class:"igv-col igv-col-4-4 igv-alert-dialog-text"}),e.append(this.$dialogLabel),e},e.AlertDialog.prototype.rowOfOk=function(){var e,t,i=this;return e=$('<div class="igv-grid-rect">'),t=$('<div class="igv-col igv-col-1-4">'),e.append(t),t=$('<div class="igv-col igv-col-2-4">'),this.$ok=$('<div class="igv-col-filler-ok-button">'),this.$ok.text("OK"),this.$ok.unbind(),this.$ok.click((function(){i.hide()})),t.append(this.$ok),e.append(t),e},e.AlertDialog.prototype.hide=function(){this.$container.hasClass("igv-grid-container-dialog")&&this.$container.offset({left:0,top:0}),this.$container.hide()},e.AlertDialog.prototype.show=function(e){var t,i,r;t=$("body").scrollTop(),this.$container.hasClass("igv-grid-container-dialog")&&(i=e.offset().top+t,r=e.outerWidth()-300,this.$container.offset({left:r,top:i})),this.$container.show()},e}((igv=function(e){function t(e){var t=0;return _.each(e,(function(e){var i=$(e.contentDiv).height();t=Math.max(i,t)})),t}function i(e,t){var i;this.track.minHeight&&(e=Math.max(this.track.minHeight,e)),this.track.maxHeight&&(e=Math.min(this.track.maxHeight,e)),i=e+"px",this.track.height=e,$(this.trackDiv).height(e),this.track.paintAxis&&(this.controlCanvas.style.height=i,this.controlCanvas.setAttribute("height",$(this.trackDiv).height())),void 0!==t&&!0!==t||this.update()}return e.TrackView=function(t,i){var r,n=this;this.track=t,t.trackView=this,this.browser=i,this.trackDiv=$('<div class="igv-track-div">')[0],this.track instanceof e.RulerTrack&&(this.trackDiv.dataset.rulerTrack="rulerTrack"),$(i.trackContainerDiv).append(this.trackDiv),t.height&&(this.trackDiv.style.height=t.height+"px"),this.appendLeftHandGutterDivToTrackDiv($(this.trackDiv)),this.$viewportContainer=$('<div class="igv-viewport-container igv-viewport-container-shim">'),$(this.trackDiv).append(this.$viewportContainer),this.viewports=[],_.each(_.range(_.size(i.genomicStateList)),(function(t){n.viewports.push(new e.Viewport(n,t))})),this.configureViewportContainer(this.$viewportContainer,this.viewports),(r=this.createRightHandGutter())&&$(this.trackDiv).append(r),this.attachDragWidget()},e.TrackView.prototype.configureViewportContainer=function(t,i){return"hidden"===t.css("overflow-y")&&(this.scrollbar=new e.TrackScrollbar(t,i),t.append(this.scrollbar.$outerScroll)),t},e.TrackScrollbar=function(e,i){function r(e){e.preventDefault(),a(e.pageY-o),e.stopPropagation()}function n(e){$(window).off("mousemove .igv",null,r),$(window).off("mouseup .igv",null,n)}function a(e){var r,n,a,o,h;o=s.$outerScroll.height(),h=s.$innerScroll.height(),r=Math.min(Math.max(0,e),o-h),a=t(i),n=-Math.round(r*(a/s.$viewportContainer.height())),s.$innerScroll.css("top",r+"px"),_.each(i,(function(e){$(e.contentDiv).css("top",n+"px")}))}var o,s=this;contentDivHeight=t(i),this.$outerScroll=$('<div class="igv-scrollbar-outer-div">'),this.$innerScroll=$("<div>"),this.$outerScroll.append(this.$innerScroll),this.$viewportContainer=e,this.viewports=i,this.$innerScroll.mousedown((function(e){e.preventDefault(),o=e.pageY-$(this).position().top,$(window).on("mousemove .igv",null,null,r),$(window).on("mouseup .igv",null,null,n),e.stopPropagation()})),this.$innerScroll.click((function(e){e.stopPropagation()})),this.$outerScroll.click((function(e){a(e.offsetY-s.$innerScroll.height()/2),e.stopPropagation()}))},e.TrackScrollbar.prototype.update=function(){var e,i,r;e=this.$viewportContainer.height(),i=t(this.viewports),r=Math.round(e/i*e),i>e?(this.$outerScroll.show(),this.$innerScroll.height(r)):this.$outerScroll.hide()},e.TrackView.prototype.attachDragWidget=function(){var t=this;t.$trackDragScrim=$('<div class="igv-track-drag-scrim">'),t.$viewportContainer.append(t.$trackDragScrim),t.$trackDragScrim.hide(),t.$trackManipulationHandle=$('<div class="igv-track-manipulation-handle">'),$(t.trackDiv).append(t.$trackManipulationHandle),t.$trackManipulationHandle.mousedown((function(i){i.preventDefault(),t.isMouseDown=!0,e.browser.dragTrackView=t})),t.$trackManipulationHandle.mouseup((function(e){t.isMouseDown=void 0})),t.$trackManipulationHandle.mouseenter((function(i){t.isMouseIn=!0,e.browser.dragTargetTrackView=t,(void 0===e.browser.dragTrackView||t===e.browser.dragTrackView)&&t.$trackDragScrim.show(),e.browser.dragTargetTrackView&&e.browser.dragTrackView&&e.browser.dragTargetTrackView!==e.browser.dragTrackView&&(e.browser.dragTargetTrackView.track.order<e.browser.dragTrackView.track.order?(e.browser.dragTrackView.track.order=e.browser.dragTargetTrackView.track.order,e.browser.dragTargetTrackView.track.order=1+e.browser.dragTrackView.track.order):(e.browser.dragTrackView.track.order=e.browser.dragTargetTrackView.track.order,e.browser.dragTargetTrackView.track.order=e.browser.dragTrackView.track.order-1),e.browser.reorderTracks())})),t.$trackManipulationHandle.mouseleave((function(i){t.isMouseIn=void 0,e.browser.dragTargetTrackView=void 0,t!==e.browser.dragTrackView&&t.$trackDragScrim.hide()}))},e.TrackView.prototype.appendLeftHandGutterDivToTrackDiv=function(t){var i,r,n,a,o=this;this.track.paintAxis&&(i=$('<div class="igv-left-hand-gutter">'),t.append(i[0]),r=$('<canvas class ="igv-track-control-canvas">'),n=i.outerWidth(),a=i.outerHeight(),r.attr("width",n),r.attr("height",a),i.append(r[0]),this.controlCanvas=r[0],this.controlCtx=this.controlCanvas.getContext("2d"),this.track.dataRange&&(i.click((function(t){e.dataRangeDialog.configureWithTrackView(o),e.dataRangeDialog.show()})),i.addClass("igv-clickable")),this.leftHandGutter=i[0])},e.TrackView.prototype.createRightHandGutter=function(){var t,i=this;if(!this.track.ignoreTrackMenu)return(t=$('<i class="fa fa-gear">')).click((function(t){e.popover.presentTrackGearMenu(t.pageX,t.pageY,i)})),this.rightHandGutter=$('<div class="igv-right-hand-gutter">')[0],$(this.rightHandGutter).append(t),this.rightHandGutter},e.TrackView.prototype.setContentHeightForViewport=function(e,t){e.setContentHeight(t),this.scrollbar&&this.scrollbar.update()},e.TrackView.prototype.dataRange=function(){return this.track.dataRange?this.track.dataRange:void 0},e.TrackView.prototype.setDataRange=function(e,t,i){this.track.dataRange.min=e,this.track.dataRange.max=t,this.track.autoscale=i,this.update()},e.TrackView.prototype.setColor=function(e){this.track.color=e,this.update()},e.TrackView.prototype.setTrackHeight=function(e,t){i.call(this,e,t||!0)},e.TrackView.prototype.isLoading=function(){var e;return e=!1,_.each(this.viewports,(function(t){!1===e&&(e=t.isLoading())})),e},e.TrackView.prototype.resize=function(){_.each(this.viewports,(function(e){e.resize()})),this.scrollbar&&this.scrollbar.update()},e.TrackView.prototype.update=function(){_.each(this.viewports,(function(e){e.update()})),this.scrollbar&&this.scrollbar.update()},e.TrackView.prototype.repaint=function(){_.each(this.viewports,(function(e){e.repaint()}))},e}((igv=function(e){function t(t,r){var n,a,o;t.$drag_drop_surface=$('<div class="igv-drag-drop-surface">'),r.append(t.$drag_drop_surface),t.$drag_drop_surface.on("drag dragstart dragend dragover dragenter dragleave drop",(function(e){e.preventDefault(),e.stopPropagation()})).on("dragover dragenter",(function(){$(".igv-drag-drop-container").addClass("is-dragover")})).on("dragleave dragend drop",(function(){$(".igv-drag-drop-container").removeClass("is-dragover")})).on("drop",(function(e){t.loadLocalFiles(e.originalEvent.dataTransfer.files)})),t.$file_input_container=$('<div class="igv-drag-drop-file-input">'),t.$drag_drop_surface.append(t.$file_input_container),t.$file_input=$('<input id="igv-track-file-input" class="igv-track-file-input-css" type="file" name="files[]" data-multiple-caption="{count} files selected" multiple="">'),t.$file_input_container.append(t.$file_input),t.$file_input.on("change",(function(e){t.loadLocalFiles(e.target.files)})),function(e,t,i,r){var a,o;a=$("<label>"),e.append(a),a.attr("for",i),a.attr("id",r),(o=$("<strong>")).text(t),a.append(o),(n=$('<span class="igv-drag-drop-surface-blurb">')).text(" or drop file(s) here"),a.append(n)}(t.$file_input_container,"Choose file(s)","igv-track-file-input","load-file-blurb"),t.$file_input_blurb=t.$file_input_container.find("#load-file-blurb"),a=$('<div id="file_input_ok" class="igv-drag-drop-ok">'),t.$drag_drop_surface.append(a),a.text("ok"),a.hide(),a.on("click",(function(r){var n;n=e.getExtension({url:t.file}),void 0===t.indexFile&&!1===e.TrackFileLoad.keyToIndexExtension[n].optional?t.warnWithMessage("ERROR. "+n+" files require an index file."):void 0===t.indexFile&&!0===e.TrackFileLoad.keyToIndexExtension[n].optional?(e.browser.loadTrack({url:t.file,indexURL:void 0,indexed:!1}),i(t)):(e.browser.loadTrack({url:t.file,indexURL:t.indexFile}),i(t))})),o=$('<div id="file_input_cancel" class="igv-drag-drop-cancel">'),t.$drag_drop_surface.append(o),o.text("cancel"),o.hide(),o.on("click",(function(e){i(t)})),function(t,r){var n,a;t.$url_input_container=$('<div class="igv-drag-and-drop-url-input-container">'),r.append(t.$url_input_container),t.$or=$("<div>"),t.$url_input_container.append(t.$or),t.$or.text("or"),t.$url_input=$('<input class="igv-drag-and-drop-url-input" placeholder="enter data file URL">'),t.$url_input_container.append(t.$url_input),t.$url_input.on("change",(function(r){var o;o=$(this).val(),e.TrackFileLoad.isIndexFile(o)?(t.warnWithMessage("Error. Must enter data URL."),$(this).val(void 0)):!1===e.TrackFileLoad.isIndexable(o)?(e.browser.loadTrack({url:o,indexed:!1}),$(this).val(void 0),i(t)):(t.$file_input_container.hide(),t.$or.hide(),t.$url_input_feedback.text(o.split("/").pop()),t.$url_input_feedback.show(),$(this).hide(),n.show(),a.show())})),t.$url_input_feedback=$('<div class="igv-drag-and-drop-url-input-feedback" >'),t.$url_input_container.append(t.$url_input_feedback),t.$url_input_feedback.hide(),t.$index_url_input=$('<input class="igv-drag-and-drop-url-input" placeholder="enter associated index file URL">'),t.$url_input_container.append(t.$index_url_input),t.$index_url_input.on("change",(function(i){var r;r=$(this).val(),!1===e.TrackFileLoad.isIndexFile(r)?(t.warnWithMessage("ERROR. Must enter index URL."),$(this).val(void 0)):(t.$index_url_input_feedback.text(r.split("/").pop()),t.$index_url_input_feedback.show(),$(this).hide())})),t.$index_url_input_feedback=$('<div class="igv-drag-and-drop-url-input-feedback" >'),t.$url_input_container.append(t.$index_url_input_feedback),t.$index_url_input_feedback.hide(),n=$('<div  id="url_input_ok" class="igv-drag-drop-ok">'),t.$url_input_container.append(n),n.text("ok"),n.hide(),n.on("click",(function(r){var n,a,o,s;n=""===t.$url_input.val()?void 0:t.$url_input.val(),a=""===t.$index_url_input.val()?void 0:t.$index_url_input.val(),o=e.getExtension({url:n}),s=e.TrackFileLoad.keyToIndexExtension[o]?o:"any",void 0===a&&!1===e.TrackFileLoad.keyToIndexExtension[s].optional?t.warnWithMessage("ERROR. A "+o+" data URL requires an associated index URL."):void 0===n?t.warnWithMessage("ERROR. A data URL must be entered."):void 0===a&&!0===e.TrackFileLoad.keyToIndexExtension[s].optional?(e.browser.loadTrack({url:n,indexURL:void 0,indexed:!1}),i(t)):(e.browser.loadTrack({url:n,indexURL:a}),i(t))})),a=$('<div  id="url_input_cancel" class="igv-drag-drop-cancel">'),t.$url_input_container.append(a),a.text("cancel"),a.hide(),a.on("click",(function(e){i(t)}))}(t,t.$drag_drop_surface)}function i(e){$("#file_input_ok").hide(),$("#file_input_cancel").hide(),e.$file_input.show(),e.$file_input_blurb.show(),e.$file_input_container.show(),e.file=void 0,e.indexFile=void 0,e.$or.show(),e.$url_input_container.show(),$("#url_input_ok").hide(),$("#url_input_cancel").hide(),e.$url_input.show(),e.$url_input.val(void 0),e.$url_input_feedback.hide(),e.$index_url_input.show(),e.$index_url_input.val(void 0),e.$index_url_input_feedback.hide(),e.$warning.hide(),e.$container.hide()}return e.TrackFileLoad=function(){var e,r,n,a=this;this.$container=$('<div class="igv-drag-drop-container">'),t(this,this.$container),this.$warning=(e=$('<div class="igv-drag-drop-warning">'),r=$('<div id="warning-message">'),e.append(r),r=$('<div id="warning-dismiss">'),e.append(r),n=$('<i class="fa fa-times-circle">'),r.append(n),n.on("click",(function(){e.hide()})),e.hide(),e),this.$container.append(this.$warning),this.$container.append($('<div class="igv-drag-drop-shim">')),this.$container.append(function(){function e(){r.removeClass("fa-times-circle"),r.addClass("fa-times")}var t,r;return(r=$('<i class="fa">')).hover((function(){r.removeClass("fa-times"),r.addClass("fa-times-circle")}),e),r.on("click",(function(){e(),i(a)})),(t=$('<div class="igv-drag-and-drop-close-container">')).append(r),e(),t}()),this.$presentationButton=$('<div class="igv-drag-and-drop-presentation-button">'),this.$presentationButton.text("Load Track"),this.$presentationButton.on("click",(function(){a.$container.is(":visible")?i(a):a.$container.show()}))},e.TrackFileLoad.prototype.warnWithMessage=function(e){this.$warning.find("#warning-message").text(e),this.$warning.show()},e.TrackFileLoad.keyToIndexExtension={bam:{extension:"bai",optional:!1},any:{extension:"idx",optional:!0},gz:{extension:"tbi",optional:!0}},e.TrackFileLoad.indexExtensionToKey=_.invert(_.mapObject(e.TrackFileLoad.keyToIndexExtension,(function(e){return e.extension}))),e.TrackFileLoad.isIndexFile=function(t){var i;return i=e.getExtension({url:t}),_.contains(_.keys(e.TrackFileLoad.indexExtensionToKey),i)},e.TrackFileLoad.isIndexable=function(t){var i;return!e.TrackFileLoad.isIndexFile(t)&&("wig"!==(i=e.getExtension({url:t}))&&"seg"!==i)},e.TrackFileLoad.prototype.loadLocalFiles=function(t){var r,n,a,o,s,h,c,l,u,d,p,f;r=function(t){var i,r;return i=_.filter(t,(function(t){return!e.TrackFileLoad.isIndexFile(t)})),_.size(i)>0?(r={},_.each(i,(function(t){var i,n,a,o;i=t.name.split("."),"gz"===_.last(i)&&i.pop(),i.pop(),n=i.join("."),a=e.getExtension({url:t}),o=_.contains(_.keys(e.TrackFileLoad.keyToIndexExtension),a)?a:"any",r[n]={file:t,extension:a,indexExtensionLookup:o}})),r):void 0}(t),n=function(t){var i,r;return i=_.filter(t,(function(t){return e.TrackFileLoad.isIndexFile(t)})),_.size(i)>0?(r={},_.each(i,(function(e){var t,i;t=e.name.slice(0,-4).split("."),_.size(t)>1?(t.pop(),i=t.join(".")):i=t,r[i]=e})),r):void 0}(t),void 0===r&&void 0===n?this.warnWithMessage("ERROR: No data or index file(s) provided."):void 0===n?(l=[],_.each(r,(function(t,i){!1===e.TrackFileLoad.keyToIndexExtension[t.indexExtensionLookup].optional&&l.push(i)})),u=_.difference(_.keys(r),l),(h=_.size(u)>0?_.pick(r,u):void 0)&&(a=_.map(_.pluck(h,"file"),(function(e){return{url:e,indexed:!1}})),e.browser.loadTracksWithConfigList(a)),_.size(l)>0?(d=_.map(l,(function(e){return r[e].file.name})).join(" and "),this.warnWithMessage("ERROR: "+d+" require an associated index file.")):i(this)):void 0===r?(p=_.map(n,(function(e){return e.name})).join(" and "),p+=" require an associated data file.",this.warnWithMessage("ERROR: "+p)):(s=function(t,i){var r,n;return r=[],_.each(t,(function(t,n){var a=void 0!==i;!1===e.TrackFileLoad.keyToIndexExtension[t.indexExtensionLookup].optional&&a&&void 0===i[n]&&r.push(n)})),n="",_.size(r)>0?(n=_.map(r,(function(e){return t[e].file.name})).join(" and "),{missing:r,blurb:n+=" require an associated index file."}):void 0}(r,n),o=function(e,t){var i,r;return i=[],_.each(t,(function(t,r){void 0===e[r]&&i.push(r)})),r="",_.size(i)>0?(r=_.map(i,(function(e){return t[e].name})).join(" and "),{missing:i,blurb:r+=" require an associated data file."}):void 0}(r,n),d=void 0,p=s?s.blurb:void 0,f=o?o.blurb:void 0,p&&f?d=p+" "+f:p?d=p:f&&(d=f),u=s?_.difference(_.keys(r),s.missing):_.keys(r),h=_.size(u)>0?_.pick(r,u):void 0,u=o?_.difference(_.keys(n),o.missing):_.keys(n),c=_.size(u)>0?_.pick(n,u):void 0,h&&(a=_.map(_.keys(h),(function(e){return c&&c[e]?{url:h[e].file,indexURL:c[e]}:{url:h[e].file,indexed:!1}})),e.browser.loadTracksWithConfigList(a)),d?this.warnWithMessage("ERROR: "+d):i(this))},e}((igv=function(e){var t=new Set(["narrowpeak","broadpeak","peaks","bedgraph","wig","gff3","gff","gtf","aneu","fusionjuncspan","refflat","seg","bed","vcf","bb","bigbed","bw","bigwig","bam","tdf","refgene","genepred","genepredext"]);return e.getFormat=function(t){return void 0===e.browser||void 0===e.browser.formats?void 0:e.browser.formats[t]},e.createTrackWithConfiguration=function(t){switch(void 0===t.type?"unknown_type":t.type.toLowerCase()){case"gwas":return new e.GWASTrack(t);case"annotation":case"genes":case"fusionjuncspan":return new e.FeatureTrack(t);case"variant":return new e.VariantTrack(t);case"alignment":return new e.BAMTrack(t);case"data":case"wig":return new e.WIGTrack(t);case"sequence":return new e.SequenceTrack(t);case"eqtl":return new e.EqtlTrack(t);case"seg":return new e.SegTrack(t);case"aneu":return new e.AneuTrack(t);default:return}},e.inferTrackTypes=function(i){(function(e){e.featureType&&(e.type=e.type||e.featureType,e.featureType=void 0),"bed"===e.type?(e.type="annotation",e.format=e.format||"bed"):"bam"===e.type?(e.type="alignment",e.format="bam"):"vcf"===e.type?(e.type="variant",e.format="vcf"):"t2d"===e.type?e.type="gwas":"FusionJuncSpan"===e.type&&(e.format="fusionjuncspan")})(i),void 0===i.sourceType&&i.url&&(i.sourceType="file"),"file"===i.sourceType&&void 0===i.format&&function(i){var r,n,a;if(i.format)i.format=i.format.toLowerCase();else switch((n=(r=(e.isFilePath(i.url)?i.url.name:i.url).toLowerCase()).indexOf("?"))>0&&(r=r.substr(0,n)),r.endsWith(".gz")?r=r.substr(0,r.length-3):(r.endsWith(".txt")||r.endsWith(".tab"))&&(r=r.substr(0,r.length-4)),(a=(n=r.lastIndexOf("."))<0?r:r.substr(n+1)).toLowerCase()){case"bw":i.format="bigwig";break;case"bb":i.format="bigbed";default:t.has(a)&&(i.format=a)}}(i),void 0===i.type&&function(e){if(!e.type&&void 0!==e.format)switch(e.format.toLowerCase()){case"bw":case"bigwig":case"wig":case"bedgraph":case"tdf":e.type="wig";break;case"vcf":e.type="variant";break;case"seg":e.type="seg";break;case"bam":e.type="alignment";break;default:e.type="annotation"}}(i)},e.configTrack=function(t,i){t.config=i,t.url=i.url,i.name=i.name||i.label,i.name?t.name=i.name:e.isFilePath(i.url)?t.name=i.url.name:t.name=i.url,t.id=i.id||t.name,t.order=i.order,t.color=i.color||e.browser.constants.defaultColor||"rgb(0,0,150)",t.removable=void 0===i.removable||i.removable,t.height=i.height||("wig"===i.type?50:100),void 0===i.autoHeight&&(i.autoHeight=i.autoheight),t.autoHeight=void 0===i.autoHeight?void 0===i.height:i.autoHeight,t.minHeight=i.minHeight||Math.min(50,t.height),t.maxHeight=i.maxHeight||Math.max(500,t.height),i.visibilityWindow&&(t.visibilityWindow=i.visibilityWindow),void 0===t.type&&(t.type=i.type)},e.setTrackLabel=function(e,t){var i=_.first(e.trackView.viewports);e.name=t,i.$viewport.find(".igv-track-label").html(e.name),e.trackView&&e.trackView.repaint()},e.paintAxis=function(t,i,r){function n(e){return 0===e?"0":Math.abs(e)>=10?e.toFixed():Math.abs(e)>=1?e.toFixed(1):e.toFixed(2)}var a,o,s,h,c,l,u,d={font:"normal 10px Arial",textAlign:"right",strokeStyle:"black"};void 0!==this.dataRange&&void 0!==this.dataRange.max&&void 0!==this.dataRange.min&&(e.graphics.fillRect(t,0,0,i,r,{fillStyle:"rgb(255, 255, 255)"}),a=(u=.95*i)-8,.01,c={x:o=u,y:s=h=.01*r},e.graphics.strokeLine(t,a,s,o,h,d),e.graphics.fillText(t,n(this.dataRange.max),a+4,s+12,d),l={x:o,y:s=h=.99*r},e.graphics.strokeLine(t,a,s,o,h,d),e.graphics.fillText(t,n(this.dataRange.min),a+4,s-4,d),e.graphics.strokeLine(t,c.x,c.y,l.x,l.y,d))},e.trackPopupMenuItemList=function(t,i,r,n,a){var o,s;return o={popover:t,viewport:i,genomicLocation:r,x:n,y:a},s=[],i.trackView.track.popupMenuItemList&&(s=e.trackMenuItemListHelper(i.trackView.track.popupMenuItemList(o))),s},e.trackMenuItemList=function(t,i){var r,n=[];return n.push(e.trackMenuItem(t,i,"Set track name",(function(){return"Track Name"}),i.track.name,(function(){var t=function(e){var t=/(?=.*[a-zA-Z].*)([a-zA-Z0-9 ]+)/.exec(e);return null!==t?t[0]:"untitled"}(e.dialog.$dialogInput.val());void 0!==t&&(e.setTrackLabel(i.track,t),i.update())}),void 0)),n.push(e.trackMenuItem(t,i,"Set track height",(function(){return"Track Height"}),i.trackDiv.clientHeight,(function(){var t=parseFloat(e.dialog.$dialogInput.val(),10);void 0!==t&&(void 0!==i.track.minHeight&&i.track.minHeight>t&&(i.track.minHeight=t),void 0!==i.track.maxHeight&&i.track.maxHeight<t&&(i.track.minHeight=t),i.setTrackHeight(t),i.track.autoHeight=!1)}),void 0)),r=[],i.track.menuItemList&&(r=n.concat(e.trackMenuItemListHelper(i.track.menuItemList(t)))),!1!==i.track.removable&&r.push(e.trackMenuItem(t,i,"Remove track",(function(){return'<div class="igv-dialog-label-centered">'+("Remove "+i.track.name)+"</div>"}),void 0,(function(){t.hide(),i.browser.removeTrack(i.track)}),!0)),r},e.trackMenuItemListHelper=function(e){var t=[];return _.size(e)>0&&(t=_.map(e,(function(e,t){var i;return e.name?(i=$("<div>")).text(e.name):i=e.object,0===t&&i.addClass("igv-track-menu-border-top"),e.click&&i.click(e.click),{object:i,init:e.init||void 0}}))),t},e.trackMenuItem=function(t,i,r,n,a,o,s){var h,c;return h=$("<div>"),!0===s&&h.addClass("igv-track-menu-border-top"),h.text(r),c=function(){var r=$(i.trackDiv);e.dialog.configure(n,a,o),e.dialog.show(r),t.hide()},h.click(c),{object:h,init:void 0}},e.dataRangeMenuItem=function(t,i){var r,n;return(r=$("<div>")).text("Set data range"),n=function(){e.dataRangeDialog.configureWithTrackView(i),e.dataRangeDialog.show(),t.hide()},r.click(n),{object:r,init:void 0}},e.colorPickerMenuItem=function(t,i){var r,n;return(r=$("<div>")).text("Set track color"),n=function(){e.colorPicker.configure(i),e.colorPicker.show(),t.hide()},r.click(n),{object:r,init:void 0}},e}((igv=function(e){e.TDFSource=function(t){this.windowFunction=t.windowFunction||"mean",this.reader=new e.TDFReader(t)},e.TDFSource.prototype.getFeatures=function(i,r,n,a){var o=this;return new Promise((function(s,h){o.reader.readRootGroup().then((function(c){var l,u=function(i,r){var n=e.browser.genome.getChromosome(i).bpLength;return Math.ceil(Math.log(Math.max(0,n/(700*r)))/t)}(i,a),d=o.reader.chrNameMap[i],p=o.reader.maxZoom;void 0===d&&(d=i),void 0===p&&(p=-1),l=u>p?"raw":o.windowFunction,o.reader.readDataset(d,l,u).then((function(e){if(null!=e){var t,i=e.tileWidth,a=Math.floor(r/i),c=Math.floor(n/i),l=[];for(t=a;t<=c;t++)void 0!==e.tiles[t]&&l.push(o.reader.readTile(e.tiles[t],1));Promise.all(l).then((function(e){var t=[];_.each(e,(function(e){switch(e.type){case"bed":!function(e,t,i,r,n,a){var o,s=e.nPositions,h=e.start,c=e.end,l=e.data[0];for(o=0;o<s;o++){var u=h[o],d=c[o];if(!(d<i)){if(u>r)break;a.push({start:u,end:d,value:l[o]})}}}(e,0,r,n,0,t);break;case"variableStep":!function(e,t,i,r,n,a){var o,s=e.nPositions,h=e.start,c=e.span,l=e.data[0];for(o=0;o<s;o++){var u=h[o],d=u+c;if(!(d<i)){if(u>r)break;a.push({start:u,end:d,value:l[o]})}}}(e,0,r,n,0,t);break;case"fixedStep":!function(e,t,i,r,n,a){var o,s=e.nPositions,h=e.start,c=e.span,l=e.data[0];for(o=0;o<s;o++){var u=h+c;if(!(u<i)){if(h>r)break;Number.isNaN(l[o])||a.push({start:h,end:u,value:l[o]}),h=u}}}(e,0,r,n,0,t);break;default:return void h("Unknown tile type: "+e.type)}})),s(t)})).catch(h)}else s(null)})).catch(h)}))}))};var t=Math.log(2);return e}((igv=function(e){return e.TDFReader=function(e){this.config=e,this.path=e.url,this.groupCache={}},e.TDFReader.prototype.readHeader=function(){var t=this;return void 0!==this.magic?Promise.resolve(this):new Promise((function(i,r){igvxhr.loadArrayBuffer(t.path,e.buildOptions(t.config,{range:{start:0,size:64e3}})).then((function(n){if(n){var a=new e.BinaryParser(new DataView(n));if(t.magic=a.getInt(),t.version=a.getInt(),t.indexPos=a.getLong(),t.indexSize=a.getInt(),a.getInt(),t.version>=2){var o=a.getInt();for(t.windowFunctions=[];o-- >0;)t.windowFunctions.push(a.getString())}t.trackType=a.getString(),t.trackLine=a.getString();var s=a.getInt();for(t.trackNames=[];s-- >0;)t.trackNames.push(a.getString());t.genomeID=a.getString(),t.flags=a.getInt(),t.compressed=0!=(1&t.flags),igvxhr.loadArrayBuffer(t.path,e.buildOptions(t.config,{range:{start:t.indexPos,size:t.indexSize}})).then((function(n){if(n){a=new e.BinaryParser(new DataView(n)),t.datasetIndex={};for(var o=a.getInt();o-- >0;){var s=a.getString(),h=a.getLong(),c=a.getInt();t.datasetIndex[s]={position:h,size:c}}for(t.groupIndex={},o=a.getInt();o-- >0;)s=a.getString(),h=a.getLong(),c=a.getInt(),t.groupIndex[s]={position:h,size:c};i(t)}else r("no data")})).catch(r)}else r("no data")})).catch(r)}))},e.TDFReader.prototype.readDataset=function(t,i,r){var n=this;return new Promise((function(a,o){n.readHeader().then((function(s){var h,c,l=n.version<2?"":"/"+i,u="all"===t||void 0===r?"0":r.toString();h="raw"===i?"/"+t+"/raw":"/"+t+"/z"+u+l,void 0===(c=n.datasetIndex[h])?a(null):igvxhr.loadArrayBuffer(n.path,e.buildOptions(n.config,{range:{start:c.position,size:c.size}})).then((function(t){if(t){for(var i=new e.BinaryParser(new DataView(t)),r=i.getInt(),n={};r-- >0;)n[i.getString()]=i.getString();for(var s=i.getString(),c=i.getFloat(),l=i.getInt(),u=[];l-- >0;)u.push({position:i.getLong(),size:i.getInt()});a({name:h,attributes:n,dataType:s,tileWidth:c,tiles:u})}else o("no data")})).catch(o)})).catch(o)}))},e.TDFReader.prototype.readRootGroup=function(){var t=this,i=this.groupCache["/"];return i?Promise.resolve(i):new Promise((function(i,r){t.readGroup("/").then((function(r){var n=e.browser.genome,a=r.chromosomes,o=r.maxZoom;o&&(t.maxZoom=Number(o)),t.chrNameMap={},a&&_.each(a.split(","),(function(e){var i=n.getChromosomeName(e);t.chrNameMap[i]=e})),i(r)})).catch(r)}))},e.TDFReader.prototype.readGroup=function(t){var i=this;return new Promise((function(r,n){i.readHeader().then((function(a){var o=i.groupCache[t],s=i.groupIndex[t];if(o)r(o);else{if(void 0===s)return r(null);igvxhr.loadArrayBuffer(i.path,e.buildOptions(i.config,{range:{start:s.position,size:s.size}})).then((function(a){if(a){for(var o=new e.BinaryParser(new DataView(a)),s=o.getInt(),h={name:t};s-- >0;)h[o.getString()]=o.getString();i.groupCache[t]=h,r(h)}else n("no data")})).catch(n)}})).catch(n)}))},e.TDFReader.prototype.readTile=function(t,i){var r=this;return new Promise((function(n,a){igvxhr.loadArrayBuffer(r.path,e.buildOptions(r.config,{range:{start:t.position,size:t.size}})).then((function(t){if(t){if(r.compressed)t=new Zlib.Inflate(new Uint8Array(t)).decompress().buffer;var o=new e.BinaryParser(new DataView(t)),s=o.getString();switch(s){case"fixedStep":n(function(e,t){var i,r,n=e.getInt(),a=e.getInt(),o=e.getFloat(),s=n,h=t;for(i=[];h-- >0;){for(s=n,r=[];s-- >0;)r.push(e.getFloat());i.push(r)}return{type:"fixedStep",start:a,span:o,data:i,nTracks:t,nPositions:n}}(o,i));break;case"variableStep":n(function(e,t){for(var i,r,n=e.getInt(),a=e.getFloat(),o=e.getInt(),s=o,h=t,c=[];s-- >0;)c.push(e.getInt());for(e.getInt(),i=[];h-- >0;){for(s=o,r=[];s-- >0;)r.push(e.getFloat());i.push(r)}return{type:"variableStep",tileStart:n,span:a,start:c,data:i,nTracks:t,nPositions:o}}(o,i));break;case"bed":case"bedWithName":n(function(e,t,i){var r,n,a,o,s,h,c;for(h=r=e.getInt(),n=[];h-- >0;)n.push(e.getInt());for(h=r,a=[];h-- >0;)a.push(e.getInt());for(e.getInt(),o=[],c=t;c-- >0;){for(np=r,dtrack=[];np-- >0;)dtrack.push(e.getFloat());o.push(dtrack)}if("bedWithName"===i)for(h=r,s=[];h-- >0;)s.push(e.getString());return{type:i,start:n,end:a,data:o,name:s,nTracks:t,nPositions:r}}(o,i,s));break;default:a("Unknown tile type: "+s)}}else a("no data")})).catch(a)}))},e}((igv=function(e){return e.SVG=function(){this.svg="",this.contents=[],[]},e.SVG.prototype.setProperties=function(e){var t="";for(var i in e)if(e.hasOwnProperty(i)){var r=e[i];"font-family"===i?t+="font-family:"+r+";":"font-size"===i?t+="font-size:"+r+";":"fillStyle"==i||"fill"===i?t+="fill:"+r+";":"strokeStyle"==i||"stroke"===i?t+="stroke:"+r+";":"stroke-width"===i?t+="stroke-width:"+r+";":console.log("Unknown property: "+i)}return t},e.SVG.prototype.setTransforms=function(e,t,i){var r="";for(var n in e){if(e.hasOwnProperty(n)){var a=e[n];"rotate"===n?(r+="rotate("+a.angle,r+=","+t,r+=","+i,r+=")"):"translate"===n?(r+="translate("+a[t],"y"in a&&(r+=","+a.y),r+=")"):console.log("Unknown transform: "+n)}r+=" "}return r},e.SVG.prototype.clearRect=function(e,t,i,r){},e.SVG.prototype.strokeLine=function(e,t,i,r,n,a){var o="";o+='<line x1="'+e+'" y1="'+t+'" x2="'+i+'" y2="'+r+'"',n&&(o+=' style="'+this.setProperties(n)+'"'),a&&(o+=' transform="'+this.setTransforms(a,e,t)+'"'),o+="/>",this.contents.push(o)},e.SVG.prototype.fillRect=function(e,t,i,r,n,a){var o="";o+='<rect x="'+e+'" y="'+t,o+='" width="'+i+'" height="'+r+'"',n&&(o+=' style="'+this.setProperties(n)+'"'),a&&(o+=' transform="'+this.setTransforms(a,e,t)+'"'),o+="/>",this.contents.push(o)},e.SVG.prototype.fillRectWithCenter=function(e,t,i,r,n,a){var o="";o+='<rect x="'+(e-i/2)+'" y="'+(t-r/2),o+='" width="'+i+'" height="'+r+'"',n&&(o+=' style="'+this.setProperties(n)+'"'),a&&(o+=' transform="'+this.setTransforms(a,e,t)+'"'),o+="/>",this.contents.push(o)},e.SVG.prototype.fillPolygon=function(e,t,i,r){var n="";n+='<polygon points="';for(var a=0;a<e.length;a++)n+=" "+e[a]+","+t[a];n+='"',i&&(n+=' style="'+this.setProperties(i)+'"'),r&&(n+=' transform="'+this.setTransforms(r,e,t)+'"'),n+="/>",this.contents.push(n)},e.SVG.prototype.fillText=function(e,t,i,r,n){var a="";a+='<text x="'+t+'" y="'+i+'"',r&&(a+=' style="'+this.setProperties(r)+'"'),n&&(a+=' transform="'+this.setTransforms(n,t,i)+'"'),a+=">",a+=e,a+="</text>",this.contents.push(a)},e.SVG.prototype.strokeText=function(e,t,i,r,n){var a="";a+='<text x="'+t+'" y="'+i+'"',r&&(a+=' style="'+this.setProperties(r)+'"'),n&&(a+=' transform="'+this.setTransforms(n,t,i)+'"'),a+=">",a+=e,a+="</text>",this.contents.push(a)},e.SVG.prototype.strokeCircle=function(e,t,i,r,n){var a="";a+='<circle cx="'+e+'" cy="'+t+'" r="'+i+'" stroke="black" fill-opacity="0.0"/>',this.contents.push(a)},e.SVG.prototype.string=function(){var e="";e+='<svg width="100%" height="100%" version="1.1" xmlns="http://www.w3.org/2000/svg">';for(var t=0;t<this.contents.length;t++)e+="\n"+this.contents[t];return e+"</svg>"},e.SVG.prototype.innerString=function(){for(var e="",t=0;t<this.contents.length;t++)e+="\n"+this.contents[t];return e},e}(igv||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{}))||{});var MAX_WBITS=15,DEF_WBITS=MAX_WBITS,MAX_MEM_LEVEL=9,MANY=1440,BMAX=15,PRESET_DICT=32,Z_NO_FLUSH=0,Z_PARTIAL_FLUSH=1,Z_SYNC_FLUSH=2,Z_FULL_FLUSH=3,Z_FINISH=4,Z_DEFLATED=8,Z_OK=0,Z_STREAM_END=1,Z_NEED_DICT=2,Z_ERRNO=-1,Z_STREAM_ERROR=-2,Z_DATA_ERROR=-3,Z_MEM_ERROR=-4,Z_BUF_ERROR=-5,Z_VERSION_ERROR=-6,METHOD=0,FLAG=1,DICT4=2,DICT3=3,DICT2=4,DICT1=5,DICT0=6,BLOCKS=7,CHECK4=8,CHECK3=9,CHECK2=10,CHECK1=11,DONE=12,BAD=13,inflate_mask=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],IB_TYPE=0,IB_LENS=1,IB_STORED=2,IB_TABLE=3,IB_BTREE=4,IB_DTREE=5,IB_CODES=6,IB_DRY=7,IB_DONE=8,IB_BAD=9,fixed_bl=9,fixed_bd=5,fixed_tl=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],fixed_td=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];ZStream.prototype.inflateInit=function(e,t){return e||(e=DEF_WBITS),t&&(t=!1),this.istate=new Inflate,this.istate.inflateInit(this,t?-e:e)},ZStream.prototype.inflate=function(e){return null==this.istate?Z_STREAM_ERROR:this.istate.inflate(this,e)},ZStream.prototype.inflateEnd=function(){if(null==this.istate)return Z_STREAM_ERROR;var e=istate.inflateEnd(this);return this.istate=null,e},ZStream.prototype.inflateSync=function(){return istate.inflateSync(this)},ZStream.prototype.inflateSetDictionary=function(e,t){return istate.inflateSetDictionary(this,e,t)},Inflate.prototype.inflateReset=function(e){return null==e||null==e.istate?Z_STREAM_ERROR:(e.total_in=e.total_out=0,e.msg=null,e.istate.mode=0!=e.istate.nowrap?BLOCKS:METHOD,e.istate.blocks.reset(e,null),Z_OK)},Inflate.prototype.inflateEnd=function(e){return null!=this.blocks&&this.blocks.free(e),this.blocks=null,Z_OK},Inflate.prototype.inflateInit=function(e,t){return e.msg=null,this.blocks=null,nowrap=0,t<0&&(t=-t,nowrap=1),t<8||t>15?(this.inflateEnd(e),Z_STREAM_ERROR):(this.wbits=t,e.istate.blocks=new InfBlocks(e,0!=e.istate.nowrap?null:this,1<<t),this.inflateReset(e),Z_OK)},Inflate.prototype.inflate=function(e,t){var i,r;if(null==e||null==e.istate||null==e.next_in)return Z_STREAM_ERROR;for(t=t==Z_FINISH?Z_BUF_ERROR:Z_OK,i=Z_BUF_ERROR;;)switch(e.istate.mode){case METHOD:if(0==e.avail_in)return i;if(i=t,e.avail_in--,e.total_in++,(15&(e.istate.method=e.next_in[e.next_in_index++]))!=Z_DEFLATED){e.istate.mode=BAD,e.msg="unknown compression method",e.istate.marker=5;break}if(8+(e.istate.method>>4)>e.istate.wbits){e.istate.mode=BAD,e.msg="invalid window size",e.istate.marker=5;break}e.istate.mode=FLAG;case FLAG:if(0==e.avail_in)return i;if(i=t,e.avail_in--,e.total_in++,r=255&e.next_in[e.next_in_index++],((e.istate.method<<8)+r)%31!=0){e.istate.mode=BAD,e.msg="incorrect header check",e.istate.marker=5;break}if(0==(r&PRESET_DICT)){e.istate.mode=BLOCKS;break}e.istate.mode=DICT4;case DICT4:if(0==e.avail_in)return i;i=t,e.avail_in--,e.total_in++,e.istate.need=(255&e.next_in[e.next_in_index++])<<24&4278190080,e.istate.mode=DICT3;case DICT3:if(0==e.avail_in)return i;i=t,e.avail_in--,e.total_in++,e.istate.need+=(255&e.next_in[e.next_in_index++])<<16&16711680,e.istate.mode=DICT2;case DICT2:if(0==e.avail_in)return i;i=t,e.avail_in--,e.total_in++,e.istate.need+=(255&e.next_in[e.next_in_index++])<<8&65280,e.istate.mode=DICT1;case DICT1:return 0==e.avail_in?i:(i=t,e.avail_in--,e.total_in++,e.istate.need+=255&e.next_in[e.next_in_index++],e.adler=e.istate.need,e.istate.mode=DICT0,Z_NEED_DICT);case DICT0:return e.istate.mode=BAD,e.msg="need dictionary",e.istate.marker=0,Z_STREAM_ERROR;case BLOCKS:if((i=e.istate.blocks.proc(e,i))==Z_DATA_ERROR){e.istate.mode=BAD,e.istate.marker=0;break}if(i==Z_OK&&(i=t),i!=Z_STREAM_END)return i;if(i=t,e.istate.blocks.reset(e,e.istate.was),0!=e.istate.nowrap){e.istate.mode=DONE;break}e.istate.mode=CHECK4;case CHECK4:if(0==e.avail_in)return i;i=t,e.avail_in--,e.total_in++,e.istate.need=(255&e.next_in[e.next_in_index++])<<24&4278190080,e.istate.mode=CHECK3;case CHECK3:if(0==e.avail_in)return i;i=t,e.avail_in--,e.total_in++,e.istate.need+=(255&e.next_in[e.next_in_index++])<<16&16711680,e.istate.mode=CHECK2;case CHECK2:if(0==e.avail_in)return i;i=t,e.avail_in--,e.total_in++,e.istate.need+=(255&e.next_in[e.next_in_index++])<<8&65280,e.istate.mode=CHECK1;case CHECK1:if(0==e.avail_in)return i;if(i=t,e.avail_in--,e.total_in++,e.istate.need+=255&e.next_in[e.next_in_index++],e.istate.was[0]!=e.istate.need){e.istate.mode=BAD,e.msg="incorrect data check",e.istate.marker=5;break}e.istate.mode=DONE;case DONE:return Z_STREAM_END;case BAD:return Z_DATA_ERROR;default:return Z_STREAM_ERROR}},Inflate.prototype.inflateSetDictionary=function(e,t,i){var r=0,n=i;return null==e||null==e.istate||e.istate.mode!=DICT0?Z_STREAM_ERROR:e._adler.adler32(1,t,0,i)!=e.adler?Z_DATA_ERROR:(e.adler=e._adler.adler32(0,null,0,0),n>=1<<e.istate.wbits&&(r=i-(n=(1<<e.istate.wbits)-1)),e.istate.blocks.set_dictionary(t,r,n),e.istate.mode=BLOCKS,Z_OK)};var mark=[0,0,255,255];Inflate.prototype.inflateSync=function(e){var t,i,r,n,a;if(null==e||null==e.istate)return Z_STREAM_ERROR;if(e.istate.mode!=BAD&&(e.istate.mode=BAD,e.istate.marker=0),0==(t=e.avail_in))return Z_BUF_ERROR;for(i=e.next_in_index,r=e.istate.marker;0!=t&&r<4;)e.next_in[i]==mark[r]?r++:r=0!=e.next_in[i]?0:4-r,i++,t--;return e.total_in+=i-e.next_in_index,e.next_in_index=i,e.avail_in=t,e.istate.marker=r,4!=r?Z_DATA_ERROR:(n=e.total_in,a=e.total_out,this.inflateReset(e),e.total_in=n,e.total_out=a,e.istate.mode=BLOCKS,Z_OK)},Inflate.prototype.inflateSyncPoint=function(e){return null==e||null==e.istate||null==e.istate.blocks?Z_STREAM_ERROR:e.istate.blocks.sync_point()};var INFBLOCKS_BORDER=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];InfBlocks.prototype.reset=function(e,t){t&&(t[0]=this.check),this.mode==IB_CODES&&this.codes.free(e),this.mode=IB_TYPE,this.bitk=0,this.bitb=0,this.read=this.write=0,this.checkfn&&(e.adler=this.check=e._adler.adler32(0,null,0,0))},InfBlocks.prototype.proc=function(e,t){var i,r,n,a,o,s,h;for(a=e.next_in_index,o=e.avail_in,r=this.bitb,n=this.bitk,h=(s=this.write)<this.read?this.read-s-1:this.end-s;;)switch(this.mode){case IB_TYPE:for(;n<3;){if(0==o)return this.bitb=r,this.bitk=n,e.avail_in=o,e.total_in+=a-e.next_in_index,e.next_in_index=a,this.write=s,this.inflate_flush(e,t);t=Z_OK,o--,r|=(255&e.next_in[a++])<<n,n+=8}switch(i=7&r,this.last=1&i,i>>>1){case 0:r>>>=3,r>>>=i=7&(n-=3),n-=i,this.mode=IB_LENS;break;case 1:inflate_trees_fixed(d=new Int32Array(1),p=new Int32Array(1),f=[],g=[],e),this.codes.init(d[0],p[0],f[0],0,g[0],0,e),r>>>=3,n-=3,this.mode=IB_CODES;break;case 2:r>>>=3,n-=3,this.mode=IB_TABLE;break;case 3:return r>>>=3,n-=3,this.mode=BAD,e.msg="invalid block type",t=Z_DATA_ERROR,this.bitb=r,this.bitk=n,e.avail_in=o,e.total_in+=a-e.next_in_index,e.next_in_index=a,this.write=s,this.inflate_flush(e,t)}break;case IB_LENS:for(;n<32;){if(0==o)return this.bitb=r,this.bitk=n,e.avail_in=o,e.total_in+=a-e.next_in_index,e.next_in_index=a,this.write=s,this.inflate_flush(e,t);t=Z_OK,o--,r|=(255&e.next_in[a++])<<n,n+=8}if((~r>>>16&65535)!=(65535&r))return this.mode=BAD,e.msg="invalid stored block lengths",t=Z_DATA_ERROR,this.bitb=r,this.bitk=n,e.avail_in=o,e.total_in+=a-e.next_in_index,e.next_in_index=a,this.write=s,this.inflate_flush(e,t);this.left=65535&r,r=n=0,this.mode=0!=left?IB_STORED:0!=this.last?IB_DRY:IB_TYPE;break;case IB_STORED:if(0==o)return this.bitb=r,this.bitk=n,e.avail_in=o,e.total_in+=a-e.next_in_index,e.next_in_index=a,write=s,this.inflate_flush(e,t);if(0==h&&(s==end&&0!=read&&(h=(s=0)<this.read?this.read-s-1:this.end-s),0==h&&(this.write=s,t=this.inflate_flush(e,t),h=(s=this.write)<this.read?this.read-s-1:this.end-s,s==this.end&&0!=this.read&&(h=(s=0)<this.read?this.read-s-1:this.end-s),0==h)))return this.bitb=r,this.bitk=n,e.avail_in=o,e.total_in+=a-e.next_in_index,e.next_in_index=a,this.write=s,this.inflate_flush(e,t);if(t=Z_OK,(i=this.left)>o&&(i=o),i>h&&(i=h),arrayCopy(e.next_in,a,window,s,i),a+=i,o-=i,s+=i,h-=i,0!=(this.left-=i))break;this.mode=0!=this.last?IB_DRY:IB_TYPE;break;case IB_TABLE:for(;n<14;){if(0==o)return this.bitb=r,this.bitk=n,e.avail_in=o,e.total_in+=a-e.next_in_index,e.next_in_index=a,this.write=s,this.inflate_flush(e,t);t=Z_OK,o--,r|=(255&e.next_in[a++])<<n,n+=8}if(this.table=i=16383&r,(31&i)>29||(i>>5&31)>29)return this.mode=IB_BAD,e.msg="too many length or distance symbols",t=Z_DATA_ERROR,this.bitb=r,this.bitk=n,e.avail_in=o,e.total_in+=a-e.next_in_index,e.next_in_index=a,this.write=s,this.inflate_flush(e,t);if(i=258+(31&i)+(i>>5&31),null==this.blens||this.blens.length<i)this.blens=new Int32Array(i);else for(var c=0;c<i;c++)this.blens[c]=0;r>>>=14,n-=14,this.index=0,mode=IB_BTREE;case IB_BTREE:for(;this.index<4+(this.table>>>10);){for(;n<3;){if(0==o)return this.bitb=r,this.bitk=n,e.avail_in=o,e.total_in+=a-e.next_in_index,e.next_in_index=a,this.write=s,this.inflate_flush(e,t);t=Z_OK,o--,r|=(255&e.next_in[a++])<<n,n+=8}this.blens[INFBLOCKS_BORDER[this.index++]]=7&r,r>>>=3,n-=3}for(;this.index<19;)this.blens[INFBLOCKS_BORDER[this.index++]]=0;if(this.bb[0]=7,(i=this.inftree.inflate_trees_bits(this.blens,this.bb,this.tb,this.hufts,e))!=Z_OK)return(t=i)==Z_DATA_ERROR&&(this.blens=null,this.mode=IB_BAD),this.bitb=r,this.bitk=n,e.avail_in=o,e.total_in+=a-e.next_in_index,e.next_in_index=a,write=s,this.inflate_flush(e,t);this.index=0,this.mode=IB_DTREE;case IB_DTREE:for(;i=this.table,this.index<258+(31&i)+(i>>5&31);){var l,u;for(i=this.bb[0];n<i;){if(0==o)return this.bitb=r,this.bitk=n,e.avail_in=o,e.total_in+=a-e.next_in_index,e.next_in_index=a,this.write=s,this.inflate_flush(e,t);t=Z_OK,o--,r|=(255&e.next_in[a++])<<n,n+=8}if(i=this.hufts[3*(this.tb[0]+(r&inflate_mask[i]))+1],(u=this.hufts[3*(this.tb[0]+(r&inflate_mask[i]))+2])<16)r>>>=i,n-=i,this.blens[this.index++]=u;else{for(c=18==u?7:u-14,l=18==u?11:3;n<i+c;){if(0==o)return this.bitb=r,this.bitk=n,e.avail_in=o,e.total_in+=a-e.next_in_index,e.next_in_index=a,this.write=s,this.inflate_flush(e,t);t=Z_OK,o--,r|=(255&e.next_in[a++])<<n,n+=8}if(n-=i,l+=(r>>>=i)&inflate_mask[c],r>>>=c,n-=c,(c=this.index)+l>258+(31&(i=this.table))+(i>>5&31)||16==u&&c<1)return this.blens=null,this.mode=IB_BAD,e.msg="invalid bit length repeat",t=Z_DATA_ERROR,this.bitb=r,this.bitk=n,e.avail_in=o,e.total_in+=a-e.next_in_index,e.next_in_index=a,this.write=s,this.inflate_flush(e,t);u=16==u?this.blens[c-1]:0;do{this.blens[c++]=u}while(0!=--l);this.index=c}}this.tb[0]=-1;var d=new Int32Array(1),p=new Int32Array(1),f=new Int32Array(1),g=new Int32Array(1);if(d[0]=9,p[0]=6,i=this.table,(i=this.inftree.inflate_trees_dynamic(257+(31&i),1+(i>>5&31),this.blens,d,p,f,g,this.hufts,e))!=Z_OK)return i==Z_DATA_ERROR&&(this.blens=null,this.mode=BAD),t=i,this.bitb=r,this.bitk=n,e.avail_in=o,e.total_in+=a-e.next_in_index,e.next_in_index=a,this.write=s,this.inflate_flush(e,t);this.codes.init(d[0],p[0],this.hufts,f[0],this.hufts,g[0],e),this.mode=IB_CODES;case IB_CODES:if(this.bitb=r,this.bitk=n,e.avail_in=o,e.total_in+=a-e.next_in_index,e.next_in_index=a,this.write=s,(t=this.codes.proc(this,e,t))!=Z_STREAM_END)return this.inflate_flush(e,t);if(t=Z_OK,this.codes.free(e),a=e.next_in_index,o=e.avail_in,r=this.bitb,n=this.bitk,h=(s=this.write)<this.read?this.read-s-1:this.end-s,0==this.last){this.mode=IB_TYPE;break}this.mode=IB_DRY;case IB_DRY:if(this.write=s,t=this.inflate_flush(e,t),h=(s=this.write)<this.read?this.read-s-1:this.end-s,this.read!=this.write)return this.bitb=r,this.bitk=n,e.avail_in=o,e.total_in+=a-e.next_in_index,e.next_in_index=a,this.write=s,this.inflate_flush(e,t);mode=DONE;case IB_DONE:return t=Z_STREAM_END,this.bitb=r,this.bitk=n,e.avail_in=o,e.total_in+=a-e.next_in_index,e.next_in_index=a,this.write=s,this.inflate_flush(e,t);case IB_BAD:return t=Z_DATA_ERROR,this.bitb=r,this.bitk=n,e.avail_in=o,e.total_in+=a-e.next_in_index,e.next_in_index=a,this.write=s,this.inflate_flush(e,t);default:return t=Z_STREAM_ERROR,this.bitb=r,this.bitk=n,e.avail_in=o,e.total_in+=a-e.next_in_index,e.next_in_index=a,this.write=s,this.inflate_flush(e,t)}},InfBlocks.prototype.free=function(e){this.reset(e,null),this.window=null,this.hufts=null},InfBlocks.prototype.set_dictionary=function(e,t,i){arrayCopy(e,t,window,0,i),this.read=this.write=i},InfBlocks.prototype.sync_point=function(){return this.mode==IB_LENS},InfBlocks.prototype.inflate_flush=function(e,t){var i,r,n;return r=e.next_out_index,(i=((n=this.read)<=this.write?this.write:this.end)-n)>e.avail_out&&(i=e.avail_out),0!=i&&t==Z_BUF_ERROR&&(t=Z_OK),e.avail_out-=i,e.total_out+=i,null!=this.checkfn&&(e.adler=this.check=e._adler.adler32(this.check,this.window,n,i)),arrayCopy(this.window,n,e.next_out,r,i),r+=i,(n+=i)==this.end&&(n=0,this.write==this.end&&(this.write=0),(i=this.write-n)>e.avail_out&&(i=e.avail_out),0!=i&&t==Z_BUF_ERROR&&(t=Z_OK),e.avail_out-=i,e.total_out+=i,null!=this.checkfn&&(e.adler=this.check=e._adler.adler32(this.check,this.window,n,i)),arrayCopy(this.window,n,e.next_out,r,i),r+=i,n+=i),e.next_out_index=r,this.read=n,t};var IC_START=0,IC_LEN=1,IC_LENEXT=2,IC_DIST=3,IC_DISTEXT=4,IC_COPY=5,IC_LIT=6,IC_WASH=7,IC_END=8,IC_BADCODE=9;InfCodes.prototype.init=function(e,t,i,r,n,a,o){this.mode=IC_START,this.lbits=e,this.dbits=t,this.ltree=i,this.ltree_index=r,this.dtree=n,this.dtree_index=a,this.tree=null},InfCodes.prototype.proc=function(e,t,i){var r,n,a,o,s,h,c,l=0,u=0,d=0;for(d=t.next_in_index,o=t.avail_in,l=e.bitb,u=e.bitk,h=(s=e.write)<e.read?e.read-s-1:e.end-s;;)switch(this.mode){case IC_START:if(h>=258&&o>=10&&(e.bitb=l,e.bitk=u,t.avail_in=o,t.total_in+=d-t.next_in_index,t.next_in_index=d,e.write=s,i=this.inflate_fast(this.lbits,this.dbits,this.ltree,this.ltree_index,this.dtree,this.dtree_index,e,t),d=t.next_in_index,o=t.avail_in,l=e.bitb,u=e.bitk,h=(s=e.write)<e.read?e.read-s-1:e.end-s,i!=Z_OK)){this.mode=i==Z_STREAM_END?IC_WASH:IC_BADCODE;break}this.need=this.lbits,this.tree=this.ltree,this.tree_index=this.ltree_index,this.mode=IC_LEN;case IC_LEN:for(r=this.need;u<r;){if(0==o)return e.bitb=l,e.bitk=u,t.avail_in=o,t.total_in+=d-t.next_in_index,t.next_in_index=d,e.write=s,e.inflate_flush(t,i);i=Z_OK,o--,l|=(255&t.next_in[d++])<<u,u+=8}if(n=3*(this.tree_index+(l&inflate_mask[r])),l>>>=this.tree[n+1],u-=this.tree[n+1],0==(a=this.tree[n])){this.lit=this.tree[n+2],this.mode=IC_LIT;break}if(0!=(16&a)){this.get=15&a,this.len=this.tree[n+2],this.mode=IC_LENEXT;break}if(0==(64&a)){this.need=a,this.tree_index=n/3+this.tree[n+2];break}if(0!=(32&a)){this.mode=IC_WASH;break}return this.mode=IC_BADCODE,t.msg="invalid literal/length code",i=Z_DATA_ERROR,e.bitb=l,e.bitk=u,t.avail_in=o,t.total_in+=d-t.next_in_index,t.next_in_index=d,e.write=s,e.inflate_flush(t,i);case IC_LENEXT:for(r=this.get;u<r;){if(0==o)return e.bitb=l,e.bitk=u,t.avail_in=o,t.total_in+=d-t.next_in_index,t.next_in_index=d,e.write=s,e.inflate_flush(t,i);i=Z_OK,o--,l|=(255&t.next_in[d++])<<u,u+=8}this.len+=l&inflate_mask[r],l>>=r,u-=r,this.need=this.dbits,this.tree=this.dtree,this.tree_index=this.dtree_index,this.mode=IC_DIST;case IC_DIST:for(r=this.need;u<r;){if(0==o)return e.bitb=l,e.bitk=u,t.avail_in=o,t.total_in+=d-t.next_in_index,t.next_in_index=d,e.write=s,e.inflate_flush(t,i);i=Z_OK,o--,l|=(255&t.next_in[d++])<<u,u+=8}if(n=3*(this.tree_index+(l&inflate_mask[r])),l>>=this.tree[n+1],u-=this.tree[n+1],0!=(16&(a=this.tree[n]))){this.get=15&a,this.dist=this.tree[n+2],this.mode=IC_DISTEXT;break}if(0==(64&a)){this.need=a,this.tree_index=n/3+this.tree[n+2];break}return this.mode=IC_BADCODE,t.msg="invalid distance code",i=Z_DATA_ERROR,e.bitb=l,e.bitk=u,t.avail_in=o,t.total_in+=d-t.next_in_index,t.next_in_index=d,e.write=s,e.inflate_flush(t,i);case IC_DISTEXT:for(r=this.get;u<r;){if(0==o)return e.bitb=l,e.bitk=u,t.avail_in=o,t.total_in+=d-t.next_in_index,t.next_in_index=d,e.write=s,e.inflate_flush(t,i);i=Z_OK,o--,l|=(255&t.next_in[d++])<<u,u+=8}this.dist+=l&inflate_mask[r],l>>=r,u-=r,this.mode=IC_COPY;case IC_COPY:for(c=s-this.dist;c<0;)c+=e.end;for(;0!=this.len;){if(0==h&&(s==e.end&&0!=e.read&&(h=(s=0)<e.read?e.read-s-1:e.end-s),0==h&&(e.write=s,i=e.inflate_flush(t,i),h=(s=e.write)<e.read?e.read-s-1:e.end-s,s==e.end&&0!=e.read&&(h=(s=0)<e.read?e.read-s-1:e.end-s),0==h)))return e.bitb=l,e.bitk=u,t.avail_in=o,t.total_in+=d-t.next_in_index,t.next_in_index=d,e.write=s,e.inflate_flush(t,i);e.window[s++]=e.window[c++],h--,c==e.end&&(c=0),this.len--}this.mode=IC_START;break;case IC_LIT:if(0==h&&(s==e.end&&0!=e.read&&(h=(s=0)<e.read?e.read-s-1:e.end-s),0==h&&(e.write=s,i=e.inflate_flush(t,i),h=(s=e.write)<e.read?e.read-s-1:e.end-s,s==e.end&&0!=e.read&&(h=(s=0)<e.read?e.read-s-1:e.end-s),0==h)))return e.bitb=l,e.bitk=u,t.avail_in=o,t.total_in+=d-t.next_in_index,t.next_in_index=d,e.write=s,e.inflate_flush(t,i);i=Z_OK,e.window[s++]=this.lit,h--,this.mode=IC_START;break;case IC_WASH:if(u>7&&(u-=8,o++,d--),e.write=s,i=e.inflate_flush(t,i),h=(s=e.write)<e.read?e.read-s-1:e.end-s,e.read!=e.write)return e.bitb=l,e.bitk=u,t.avail_in=o,t.total_in+=d-t.next_in_index,t.next_in_index=d,e.write=s,e.inflate_flush(t,i);this.mode=IC_END;case IC_END:return i=Z_STREAM_END,e.bitb=l,e.bitk=u,t.avail_in=o,t.total_in+=d-t.next_in_index,t.next_in_index=d,e.write=s,e.inflate_flush(t,i);case IC_BADCODE:return i=Z_DATA_ERROR,e.bitb=l,e.bitk=u,t.avail_in=o,t.total_in+=d-t.next_in_index,t.next_in_index=d,e.write=s,e.inflate_flush(t,i);default:return i=Z_STREAM_ERROR,e.bitb=l,e.bitk=u,t.avail_in=o,t.total_in+=d-t.next_in_index,t.next_in_index=d,e.write=s,e.inflate_flush(t,i)}},InfCodes.prototype.free=function(e){},InfCodes.prototype.inflate_fast=function(e,t,i,r,n,a,o,s){var h,c,l,u,d,p,f,g,v,m,w,b,y,k,x,S;f=s.next_in_index,g=s.avail_in,d=o.bitb,p=o.bitk,m=(v=o.write)<o.read?o.read-v-1:o.end-v,w=inflate_mask[e],b=inflate_mask[t];do{for(;p<20;)g--,d|=(255&s.next_in[f++])<<p,p+=8;if(0!=(u=(c=i)[S=3*((l=r)+(h=d&w))]))for(;;){if(d>>=c[S+1],p-=c[S+1],0!=(16&u)){for(u&=15,y=c[S+2]+(d&inflate_mask[u]),d>>=u,p-=u;p<15;)g--,d|=(255&s.next_in[f++])<<p,p+=8;for(u=(c=n)[S=3*((l=a)+(h=d&b))];;){if(d>>=c[S+1],p-=c[S+1],0!=(16&u)){for(u&=15;p<u;)g--,d|=(255&s.next_in[f++])<<p,p+=8;if(k=c[S+2]+(d&inflate_mask[u]),d>>=u,p-=u,m-=y,v>=k)x=v-k,o.window[v++]=o.window[x++],o.window[v++]=o.window[x++],y-=2;else{x=v-k;do{x+=o.end}while(x<0);if(y>(u=o.end-x)){if(y-=u,v-x>0&&u>v-x)do{o.window[v++]=o.window[x++]}while(0!=--u);else arrayCopy(o.window,x,o.window,v,u),v+=u,x+=u,u=0;x=0}}do{o.window[v++]=o.window[x++]}while(0!=--y);break}if(0!=(64&u))return s.msg="invalid distance code",g+=y=p>>3<(y=s.avail_in-g)?p>>3:y,f-=y,p-=y<<3,o.bitb=d,o.bitk=p,s.avail_in=g,s.total_in+=f-s.next_in_index,s.next_in_index=f,o.write=v,Z_DATA_ERROR;h+=c[S+2],u=c[S=3*(l+(h+=d&inflate_mask[u]))]}break}if(0!=(64&u))return 0!=(32&u)?(g+=y=p>>3<(y=s.avail_in-g)?p>>3:y,f-=y,p-=y<<3,o.bitb=d,o.bitk=p,s.avail_in=g,s.total_in+=f-s.next_in_index,s.next_in_index=f,o.write=v,Z_STREAM_END):(s.msg="invalid literal/length code",g+=y=p>>3<(y=s.avail_in-g)?p>>3:y,f-=y,p-=y<<3,o.bitb=d,o.bitk=p,s.avail_in=g,s.total_in+=f-s.next_in_index,s.next_in_index=f,o.write=v,Z_DATA_ERROR);if(h+=c[S+2],0==(u=c[S=3*(l+(h+=d&inflate_mask[u]))])){d>>=c[S+1],p-=c[S+1],o.window[v++]=c[S+2],m--;break}}else d>>=c[S+1],p-=c[S+1],o.window[v++]=c[S+2],m--}while(m>=258&&g>=10);return g+=y=p>>3<(y=s.avail_in-g)?p>>3:y,f-=y,p-=y<<3,o.bitb=d,o.bitk=p,s.avail_in=g,s.total_in+=f-s.next_in_index,s.next_in_index=f,o.write=v,Z_OK},InfTree.prototype.huft_build=function(e,t,i,r,n,a,o,s,h,c,l){var u,d,p,f,g,v,m,w,b,y,k,x,S,_,C;y=0,g=i;do{this.c[e[t+y]]++,y++,g--}while(0!=g);if(this.c[0]==i)return o[0]=-1,s[0]=0,Z_OK;for(w=s[0],v=1;v<=BMAX&&0==this.c[v];v++);for(m=v,w<v&&(w=v),g=BMAX;0!=g&&0==this.c[g];g--);for(p=g,w>g&&(w=g),s[0]=w,_=1<<v;v<g;v++,_<<=1)if((_-=this.c[v])<0)return Z_DATA_ERROR;if((_-=this.c[g])<0)return Z_DATA_ERROR;for(this.c[g]+=_,this.x[1]=v=0,y=1,S=2;0!=--g;)this.x[S]=v+=this.c[y],S++,y++;g=0,y=0;do{0!=(v=e[t+y])&&(this.v[this.x[v]++]=g),y++}while(++g<i);for(i=this.x[p],this.x[0]=g=0,y=0,f=-1,x=-w,this.u[0]=0,k=0,C=0;m<=p;m++)for(u=this.c[m];0!=u--;){for(;m>x+w;){if(f++,C=(C=p-(x+=w))>w?w:C,(d=1<<(v=m-x))>u+1&&(d-=u+1,S=m,v<C))for(;++v<C&&!((d<<=1)<=this.c[++S]);)d-=this.c[S];if(C=1<<v,this.hn[0]+C>MANY)return Z_DATA_ERROR;this.u[f]=k=this.hn[0],this.hn[0]+=C,0!=f?(this.x[f]=g,this.r[0]=v,this.r[1]=w,v=g>>>x-w,this.r[2]=k-this.u[f-1]-v,arrayCopy(this.r,0,h,3*(this.u[f-1]+v),3)):o[0]=k}for(this.r[1]=m-x,y>=i?this.r[0]=192:l[y]<r?(this.r[0]=this.v[y]<256?0:96,this.r[2]=this.v[y++]):(this.r[0]=a[this.v[y]-r]+16+64,this.r[2]=n[this.v[y++]-r]),d=1<<m-x,v=g>>>x;v<C;v+=d)arrayCopy(this.r,0,h,3*(k+v),3);for(v=1<<m-1;0!=(g&v);v>>>=1)g^=v;for(g^=v,b=(1<<x)-1;(g&b)!=this.x[f];)f--,b=(1<<(x-=w))-1}return 0!=_&&1!=p?Z_BUF_ERROR:Z_OK},InfTree.prototype.inflate_trees_bits=function(e,t,i,r,n){var a;return this.initWorkArea(19),this.hn[0]=0,(a=this.huft_build(e,0,19,19,null,null,i,t,r,this.hn,this.v))==Z_DATA_ERROR?n.msg="oversubscribed dynamic bit lengths tree":a!=Z_BUF_ERROR&&0!=t[0]||(n.msg="incomplete dynamic bit lengths tree",a=Z_DATA_ERROR),a},InfTree.prototype.inflate_trees_dynamic=function(e,t,i,r,n,a,o,s,h){var c;return this.initWorkArea(288),this.hn[0]=0,(c=this.huft_build(i,0,e,257,cplens,cplext,a,r,s,this.hn,this.v))!=Z_OK||0==r[0]?(c==Z_DATA_ERROR?h.msg="oversubscribed literal/length tree":c!=Z_MEM_ERROR&&(h.msg="incomplete literal/length tree",c=Z_DATA_ERROR),c):(this.initWorkArea(288),(c=this.huft_build(i,e,t,0,cpdist,cpdext,o,n,s,this.hn,this.v))!=Z_OK||0==n[0]&&e>257?(c==Z_DATA_ERROR?h.msg="oversubscribed distance tree":c==Z_BUF_ERROR?(h.msg="incomplete distance tree",c=Z_DATA_ERROR):c!=Z_MEM_ERROR&&(h.msg="empty distance tree with lengths",c=Z_DATA_ERROR),c):Z_OK)},InfTree.prototype.initWorkArea=function(e){null==this.hn&&(this.hn=new Int32Array(1),this.v=new Int32Array(e),this.c=new Int32Array(BMAX+1),this.r=new Int32Array(3),this.u=new Int32Array(BMAX),this.x=new Int32Array(BMAX+1)),this.v.length<e&&(this.v=new Int32Array(e));for(var t=0;t<e;t++)this.v[t]=0;for(t=0;t<BMAX+1;t++)this.c[t]=0;for(t=0;t<3;t++)this.r[t]=0;arrayCopy(this.c,0,this.u,0,BMAX),arrayCopy(this.c,0,this.x,0,BMAX+1)};var testArray=new Uint8Array(1),hasSubarray="function"==typeof testArray.subarray,hasSlice=!1,ADLER_BASE=65521,ADLER_NMAX=5552;(function(){"use strict";function e(e){throw e}function t(e,t){var i,r=e.split("."),n=C;!(r[0]in n)&&n.execScript&&n.execScript("var "+r[0]);for(;r.length&&(i=r.shift());)r.length||t===S?n=n[i]?n[i]:n[i]={}:n[i]=t}function i(t,i){this.index="number"==typeof i?i:0,this.m=0,this.buffer=t instanceof(T?Uint8Array:Array)?t:new(T?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&e(Error("invalid index")),this.buffer.length<=this.index&&this.f()}function r(e,t,i){var r,n="number"==typeof t?t:t=0,a="number"==typeof i?i:e.length;for(r=-1,n=7&a;n--;++t)r=r>>>8^L[255&(r^e[t])];for(n=a>>3;n--;t+=8)r=(r=(r=(r=(r=(r=(r=(r=r>>>8^L[255&(r^e[t])])>>>8^L[255&(r^e[t+1])])>>>8^L[255&(r^e[t+2])])>>>8^L[255&(r^e[t+3])])>>>8^L[255&(r^e[t+4])])>>>8^L[255&(r^e[t+5])])>>>8^L[255&(r^e[t+6])])>>>8^L[255&(r^e[t+7])];return(4294967295^r)>>>0}function n(){}function a(e){this.buffer=new(T?Uint16Array:Array)(2*e),this.length=0}function o(e){var t,i,r,n,a,o,s,h,c,l=e.length,u=0,d=Number.POSITIVE_INFINITY;for(h=0;h<l;++h)e[h]>u&&(u=e[h]),e[h]<d&&(d=e[h]);for(t=1<<u,i=new(T?Uint32Array:Array)(t),r=1,n=0,a=2;r<=u;){for(h=0;h<l;++h)if(e[h]===r){for(o=0,s=n,c=0;c<r;++c)o=o<<1|1&s,s>>=1;for(c=o;c<t;c+=a)i[c]=r<<16|h;++n}++r,n<<=1,a<<=1}return[i,u,d]}function s(e,t){this.k=F,this.I=0,this.input=T&&e instanceof Array?new Uint8Array(e):e,this.b=0,t&&(t.lazy&&(this.I=t.lazy),"number"==typeof t.compressionType&&(this.k=t.compressionType),t.outputBuffer&&(this.a=T&&t.outputBuffer instanceof Array?new Uint8Array(t.outputBuffer):t.outputBuffer),"number"==typeof t.outputIndex&&(this.b=t.outputIndex)),this.a||(this.a=new(T?Uint8Array:Array)(32768))}function h(e,t){this.length=e,this.P=t}function c(t,i){function r(t,i){var r,n,a,o,s=t.P,h=[],c=0;switch(r=V[t.length],h[c++]=65535&r,h[c++]=r>>16&255,h[c++]=r>>24,_){case 1===s:n=[0,s-1,0];break;case 2===s:n=[1,s-2,0];break;case 3===s:n=[2,s-3,0];break;case 4===s:n=[3,s-4,0];break;case 6>=s:n=[4,s-5,1];break;case 8>=s:n=[5,s-7,1];break;case 12>=s:n=[6,s-9,2];break;case 16>=s:n=[7,s-13,2];break;case 24>=s:n=[8,s-17,3];break;case 32>=s:n=[9,s-25,3];break;case 48>=s:n=[10,s-33,4];break;case 64>=s:n=[11,s-49,4];break;case 96>=s:n=[12,s-65,5];break;case 128>=s:n=[13,s-97,5];break;case 192>=s:n=[14,s-129,6];break;case 256>=s:n=[15,s-193,6];break;case 384>=s:n=[16,s-257,7];break;case 512>=s:n=[17,s-385,7];break;case 768>=s:n=[18,s-513,8];break;case 1024>=s:n=[19,s-769,8];break;case 1536>=s:n=[20,s-1025,9];break;case 2048>=s:n=[21,s-1537,9];break;case 3072>=s:n=[22,s-2049,10];break;case 4096>=s:n=[23,s-3073,10];break;case 6144>=s:n=[24,s-4097,11];break;case 8192>=s:n=[25,s-6145,11];break;case 12288>=s:n=[26,s-8193,12];break;case 16384>=s:n=[27,s-12289,12];break;case 24576>=s:n=[28,s-16385,13];break;case 32768>=s:n=[29,s-24577,13];break;default:e("invalid distance")}for(r=n,h[c++]=r[0],h[c++]=r[1],h[c++]=r[2],a=0,o=h.length;a<o;++a)g[v++]=h[a];w[h[0]]++,b[h[3]]++,m=t.length+i-1,d=null}var n,a,o,s,h,c,u,d,p,f={},g=T?new Uint16Array(2*i.length):[],v=0,m=0,w=new(T?Uint32Array:Array)(286),b=new(T?Uint32Array:Array)(30),y=t.I;if(!T){for(o=0;285>=o;)w[o++]=0;for(o=0;29>=o;)b[o++]=0}for(w[256]=1,n=0,a=i.length;n<a;++n){for(o=h=0,s=3;o<s&&n+o!==a;++o)h=h<<8|i[n+o];if(f[h]===S&&(f[h]=[]),c=f[h],!(0<m--)){for(;0<c.length&&32768<n-c[0];)c.shift();if(n+3>=a){for(d&&r(d,-1),o=0,s=a-n;o<s;++o)p=i[n+o],g[v++]=p,++w[p];break}0<c.length?(u=l(i,n,c),d?d.length<u.length?(p=i[n-1],g[v++]=p,++w[p],r(u,0)):r(d,-1):u.length<y?d=u:r(u,0)):d?r(d,-1):(p=i[n],g[v++]=p,++w[p])}c.push(n)}return g[v++]=256,w[256]++,t.V=w,t.U=b,T?g.subarray(0,v):g}function l(e,t,i){var r,n,a,o,s,c,l=0,u=e.length;o=0,c=i.length;e:for(;o<c;o++){if(r=i[c-o-1],a=3,3<l){for(s=l;3<s;s--)if(e[r+s-1]!==e[t+s-1])continue e;a=l}for(;258>a&&t+a<u&&e[r+a]===e[t+a];)++a;if(a>l&&(n=r,l=a),258===a)break}return new h(l,t-n)}function u(e,t){var i,r,n,o,s,h=e.length,c=new a(572),l=new(T?Uint8Array:Array)(h);if(!T)for(o=0;o<h;o++)l[o]=0;for(o=0;o<h;++o)0<e[o]&&c.push(o,e[o]);if(i=Array(c.length/2),r=new(T?Uint32Array:Array)(c.length/2),1===i.length)return l[c.pop().index]=1,l;for(o=0,s=c.length/2;o<s;++o)i[o]=c.pop(),r[o]=i[o].value;for(n=function(e,t,i){function r(e){var i=p[e][f[e]];i===t?(r(e+1),r(e+1)):--u[i],++f[e]}var n,a,o,s,h,c=new(T?Uint16Array:Array)(i),l=new(T?Uint8Array:Array)(i),u=new(T?Uint8Array:Array)(t),d=Array(i),p=Array(i),f=Array(i),g=(1<<i)-t,v=1<<i-1;for(c[i-1]=t,a=0;a<i;++a)g<v?l[a]=0:(l[a]=1,g-=v),g<<=1,c[i-2-a]=(c[i-1-a]/2|0)+t;for(c[0]=l[0],d[0]=Array(c[0]),p[0]=Array(c[0]),a=1;a<i;++a)c[a]>2*c[a-1]+l[a]&&(c[a]=2*c[a-1]+l[a]),d[a]=Array(c[a]),p[a]=Array(c[a]);for(n=0;n<t;++n)u[n]=i;for(o=0;o<c[i-1];++o)d[i-1][o]=e[o],p[i-1][o]=o;for(n=0;n<i;++n)f[n]=0;for(1===l[i-1]&&(--u[0],++f[i-1]),a=i-2;0<=a;--a){for(s=n=0,h=f[a+1],o=0;o<c[a];o++)(s=d[a+1][h]+d[a+1][h+1])>e[n]?(d[a][o]=s,p[a][o]=t,h+=2):(d[a][o]=e[n],p[a][o]=n,++n);f[a]=0,1===l[a]&&r(a)}return u}(r,r.length,t),o=0,s=i.length;o<s;++o)l[i[o].index]=n[o];return l}function d(e){var t,i,r,n,a=new(T?Uint16Array:Array)(e.length),o=[],s=[],h=0;for(t=0,i=e.length;t<i;t++)o[e[t]]=1+(0|o[e[t]]);for(t=1,i=16;t<=i;t++)s[t]=h,h+=0|o[t],h<<=1;for(t=0,i=e.length;t<i;t++)for(h=s[e[t]],s[e[t]]+=1,r=a[t]=0,n=e[t];r<n;r++)a[t]=a[t]<<1|1&h,h>>>=1;return a}function p(e,t){this.input=e,this.b=this.c=0,this.i={},t&&(t.flags&&(this.i=t.flags),"string"==typeof t.filename&&(this.filename=t.filename),"string"==typeof t.comment&&(this.A=t.comment),t.deflateOptions&&(this.l=t.deflateOptions)),this.l||(this.l={})}function f(t,i){switch(this.p=[],this.q=32768,this.e=this.j=this.c=this.u=0,this.input=T?new Uint8Array(t):t,this.w=!1,this.r=q,this.L=!1,!i&&(i={})||(i.index&&(this.c=i.index),i.bufferSize&&(this.q=i.bufferSize),i.bufferType&&(this.r=i.bufferType),i.resize&&(this.L=i.resize)),this.r){case z:this.b=32768,this.a=new(T?Uint8Array:Array)(32768+this.q+258);break;case q:this.b=0,this.a=new(T?Uint8Array:Array)(this.q),this.f=this.T,this.B=this.Q,this.s=this.S;break;default:e(Error("invalid inflate mode"))}}function g(t,i){for(var r,n=t.j,a=t.e,o=t.input,s=t.c;a<i;)(r=o[s++])===S&&e(Error("input buffer is broken")),n|=r<<a,a+=8;return r=n&(1<<i)-1,t.j=n>>>i,t.e=a-i,t.c=s,r}function v(e,t){for(var i,r,n,a=e.j,o=e.e,s=e.input,h=e.c,c=t[0],l=t[1];o<l&&(i=s[h++])!==S;)a|=i<<o,o+=8;return n=(r=c[a&(1<<l)-1])>>>16,e.j=a>>n,e.e=o-n,e.c=h,65535&r}function m(e){function t(e,t,i){var r,n,a,o;for(o=0;o<e;)switch(r=v(this,t)){case 16:for(a=3+g(this,2);a--;)i[o++]=n;break;case 17:for(a=3+g(this,3);a--;)i[o++]=0;n=0;break;case 18:for(a=11+g(this,7);a--;)i[o++]=0;n=0;break;default:n=i[o++]=r}return i}var i,r,n,a,s=g(e,5)+257,h=g(e,5)+1,c=g(e,4)+4,l=new(T?Uint8Array:Array)(Y.length);for(a=0;a<c;++a)l[Y[a]]=g(e,3);i=o(l),r=new(T?Uint8Array:Array)(s),n=new(T?Uint8Array:Array)(h),e.s(o(t.call(e,s,i,r)),o(t.call(e,h,i,n)))}function w(e){this.input=e,this.c=0,this.t=[],this.D=!1}function b(e){if("string"==typeof e){var t,i,r=e.split("");for(t=0,i=r.length;t<i;t++)r[t]=(255&r[t].charCodeAt(0))>>>0;e=r}for(var n,a=1,o=0,s=e.length,h=0;0<s;){s-=n=1024<s?1024:s;do{o+=a+=e[h++]}while(--n);a%=65521,o%=65521}return(o<<16|a)>>>0}function y(t,i){var r,n;switch(this.input=t,this.c=0,!i&&(i={})||(i.index&&(this.c=i.index),i.verify&&(this.Z=i.verify)),r=t[this.c++],n=t[this.c++],15&r){case de:this.method=de;break;default:e(Error("unsupported compression method"))}0!=((r<<8)+n)%31&&e(Error("invalid fcheck flag:"+((r<<8)+n)%31)),32&n&&e(Error("fdict flag is not supported")),this.K=new f(t,{index:this.c,bufferSize:i.bufferSize,bufferType:i.bufferType,resize:i.resize})}function k(e,t){this.input=e,this.a=new(T?Uint8Array:Array)(32768),this.k=pe.o;var i,r={};for(i in!t&&(t={})||"number"!=typeof t.compressionType||(this.k=t.compressionType),t)r[i]=t[i];r.outputBuffer=this.a,this.J=new s(this.input,r)}function x(e,i){var r,n,a,o;if(Object.keys)r=Object.keys(i);else for(n in r=[],a=0,i)r[a++]=n;for(a=0,o=r.length;a<o;++a)t(e+"."+(n=r[a]),i[n])}var S=void 0,_=!0,C=this,T="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;i.prototype.f=function(){var e,t=this.buffer,i=t.length,r=new(T?Uint8Array:Array)(i<<1);if(T)r.set(t);else for(e=0;e<i;++e)r[e]=t[e];return this.buffer=r},i.prototype.d=function(e,t,i){var r,n=this.buffer,a=this.index,o=this.m,s=n[a];if(i&&1<t&&(e=8<t?(E[255&e]<<24|E[e>>>8&255]<<16|E[e>>>16&255]<<8|E[e>>>24&255])>>32-t:E[e]>>8-t),8>t+o)s=s<<t|e,o+=t;else for(r=0;r<t;++r)s=s<<1|e>>t-r-1&1,8==++o&&(o=0,n[a++]=E[s],s=0,a===n.length&&(n=this.f()));n[a]=s,this.buffer=n,this.m=o,this.index=a},i.prototype.finish=function(){var e,t=this.buffer,i=this.index;return 0<this.m&&(t[i]<<=8-this.m,t[i]=E[t[i]],i++),T?e=t.subarray(0,i):(t.length=i,e=t),e};var I,A=new(T?Uint8Array:Array)(256);for(I=0;256>I;++I){for(var P=$=I,R=7,$=$>>>1;$;$>>>=1)P<<=1,P|=1&$,--R;A[I]=(P<<R&255)>>>0}var E=A,M=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],L=T?new Uint32Array(M):M;n.prototype.getName=function(){return this.name},n.prototype.getData=function(){return this.data},n.prototype.X=function(){return this.Y},t("Zlib.GunzipMember",n),t("Zlib.GunzipMember.prototype.getName",n.prototype.getName),t("Zlib.GunzipMember.prototype.getData",n.prototype.getData),t("Zlib.GunzipMember.prototype.getMtime",n.prototype.X),a.prototype.getParent=function(e){return 2*((e-2)/4|0)},a.prototype.push=function(e,t){var i,r,n,a=this.buffer;for(i=this.length,a[this.length++]=t,a[this.length++]=e;0<i&&(r=this.getParent(i),a[i]>a[r]);)n=a[i],a[i]=a[r],a[r]=n,n=a[i+1],a[i+1]=a[r+1],a[r+1]=n,i=r;return this.length},a.prototype.pop=function(){var e,t,i,r,n,a=this.buffer;for(t=a[0],e=a[1],this.length-=2,a[0]=a[this.length],a[1]=a[this.length+1],n=0;!((r=2*n+2)>=this.length)&&(r+2<this.length&&a[r+2]>a[r]&&(r+=2),a[r]>a[n]);)i=a[n],a[n]=a[r],a[r]=i,i=a[n+1],a[n+1]=a[r+1],a[r+1]=i,n=r;return{index:e,value:t,length:this.length}};var D,F=2,B={NONE:0,v:1,o:F,aa:3},O=[];for(D=0;288>D;D++)switch(_){case 143>=D:O.push([D+48,8]);break;case 255>=D:O.push([D-144+400,9]);break;case 279>=D:O.push([D-256+0,7]);break;case 287>=D:O.push([D-280+192,8]);break;default:e("invalid literal: "+D)}s.prototype.g=function(){var t,r,n,a,o=this.input;switch(this.k){case 0:for(n=0,a=o.length;n<a;){var s,h,l,p=r=T?o.subarray(n,n+65535):o.slice(n,n+65535),f=(n+=r.length)===a,g=S,v=S,m=this.a,w=this.b;if(T){for(m=new Uint8Array(this.a.buffer);m.length<=w+p.length+5;)m=new Uint8Array(m.length<<1);m.set(this.a)}if(s=f?1:0,m[w++]=0|s,l=65536+~(h=p.length)&65535,m[w++]=255&h,m[w++]=h>>>8&255,m[w++]=255&l,m[w++]=l>>>8&255,T)m.set(p,w),w+=p.length,m=m.subarray(0,w);else{for(g=0,v=p.length;g<v;++g)m[w++]=p[g];m.length=w}this.b=w,this.a=m}break;case 1:var b=new i(T?new Uint8Array(this.a.buffer):this.a,this.b);b.d(1,1,_),b.d(1,2,_);var y,k,x,C=c(this,o);for(y=0,k=C.length;y<k;y++)if(x=C[y],i.prototype.d.apply(b,O[x]),256<x)b.d(C[++y],C[++y],_),b.d(C[++y],5),b.d(C[++y],C[++y],_);else if(256===x)break;this.a=b.finish(),this.b=this.a.length;break;case F:var I,A,P,R,$,E,M,L,D,B,N,V,H,W,G,U=new i(T?new Uint8Array(this.a.buffer):this.a,this.b),z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=Array(19);for(I=F,U.d(1,1,_),U.d(I,2,_),A=c(this,o),M=d(E=u(this.V,15)),D=d(L=u(this.U,7)),P=286;257<P&&0===E[P-1];P--);for(R=30;1<R&&0===L[R-1];R--);var Z,j,K,X,Y,Q,J=P,ee=R,te=new(T?Uint32Array:Array)(J+ee),ie=new(T?Uint32Array:Array)(316),re=new(T?Uint8Array:Array)(19);for(Z=j=0;Z<J;Z++)te[j++]=E[Z];for(Z=0;Z<ee;Z++)te[j++]=L[Z];if(!T)for(Z=0,X=re.length;Z<X;++Z)re[Z]=0;for(Z=Y=0,X=te.length;Z<X;Z+=j){for(j=1;Z+j<X&&te[Z+j]===te[Z];++j);if(K=j,0===te[Z])if(3>K)for(;0<K--;)ie[Y++]=0,re[0]++;else for(;0<K;)(Q=138>K?K:138)>K-3&&Q<K&&(Q=K-3),10>=Q?(ie[Y++]=17,ie[Y++]=Q-3,re[17]++):(ie[Y++]=18,ie[Y++]=Q-11,re[18]++),K-=Q;else if(ie[Y++]=te[Z],re[te[Z]]++,3>--K)for(;0<K--;)ie[Y++]=te[Z],re[te[Z]]++;else for(;0<K;)(Q=6>K?K:6)>K-3&&Q<K&&(Q=K-3),ie[Y++]=16,ie[Y++]=Q-3,re[16]++,K-=Q}for(t=T?ie.subarray(0,Y):ie.slice(0,Y),B=u(re,7),W=0;19>W;W++)q[W]=B[z[W]];for($=19;4<$&&0===q[$-1];$--);for(N=d(B),U.d(P-257,5,_),U.d(R-1,5,_),U.d($-4,4,_),W=0;W<$;W++)U.d(q[W],3,_);for(W=0,G=t.length;W<G;W++)if(V=t[W],U.d(N[V],B[V],_),16<=V){switch(W++,V){case 16:H=2;break;case 17:H=3;break;case 18:H=7;break;default:e("invalid code: "+V)}U.d(t[W],H,_)}var ne,ae,oe,se,he,ce,le,ue,de=[M,E],pe=[D,L];for(he=de[0],ce=de[1],le=pe[0],ue=pe[1],ne=0,ae=A.length;ne<ae;++ne)if(oe=A[ne],U.d(he[oe],ce[oe],_),256<oe)U.d(A[++ne],A[++ne],_),se=A[++ne],U.d(le[se],ue[se],_),U.d(A[++ne],A[++ne],_);else if(256===oe)break;this.a=U.finish(),this.b=this.a.length;break;default:e("invalid compression type")}return this.a};var N=function(){function t(t){switch(_){case 3===t:return[257,t-3,0];case 4===t:return[258,t-4,0];case 5===t:return[259,t-5,0];case 6===t:return[260,t-6,0];case 7===t:return[261,t-7,0];case 8===t:return[262,t-8,0];case 9===t:return[263,t-9,0];case 10===t:return[264,t-10,0];case 12>=t:return[265,t-11,1];case 14>=t:return[266,t-13,1];case 16>=t:return[267,t-15,1];case 18>=t:return[268,t-17,1];case 22>=t:return[269,t-19,2];case 26>=t:return[270,t-23,2];case 30>=t:return[271,t-27,2];case 34>=t:return[272,t-31,2];case 42>=t:return[273,t-35,3];case 50>=t:return[274,t-43,3];case 58>=t:return[275,t-51,3];case 66>=t:return[276,t-59,3];case 82>=t:return[277,t-67,4];case 98>=t:return[278,t-83,4];case 114>=t:return[279,t-99,4];case 130>=t:return[280,t-115,4];case 162>=t:return[281,t-131,5];case 194>=t:return[282,t-163,5];case 226>=t:return[283,t-195,5];case 257>=t:return[284,t-227,5];case 258===t:return[285,t-258,0];default:e("invalid length: "+t)}}var i,r,n=[];for(i=3;258>=i;i++)r=t(i),n[i]=r[2]<<24|r[1]<<16|r[0];return n}(),V=T?new Uint32Array(N):N;p.prototype.g=function(){var e,t,i,n,a,o,h,c,l=new(T?Uint8Array:Array)(32768),u=0,d=this.input,p=this.c,f=this.filename,g=this.A;if(l[u++]=31,l[u++]=139,l[u++]=8,e=0,this.i.fname&&(e|=G),this.i.fcomment&&(e|=U),this.i.fhcrc&&(e|=W),l[u++]=e,t=(Date.now?Date.now():+new Date)/1e3|0,l[u++]=255&t,l[u++]=t>>>8&255,l[u++]=t>>>16&255,l[u++]=t>>>24&255,l[u++]=0,l[u++]=H,this.i.fname!==S){for(h=0,c=f.length;h<c;++h)255<(o=f.charCodeAt(h))&&(l[u++]=o>>>8&255),l[u++]=255&o;l[u++]=0}if(this.i.comment){for(h=0,c=g.length;h<c;++h)255<(o=g.charCodeAt(h))&&(l[u++]=o>>>8&255),l[u++]=255&o;l[u++]=0}return this.i.fhcrc&&(i=65535&r(l,0,u),l[u++]=255&i,l[u++]=i>>>8&255),this.l.outputBuffer=l,this.l.outputIndex=u,l=(a=new s(d,this.l)).g(),u=a.b,T&&(u+8>l.buffer.byteLength?(this.a=new Uint8Array(u+8),this.a.set(new Uint8Array(l.buffer)),l=this.a):l=new Uint8Array(l.buffer)),n=r(d,S,S),l[u++]=255&n,l[u++]=n>>>8&255,l[u++]=n>>>16&255,l[u++]=n>>>24&255,c=d.length,l[u++]=255&c,l[u++]=c>>>8&255,l[u++]=c>>>16&255,l[u++]=c>>>24&255,this.c=p,T&&u<l.length&&(this.a=l=l.subarray(0,u)),l};var H=255,W=2,G=8,U=16;t("Zlib.Gzip",p),t("Zlib.Gzip.prototype.compress",p.prototype.g);var z=0,q=1,Z={N:z,M:q};f.prototype.h=function(){for(;!this.w;){var t=g(this,3);switch(1&t&&(this.w=_),t>>>=1){case 0:var i=this.input,r=this.c,n=this.a,a=this.b,o=S,s=S,h=S,c=n.length,l=S;switch(this.e=this.j=0,(o=i[r++])===S&&e(Error("invalid uncompressed block header: LEN (first byte)")),s=o,(o=i[r++])===S&&e(Error("invalid uncompressed block header: LEN (second byte)")),s|=o<<8,(o=i[r++])===S&&e(Error("invalid uncompressed block header: NLEN (first byte)")),h=o,(o=i[r++])===S&&e(Error("invalid uncompressed block header: NLEN (second byte)")),s===~(h|=o<<8)&&e(Error("invalid uncompressed block header: length verify")),r+s>i.length&&e(Error("input buffer is broken")),this.r){case z:for(;a+s>n.length;){if(s-=l=c-a,T)n.set(i.subarray(r,r+l),a),a+=l,r+=l;else for(;l--;)n[a++]=i[r++];this.b=a,n=this.f(),a=this.b}break;case q:for(;a+s>n.length;)n=this.f({F:2});break;default:e(Error("invalid inflate mode"))}if(T)n.set(i.subarray(r,r+s),a),a+=s,r+=s;else for(;s--;)n[a++]=i[r++];this.c=r,this.b=a,this.a=n;break;case 1:this.s(ce,ue);break;case 2:m(this);break;default:e(Error("unknown BTYPE: "+t))}}return this.B()};var j,K,X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Y=T?new Uint16Array(X):X,Q=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],J=T?new Uint16Array(Q):Q,ee=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],te=T?new Uint8Array(ee):ee,ie=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],re=T?new Uint16Array(ie):ie,ne=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],ae=T?new Uint8Array(ne):ne,oe=new(T?Uint8Array:Array)(288);for(j=0,K=oe.length;j<K;++j)oe[j]=143>=j?8:255>=j?9:279>=j?7:8;var se,he,ce=o(oe),le=new(T?Uint8Array:Array)(30);for(se=0,he=le.length;se<he;++se)le[se]=5;var ue=o(le);f.prototype.s=function(e,t){var i=this.a,r=this.b;this.C=e;for(var n,a,o,s,h=i.length-258;256!==(n=v(this,e));)if(256>n)r>=h&&(this.b=r,i=this.f(),r=this.b),i[r++]=n;else for(s=J[a=n-257],0<te[a]&&(s+=g(this,te[a])),n=v(this,t),o=re[n],0<ae[n]&&(o+=g(this,ae[n])),r>=h&&(this.b=r,i=this.f(),r=this.b);s--;)i[r]=i[r++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},f.prototype.S=function(e,t){var i=this.a,r=this.b;this.C=e;for(var n,a,o,s,h=i.length;256!==(n=v(this,e));)if(256>n)r>=h&&(h=(i=this.f()).length),i[r++]=n;else for(s=J[a=n-257],0<te[a]&&(s+=g(this,te[a])),n=v(this,t),o=re[n],0<ae[n]&&(o+=g(this,ae[n])),r+s>h&&(h=(i=this.f()).length);s--;)i[r]=i[r++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},f.prototype.f=function(){var e,t,i=new(T?Uint8Array:Array)(this.b-32768),r=this.b-32768,n=this.a;if(T)i.set(n.subarray(32768,i.length));else for(e=0,t=i.length;e<t;++e)i[e]=n[e+32768];if(this.p.push(i),this.u+=i.length,T)n.set(n.subarray(r,r+32768));else for(e=0;32768>e;++e)n[e]=n[r+e];return this.b=32768,n},f.prototype.T=function(e){var t,i,r,n=this.input.length/this.c+1|0,a=this.input,o=this.a;return e&&("number"==typeof e.F&&(n=e.F),"number"==typeof e.O&&(n+=e.O)),2>n?i=(r=(a.length-this.c)/this.C[2]/2*258|0)<o.length?o.length+r:o.length<<1:i=o.length*n,T?(t=new Uint8Array(i)).set(o):t=o,this.a=t},f.prototype.B=function(){var e,t,i,r,n,a=0,o=this.a,s=this.p,h=new(T?Uint8Array:Array)(this.u+(this.b-32768));if(0===s.length)return T?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(t=0,i=s.length;t<i;++t)for(r=0,n=(e=s[t]).length;r<n;++r)h[a++]=e[r];for(t=32768,i=this.b;t<i;++t)h[a++]=o[t];return this.p=[],this.buffer=h},f.prototype.Q=function(){var e,t=this.b;return T?this.L?(e=new Uint8Array(t)).set(this.a.subarray(0,t)):e=this.a.subarray(0,t):(this.a.length>t&&(this.a.length=t),e=this.a),this.buffer=e},w.prototype.W=function(){return this.D||this.h(),this.t.slice()},w.prototype.h=function(){for(var t=this.input.length;this.c<t;){var i,a,o=new n,s=S,h=S,c=S,l=S,u=S,d=S,p=S,g=this.input,v=this.c;switch(o.G=g[v++],o.H=g[v++],(31!==o.G||139!==o.H)&&e(Error("invalid file signature:"+o.G+","+o.H)),o.z=g[v++],o.z){case 8:break;default:e(Error("unknown compression method: "+o.z))}if(o.n=g[v++],a=g[v++]|g[v++]<<8|g[v++]<<16|g[v++]<<24,o.Y=new Date(1e3*a),o.ea=g[v++],o.da=g[v++],0<(4&o.n)&&(o.$=g[v++]|g[v++]<<8,v+=o.$),0<(o.n&G)){for(d=[],u=0;0<(l=g[v++]);)d[u++]=String.fromCharCode(l);o.name=d.join("")}if(0<(o.n&U)){for(d=[],u=0;0<(l=g[v++]);)d[u++]=String.fromCharCode(l);o.A=d.join("")}0<(o.n&W)&&(o.R=65535&r(g,0,v),o.R!==(g[v++]|g[v++]<<8)&&e(Error("invalid header crc16"))),s=g[g.length-4]|g[g.length-3]<<8|g[g.length-2]<<16|g[g.length-1]<<24,g.length-v-4-4<512*s&&(c=s),h=new f(g,{index:v,bufferSize:c}),o.data=i=h.h(),v=h.c,o.ba=p=(g[v++]|g[v++]<<8|g[v++]<<16|g[v++]<<24)>>>0,r(i,S,S)!==p&&e(Error("invalid CRC-32 checksum: 0x"+r(i,S,S).toString(16)+" / 0x"+p.toString(16))),o.ca=s=(g[v++]|g[v++]<<8|g[v++]<<16|g[v++]<<24)>>>0,(4294967295&i.length)!==s&&e(Error("invalid input size: "+(4294967295&i.length)+" / "+s)),this.t.push(o),this.c=v}this.D=_;var m,w,b,y=this.t,k=0,x=0;for(m=0,w=y.length;m<w;++m)x+=y[m].data.length;if(T)for(b=new Uint8Array(x),m=0;m<w;++m)b.set(y[m].data,k),k+=y[m].data.length;else{for(b=[],m=0;m<w;++m)b[m]=y[m].data;b=Array.prototype.concat.apply([],b)}return b},t("Zlib.Gunzip",w),t("Zlib.Gunzip.prototype.decompress",w.prototype.h),t("Zlib.Gunzip.prototype.getMembers",w.prototype.W),y.prototype.h=function(){var t,i=this.input;return t=this.K.h(),this.c=this.K.c,this.Z&&((i[this.c++]<<24|i[this.c++]<<16|i[this.c++]<<8|i[this.c++])>>>0!==b(t)&&e(Error("invalid adler-32 checksum"))),t};var de=8,pe=B;k.prototype.g=function(){var t,i,r,n,a,o,s,h=0;switch(s=this.a,t=de){case de:i=Math.LOG2E*Math.log(32768)-8;break;default:e(Error("invalid compression method"))}switch(r=i<<4|t,s[h++]=r,t){case de:switch(this.k){case pe.NONE:a=0;break;case pe.v:a=1;break;case pe.o:a=2;break;default:e(Error("unsupported compression type"))}break;default:e(Error("invalid compression method"))}return n=a<<6|0,s[h++]=n|31-(256*r+n)%31,o=b(this.input),this.J.b=h,h=(s=this.J.g()).length,T&&((s=new Uint8Array(s.buffer)).length<=h+4&&(this.a=new Uint8Array(s.length+4),this.a.set(s),s=this.a),s=s.subarray(0,h+4)),s[h++]=o>>24&255,s[h++]=o>>16&255,s[h++]=o>>8&255,s[h++]=255&o,s},t("Zlib.Inflate",y),t("Zlib.Inflate.prototype.decompress",y.prototype.h),x("Zlib.Inflate.BufferType",{ADAPTIVE:Z.M,BLOCK:Z.N}),t("Zlib.Deflate",k),t("Zlib.Deflate.compress",(function(e,t){return new k(e,t).g()})),t("Zlib.Deflate.prototype.compress",k.prototype.g),x("Zlib.Deflate.CompressionType",{NONE:pe.NONE,FIXED:pe.v,DYNAMIC:pe.o})}).call(this),function(e){function t(t){var o=t||window.event,s=h.call(arguments,1),c=0,u=0,d=0,p=0,f=0,g=0;if((t=e.event.fix(o)).type="mousewheel","detail"in o&&(d=-1*o.detail),"wheelDelta"in o&&(d=o.wheelDelta),"wheelDeltaY"in o&&(d=o.wheelDeltaY),"wheelDeltaX"in o&&(u=-1*o.wheelDeltaX),"axis"in o&&o.axis===o.HORIZONTAL_AXIS&&(u=-1*d,d=0),c=0===d?u:d,"deltaY"in o&&(c=d=-1*o.deltaY),"deltaX"in o&&(u=o.deltaX,0===d&&(c=-1*u)),0!==d||0!==u){if(1===o.deltaMode){var v=e.data(this,"mousewheel-line-height");c*=v,d*=v,u*=v}else if(2===o.deltaMode){var m=e.data(this,"mousewheel-page-height");c*=m,d*=m,u*=m}if(p=Math.max(Math.abs(d),Math.abs(u)),(!a||p<a)&&(a=p,r(o,p)&&(a/=40)),r(o,p)&&(c/=40,u/=40,d/=40),c=Math[c>=1?"floor":"ceil"](c/a),u=Math[u>=1?"floor":"ceil"](u/a),d=Math[d>=1?"floor":"ceil"](d/a),l.settings.normalizeOffset&&this.getBoundingClientRect){var w=this.getBoundingClientRect();f=t.clientX-w.left,g=t.clientY-w.top}return t.deltaX=u,t.deltaY=d,t.deltaFactor=a,t.offsetX=f,t.offsetY=g,t.deltaMode=0,s.unshift(t,c,u,d),n&&clearTimeout(n),n=setTimeout(i,200),(e.event.dispatch||e.event.handle).apply(this,s)}}function i(){a=null}function r(e,t){return l.settings.adjustOldDeltas&&"mousewheel"===e.type&&t%120==0}var n,a,o=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],s="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],h=Array.prototype.slice;if(e.event.fixHooks)for(var c=o.length;c;)e.event.fixHooks[o[--c]]=e.event.mouseHooks;var l=e.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var i=s.length;i;)this.addEventListener(s[--i],t,!1);else this.onmousewheel=t;e.data(this,"mousewheel-line-height",l.getLineHeight(this)),e.data(this,"mousewheel-page-height",l.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var i=s.length;i;)this.removeEventListener(s[--i],t,!1);else this.onmousewheel=null;e.removeData(this,"mousewheel-line-height"),e.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var i=e(t),r=i["offsetParent"in e.fn?"offsetParent":"parent"]();return r.length||(r=e("body")),parseInt(r.css("fontSize"),10)||parseInt(i.css("fontSize"),10)||16},getPageHeight:function(t){return e(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};e.fn.extend({mousewheel:function(e){return e?this.bind("mousewheel",e):this.trigger("mousewheel")},unmousewheel:function(e){return this.unbind("mousewheel",e)}})}(jQuery),function(e){function t(e){return"[object Array]"===Object.prototype.toString.call(e)}function i(){for(var e=0;e<x.length;e++)x[e][0](x[e][1]);x=[],g=!1}function r(e,t){x.push([e,t]),g||(g=!0,k(i,0))}function n(e){var t=e.owner,i=t.state_,r=t.data_,n=e[i],s=e.then;if("function"==typeof n){i=w;try{r=n(r)}catch(e){h(s,e)}}a(s,r)||(i===w&&o(s,r),i===b&&h(s,r))}function a(e,t){var i;try{if(e===t)throw new TypeError("A promises callback cannot return that same promise.");if(t&&("function"==typeof t||"object"==typeof t)){var r=t.then;if("function"==typeof r)return r.call(t,(function(r){i||(i=!0,t!==r?o(e,r):s(e,r))}),(function(t){i||(i=!0,h(e,t))})),!0}}catch(t){return i||h(e,t),!0}return!1}function o(e,t){e!==t&&a(e,t)||s(e,t)}function s(e,t){e.state_===v&&(e.state_=m,e.data_=t,r(l,e))}function h(e,t){e.state_===v&&(e.state_=m,e.data_=t,r(u,e))}function c(e){var t=e.then_;e.then_=void 0;for(var i=0;i<t.length;i++)n(t[i])}function l(e){e.state_=w,c(e)}function u(e){e.state_=b,c(e)}function d(e){if("function"!=typeof e)throw new TypeError("Promise constructor takes a function argument");if(this instanceof d==0)throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this.then_=[],function(e,t){function i(e){h(t,e)}try{e((function(e){o(t,e)}),i)}catch(e){i(e)}}(e,this)}var p=e.Promise,f=p&&"resolve"in p&&"reject"in p&&"all"in p&&"race"in p&&function(){var e;return new p((function(t){e=t})),"function"==typeof e}();"undefined"!=typeof exports&&exports?(exports.Promise=f?p:d,exports.Polyfill=d):"function"==typeof define&&define.amd?define((function(){return f?p:d})):f||(e.Promise=d);var g,v="pending",m="sealed",w="fulfilled",b="rejected",y=function(){},k="undefined"!=typeof setImmediate?setImmediate:setTimeout,x=[];d.prototype={constructor:d,state_:v,then_:null,data_:void 0,then:function(e,t){var i={owner:this,then:new this.constructor(y),fulfilled:e,rejected:t};return this.state_===w||this.state_===b?r(n,i):this.then_.push(i),i.then},catch:function(e){return this.then(null,e)}},d.all=function(e){if(!t(e))throw new TypeError("You must pass an array to Promise.all().");return new this((function(t,i){function r(e){return o++,function(i){a[e]=i,--o||t(a)}}for(var n,a=[],o=0,s=0;s<e.length;s++)(n=e[s])&&"function"==typeof n.then?n.then(r(s),i):a[s]=n;o||t(a)}))},d.race=function(e){if(!t(e))throw new TypeError("You must pass an array to Promise.race().");return new this((function(t,i){for(var r,n=0;n<e.length;n++)(r=e[n])&&"function"==typeof r.then?r.then(t,i):t(r)}))},d.resolve=function(e){return e&&"object"==typeof e&&e.constructor===this?e:new this((function(t){t(e)}))},d.reject=function(e){return new this((function(t,i){i(e)}))}}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports&&(module.exports=e)}((function(e){return void 0===igv&&(igv={}),igv})),function(e){"use strict";var t="kinetic-active";window.requestAnimationFrame||(window.requestAnimationFrame=window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}),e.support=e.support||{},e.extend(e.support,{touch:"ontouchend"in document});var i=function(t,i){return this.settings=i,this.el=t,this.$el=e(t),this._initElements(),this};i.DATA_KEY="kinetic",i.DEFAULTS={cursor:"move",decelerate:!0,triggerHardware:!1,threshold:0,y:!0,x:!0,slowdown:.9,maxvelocity:40,throttleFPS:60,invert:!1,movingClass:{up:"kinetic-moving-up",down:"kinetic-moving-down",left:"kinetic-moving-left",right:"kinetic-moving-right"},deceleratingClass:{up:"kinetic-decelerating-up",down:"kinetic-decelerating-down",left:"kinetic-decelerating-left",right:"kinetic-decelerating-right"}},i.prototype.start=function(t){this.settings=e.extend(this.settings,t),this.velocity=t.velocity||this.velocity,this.velocityY=t.velocityY||this.velocityY,this.settings.decelerate=!1,this._move()},i.prototype.end=function(){this.settings.decelerate=!0},i.prototype.stop=function(){this.velocity=0,this.velocityY=0,this.settings.decelerate=!0,e.isFunction(this.settings.stopped)&&this.settings.stopped.call(this)},i.prototype.detach=function(){this._detachListeners(),this.$el.removeClass(t).css("cursor","")},i.prototype.attach=function(){this.$el.hasClass(t)||(this._attachListeners(this.$el),this.$el.addClass(t).css("cursor",this.settings.cursor))},i.prototype._initElements=function(){this.$el.addClass(t),e.extend(this,{xpos:null,prevXPos:!1,ypos:null,prevYPos:!1,mouseDown:!1,throttleTimeout:1e3/this.settings.throttleFPS,lastMove:null,elementFocused:null}),this.velocity=0,this.velocityY=0,e(document).mouseup(e.proxy(this._resetMouse,this)).click(e.proxy(this._resetMouse,this)),this._initEvents(),this.$el.css("cursor",this.settings.cursor),this.settings.triggerHardware&&this.$el.css({"-webkit-transform":"translate3d(0,0,0)","-webkit-perspective":"1000","-webkit-backface-visibility":"hidden"})},i.prototype._initEvents=function(){var t=this;this.settings.events={touchStart:function(e){var i;t._useTarget(e.target,e)&&(i=e.originalEvent.touches[0],t.threshold=t._threshold(e.target,e),t._start(i.clientX,i.clientY),e.stopPropagation())},touchMove:function(e){var i;t.mouseDown&&(i=e.originalEvent.touches[0],t._inputmove(i.clientX,i.clientY),e.preventDefault&&e.preventDefault())},inputDown:function(e){t._useTarget(e.target,e)&&(t.threshold=t._threshold(e.target,e),t._start(e.clientX,e.clientY),t.elementFocused=e.target,"IMG"===e.target.nodeName&&e.preventDefault(),e.stopPropagation())},inputEnd:function(e){t._useTarget(e.target,e)&&(t._end(),t.elementFocused=null,e.preventDefault&&e.preventDefault())},inputMove:function(e){t.mouseDown&&(t._inputmove(e.clientX,e.clientY),e.preventDefault&&e.preventDefault())},scroll:function(i){e.isFunction(t.settings.moved)&&t.settings.moved.call(t,t.settings),i.preventDefault&&i.preventDefault()},inputClick:function(e){return Math.abs(t.velocity)>0?(e.preventDefault(),!1):void 0},dragStart:function(e){return(!t._useTarget(e.target,e)||!t.elementFocused)&&void 0},selectStart:function(i){return e.isFunction(t.settings.selectStart)?t.settings.selectStart.apply(t,arguments):!t._useTarget(i.target,i)&&void 0}},this._attachListeners(this.$el,this.settings)},i.prototype._inputmove=function(t,i){var r=this.$el;if(this.el,(!this.lastMove||new Date>new Date(this.lastMove.getTime()+this.throttleTimeout))&&(this.lastMove=new Date,this.mouseDown&&(this.xpos||this.ypos))){var n=t-this.xpos,a=i-this.ypos;if(this.settings.invert&&(n*=-1,a*=-1),this.threshold>0){var o=Math.sqrt(n*n+a*a);if(this.threshold>o)return;this.threshold=0}this.elementFocused&&(e(this.elementFocused).blur(),this.elementFocused=null,r.focus()),this.settings.decelerate=!1,this.velocity=this.velocityY=0;var s=this.scrollLeft(),h=this.scrollTop();this.scrollLeft(this.settings.x?s-n:s),this.scrollTop(this.settings.y?h-a:h),this.prevXPos=this.xpos,this.prevYPos=this.ypos,this.xpos=t,this.ypos=i,this._calculateVelocities(),this._setMoveClasses(this.settings.movingClass),e.isFunction(this.settings.moved)&&this.settings.moved.call(this,this.settings)}},i.prototype._calculateVelocities=function(){this.velocity=this._capVelocity(this.prevXPos-this.xpos,this.settings.maxvelocity),this.velocityY=this._capVelocity(this.prevYPos-this.ypos,this.settings.maxvelocity),this.settings.invert&&(this.velocity*=-1,this.velocityY*=-1)},i.prototype._end=function(){this.xpos&&this.prevXPos&&!1===this.settings.decelerate&&(this.settings.decelerate=!0,this._calculateVelocities(),this.xpos=this.prevXPos=this.mouseDown=!1,this._move())},i.prototype._useTarget=function(t,i){return!e.isFunction(this.settings.filterTarget)||!1!==this.settings.filterTarget.call(this,t,i)},i.prototype._threshold=function(t,i){return e.isFunction(this.settings.threshold)?this.settings.threshold.call(this,t,i):this.settings.threshold},i.prototype._start=function(e,t){this.mouseDown=!0,this.velocity=this.prevXPos=0,this.velocityY=this.prevYPos=0,this.xpos=e,this.ypos=t},i.prototype._resetMouse=function(){this.xpos=!1,this.ypos=!1,this.mouseDown=!1},i.prototype._decelerateVelocity=function(e,t){return 0===Math.floor(Math.abs(e))?0:e*t},i.prototype._capVelocity=function(e,t){var i=e;return e>0?e>t&&(i=t):0-t>e&&(i=0-t),i},i.prototype._setMoveClasses=function(e){var t=this.settings,i=this.$el;i.removeClass(t.movingClass.up).removeClass(t.movingClass.down).removeClass(t.movingClass.left).removeClass(t.movingClass.right).removeClass(t.deceleratingClass.up).removeClass(t.deceleratingClass.down).removeClass(t.deceleratingClass.left).removeClass(t.deceleratingClass.right),this.velocity>0&&i.addClass(e.right),this.velocity<0&&i.addClass(e.left),this.velocityY>0&&i.addClass(e.down),this.velocityY<0&&i.addClass(e.up)},i.prototype._move=function(){var t=this._getScroller()[0],i=this,r=i.settings;r.x&&t.scrollWidth>0?(this.scrollLeft(this.scrollLeft()+this.velocity),Math.abs(this.velocity)>0&&(this.velocity=r.decelerate?i._decelerateVelocity(this.velocity,r.slowdown):this.velocity)):this.velocity=0,r.y&&t.scrollHeight>0?(this.scrollTop(this.scrollTop()+this.velocityY),Math.abs(this.velocityY)>0&&(this.velocityY=r.decelerate?i._decelerateVelocity(this.velocityY,r.slowdown):this.velocityY)):this.velocityY=0,i._setMoveClasses(r.deceleratingClass),e.isFunction(r.moved)&&r.moved.call(this,r),Math.abs(this.velocity)>0||Math.abs(this.velocityY)>0?this.moving||(this.moving=!0,window.requestAnimationFrame((function(){i.moving=!1,i._move()}))):i.stop()},i.prototype._getScroller=function(){var t=this.$el;return(this.$el.is("body")||this.$el.is("html"))&&(t=e(window)),t},i.prototype.scrollLeft=function(e){var t=this._getScroller();return"number"!=typeof e?t.scrollLeft():(t.scrollLeft(e),void(this.settings.scrollLeft=e))},i.prototype.scrollTop=function(e){var t=this._getScroller();return"number"!=typeof e?t.scrollTop():(t.scrollTop(e),void(this.settings.scrollTop=e))},i.prototype._attachListeners=function(){var t=this.$el,i=this.settings;e.support.touch&&t.bind("touchstart",i.events.touchStart).bind("touchend",i.events.inputEnd).bind("touchmove",i.events.touchMove),t.mousedown(i.events.inputDown).mouseup(i.events.inputEnd).mousemove(i.events.inputMove),t.click(i.events.inputClick).scroll(i.events.scroll).bind("selectstart",i.events.selectStart).bind("dragstart",i.events.dragStart)},i.prototype._detachListeners=function(){var t=this.$el,i=this.settings;e.support.touch&&t.unbind("touchstart",i.events.touchStart).unbind("touchend",i.events.inputEnd).unbind("touchmove",i.events.touchMove),t.unbind("mousedown",i.events.inputDown).unbind("mouseup",i.events.inputEnd).unbind("mousemove",i.events.inputMove),t.unbind("click",i.events.inputClick).unbind("scroll",i.events.scroll).unbind("selectstart",i.events.selectStart).unbind("dragstart",i.events.dragStart)},e.Kinetic=i,e.fn.kinetic=function(t,r){return this.each((function(){var n=e(this),a=n.data(i.DATA_KEY),o=e.extend({},i.DEFAULTS,n.data(),"object"==typeof t&&t);a||n.data(i.DATA_KEY,a=new i(this,o)),"string"==typeof t&&a[t](r)}))}}(window.jQuery||window.Zepto);