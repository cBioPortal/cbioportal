name: genie-performance-test

on:
  schedule:
    - cron:  '*/1 * * * *'

jobs:
  probe-genie-endpoint:
    name: Genie private endpoint probe

    runs-on: ubuntu-latest

    steps:
    - name: GET request to genie private page
      env:
        GENIE_PRIVATE_SECRET: ${{ secrets.GENIE_PRIVATE_SECRET }}
        MAX_WAIT_TIME_IN_SECONDS: 2.0
        URL: "https://genie.cbioportal.org/api/studies/genie_public"
        OK_RESPONSE_CODE: 200
      # GET request to URL with a MAX_WAIT_TIME_IN_SECONDS second limit
      #   if curl fails, automatically exit with curl's non-zero exit code
      #   else if we did not get a OK_RESPONSE_CODE exit with a non-zero exit code
      #   else we are OK!
      run: |
        curl --max-time $MAX_WAIT_TIME_IN_SECONDS -I -H "Authorization:Bearer $GENIE_PRIVATE_SECRET" "$URL" -H "accept:application/json" > curl.out
        RESPONSE_CODE=`head -1 curl.out | cut -d" " -f2`
        if [ "$RESPONSE_CODE" != "$OK_RESPONSE_CODE" ]; then
          echo "Request failed with response code '$RESPONSE_CODE', expected '$OK_RESPONSE_CODE'"
          exit 1
        else
          echo "Request succeeded with expected response code '$OK_RESPONSE_CODE'"
          exit 0
        fi
